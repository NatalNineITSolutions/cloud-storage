{"version":3,"file":"drive-routes-45d138fc.js","sources":["../../../node_modules/@tanstack/query-core/build/modern/infiniteQueryObserver.js","../../../node_modules/@tanstack/react-query/build/modern/useInfiniteQuery.js","../../../resources/client/drive/shareable-link/shareable-link-page/link-page-store.ts","../../../resources/client/drive/shareable-link/queries/use-shareable-link-page.ts","../../../resources/client/drive/shareable-link/shareable-link-page/queries/check-link-password.ts","../../../resources/client/drive/shareable-link/shareable-link-page/queries/import-into-own-drive.ts","../../../resources/client/drive/shareable-link/shareable-link-page/shareable-link-page-action-buttons.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/shareable-link-navbar.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/password-page.tsx","../../../resources/client/drive/file-view/file-grid/base-file-grid-item.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview-file-grid.tsx","../../../resources/client/drive/shareable-link/queries/create-shareable-link.ts","../../../resources/client/drive/files/queries/use-add-star-to-entries.ts","../../../resources/client/drive/files/queries/use-remove-star-from-entries.ts","../../../resources/client/drive/files/queries/use-duplicate-entries.ts","../../../resources/client/drive/files/queries/use-delete-entries.ts","../../../resources/client/drive/share-dialog/queries/use-unshare-entries.ts","../../../resources/client/drive/files/queries/use-restore-entries.ts","../../../resources/client/drive/entry-actions/use-entry-actions.ts","../../../resources/client/drive/entry-actions/use-drive-page-actions.ts","../../../resources/client/drive/entry-actions/entry-action-menu-trigger.tsx","../../../resources/client/drive/file-view/file-table/file-table-columns.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview-file-table.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/use-navigate-to-subfolder.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview-file-view.tsx","../../../common/resources/client/ui/layout/dashboard-content-header.tsx","../../../resources/client/drive/files/queries/use-folder-path.ts","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview-breadcrumb.tsx","../../../resources/client/drive/layout/sorting/available-sorts.ts","../../../resources/client/drive/layout/sorting/entries-sort-button.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview-header.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/folder-preview/folder-preview.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/shareable-link-page-file-preview.tsx","../../../resources/client/drive/shareable-link/shareable-link-page/shareable-link-page.tsx","../../../common/resources/client/workspace/requests/create-workspace.ts","../../../common/resources/client/workspace/new-workspace-dialog.tsx","../../../common/resources/client/workspace/requests/workspace-with-members.ts","../../../common/resources/client/workspace/requests/invite-members.ts","../../../common/resources/client/workspace/requests/resend-invite.ts","../../../common/resources/client/utils/string/is-email.ts","../../../common/resources/client/workspace/requests/change-role.ts","../../../common/resources/client/workspace/requests/remove-member.ts","../../../common/resources/client/workspace/leave-workspace-confirmation.tsx","../../../common/resources/client/workspace/workspace-members-dialog.tsx","../../../common/resources/client/workspace/requests/update-workspace.ts","../../../common/resources/client/workspace/rename-workspace-dialog.tsx","../../../common/resources/client/workspace/requests/delete-workspace.ts","../../../common/resources/client/workspace/workspace-selector.tsx","../../../resources/client/drive/menu-positions.ts","../../../node_modules/performant-array-to-tree/build/arrayToTree.min.js","../../../resources/client/drive/files/queries/use-folders.ts","../../../resources/client/drive/files/queries/use-move-entries.ts","../../../resources/client/drive/files/utils/can-move-entries-into.ts","../../../resources/client/drive/files/use-folder-drop-action.ts","../../../resources/client/drive/layout/sidebar/folder-tree-drag-id.ts","../../../resources/client/drive/layout/sidebar/use-sidebar-tree-drop-target.ts","../../../common/resources/client/ui/tree/tree-context.tsx","../../../common/resources/client/ui/tree/render-tree.ts","../../../common/resources/client/ui/tree/tree-label.tsx","../../../common/resources/client/ui/tree/tree-item.tsx","../../../common/resources/client/ui/tree/tree.tsx","../../../resources/client/drive/layout/sidebar/folder-tree.tsx","../../../resources/client/drive/layout/sidebar/sidebar-menu.tsx","../../../resources/client/drive/layout/sidebar/sidebar.tsx","../../../resources/client/drive/files/queries/use-paginated-entries.ts","../../../resources/client/drive/search/drive-search-filters.ts","../../../resources/client/drive/search/search-filter-list.tsx","../../../common/resources/client/ui/interactions/utils/restrict-resizable-within-boundary.ts","../../../common/resources/client/ui/interactions/dnd/mouse-selection/use-mouse-selectable.ts","../../../common/resources/client/ui/interactions/utils/rects-intersect.ts","../../../common/resources/client/ui/interactions/dnd/mouse-selection/use-mouse-selection-box.ts","../../../resources/client/drive/files/queries/use-entries.ts","../../../resources/client/drive/files/use-selected-entries.ts","../../../resources/client/drive/entry-actions/entry-action-list.tsx","../../../resources/client/drive/files/drive-context-menu.tsx","../../../common/resources/client/utils/hooks/is-touch-device.ts","../../../resources/client/drive/file-view/use-file-view-dnd.ts","../../../resources/client/drive/file-view/file-table/file-table-row.tsx","../../../resources/client/drive/file-view/use-view-item-action-handler.ts","../../../resources/client/drive/file-view/file-table/file-table.tsx","../../../resources/client/drive/file-view/file-grid/file-grid-item.tsx","../../../resources/client/drive/file-view/file-grid/file-grid.tsx","../../../resources/client/drive/layout/sorting/drive-sort-button.tsx","../../../resources/client/drive/page-breadcrumbs.tsx","../../../common/resources/client/ui/infinite-scroll/infinite-scroll-sentinel.tsx","../../../resources/client/drive/drop-target-mask.tsx","../../../resources/client/drive/file-view/file-view.tsx","../../../resources/client/drive/uploading/upload-queue-item.tsx","../../../resources/client/drive/uploading/upload-queue.tsx","../../../resources/client/drive/details-sidebar/detailed-examination.svg","../../../resources/client/drive/details-sidebar/details-sidebar-header.tsx","../../../resources/client/drive/details-sidebar/details-sidebar-section-header.tsx","../../../resources/client/drive/details-sidebar/requests/use-sync-entry-tags.ts","../../../resources/client/drive/details-sidebar/requests/use-file-entry-tags.ts","../../../resources/client/drive/details-sidebar/details-sidebar-tags.tsx","../../../resources/client/drive/details-sidebar/details-sidebar-properties.tsx","../../../resources/client/drive/details-sidebar/details-sidebar.tsx","../../../resources/client/drive/files/queries/use-rename-entry.ts","../../../resources/client/drive/files/dialogs/rename-entry-dialog.tsx","../../../resources/client/drive/files/queries/create-folder.ts","../../../resources/client/drive/files/dialogs/new-folder-dialog.tsx","../../../resources/client/drive/files/dialogs/entry-preview-dialog.tsx","../../../resources/client/drive/share-dialog/queries/use-share-entry.ts","../../../resources/client/drive/files/drive-entry.ts","../../../resources/client/drive/share-dialog/permission-selector.tsx","../../../resources/client/drive/share-dialog/queries/use-change-permission.ts","../../../common/resources/client/ui/images/user-avatar.tsx","../../../resources/client/drive/share-dialog/member-list.tsx","../../../resources/client/drive/share-dialog/share-panel.tsx","../../../resources/client/drive/shareable-link/queries/use-entry-shareable-link.ts","../../../resources/client/drive/shareable-link/queries/use-delete-shareable-link.ts","../../../common/resources/client/utils/string/random-string.ts","../../../resources/client/drive/share-dialog/link-panel/shareable-link-panel.tsx","../../../resources/client/drive/shareable-link/queries/use-update-shareable-link.ts","../../../resources/client/drive/share-dialog/link-panel/link-settings-dialog.tsx","../../../resources/client/drive/share-dialog/share-dialog.tsx","../../../common/resources/client/ui/forms/combobox/combobox.tsx","../../../resources/client/drive/files/dialogs/move-entries-dialog/move-entries-dialog-search.tsx","../../../resources/client/drive/files/dialogs/move-entries-dialog/move-entries-dialog-breadcrumbs.tsx","../../../resources/client/drive/files/dialogs/move-entries-dialog/my-files.svg","../../../resources/client/drive/files/dialogs/move-entries-dialog/move-entries-dialog-folder-list.tsx","../../../resources/client/drive/files/dialogs/move-entries-dialog/move-entries-dialog.tsx","../../../resources/client/drive/files/dialogs/delete-entries-forever-dialog.tsx","../../../resources/client/drive/files/dialogs/block-trash-folder-view-dialog.tsx","../../../resources/client/drive/files/dialogs/drive-dialogs-container.tsx","../../../common/resources/client/ui/interactions/dnd/use-drag-monitor.ts","../../../resources/client/drive/file-view/entry-drag-preview.tsx","../../../resources/client/drive/layout/drive-content-header.tsx","../../../resources/client/drive/layout/drive-layout.tsx","../../../resources/client/drive/layout/workspace-content-header.tsx","../../../resources/client/drive/layout/workspace-layout.tsx","../../../resources/client/drive/drive-routes.tsx"],"sourcesContent":["// src/infiniteQueryObserver.ts\nimport { QueryObserver } from \"./queryObserver.js\";\nimport {\n  hasNextPage,\n  hasPreviousPage,\n  infiniteQueryBehavior\n} from \"./infiniteQueryBehavior.js\";\nvar InfiniteQueryObserver = class extends QueryObserver {\n  // eslint-disable-next-line @typescript-eslint/no-useless-constructor\n  constructor(client, options) {\n    super(client, options);\n  }\n  bindMethods() {\n    super.bindMethods();\n    this.fetchNextPage = this.fetchNextPage.bind(this);\n    this.fetchPreviousPage = this.fetchPreviousPage.bind(this);\n  }\n  setOptions(options, notifyOptions) {\n    super.setOptions(\n      {\n        ...options,\n        behavior: infiniteQueryBehavior()\n      },\n      notifyOptions\n    );\n  }\n  getOptimisticResult(options) {\n    options.behavior = infiniteQueryBehavior();\n    return super.getOptimisticResult(options);\n  }\n  fetchNextPage(options) {\n    return this.fetch({\n      ...options,\n      meta: {\n        fetchMore: { direction: \"forward\" }\n      }\n    });\n  }\n  fetchPreviousPage(options) {\n    return this.fetch({\n      ...options,\n      meta: {\n        fetchMore: { direction: \"backward\" }\n      }\n    });\n  }\n  createResult(query, options) {\n    const { state } = query;\n    const result = super.createResult(query, options);\n    const { isFetching, isRefetching } = result;\n    const isFetchingNextPage = isFetching && state.fetchMeta?.fetchMore?.direction === \"forward\";\n    const isFetchingPreviousPage = isFetching && state.fetchMeta?.fetchMore?.direction === \"backward\";\n    return {\n      ...result,\n      fetchNextPage: this.fetchNextPage,\n      fetchPreviousPage: this.fetchPreviousPage,\n      hasNextPage: hasNextPage(options, state.data),\n      hasPreviousPage: hasPreviousPage(options, state.data),\n      isFetchingNextPage,\n      isFetchingPreviousPage,\n      isRefetching: isRefetching && !isFetchingNextPage && !isFetchingPreviousPage\n    };\n  }\n};\nexport {\n  InfiniteQueryObserver\n};\n//# sourceMappingURL=infiniteQueryObserver.js.map","\"use client\";\n\n// src/useInfiniteQuery.ts\nimport { InfiniteQueryObserver } from \"@tanstack/query-core\";\nimport { useBaseQuery } from \"./useBaseQuery.js\";\nfunction useInfiniteQuery(options, queryClient) {\n  return useBaseQuery(\n    options,\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n    InfiniteQueryObserver,\n    queryClient\n  );\n}\nexport {\n  useInfiniteQuery\n};\n//# sourceMappingURL=useInfiniteQuery.js.map","import {create} from 'zustand';\r\nimport {immer} from 'zustand/middleware/immer';\r\nimport {DriveSortDescriptor} from '../../drive-store';\r\nimport {\r\n  getFromLocalStorage,\r\n  setInLocalStorage,\r\n} from '@common/utils/hooks/local-storage';\r\n\r\ninterface LinkPageState {\r\n  password: string | null;\r\n  setPassword: (value: string) => void;\r\n  isPasswordProtected: boolean;\r\n  setIsPasswordProtected: (value: boolean) => void;\r\n  activeSort: DriveSortDescriptor;\r\n  setActiveSort: (value: DriveSortDescriptor) => void;\r\n  viewMode: 'grid' | 'list';\r\n  setViewMode: (mode: 'grid' | 'list') => void;\r\n}\r\n\r\nexport const useLinkPageStore = create<LinkPageState>()(\r\n  immer(set => ({\r\n    password: null,\r\n    viewMode: getFromLocalStorage<'list' | 'grid'>('drive.viewMode'),\r\n    activeSort: {\r\n      orderBy: 'updated_at',\r\n      orderDir: 'desc',\r\n    },\r\n    setPassword: value => {\r\n      set(state => {\r\n        state.password = value;\r\n      });\r\n    },\r\n    isPasswordProtected: false,\r\n    setIsPasswordProtected: value => {\r\n      set(state => {\r\n        state.isPasswordProtected = value;\r\n      });\r\n    },\r\n\r\n    setViewMode: mode => {\r\n      set(state => {\r\n        state.viewMode = mode;\r\n        setInLocalStorage('drive.viewMode', mode);\r\n      });\r\n    },\r\n    setActiveSort: value => {\r\n      set(state => {\r\n        state.activeSort = value;\r\n      });\r\n    },\r\n  }))\r\n);\r\n\r\nexport function linkPageState() {\r\n  return useLinkPageStore.getState();\r\n}\r\n","import {keepPreviousData, useInfiniteQuery} from '@tanstack/react-query';\r\nimport {useParams} from 'react-router-dom';\r\nimport type {FetchShareableLinkResponse} from './use-entry-shareable-link';\r\nimport type {DriveEntry} from '../../files/drive-entry';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {\r\n  linkPageState,\r\n  useLinkPageStore,\r\n} from '../shareable-link-page/link-page-store';\r\nimport {LengthAwarePaginationResponse} from '@common/http/backend-response/pagination-response';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {getBootstrapData} from '@common/core/bootstrap-data/use-backend-bootstrap-data';\r\n\r\nexport interface FetchShareableLinkPageResponse\r\n  extends FetchShareableLinkResponse {\r\n  folderChildren: LengthAwarePaginationResponse<DriveEntry>;\r\n  passwordInvalid: boolean;\r\n}\r\n\r\nexport function useShareableLinkPage() {\r\n  const {hash} = useParams();\r\n  const {orderBy, orderDir} = useLinkPageStore(s => s.activeSort);\r\n  const order = `${orderBy}:${orderDir}`;\r\n  const isPasswordProtected = useLinkPageStore(s => s.isPasswordProtected);\r\n  const password = useLinkPageStore(s => s.password);\r\n\r\n  const query = useInfiniteQuery({\r\n    queryKey: DriveQueryKeys.fetchShareableLink({hash, sort: order}),\r\n    queryFn: async ({pageParam = 1}) => {\r\n      const response = await fetchLinkByHash({\r\n        hash: hash!,\r\n        page: pageParam,\r\n        order,\r\n        password,\r\n      });\r\n      if (response.passwordInvalid) {\r\n        linkPageState().setIsPasswordProtected(true);\r\n      }\r\n      return response;\r\n    },\r\n    initialData: () => {\r\n      const data = getBootstrapData().loaders?.shareableLinkPage;\r\n      if (data && data.link?.hash === hash) {\r\n        if (data.passwordInvalid) {\r\n          linkPageState().setIsPasswordProtected(true);\r\n        }\r\n        return {\r\n          pageParams: [undefined, 1],\r\n          pages: [data],\r\n        };\r\n      }\r\n    },\r\n    initialPageParam: 1,\r\n    getNextPageParam: lastResponse => {\r\n      if (!lastResponse.folderChildren) return undefined;\r\n      const currentPage = lastResponse.folderChildren.current_page;\r\n      const lastPage = lastResponse.folderChildren.last_page;\r\n      if (currentPage >= lastPage) {\r\n        return undefined;\r\n      }\r\n      return currentPage + 1;\r\n    },\r\n    // disable query if link is password protected and correct\r\n    // password was not entered yet, to prevent unnecessary requests\r\n    enabled: (!!hash && !isPasswordProtected) || password != null,\r\n    placeholderData: keepPreviousData,\r\n  });\r\n\r\n  return {\r\n    ...query,\r\n    link: query.data?.pages[0].link,\r\n    entries: query.data?.pages.flatMap(p => p.folderChildren?.data),\r\n  };\r\n}\r\n\r\ninterface FetchLinkByHashParams {\r\n  hash: string;\r\n  page?: number;\r\n  order?: string;\r\n  password?: string | null;\r\n}\r\nfunction fetchLinkByHash({\r\n  hash,\r\n  page = 1,\r\n  order,\r\n  password,\r\n}: FetchLinkByHashParams): Promise<FetchShareableLinkPageResponse> {\r\n  return apiClient\r\n    .get(`shareable-links/${hash}`, {\r\n      params: {loader: 'shareableLinkPage', page, order, password},\r\n    })\r\n    .then(response => response.data);\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {linkPageState} from '../link-page-store';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\nimport {message} from '@common/i18n/message';\r\n\r\ninterface Response extends BackendResponse {\r\n  matches: boolean;\r\n}\r\n\r\ninterface Props {\r\n  password: string;\r\n  linkHash: string;\r\n}\r\n\r\nfunction checkLinkPassword({password, linkHash}: Props): Promise<Response> {\r\n  return apiClient\r\n    .post(`shareable-links/${linkHash}/check-password`, {password})\r\n    .then(r => r.data);\r\n}\r\n\r\nexport function useCheckLinkPassword() {\r\n  return useMutation({\r\n    mutationFn: (props: Props) => checkLinkPassword(props),\r\n    onSuccess: (response, props) => {\r\n      if (response.matches) {\r\n        linkPageState().setPassword(props.password);\r\n      }\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not create link')),\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveEntryUser} from '../../../files/drive-entry';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {useLinkPageStore} from '../link-page-store';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {DriveQueryKeys} from '../../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  users: DriveEntryUser[];\r\n}\r\n\r\ninterface Props {\r\n  password: string | null;\r\n  linkId: number;\r\n}\r\n\r\nfunction importIntoOwnDrive({linkId, password}: Props): Promise<Response> {\r\n  return apiClient\r\n    .post(`shareable-links/${linkId}/import`, {password})\r\n    .then(r => r.data);\r\n}\r\n\r\nexport function useImportIntoOwnDrive() {\r\n  const password = useLinkPageStore(s => s.password);\r\n  return useMutation({\r\n    mutationFn: (props: Omit<Props, 'password'>) =>\r\n      importIntoOwnDrive({...props, password}),\r\n    onSuccess: async () => {\r\n      await queryClient.invalidateQueries({\r\n        queryKey: DriveQueryKeys.fetchShareableLink(),\r\n      });\r\n      toast(message('Item imported into your drive'));\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not create link')),\r\n  });\r\n}\r\n","import {useShareableLinkPage} from '../queries/use-shareable-link-page';\r\nimport {useAuth} from '@common/auth/use-auth';\r\nimport {useFileEntryUrls} from '@common/uploads/hooks/file-entry-urls';\r\nimport {useImportIntoOwnDrive} from './queries/import-into-own-drive';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {FileDownloadIcon} from '@common/icons/material/FileDownload';\r\nimport {downloadFileFromUrl} from '@common/uploads/utils/download-file-from-url';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {\r\n  Menu,\r\n  MenuItem,\r\n  MenuTrigger,\r\n} from '@common/ui/navigation/menu/menu-trigger';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {KeyboardArrowDownIcon} from '@common/icons/material/KeyboardArrowDown';\r\nimport {ImportExportIcon} from '@common/icons/material/ImportExport';\r\nimport React, {Fragment} from 'react';\r\nimport {Tooltip} from '@common/ui/tooltip/tooltip';\r\n\r\nexport function ShareableLinkPageActionButtons() {\r\n  const {link} = useShareableLinkPage();\r\n  const {user, isLoggedIn} = useAuth();\r\n  const {downloadUrl} = useFileEntryUrls(link?.entry);\r\n  const importIntoOwnDrive = useImportIntoOwnDrive();\r\n  const alreadyImported = link?.entry?.users!.find(u => u.id === user?.id);\r\n\r\n  if (!link?.entry) return null;\r\n\r\n  return (\r\n    <div>\r\n      {link.allow_download && <DownloadButton downloadUrl={downloadUrl} />}\r\n      {!alreadyImported && isLoggedIn && link.allow_edit && (\r\n        <MenuTrigger\r\n          onItemSelected={key => {\r\n            if (key === 'import') {\r\n              importIntoOwnDrive.mutate({linkId: link.id});\r\n            } else if (key === 'download') {\r\n              if (downloadUrl) {\r\n                downloadFileFromUrl(downloadUrl);\r\n              }\r\n            }\r\n          }}\r\n        >\r\n          <IconButton className=\"ml-6\" disabled={importIntoOwnDrive.isPending}>\r\n            <KeyboardArrowDownIcon />\r\n          </IconButton>\r\n          <Menu>\r\n            <MenuItem value=\"download\" startIcon={<FileDownloadIcon />}>\r\n              <Trans message=\"Download\" />\r\n            </MenuItem>\r\n            <MenuItem value=\"import\" startIcon={<ImportExportIcon />}>\r\n              <Trans message=\"Save a copy to your own drive\" />\r\n            </MenuItem>\r\n          </Menu>\r\n        </MenuTrigger>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface DownloadButtonProps {\r\n  downloadUrl: string | undefined;\r\n}\r\nfunction DownloadButton({downloadUrl}: DownloadButtonProps) {\r\n  return (\r\n    <Fragment>\r\n      <Tooltip label={<Trans message=\"Download\" />}>\r\n        <IconButton\r\n          className=\"md:hidden\"\r\n          onClick={() => {\r\n            if (downloadUrl) {\r\n              downloadFileFromUrl(downloadUrl);\r\n            }\r\n          }}\r\n        >\r\n          <FileDownloadIcon />\r\n        </IconButton>\r\n      </Tooltip>\r\n      <Button\r\n        className=\"max-md:hidden\"\r\n        size=\"sm\"\r\n        variant=\"flat\"\r\n        color=\"chip\"\r\n        startIcon={<FileDownloadIcon />}\r\n        onClick={() => {\r\n          if (downloadUrl) {\r\n            downloadFileFromUrl(downloadUrl);\r\n          }\r\n        }}\r\n      >\r\n        <Trans message=\"Download\" />\r\n      </Button>\r\n    </Fragment>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {FileTypeIcon} from '@common/uploads/file-type-icon/file-type-icon';\r\nimport {Navbar} from '@common/ui/navigation/navbar/navbar';\r\nimport {useShareableLinkPage} from '../queries/use-shareable-link-page';\r\nimport {ShareableLinkPageActionButtons} from './shareable-link-page-action-buttons';\r\nimport {useIsMobileMediaQuery} from '@common/utils/hooks/is-mobile-media-query';\r\n\r\nexport function ShareableLinkNavbar() {\r\n  const {link} = useShareableLinkPage();\r\n  const isMobile = useIsMobileMediaQuery();\r\n  return (\r\n    <Navbar\r\n      size=\"md\"\r\n      color=\"bg\"\r\n      className=\"flex-shrink-0\"\r\n      rightChildren={link?.entry && <ShareableLinkPageActionButtons />}\r\n      menuPosition=\"shareable-link-page\"\r\n      hideLogo={isMobile}\r\n    >\r\n      {link?.entry && link.entry.type !== 'folder' && (\r\n        <div className=\"fex-auto flex min-w-0 items-center gap-10\">\r\n          <FileTypeIcon className=\"flex-shrink-0\" type={link.entry.type} />\r\n          <div className=\"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium\">\r\n            {link.entry.name}\r\n          </div>\r\n        </div>\r\n      )}\r\n    </Navbar>\r\n  );\r\n}\r\n","import {useState} from 'react';\r\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\r\nimport {TextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {useCheckLinkPassword} from './queries/check-link-password';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {ShareableLinkNavbar} from './shareable-link-navbar';\r\nimport {useParams} from 'react-router-dom';\r\nimport secureFilesSvg from '@common/auth/ui/account-settings/access-token-panel/secure-files.svg';\r\n\r\nexport function PasswordPage() {\r\n  const {trans} = useTrans();\r\n  const {hash} = useParams();\r\n  const fieldLabel = trans({message: 'Password'});\r\n  const [password, setPassword] = useState<string>('');\r\n  const checkPassword = useCheckLinkPassword();\r\n  const linkHash = hash ? hash.split(':')[0] : null;\r\n\r\n  const passwordIsInvalid = checkPassword.data && !checkPassword.data.matches;\r\n\r\n  return (\r\n    <div className=\"flex h-screen flex-col bg-alt\">\r\n      <ShareableLinkNavbar />\r\n      <div className=\"mx-auto my-80 px-10 md:px-20\">\r\n        <div className=\"flex max-w-[560px] flex-col items-center gap-40 rounded border bg p-24 md:flex-row md:gap-14\">\r\n          <div className=\"h-132 w-[165px]\">\r\n            <SvgImage src={secureFilesSvg} />\r\n          </div>\r\n          <form\r\n            onSubmit={e => {\r\n              e.preventDefault();\r\n              checkPassword.mutate({\r\n                linkHash: linkHash!,\r\n                password,\r\n              });\r\n            }}\r\n          >\r\n            <span className=\"text-sm\">\r\n              <Trans message=\"The link you are trying to access is password protected.\" />\r\n            </span>\r\n            <TextField\r\n              autoFocus\r\n              placeholder={fieldLabel}\r\n              aria-label={fieldLabel}\r\n              className=\"mb-20 mt-10\"\r\n              type=\"password\"\r\n              value={password}\r\n              required\r\n              errorMessage={\r\n                passwordIsInvalid && <Trans message=\"Password is not valid\" />\r\n              }\r\n              onChange={e => {\r\n                setPassword(e.target.value);\r\n              }}\r\n            />\r\n            <div className=\"text-right\">\r\n              <Button\r\n                variant=\"flat\"\r\n                color=\"primary\"\r\n                type=\"submit\"\r\n                className=\"w-full md:w-auto\"\r\n                disabled={checkPassword.isPending}\r\n              >\r\n                <Trans message=\"Enter\" />\r\n              </Button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React, {ComponentPropsWithoutRef, ReactNode} from 'react';\r\nimport clsx from 'clsx';\r\nimport {FileThumbnail} from '@common/uploads/file-type-icon/file-thumbnail';\r\nimport {DriveEntry} from '../../files/drive-entry';\r\n\r\ninterface BaseFileGridItemProps extends ComponentPropsWithoutRef<'div'> {\r\n  entry: DriveEntry;\r\n  className?: string;\r\n  isSelected?: boolean;\r\n  isMobileMode?: boolean;\r\n  footerAdornment?: ReactNode;\r\n}\r\n\r\nexport const BaseFileGridItem = React.forwardRef<\r\n  HTMLDivElement,\r\n  BaseFileGridItemProps\r\n>(\r\n  (\r\n    {entry, className, isSelected, isMobileMode, footerAdornment, ...domProps},\r\n    ref\r\n  ) => {\r\n    return (\r\n      <div\r\n        {...domProps}\r\n        ref={ref}\r\n        className={clsx(\r\n          'shadow rounded border aspect-square flex flex-col grid-item transition-shadow-opacity select-none overflow-hidden outline-none dark:bg-alt',\r\n          isSelected && 'border-primary',\r\n          className\r\n        )}\r\n      >\r\n        <div className=\"flex-auto relative min-h-0\">\r\n          <FileThumbnail\r\n            className=\"h-full w-full\"\r\n            iconClassName=\"block w-70 h-70 absolute m-auto inset-0\"\r\n            file={entry}\r\n          />\r\n        </div>\r\n        <Footer\r\n          entry={entry}\r\n          isSelected={isSelected}\r\n          isMobile={isMobileMode}\r\n          adornment={footerAdornment}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n);\r\n\r\ninterface FooterProps {\r\n  entry: DriveEntry;\r\n  isSelected?: boolean;\r\n  isMobile?: boolean;\r\n  adornment?: ReactNode;\r\n}\r\nfunction Footer({entry, isSelected, isMobile, adornment}: FooterProps) {\r\n  return (\r\n    <div\r\n      className={clsx(\r\n        'text-sm h-48 flex-shrink-0 flex items-center',\r\n        isMobile ? 'justify-between gap-10 pl-18 pr-2' : 'justify-center px-16',\r\n        // isSelected && 'bg-primary-light/20'\r\n      )}\r\n    >\r\n      <div className=\"min-w-0 whitespace-nowrap overflow-hidden overflow-ellipsis\">\r\n        {entry.name}\r\n      </div>\r\n      {adornment}\r\n    </div>\r\n  );\r\n}\r\n","import {BaseFileGridItem} from '../../../file-view/file-grid/base-file-grid-item';\r\nimport React from 'react';\r\nimport {DriveEntry} from '../../../files/drive-entry';\r\n\r\nexport interface FolderPreviewGridProps {\r\n  entries: DriveEntry[];\r\n  onEntrySelected: (entry: DriveEntry, index: number) => void;\r\n}\r\nexport function FolderPreviewFileGrid({\r\n  entries,\r\n  onEntrySelected,\r\n}: FolderPreviewGridProps) {\r\n  return (\r\n    <div className=\"file-grid\">\r\n      {entries.map((entry, index) => (\r\n        <BaseFileGridItem\r\n          tabIndex={-1}\r\n          className=\"hover:shadow-md cursor-pointer bg\"\r\n          entry={entry}\r\n          key={entry.id}\r\n          onContextMenu={e => {\r\n            e.preventDefault();\r\n          }}\r\n          onKeyDown={e => {\r\n            if (e.key === 'Enter' || e.key === ' ') {\r\n              onEntrySelected(entry, index);\r\n            }\r\n          }}\r\n          onClick={() => {\r\n            onEntrySelected(entry, index);\r\n          }}\r\n        />\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {FetchShareableLinkResponse} from './use-entry-shareable-link';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\nfunction createShareableLink(\r\n  entryId?: number | null,\r\n): Promise<FetchShareableLinkResponse> {\r\n  if (!entryId) {\r\n    return Promise.reject(new Error('Invalid entry id'));\r\n  }\r\n  return apiClient\r\n    .post(`file-entries/${entryId}/shareable-link`)\r\n    .then(response => response.data);\r\n}\r\n\r\ninterface Payload {\r\n  entryId: number;\r\n}\r\nexport function useCreateShareableLink() {\r\n  return useMutation({\r\n    mutationFn: ({entryId}: Payload) => createShareableLink(entryId),\r\n    onSuccess: (data, {entryId}) => {\r\n      queryClient.setQueryData<FetchShareableLinkResponse>(\r\n        DriveQueryKeys.fetchEntryShareableLink(entryId),\r\n        data,\r\n      );\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not create link')),\r\n  });\r\n}\r\n","import {apiClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {Tag} from '@common/tags/tag';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {useMutation} from '@tanstack/react-query';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  tag: Tag;\r\n}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n}\r\n\r\nfunction addStarToEntries({entryIds}: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post('file-entries/star', {entryIds})\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useAddStarToEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => addStarToEntries(payload),\r\n    onSuccess: (data, {entryIds}) => {\r\n      invalidateEntryQueries();\r\n      toast(\r\n        message('Starred [one 1 item|other :count items]', {\r\n          values: {count: entryIds.length},\r\n        }),\r\n      );\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not star items')),\r\n  });\r\n}\r\n","import {apiClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {Tag} from '@common/tags/tag';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {useMutation} from '@tanstack/react-query';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  tag: Tag;\r\n}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n}\r\n\r\nfunction removeStarFromEntries({entryIds}: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post('file-entries/unstar', {entryIds})\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useRemoveStarFromEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => removeStarFromEntries(payload),\r\n    onSuccess: (data, {entryIds}) => {\r\n      invalidateEntryQueries();\r\n      toast(\r\n        message('Removed star from [one 1 item|other :count items]', {\r\n          values: {count: entryIds.length},\r\n        }),\r\n      );\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not remove star')),\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveEntry} from '../drive-entry';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {DriveQueryKeys, invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  entries: DriveEntry[];\r\n}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n  destinationId?: number;\r\n}\r\n\r\nfunction duplicateEntries(payload: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post('file-entries/duplicate', payload)\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useDuplicateEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => {\r\n      toast.loading(\r\n        message('Duplicating [one 1 item|other :count items]...', {\r\n          values: {\r\n            count: payload.entryIds.length,\r\n          },\r\n        }),\r\n        {disableExitAnimation: true},\r\n      );\r\n      return duplicateEntries(payload);\r\n    },\r\n    onSuccess: (r, p) => {\r\n      invalidateEntryQueries();\r\n      queryClient.invalidateQueries({\r\n        queryKey: DriveQueryKeys.fetchStorageSummary,\r\n      });\r\n      toast(\r\n        message('Duplicated [one 1 item|other :count items]', {\r\n          values: {count: p.entryIds.length},\r\n        }),\r\n        {disableEnterAnimation: true},\r\n      );\r\n    },\r\n    onError: err =>\r\n      showHttpErrorToast(err, message('Could not duplicate items'), null, {\r\n        disableEnterAnimation: true,\r\n      }),\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {DriveQueryKeys, invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {getAxiosErrorMessage} from '@common/utils/http/get-axios-error-message';\r\nimport {MessageDescriptor} from '@common/i18n/message-descriptor';\r\n\r\ninterface Response extends BackendResponse {}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n  emptyTrash?: boolean;\r\n  deleteForever?: boolean;\r\n}\r\n\r\nfunction deleteEntries(payload: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post('file-entries/delete', payload)\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useDeleteEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => {\r\n      toast.loading(getLoaderMessage(payload), {disableExitAnimation: true});\r\n      return deleteEntries(payload);\r\n    },\r\n    onSuccess: (r, {entryIds, emptyTrash, deleteForever}) => {\r\n      invalidateEntryQueries();\r\n      queryClient.invalidateQueries({\r\n        queryKey: DriveQueryKeys.fetchStorageSummary,\r\n      });\r\n      if (emptyTrash) {\r\n        toast(message('Emptied trash'), {disableEnterAnimation: true});\r\n      } else if (deleteForever) {\r\n        toast(\r\n          message('Permanently deleted [one 1 item|other :count items]', {\r\n            values: {count: entryIds.length},\r\n          }),\r\n          {disableEnterAnimation: true},\r\n        );\r\n      } else {\r\n        toast(\r\n          message('Moved [one 1 item|other :count items] to trash', {\r\n            values: {count: entryIds.length},\r\n          }),\r\n          {disableEnterAnimation: true},\r\n        );\r\n      }\r\n    },\r\n    onError: (err, {emptyTrash}) => {\r\n      const backendError = getAxiosErrorMessage(err);\r\n      if (backendError) {\r\n        toast.danger(backendError, {disableEnterAnimation: true});\r\n      } else if (emptyTrash) {\r\n        toast.danger('could not empty trash', {disableEnterAnimation: true});\r\n      } else {\r\n        toast.danger('Could not delete items', {disableEnterAnimation: true});\r\n      }\r\n    },\r\n  });\r\n}\r\n\r\nfunction getLoaderMessage(payload: Payload): MessageDescriptor {\r\n  if (payload.emptyTrash) {\r\n    return message('Emptying trash...');\r\n  } else if (payload.deleteForever) {\r\n    return message('Deleting files...');\r\n  } else {\r\n    return message('Moving to trash...');\r\n  }\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveEntryUser} from '../../files/drive-entry';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\n\r\ninterface Response extends BackendResponse {\r\n  users: DriveEntryUser[];\r\n}\r\n\r\ninterface Payload {\r\n  userId: number | 'me';\r\n  entryIds: number[];\r\n}\r\n\r\nexport function useUnshareEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => unshareEntries(payload),\r\n    onSuccess: () => {\r\n      return invalidateEntryQueries();\r\n    },\r\n  });\r\n}\r\n\r\nfunction unshareEntries({entryIds, ...payload}: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post(`file-entries/${entryIds.join(',')}/unshare`, payload)\r\n    .then(response => response.data);\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n}\r\n\r\nexport function useRestoreEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => restoreEntries(payload),\r\n    onSuccess: (r, p) => {\r\n      invalidateEntryQueries();\r\n      toast(\r\n        message('Restored [one 1 item|other :count items]', {\r\n          values: {count: p.entryIds.length},\r\n        }),\r\n      );\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not restore items')),\r\n  });\r\n}\r\n\r\nfunction restoreEntries(payload: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post('file-entries/restore', payload)\r\n    .then(response => response.data);\r\n}\r\n","import {message} from '@common/i18n/message';\r\nimport {PersonAddIcon} from '@common/icons/material/PersonAdd';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {EntryAction} from './entry-action';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {RemoveRedEyeIcon} from '@common/icons/material/RemoveRedEye';\r\nimport {LinkIcon} from '@common/icons/material/Link';\r\nimport {useCreateShareableLink} from '../shareable-link/queries/create-shareable-link';\r\nimport {StarIcon} from '@common/icons/material/Star';\r\nimport {useAddStarToEntries} from '../files/queries/use-add-star-to-entries';\r\nimport {StarOutlineIcon} from '@common/icons/material/StarOutline';\r\nimport {useRemoveStarFromEntries} from '../files/queries/use-remove-star-from-entries';\r\nimport {DriveFileMoveIcon} from '@common/icons/material/DriveFileMove';\r\nimport {DriveFileRenameOutlineIcon} from '@common/icons/material/DriveFileRenameOutline';\r\nimport {ContentCopyIcon} from '@common/icons/material/ContentCopy';\r\nimport {useDuplicateEntries} from '../files/queries/use-duplicate-entries';\r\nimport {FileDownloadIcon} from '@common/icons/material/FileDownload';\r\nimport {DeleteIcon} from '@common/icons/material/Delete';\r\nimport {SharesPage, TrashPage} from '../drive-page/drive-page';\r\nimport {useDeleteEntries} from '../files/queries/use-delete-entries';\r\nimport {useUnshareEntries} from '../share-dialog/queries/use-unshare-entries';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\nimport {useFileEntryUrls} from '@common/uploads/hooks/file-entry-urls';\r\nimport {downloadFileFromUrl} from '@common/uploads/utils/download-file-from-url';\r\nimport {useRestoreEntries} from '../files/queries/use-restore-entries';\r\nimport {RestoreIcon} from '@common/icons/material/Restore';\r\n\r\nexport function useEntryActions(entries: DriveEntry[]): EntryAction[] {\r\n  const preview = usePreviewAction(entries);\r\n  const share = useShareAction(entries);\r\n  const getLink = useGetLinkAction(entries);\r\n  const addStar = useAddToStarredAction(entries);\r\n  const removeStar = useRemoveFromStarred(entries);\r\n  const moveTo = useMoveToAction(entries);\r\n  const rename = useRenameAction(entries);\r\n  const makeCopy = useMakeCopyAction(entries);\r\n  const download = useDownloadEntriesAction(entries);\r\n  const deleteAction = useDeleteEntriesAction(entries);\r\n  const removeSharedEntries = useRemoveSharedEntriesAction(entries);\r\n  const restoreEntries = useRestoreEntriesAction(entries);\r\n\r\n  return [\r\n    preview,\r\n    share,\r\n    getLink,\r\n    addStar,\r\n    removeStar,\r\n    moveTo,\r\n    rename,\r\n    makeCopy,\r\n    download,\r\n    deleteAction,\r\n    removeSharedEntries,\r\n    restoreEntries,\r\n  ].filter(action => !!action) as EntryAction[];\r\n}\r\n\r\nexport function usePreviewAction(\r\n  entries: DriveEntry[]\r\n): EntryAction | undefined {\r\n  if (!entries.some(e => e.type !== 'folder')) return;\r\n  return {\r\n    label: message('Preview'),\r\n    icon: RemoveRedEyeIcon,\r\n    key: 'preview',\r\n    execute: () => {\r\n      driveState().setActiveActionDialog('preview', entries);\r\n    },\r\n  };\r\n}\r\n\r\nexport function useShareAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (\r\n    entries.length > 1 ||\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === TrashPage\r\n  )\r\n    return;\r\n    return {\r\n      label: message('Share'),\r\n      icon: PersonAddIcon,\r\n      key: 'share',\r\n      execute: () => {\r\n        driveState().setActiveActionDialog('share', entries);\r\n      },\r\n    };\r\n  \r\n}\r\n\r\n\r\nfunction useGetLinkAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const createLink = useCreateShareableLink();\r\n  if (\r\n    entries.length > 1 ||\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === TrashPage\r\n  ) {\r\n    return;\r\n  }\r\n  return {\r\n    label: message('Get link'),\r\n    icon: LinkIcon,\r\n    key: 'getLink',\r\n    execute: () => {\r\n      createLink.mutate({entryId: entries[0].id});\r\n      driveState().setActiveActionDialog('getLink', entries);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useAddToStarredAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const starEntries = useAddStarToEntries();\r\n  if (\r\n    entries.every(e => e.tags?.find(tag => tag.name === 'starred')) ||\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === TrashPage\r\n  ) {\r\n    return;\r\n  }\r\n  return {\r\n    label: message('Add to starred'),\r\n    icon: StarIcon,\r\n    key: 'addToStarred',\r\n    execute: () => {\r\n      starEntries.mutate({entryIds: entries.map(e => e.id)});\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useRemoveFromStarred(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const removeStar = useRemoveStarFromEntries();\r\n  if (\r\n    !entries.every(e => e.tags?.find(tag => tag.name === 'starred')) ||\r\n    activePage === TrashPage\r\n  )\r\n    return;\r\n  return {\r\n    label: message('Remove from starred'),\r\n    icon: StarOutlineIcon,\r\n    key: 'removeFromStarred',\r\n    execute: () => {\r\n      removeStar.mutate({entryIds: entries.map(e => e.id)});\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useMoveToAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === SharesPage ||\r\n    activePage === TrashPage\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  return {\r\n    label: message('Move to'),\r\n    icon: DriveFileMoveIcon,\r\n    key: 'moveTo',\r\n    execute: () => {\r\n      driveState().setActiveActionDialog('moveTo', entries);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useRenameAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (\r\n    entries.length > 1 ||\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === TrashPage\r\n  )\r\n    return;\r\n  return {\r\n    label: message('Rename'),\r\n    icon: DriveFileRenameOutlineIcon,\r\n    key: 'rename',\r\n    execute: () => {\r\n      driveState().setActiveActionDialog('rename', entries);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useMakeCopyAction(entries: DriveEntry[]): EntryAction | undefined {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const duplicateEntries = useDuplicateEntries();\r\n  if (\r\n    entries.length > 1 ||\r\n    !entries.every(e => e.permissions['files.update']) ||\r\n    activePage === TrashPage\r\n  )\r\n    return;\r\n  return {\r\n    label: message('Make a copy'),\r\n    icon: ContentCopyIcon,\r\n    key: 'makeCopy',\r\n    execute: () => {\r\n      duplicateEntries.mutate({entryIds: entries.map(e => e.id)});\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n\r\nfunction useDownloadEntriesAction(\r\n  entries: DriveEntry[]\r\n): EntryAction | undefined {\r\n  const {downloadUrl} = useFileEntryUrls(entries[0], {\r\n    downloadHashes: entries.map(e => e.hash),\r\n  });\r\n  if (!entries.every(e => e.permissions['files.download'])) return;\r\n  return {\r\n    label: message('Download'),\r\n    icon: FileDownloadIcon,\r\n    key: 'download',\r\n    execute: () => {\r\n      if (downloadUrl) {\r\n        downloadFileFromUrl(downloadUrl);\r\n      }\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n\r\nexport function useDeleteEntriesAction(\r\n  entries: DriveEntry[]\r\n): EntryAction | undefined {\r\n  const deleteEntries = useDeleteEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (\r\n    activePage === SharesPage ||\r\n    !entries.every(e => e.permissions['files.delete'])\r\n  )\r\n    return;\r\n  return {\r\n    label:\r\n      activePage === TrashPage ? message('Delete forever') : message('Remove'),\r\n    icon: DeleteIcon,\r\n    key: 'delete',\r\n    execute: () => {\r\n      if (activePage === TrashPage) {\r\n        driveState().setActiveActionDialog('confirmAndDeleteForever', entries);\r\n      } else {\r\n        deleteEntries.mutate({\r\n          entryIds: entries.map(e => e.id),\r\n          deleteForever: activePage === TrashPage,\r\n        });\r\n        driveState().selectEntries([]);\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport function useRestoreEntriesAction(\r\n  entries: DriveEntry[]\r\n): EntryAction | undefined {\r\n  const restoreEntries = useRestoreEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (\r\n    activePage !== TrashPage ||\r\n    !entries.every(e => e.permissions['files.delete'])\r\n  )\r\n    return;\r\n  return {\r\n    label: message('Restore'),\r\n    icon: RestoreIcon,\r\n    key: 'restore',\r\n    execute: () => {\r\n      restoreEntries.mutate({\r\n        entryIds: entries.map(e => e.id),\r\n      });\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n\r\nexport function useRemoveSharedEntriesAction(\r\n  entries: DriveEntry[]\r\n): EntryAction | undefined {\r\n  const unshareEntries = useUnshareEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (activePage !== SharesPage) return;\r\n  return {\r\n    label: message('Remove'),\r\n    icon: DeleteIcon,\r\n    key: 'removeSharedEntry',\r\n    execute: () => {\r\n      unshareEntries.mutate(\r\n        {entryIds: entries.map(e => e.id), userId: 'me'},\r\n        {\r\n          onSuccess: (r, p) => {\r\n            toast(\r\n              message('Removed [one 1 item|other {count} items]', {\r\n                values: {count: p.entryIds.length},\r\n              })\r\n            );\r\n          },\r\n          onError: err =>\r\n            showHttpErrorToast(err, message('Could not remove items')),\r\n        }\r\n      );\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n","import {EntryAction} from './entry-action';\r\nimport {message} from '@common/i18n/message';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {DrivePage, TrashPage} from '../drive-page/drive-page';\r\nimport {CreateNewFolderIcon} from '@common/icons/material/CreateNewFolder';\r\nimport {useDriveUploadQueue} from '../uploading/use-drive-upload-queue';\r\nimport {openUploadWindow} from '@common/uploads/utils/open-upload-window';\r\nimport {FileUploadIcon} from '@common/icons/material/FileUpload';\r\nimport {DriveFolderUploadIcon} from '@common/icons/material/DriveFolderUpload';\r\nimport {useDeleteEntries} from '../files/queries/use-delete-entries';\r\nimport {DeleteForeverIcon} from '@common/icons/material/DeleteForever';\r\n\r\nexport function useDrivePageActions(page: DrivePage): EntryAction[] {\r\n  const newFolder = useNewFolderAction(page);\r\n  const uploadFiles = useUploadFilesAction(page);\r\n  const uploadFolder = useUploadFolderAction(page);\r\n  const emptyTrash = useEmptyTrashAction(page);\r\n  return [newFolder, uploadFiles, uploadFolder, emptyTrash].filter(\r\n    action => !!action\r\n  ) as EntryAction[];\r\n}\r\n\r\nfunction useNewFolderAction(page: DrivePage): EntryAction | undefined {\r\n  if (!page.folder || !page.folder.permissions['files.update']) return;\r\n  return {\r\n    label: message('New folder'),\r\n    icon: CreateNewFolderIcon,\r\n    key: 'newFolder',\r\n    execute: () => {\r\n      if (page.folder) {\r\n        driveState().setActiveActionDialog('newFolder', [page.folder]);\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nfunction useUploadFilesAction(page: DrivePage): EntryAction | undefined {\r\n  const {uploadFiles} = useDriveUploadQueue();\r\n  if (!page.folder || !page.folder.permissions['files.update']) return;\r\n  return {\r\n    label: message('Upload files'),\r\n    icon: FileUploadIcon,\r\n    key: 'uploadFiles',\r\n    execute: async () => {\r\n      uploadFiles(await openUploadWindow({multiple: true}));\r\n    },\r\n  };\r\n}\r\n\r\nfunction useUploadFolderAction(page: DrivePage): EntryAction | undefined {\r\n  const {uploadFiles} = useDriveUploadQueue();\r\n  if (!page.folder || !page.folder.permissions['files.update']) return;\r\n  return {\r\n    label: message('Upload folder'),\r\n    icon: DriveFolderUploadIcon,\r\n    key: 'uploadFolder',\r\n    execute: async () => {\r\n      uploadFiles(await openUploadWindow({directory: true}));\r\n    },\r\n  };\r\n}\r\n\r\nfunction useEmptyTrashAction(page: DrivePage): EntryAction | undefined {\r\n  const deleteEntries = useDeleteEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  if (activePage !== TrashPage) return;\r\n  return {\r\n    label: message('Empty trash'),\r\n    icon: DeleteForeverIcon,\r\n    key: 'emptyTrash',\r\n    execute: () => {\r\n      deleteEntries.mutate({entryIds: [], emptyTrash: true});\r\n      driveState().selectEntries([]);\r\n    },\r\n  };\r\n}\r\n","import React, {createElement, ReactElement} from 'react';\r\nimport {\r\n  Menu,\r\n  MenuItem,\r\n  MenuTrigger,\r\n} from '@common/ui/navigation/menu/menu-trigger';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {useEntryActions} from './use-entry-actions';\r\nimport {EntryAction} from './entry-action';\r\nimport {DrivePage, RootFolderPage, TrashPage} from '../drive-page/drive-page';\r\nimport {useDrivePageActions} from './use-drive-page-actions';\r\n\r\ninterface Props {\r\n  children: ReactElement;\r\n  entries?: DriveEntry[];\r\n  page?: DrivePage;\r\n}\r\nexport function EntryActionMenuTrigger({children, entries, page}: Props) {\r\n  if (page?.id === RootFolderPage.id) {\r\n    return <PageMenu page={RootFolderPage}>{children}</PageMenu>;\r\n  }\r\n\r\n  if (page === TrashPage) {\r\n    return <PageMenu page={TrashPage}>{children}</PageMenu>;\r\n  }\r\n\r\n  if (page?.folder) {\r\n    return <EntriesMenu entries={[page.folder]}>{children}</EntriesMenu>;\r\n  }\r\n\r\n  if (entries?.length) {\r\n    return <EntriesMenu entries={entries}>{children}</EntriesMenu>;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\ninterface EntriesContextMenuProps extends Omit<BaseMenuProps, 'actions'> {\r\n  entries: DriveEntry[];\r\n}\r\nfunction EntriesMenu({entries, children}: EntriesContextMenuProps) {\r\n  const actions = useEntryActions(entries);\r\n  return <BaseMenu actions={actions}>{children}</BaseMenu>;\r\n}\r\n\r\ninterface PageContextMenuProps extends Omit<BaseMenuProps, 'actions'> {\r\n  page: DrivePage;\r\n}\r\nfunction PageMenu({page, children}: PageContextMenuProps) {\r\n  const actions = useDrivePageActions(page);\r\n  return <BaseMenu actions={actions}>{children}</BaseMenu>;\r\n}\r\n\r\ninterface BaseMenuProps {\r\n  actions: EntryAction[];\r\n  children: ReactElement;\r\n}\r\nfunction BaseMenu({actions, children}: BaseMenuProps) {\r\n  return (\r\n    <MenuTrigger>\r\n      {children}\r\n      <Menu>\r\n        {actions.map(action => {\r\n          return (\r\n            <MenuItem\r\n              onSelected={() => {\r\n                action.execute();\r\n              }}\r\n              key={action.key}\r\n              value={action.key}\r\n              startIcon={createElement(action.icon)}\r\n            >\r\n              <Trans {...action.label} />\r\n            </MenuItem>\r\n          );\r\n        })}\r\n      </Menu>\r\n    </MenuTrigger>\r\n  );\r\n}\r\n","import {ColumnConfig} from '@common/datatable/column-config';\r\nimport {DriveEntry} from '../../files/drive-entry';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {FileThumbnail} from '@common/uploads/file-type-icon/file-thumbnail';\r\nimport {FormattedDate} from '@common/i18n/formatted-date';\r\nimport {prettyBytes} from '@common/uploads/utils/pretty-bytes';\r\nimport React, {useContext} from 'react';\r\nimport memoize from 'nano-memoize';\r\nimport {TableContext} from '@common/ui/tables/table-context';\r\nimport {Checkbox} from '@common/ui/forms/toggle/checkbox';\r\nimport {EntryActionMenuTrigger} from '@app/drive/entry-actions/entry-action-menu-trigger';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {MoreVertIcon} from '@common/icons/material/MoreVert';\r\nimport clsx from 'clsx';\r\n\r\nconst formatFileSize = memoize(bytes => {\r\n  return prettyBytes(bytes);\r\n});\r\n\r\nexport const fileTableColumns: ColumnConfig<DriveEntry>[] = [\r\n  {\r\n    key: 'name',\r\n    allowsSorting: true,\r\n    header: () => <Trans message=\"Name\" />,\r\n    visibleInMode: 'all',\r\n    width: 'flex-3 min-w-200',\r\n    body: entry => <FileNameColumn entry={entry} />,\r\n  },\r\n  {\r\n    key: 'updated_at',\r\n    allowsSorting: true,\r\n    maxWidth: 'max-w-184',\r\n    header: () => <Trans message=\"Last modified\" />,\r\n    body: user => <FormattedDate date={user.updated_at} />,\r\n  },\r\n  {\r\n    key: 'file_size',\r\n    allowsSorting: true,\r\n    header: () => <Trans message=\"Size\" />,\r\n    maxWidth: 'max-w-144',\r\n    body: entry => formatFileSize(entry.file_size) ?? '-',\r\n  },\r\n  {\r\n    key: 'actions',\r\n    hideHeader: true,\r\n    header: () => <Trans message=\"Actions\" />,\r\n    align: 'end',\r\n    width: 'w-42 flex-shrink-0',\r\n    visibleInMode: 'all',\r\n    body: entry => <ActionsColumn entry={entry} />,\r\n  },\r\n];\r\n\r\nfunction FileNameColumn({entry}: {entry: DriveEntry}) {\r\n  const {isCollapsedMode} = useContext(TableContext);\r\n  const sizeClassName = isCollapsedMode ? 'w-30 h-30' : 'w-24 h-24';\r\n  return (\r\n    <div className=\"flex items-center gap-14\">\r\n      <FileThumbnail\r\n        className={clsx('rounded', sizeClassName)}\r\n        iconClassName={sizeClassName}\r\n        file={entry}\r\n      />\r\n      <div className=\"min-w-0\">\r\n        <div className=\"overflow-hidden overflow-ellipsis\">{entry.name}</div>\r\n        {isCollapsedMode && (\r\n          <div className=\"text-muted text-xs flex items-center mt-4\">\r\n            <FormattedDate date={entry.updated_at} />\r\n            <div></div>\r\n            <div>{formatFileSize(entry.file_size)}</div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface ActionsBodyProps {\r\n  entry: DriveEntry;\r\n}\r\nfunction ActionsColumn({entry}: ActionsBodyProps) {\r\n  const {selectedRows} = useContext(TableContext);\r\n  return selectedRows.length ? (\r\n    <Checkbox\r\n      className=\"block mr-8\"\r\n      checked={selectedRows.includes(entry.id)}\r\n    />\r\n  ) : (\r\n    <EntryActionMenuTrigger entries={[entry]}>\r\n      <IconButton className=\"text-muted\">\r\n        <MoreVertIcon />\r\n      </IconButton>\r\n    </EntryActionMenuTrigger>\r\n  );\r\n}\r\n","import {useIsMobileMediaQuery} from '@common/utils/hooks/is-mobile-media-query';\r\nimport {DriveSortDescriptor} from '../../../drive-store';\r\nimport React from 'react';\r\nimport {Table} from '@common/ui/tables/table';\r\nimport {linkPageState, useLinkPageStore} from '../link-page-store';\r\nimport type {FolderPreviewGridProps} from './folder-preview-file-grid';\r\nimport {fileTableColumns} from '../../../file-view/file-table/file-table-columns';\r\n\r\nconst mobileColumns = fileTableColumns.filter(\r\n  config => config.key !== 'updated_at'\r\n);\r\n\r\nexport function FolderPreviewFileTable({\r\n  entries,\r\n  onEntrySelected,\r\n}: FolderPreviewGridProps) {\r\n  const sortDescriptor = useLinkPageStore(s => s.activeSort);\r\n  const isMobile = useIsMobileMediaQuery();\r\n\r\n  return (\r\n    <Table\r\n      columns={isMobile ? mobileColumns : fileTableColumns}\r\n      data={entries}\r\n      sortDescriptor={sortDescriptor}\r\n      onSortChange={value => {\r\n        linkPageState().setActiveSort(value as DriveSortDescriptor);\r\n      }}\r\n      onAction={(item, index) => {\r\n        onEntrySelected(item, index);\r\n      }}\r\n      enableSelection={false}\r\n    />\r\n  );\r\n}\r\n","import {useShareableLinkPage} from '../../queries/use-shareable-link-page';\r\nimport {useNavigate} from 'react-router-dom';\r\nimport {ShareableLink} from '../../shareable-link';\r\n\r\nfunction buildFolderHash(link: ShareableLink, folderHash?: string) {\r\n  let hash = link.hash;\r\n  if (folderHash && link.entry?.hash !== folderHash) {\r\n    hash = `${hash}:${folderHash}`;\r\n  }\r\n  return hash;\r\n}\r\n\r\nexport function useNavigateToSubfolder() {\r\n  const {link} = useShareableLinkPage();\r\n  const navigate = useNavigate();\r\n  return (hash: string) => {\r\n    if (!link) return;\r\n    navigate(`/drive/s/${buildFolderHash(link, hash)}`);\r\n  };\r\n}\r\n","import {AnimatePresence, m} from 'framer-motion';\r\nimport React, {useEffect, useRef, useState} from 'react';\r\nimport {ProgressCircle} from '@common/ui/progress/progress-circle';\r\nimport {useShareableLinkPage} from '../../queries/use-shareable-link-page';\r\nimport {FilePreviewDialog} from '@common/uploads/preview/file-preview-dialog';\r\nimport {DialogTrigger} from '@common/ui/overlays/dialog/dialog-trigger';\r\nimport clsx from 'clsx';\r\nimport {DriveEntry} from '../../../files/drive-entry';\r\nimport {FolderPreviewFileGrid} from './folder-preview-file-grid';\r\nimport {useLinkPageStore} from '../link-page-store';\r\nimport {FolderPreviewFileTable} from './folder-preview-file-table';\r\nimport {useNavigateToSubfolder} from './use-navigate-to-subfolder';\r\nimport {useLocation} from 'react-router-dom';\r\nimport {opacityAnimation} from '@common/ui/animation/opacity-animation';\r\nimport {AdHost} from '@common/admin/ads/ad-host';\r\n\r\ninterface FolderPreviewChildrenProps {\r\n  className?: string;\r\n}\r\nexport function FolderPreviewFileView({className}: FolderPreviewChildrenProps) {\r\n  const {pathname} = useLocation();\r\n  const navigateToSubfolder = useNavigateToSubfolder();\r\n  const [activePreviewIndex, setActivePreviewIndex] = useState<number>();\r\n  const viewMode = useLinkPageStore(s => s.viewMode);\r\n  const sentinelRef = useRef<HTMLDivElement>(null);\r\n  const {\r\n    link,\r\n    entries,\r\n    isFetchingNextPage,\r\n    hasNextPage,\r\n    fetchNextPage,\r\n    isPlaceholderData,\r\n  } = useShareableLinkPage();\r\n\r\n  // close preview modal on back/forward navigation\r\n  useEffect(() => {\r\n    setActivePreviewIndex(undefined);\r\n  }, [pathname]);\r\n\r\n  useEffect(() => {\r\n    const sentinelEl = sentinelRef.current;\r\n    if (!sentinelEl) return;\r\n    const observer = new IntersectionObserver(([entry]) => {\r\n      if (entry.isIntersecting && hasNextPage) {\r\n        fetchNextPage();\r\n      }\r\n    });\r\n    observer.observe(sentinelEl);\r\n    return () => {\r\n      observer.unobserve(sentinelEl);\r\n    };\r\n  }, [hasNextPage, fetchNextPage]);\r\n\r\n  if (!link || isPlaceholderData) {\r\n    return (\r\n      <div className={clsx('flex justify-center', className)}>\r\n        <ProgressCircle isIndeterminate />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const handlePreview = (entry: DriveEntry, index: number) => {\r\n    if (entry.type === 'folder') {\r\n      navigateToSubfolder(entry.hash);\r\n    } else {\r\n      setActivePreviewIndex(index);\r\n    }\r\n  };\r\n\r\n  const folderEntries = entries || [];\r\n\r\n  return (\r\n    <>\r\n      <div\r\n        className={clsx(\r\n          'file-grid-container flex-auto overflow-auto px-14 pb-14 md:px-24 md:pb-24',\r\n          className,\r\n        )}\r\n      >\r\n        <AdHost slot=\"file-preview\" className=\"mb-40\" />\r\n        {viewMode === 'grid' ? (\r\n          <FolderPreviewFileGrid\r\n            entries={folderEntries}\r\n            onEntrySelected={handlePreview}\r\n          />\r\n        ) : (\r\n          <FolderPreviewFileTable\r\n            entries={folderEntries}\r\n            onEntrySelected={handlePreview}\r\n          />\r\n        )}\r\n        <span ref={sentinelRef} aria-hidden />\r\n        <AnimatePresence>\r\n          {isFetchingNextPage && (\r\n            <m.div\r\n              className=\"mt-24 flex w-full justify-center\"\r\n              {...opacityAnimation}\r\n            >\r\n              <ProgressCircle isIndeterminate aria-label=\"loading\" />\r\n            </m.div>\r\n          )}\r\n        </AnimatePresence>\r\n      </div>\r\n      <DialogTrigger\r\n        type=\"modal\"\r\n        isOpen={activePreviewIndex != undefined}\r\n        onClose={() => setActivePreviewIndex(undefined)}\r\n      >\r\n        <FilePreviewDialog\r\n          entries={folderEntries}\r\n          defaultActiveIndex={activePreviewIndex}\r\n          allowDownload={link.allow_download}\r\n        />\r\n      </DialogTrigger>\r\n    </>\r\n  );\r\n}\r\n","import {ReactNode} from 'react';\r\nimport clsx from 'clsx';\r\n\r\ninterface DashboardContentHeaderProps {\r\n  children: ReactNode;\r\n  className?: string;\r\n}\r\nexport function DashboardContentHeader({\r\n  children,\r\n  className,\r\n}: DashboardContentHeaderProps) {\r\n  return (\r\n    <div className={clsx(className, 'dashboard-grid-header')}>{children}</div>\r\n  );\r\n}\r\n","import {useQuery} from '@tanstack/react-query';\r\nimport {DriveFolder} from '../drive-entry';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {apiClient} from '@common/http/query-client';\r\n\r\ninterface FolderPathResponse extends BackendResponse {\r\n  path: DriveFolder[];\r\n}\r\n\r\ntype Params = Record<string, string | number | null>;\r\n\r\ninterface Props {\r\n  hash?: string;\r\n  params?: Params;\r\n  isEnabled?: boolean;\r\n}\r\nexport function useFolderPath({hash, params, isEnabled = true}: Props) {\r\n  return useQuery({\r\n    queryKey: DriveQueryKeys.fetchFolderPath(hash!, params),\r\n    queryFn: () => fetchFolderPath(hash!, params),\r\n    enabled: !!hash && isEnabled,\r\n  });\r\n}\r\n\r\nfunction fetchFolderPath(\r\n  hash: string,\r\n  params?: Params,\r\n): Promise<FolderPathResponse> {\r\n  return apiClient\r\n    .get(`folders/${hash}/path`, {params})\r\n    .then(response => response.data);\r\n}\r\n","import React, {ReactElement, ReactNode} from 'react';\r\nimport clsx from 'clsx';\r\nimport {DriveFolder} from '../../../files/drive-entry';\r\nimport {useFolderPath} from '../../../files/queries/use-folder-path';\r\nimport {Breadcrumb} from '@common/ui/breadcrumbs/breadcrumb';\r\nimport {ShareableLink} from '../../shareable-link';\r\nimport {useLinkPageStore} from '../link-page-store';\r\nimport {BreadcrumbItem} from '@common/ui/breadcrumbs/breadcrumb-item';\r\nimport {useNavigateToSubfolder} from './use-navigate-to-subfolder';\r\n\r\ninterface Props {\r\n  className?: string;\r\n  folder?: DriveFolder;\r\n  link: ShareableLink;\r\n}\r\nexport function FolderPreviewBreadcrumb({className, folder, link}: Props) {\r\n  const navigateToSubfolder = useNavigateToSubfolder();\r\n  const password = useLinkPageStore(s => s.password);\r\n  const query = useFolderPath({\r\n    hash: folder?.hash,\r\n    params: {\r\n      shareable_link: link.id,\r\n      password,\r\n    },\r\n  });\r\n\r\n  let content: ReactNode;\r\n\r\n  if (query.isLoading) {\r\n    content = null;\r\n  } else {\r\n    const items: {folder: DriveFolder; label: ReactElement}[] = [];\r\n    if (query.data) {\r\n      query.data.path.forEach(parent => {\r\n        items.push({\r\n          folder: parent,\r\n          label: <>{parent.name}</>,\r\n        });\r\n      });\r\n    }\r\n\r\n    content = (\r\n      <Breadcrumb size=\"lg\" isNavigation>\r\n        {items.map(item => {\r\n          return (\r\n            <BreadcrumbItem\r\n              onSelected={() => {\r\n                navigateToSubfolder(item.folder.hash);\r\n              }}\r\n              key={item.folder.hash}\r\n            >\r\n              {item.label}\r\n            </BreadcrumbItem>\r\n          );\r\n        })}\r\n      </Breadcrumb>\r\n    );\r\n  }\r\n\r\n  return <div className={clsx('h-36 flex-shrink-0', className)}>{content}</div>;\r\n}\r\n","import {message} from '@common/i18n/message';\r\nimport {MessageDescriptor} from '@common/i18n/message-descriptor';\r\n\r\nexport const AVAILABLE_SORTS: DriveSortOption[] = [\r\n  {id: 'file_size', label: message('Size')},\r\n  {id: 'name', label: message('Name')},\r\n  {id: 'updated_at', label: message('Last modified')},\r\n  {id: 'created_at', label: message('Upload date')},\r\n  {id: 'type', label: message('Type')},\r\n  {id: 'extension', label: message('Extension')},\r\n];\r\n\r\nexport interface DriveSortOption {\r\n  id: SortColumn;\r\n  label: MessageDescriptor;\r\n}\r\n\r\nexport type SortColumn =\r\n  | 'file_size'\r\n  | 'name'\r\n  | 'updated_at'\r\n  | 'created_at'\r\n  | 'type'\r\n  | 'extension';\r\n\r\nexport type SortDirection = 'desc' | 'asc';\r\n\r\nexport interface SortValue {\r\n  column: SortColumn;\r\n  direction: SortDirection;\r\n}\r\n","import {AVAILABLE_SORTS, SortColumn} from './available-sorts';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {SortIcon} from '@common/icons/material/Sort';\r\nimport {\r\n  Menu,\r\n  MenuItem,\r\n  MenuSection,\r\n  MenuTrigger,\r\n} from '@common/ui/navigation/menu/menu-trigger';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport type {DriveSortDescriptor} from '../../drive-store';\r\n\r\ninterface Props {\r\n  descriptor: DriveSortDescriptor;\r\n  onChange: (value: DriveSortDescriptor) => void;\r\n  isDisabled?: boolean;\r\n}\r\nexport function EntriesSortButton({\r\n  descriptor,\r\n  onChange,\r\n  isDisabled = false,\r\n}: Props) {\r\n  const column = descriptor.orderBy;\r\n  const direction = descriptor.orderDir;\r\n  const sort = AVAILABLE_SORTS.find(s => s.id === column);\r\n\r\n  return (\r\n    <MenuTrigger\r\n      showCheckmark\r\n      selectionMode=\"multiple\"\r\n      selectedValue={[direction || 'desc', column || '']}\r\n      onItemSelected={key => {\r\n        if (key === 'asc' || key === 'desc') {\r\n          onChange({\r\n            orderBy: column,\r\n            orderDir: key,\r\n          });\r\n        } else {\r\n          onChange({\r\n            orderBy: key as SortColumn,\r\n            orderDir: direction,\r\n          });\r\n        }\r\n      }}\r\n    >\r\n      <Button\r\n        className=\"text-muted\"\r\n        variant=\"text\"\r\n        size=\"sm\"\r\n        startIcon={<SortIcon />}\r\n        disabled={isDisabled}\r\n      >\r\n        {sort ? <Trans {...sort.label} /> : null}\r\n      </Button>\r\n      <Menu>\r\n        <MenuSection label={<Trans message=\"Direction\" />}>\r\n          <MenuItem value=\"asc\">\r\n            <Trans message=\"Ascending\" />\r\n          </MenuItem>\r\n          <MenuItem value=\"desc\">\r\n            <Trans message=\"Descending\" />\r\n          </MenuItem>\r\n        </MenuSection>\r\n        <MenuSection label={<Trans message=\"Sort By\" />}>\r\n          {AVAILABLE_SORTS.map(item => (\r\n            <MenuItem key={item.id} value={item.id}>\r\n              <Trans {...item.label} />\r\n            </MenuItem>\r\n          ))}\r\n        </MenuSection>\r\n      </Menu>\r\n    </MenuTrigger>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {FolderPreviewBreadcrumb} from './folder-preview-breadcrumb';\r\nimport {EntriesSortButton} from '../../../layout/sorting/entries-sort-button';\r\nimport {linkPageState, useLinkPageStore} from '../link-page-store';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {GridViewIcon} from '@common/icons/material/GridView';\r\nimport {useShareableLinkPage} from '../../queries/use-shareable-link-page';\r\nimport {DriveFolder} from '../../../files/drive-entry';\r\n\r\nexport function FolderPreviewHeader() {\r\n  const activeSort = useLinkPageStore(s => s.activeSort);\r\n  const {link, isFetching} = useShareableLinkPage();\r\n  const hasEntry = link && link.entry;\r\n\r\n  return (\r\n    <div className=\"md:flex-row flex flex-col md:items-center gap-14 justify-between p-14 md:p-24 md:h-90\">\r\n      {hasEntry && (\r\n        <FolderPreviewBreadcrumb\r\n          link={link}\r\n          folder={link.entry as DriveFolder}\r\n          className=\"flex-auto\"\r\n        />\r\n      )}\r\n      {hasEntry && (\r\n        <div className=\"flex items-center justify-between md:justify-start text-muted\">\r\n          <EntriesSortButton\r\n            isDisabled={isFetching}\r\n            descriptor={activeSort}\r\n            onChange={value => {\r\n              linkPageState().setActiveSort(value);\r\n            }}\r\n          />\r\n          <div className=\"md:border-l md:pl-10 ml-10\">\r\n            <IconButton\r\n              onClick={() => {\r\n                linkPageState().setViewMode(\r\n                  linkPageState().viewMode === 'grid' ? 'list' : 'grid'\r\n                );\r\n              }}\r\n            >\r\n              <GridViewIcon />\r\n            </IconButton>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {useShareableLinkPage} from '../../queries/use-shareable-link-page';\r\nimport {IllustratedMessage} from '@common/ui/images/illustrated-message';\r\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\r\nimport {FolderPreviewFileView} from './folder-preview-file-view';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DashboardLayout} from '@common/ui/layout/dashboard-layout';\r\nimport {FileUploadProvider} from '@common/uploads/uploader/file-upload-provider';\r\nimport {DashboardContent} from '@common/ui/layout/dashboard-content';\r\nimport {DashboardNavbar} from '@common/ui/layout/dashboard-navbar';\r\nimport {DashboardContentHeader} from '@common/ui/layout/dashboard-content-header';\r\nimport {ShareableLinkPageActionButtons} from '../shareable-link-page-action-buttons';\r\nimport {FolderPreviewHeader} from './folder-preview-header';\r\nimport shareSvg from './share.svg';\r\nimport clsx from 'clsx';\r\n\r\nexport function FolderPreview() {\r\n  const {entries, isFetched} = useShareableLinkPage();\r\n  const showEmptyMessage = isFetched && !entries?.length;\r\n\r\n  return (\r\n    <DashboardLayout name=\"folder-preview\">\r\n      <DashboardNavbar\r\n        hideToggleButton\r\n        rightChildren={<ShareableLinkPageActionButtons />}\r\n        color=\"bg\"\r\n      />\r\n      <DashboardContentHeader>\r\n        <FolderPreviewHeader />\r\n      </DashboardContentHeader>\r\n      <FileUploadProvider>\r\n        <DashboardContent>\r\n          {showEmptyMessage ? <EmptyMessage /> : <FolderPreviewFileView />}\r\n        </DashboardContent>\r\n      </FileUploadProvider>\r\n    </DashboardLayout>\r\n  );\r\n}\r\n\r\ninterface EmptyMessageProps {\r\n  className?: string;\r\n}\r\nfunction EmptyMessage({className}: EmptyMessageProps) {\r\n  return (\r\n    <IllustratedMessage\r\n      className={clsx(className, 'mt-80')}\r\n      image={<SvgImage src={shareSvg} />}\r\n      title={<Trans message=\"Folder is empty\" />}\r\n      description={\r\n        <Trans message=\"No files have been uploaded to this folder yet\" />\r\n      }\r\n    />\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {FilePreviewContainer} from '@common/uploads/preview/file-preview-container';\r\nimport {useShareableLinkPage} from '../queries/use-shareable-link-page';\r\nimport {ShareableLinkNavbar} from './shareable-link-navbar';\r\nimport {AdHost} from '@common/admin/ads/ad-host';\r\n\r\nexport function ShareableLinkPageFilePreview() {\r\n  const {link} = useShareableLinkPage();\r\n\r\n  if (!link?.entry) return null;\r\n\r\n  return (\r\n    <div className=\"flex h-screen flex-col bg-alt\">\r\n      <ShareableLinkNavbar />\r\n      <AdHost slot=\"file-preview\" className=\"mx-auto mt-24\" />\r\n      <FilePreviewContainer\r\n        entries={[link.entry]}\r\n        showHeader={false}\r\n        allowDownload={link.allow_download}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import React, {ReactElement} from 'react';\r\nimport {useShareableLinkPage} from '../queries/use-shareable-link-page';\r\nimport {useLinkPageStore} from './link-page-store';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {ProgressCircle} from '@common/ui/progress/progress-circle';\r\nimport {PasswordPage} from './password-page';\r\nimport {FolderPreview} from './folder-preview/folder-preview';\r\nimport {ShareableLinkPageFilePreview} from './shareable-link-page-file-preview';\r\nimport {FileEntryUrlsContext} from '@common/uploads/hooks/file-entry-urls';\r\nimport {NotFoundPage} from '@common/ui/not-found-page/not-found-page';\r\n\r\nexport function ShareableLinkPage() {\r\n  const {status, link} = useShareableLinkPage();\r\n  const {trans} = useTrans();\r\n  const isPasswordProtected = useLinkPageStore(s => s.isPasswordProtected);\r\n  const password = useLinkPageStore(s => s.password);\r\n\r\n  let content: ReactElement;\r\n\r\n  if (status === 'pending') {\r\n    content = (\r\n      <div className=\"flex h-screen flex-auto items-center justify-center\">\r\n        <ProgressCircle\r\n          aria-label={trans({message: 'Loading link'})}\r\n          isIndeterminate\r\n        />\r\n      </div>\r\n    );\r\n  } else if (!link && !isPasswordProtected) {\r\n    return <NotFoundPage />;\r\n  } else if (isPasswordProtected && !password) {\r\n    content = <PasswordPage />;\r\n  } else if (link?.entry?.type === 'folder') {\r\n    content = <FolderPreview />;\r\n  } else {\r\n    content = <ShareableLinkPageFilePreview />;\r\n  }\r\n\r\n  return (\r\n    <FileEntryUrlsContext.Provider value={{shareable_link: link?.id, password}}>\r\n      {content}\r\n    </FileEntryUrlsContext.Provider>\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {UseFormReturn} from 'react-hook-form';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {toast} from '../../ui/toast/toast';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {Workspace} from '../types/workspace';\r\nimport {onFormQueryError} from '../../errors/on-form-query-error';\r\nimport {message} from '../../i18n/message';\r\n\r\ninterface Response extends BackendResponse {\r\n  workspace: Workspace;\r\n}\r\n\r\ninterface Props {\r\n  name: string;\r\n}\r\n\r\nexport function useCreateWorkspace(form: UseFormReturn<Props>) {\r\n  return useMutation({\r\n    mutationFn: (props: Props) => createWorkspace(props),\r\n    onSuccess: () => {\r\n      toast(message('Created workspace'));\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.fetchUserWorkspaces,\r\n      });\r\n    },\r\n    onError: r => onFormQueryError(r, form),\r\n  });\r\n}\r\n\r\nfunction createWorkspace(props: Props): Promise<Response> {\r\n  return apiClient.post('workspace', props).then(r => r.data);\r\n}\r\n","import {useForm} from 'react-hook-form';\r\nimport {FormTextField} from '../ui/forms/input-field/text-field/text-field';\r\nimport {Form} from '../ui/forms/form';\r\nimport {Button} from '../ui/buttons/button';\r\nimport {useCreateWorkspace} from './requests/create-workspace';\r\nimport {DialogFooter} from '../ui/overlays/dialog/dialog-footer';\r\nimport {useDialogContext} from '../ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '../ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '../ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '../ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '../i18n/trans';\r\n\r\nexport function NewWorkspaceDialog() {\r\n  const form = useForm<{name: string}>();\r\n  const {formId, close} = useDialogContext();\r\n  const createWorkspace = useCreateWorkspace(form);\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogHeader>\r\n        <Trans message=\"Create workspace\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <Form\r\n          form={form}\r\n          id={formId}\r\n          onSubmit={() => {\r\n            createWorkspace.mutate(form.getValues(), {\r\n              onSuccess: response => {\r\n                close(response.workspace.id);\r\n              },\r\n            });\r\n          }}\r\n        >\r\n          <FormTextField\r\n            name=\"name\"\r\n            autoFocus\r\n            label={<Trans message=\"Workspace name\" />}\r\n            minLength={3}\r\n            required\r\n          />\r\n        </Form>\r\n      </DialogBody>\r\n      <DialogFooter>\r\n        <Button variant=\"text\" onClick={close}>\r\n          <Trans message=\"Cancel\" />\r\n        </Button>\r\n        <Button\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          type=\"submit\"\r\n          form={formId}\r\n          disabled={createWorkspace.isPending}\r\n        >\r\n          <Trans message=\"Create\" />\r\n        </Button>\r\n      </DialogFooter>\r\n    </Dialog>\r\n  );\r\n}\r\n","import {useQuery} from '@tanstack/react-query';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {Workspace} from '../types/workspace';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {apiClient} from '../../http/query-client';\r\n\r\nexport interface FetchWorkspaceWithMembersResponse extends BackendResponse {\r\n  workspace: Workspace;\r\n}\r\n\r\nfunction fetchWorkspaceWithMembers(\r\n  workspaceId: number,\r\n): Promise<FetchWorkspaceWithMembersResponse> {\r\n  return apiClient\r\n    .get(`workspace/${workspaceId}`)\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useWorkspaceWithMembers(workspaceId: number) {\r\n  return useQuery({\r\n    queryKey: WorkspaceQueryKeys.workspaceWithMembers(workspaceId),\r\n    queryFn: () => fetchWorkspaceWithMembers(workspaceId),\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {WorkspaceInvite} from '../types/workspace-invite';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {showHttpErrorToast} from '../../utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  invites: WorkspaceInvite[];\r\n}\r\n\r\ninterface Props {\r\n  workspaceId: number;\r\n  emails: string[];\r\n  roleId: number;\r\n}\r\n\r\nfunction InviteMembers({workspaceId, ...other}: Props): Promise<Response> {\r\n  return apiClient\r\n    .post(`workspace/${workspaceId}/invite`, other)\r\n    .then(r => r.data);\r\n}\r\n\r\nexport function useInviteMembers() {\r\n  return useMutation({\r\n    mutationFn: (props: Props) => InviteMembers(props),\r\n    onSuccess: (response, props) => {\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.workspaceWithMembers(props.workspaceId),\r\n      });\r\n    },\r\n    onError: err => showHttpErrorToast(err),\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {WorkspaceInvite} from '../types/workspace-invite';\r\nimport {toast} from '../../ui/toast/toast';\r\nimport {apiClient} from '../../http/query-client';\r\nimport {showHttpErrorToast} from '../../utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  invite: WorkspaceInvite;\r\n}\r\n\r\ninterface Props {\r\n  workspaceId: number;\r\n  inviteId: string;\r\n}\r\n\r\nfunction ResendInvite({\r\n  workspaceId,\r\n  inviteId,\r\n  ...other\r\n}: Props): Promise<Response> {\r\n  return apiClient\r\n    .post(`workspace/${workspaceId}/${inviteId}/resend`, other)\r\n    .then(r => r.data);\r\n}\r\n\r\nexport function useResendInvite() {\r\n  return useMutation({\r\n    mutationFn: (props: Props) => ResendInvite(props),\r\n    onSuccess: () => {\r\n      toast('Invite sent');\r\n    },\r\n    onError: err => showHttpErrorToast(err),\r\n  });\r\n}\r\n","const matcher =\r\n  /^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;\r\n\r\nexport function isEmail(string?: string): boolean {\r\n  if (!string) return false;\r\n  if (string.length > 320) return false;\r\n  return matcher.test(string);\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {toast} from '../../ui/toast/toast';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {WorkspaceMember} from '../types/workspace-member';\r\nimport {WorkspaceInvite} from '../types/workspace-invite';\r\nimport {message} from '../../i18n/message';\r\nimport {showHttpErrorToast} from '../../utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {}\r\n\r\ninterface Props {\r\n  workspaceId: number;\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n  roleId: number;\r\n}\r\n\r\nfunction ChangeRole({workspaceId, member, ...other}: Props): Promise<Response> {\r\n  const modelType = member.model_type;\r\n  const memberId =\r\n    member.model_type === 'invite' ? member.id : member.member_id;\r\n  return apiClient\r\n    .post(\r\n      `workspace/${workspaceId}/${modelType}/${memberId}/change-role`,\r\n      other,\r\n    )\r\n    .then(r => r.data);\r\n}\r\n\r\nexport function useChangeRole() {\r\n  return useMutation({\r\n    mutationFn: (props: Props) => ChangeRole(props),\r\n    onSuccess: (response, props) => {\r\n      toast(message('Role changed'));\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.workspaceWithMembers(props.workspaceId),\r\n      });\r\n    },\r\n    onError: err => showHttpErrorToast(err),\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {useAuth} from '../../auth/use-auth';\r\nimport {useActiveWorkspaceId} from '../active-workspace-id-context';\r\nimport {PersonalWorkspace} from '../user-workspaces';\r\nimport {showHttpErrorToast} from '../../utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {}\r\n\r\ninterface Props {\r\n  workspaceId: number;\r\n  memberId: number | string;\r\n  memberType: 'invite' | 'member';\r\n}\r\n\r\nfunction removeMember({\r\n  workspaceId,\r\n  memberId,\r\n  memberType,\r\n}: Props): Promise<Response> {\r\n  const endpoint =\r\n    memberType === 'invite'\r\n      ? `workspace/invite/${memberId}`\r\n      : `workspace/${workspaceId}/member/${memberId}`;\r\n  return apiClient.delete(endpoint).then(r => r.data);\r\n}\r\n\r\nexport function useRemoveMember() {\r\n  const {workspaceId, setWorkspaceId} = useActiveWorkspaceId();\r\n  const {user} = useAuth();\r\n  return useMutation({\r\n    mutationFn: (props: Props) => removeMember(props),\r\n    onSuccess: (response, props) => {\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.fetchUserWorkspaces,\r\n      });\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.workspaceWithMembers(props.workspaceId),\r\n      });\r\n\r\n      // if user left workspace that is currently active, switch to personal workspace\r\n      if (props.memberId === user?.id && workspaceId === props.workspaceId) {\r\n        setWorkspaceId(PersonalWorkspace.id);\r\n      }\r\n    },\r\n    onError: err => showHttpErrorToast(err),\r\n  });\r\n}\r\n","import {ConfirmationDialog} from '../ui/overlays/dialog/confirmation-dialog';\r\nimport {Trans} from '../i18n/trans';\r\n\r\ninterface Props {\r\n  onConfirm?: () => void;\r\n  isLoading?: boolean;\r\n}\r\nexport function LeaveWorkspaceConfirmation({onConfirm, isLoading}: Props) {\r\n  return (\r\n    <ConfirmationDialog\r\n      isDanger\r\n      title={<Trans message=\"Leave workspace\" />}\r\n      isLoading={isLoading}\r\n      onConfirm={onConfirm}\r\n      body={\r\n        <div>\r\n          <Trans message=\"Are you sure you want to leave this workspace?\" />\r\n          <div className=\"mt-8 font-semibold\">\r\n            <Trans message=\"All resources you've created in the workspace will be transferred to workspace owner.\" />\r\n          </div>\r\n        </div>\r\n      }\r\n      confirm={<Trans message=\"Leave\" />}\r\n    />\r\n  );\r\n}\r\n","import {useEffect, useState} from 'react';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {useWorkspaceWithMembers} from './requests/workspace-with-members';\r\nimport {ProgressCircle} from '../ui/progress/progress-circle';\r\nimport {Workspace} from './types/workspace';\r\nimport {GroupIcon} from '../icons/material/Group';\r\nimport {WorkspaceMember} from './types/workspace-member';\r\nimport {useAuth} from '../auth/use-auth';\r\nimport {\r\n  ChipField,\r\n  ChipValue,\r\n} from '../ui/forms/input-field/chip-field/chip-field';\r\nimport {useValueLists} from '../http/value-lists';\r\nimport {Button} from '../ui/buttons/button';\r\nimport {ArrowDropDownIcon} from '../icons/material/ArrowDropDown';\r\nimport {useInviteMembers} from './requests/invite-members';\r\nimport {WorkspaceInvite} from './types/workspace-invite';\r\nimport {ConfirmationDialog} from '../ui/overlays/dialog/confirmation-dialog';\r\nimport {useResendInvite} from './requests/resend-invite';\r\nimport {isEmail} from '../utils/string/is-email';\r\nimport {ButtonSize} from '../ui/buttons/button-size';\r\nimport {useChangeRole} from './requests/change-role';\r\nimport {IconButton} from '../ui/buttons/icon-button';\r\nimport {useRemoveMember} from './requests/remove-member';\r\nimport {CloseIcon} from '../icons/material/Close';\r\nimport {ExitToAppIcon} from '../icons/material/ExitToApp';\r\nimport {toast} from '../ui/toast/toast';\r\nimport {DialogTrigger} from '../ui/overlays/dialog/dialog-trigger';\r\nimport {Menu, MenuItem, MenuTrigger} from '../ui/navigation/menu/menu-trigger';\r\nimport {useDialogContext} from '../ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '../ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '../ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '../ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '../i18n/trans';\r\nimport {useTrans} from '../i18n/use-trans';\r\nimport {message} from '../i18n/message';\r\nimport {LeaveWorkspaceConfirmation} from './leave-workspace-confirmation';\r\n\r\ninterface WorkspaceMembersDialogProps {\r\n  workspace: Workspace;\r\n}\r\nexport function WorkspaceMembersDialog({\r\n  workspace,\r\n}: WorkspaceMembersDialogProps) {\r\n  const {data, isLoading} = useWorkspaceWithMembers(workspace.id);\r\n  return (\r\n    <Dialog size=\"lg\">\r\n      <DialogHeader>\r\n        <Trans message=\"Manage workspace members\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        {isLoading ? (\r\n          <div className=\"flex items-center justify-center min-h-[238px]\">\r\n            <ProgressCircle isIndeterminate aria-label=\"Loading workspace...\" />\r\n          </div>\r\n        ) : (\r\n          <Manager workspace={data!.workspace} />\r\n        )}\r\n      </DialogBody>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\ninterface ManagerProps {\r\n  workspace: Workspace;\r\n}\r\nfunction Manager({workspace}: ManagerProps) {\r\n  const can = usePermissions(workspace);\r\n  const members: (WorkspaceMember | WorkspaceInvite)[] = [\r\n    ...(workspace.members || []),\r\n    ...(workspace.invites || []),\r\n  ];\r\n\r\n  return (\r\n    <div>\r\n      {can.invite && <InviteChipField workspace={workspace} />}\r\n      <div className=\"flex items-center gap-10 mb-14 text-base\">\r\n        <GroupIcon className=\"icon-sm\" />\r\n        <Trans\r\n          message=\"Members of `:workspace`\"\r\n          values={{workspace: workspace.name}}\r\n        />\r\n      </div>\r\n      <AnimatePresence initial={false}>\r\n        {members.map(member => (\r\n          <MemberListItem\r\n            key={`${member.model_type}.${member.id}`}\r\n            workspace={workspace}\r\n            member={member}\r\n          />\r\n        ))}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface MemberListItemProps {\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n  workspace: Workspace;\r\n}\r\nfunction MemberListItem({workspace, member}: MemberListItemProps) {\r\n  return (\r\n    <m.div\r\n      initial={{x: '-100%', opacity: 0}}\r\n      animate={{x: 0, opacity: 1}}\r\n      exit={{x: '100%', opacity: 0}}\r\n      transition={{type: 'tween', duration: 0.125}}\r\n      className=\"flex items-start text-sm gap-14 mb-20\"\r\n      key={`${member.model_type}.${member.id}`}\r\n    >\r\n      <img\r\n        className=\"w-36 h-36 rounded flex-shrink-0\"\r\n        src={member.avatar}\r\n        alt=\"\"\r\n      />\r\n      <div className=\"md:flex flex-auto items-center justify-between gap-14 min-w-0\">\r\n        <div className=\"overflow-hidden mb-10 md:mb-0 md:mr-10\">\r\n          <div className=\"flex items-center justify-start gap-6\">\r\n            <div className=\"overflow-hidden text-ellipsis whitespace-nowrap\">\r\n              {member.display_name}\r\n            </div>\r\n            <MemberDisplayNameAppend workspace={workspace} member={member} />\r\n          </div>\r\n          <div className=\"text-muted\">{member.email}</div>\r\n        </div>\r\n        <MemberActions workspace={workspace} member={member} />\r\n      </div>\r\n    </m.div>\r\n  );\r\n}\r\n\r\nfunction usePermissions(workspace: Workspace) {\r\n  const {user: authUser} = useAuth();\r\n  const response = {update: false, invite: false, delete: false};\r\n  const permissions = ['update', 'invite', 'delete'] as const;\r\n  const authMember = workspace.members?.find(mb => mb.id === authUser?.id);\r\n\r\n  if (authMember) {\r\n    permissions.forEach(permission => {\r\n      response[permission] =\r\n        authMember.is_owner ||\r\n        !!authMember.permissions?.find(\r\n          p => p.name === `workspace_members.${permission}`,\r\n        );\r\n    });\r\n  }\r\n\r\n  return response;\r\n}\r\n\r\ninterface MemberActionsProps {\r\n  workspace: Workspace;\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n}\r\nfunction MemberActions({workspace, member}: MemberActionsProps) {\r\n  const [selectedRole, setSelectedRole] = useState<number>(member.role_id);\r\n  const changeRole = useChangeRole();\r\n  const {user} = useAuth();\r\n\r\n  const can = usePermissions(workspace);\r\n  const isOwner = member.model_type === 'member' && member.is_owner;\r\n  const isCurrentUser =\r\n    member.model_type === 'member' && user?.id === member.id;\r\n\r\n  const roleSelector =\r\n    !can.update || isOwner || isCurrentUser ? (\r\n      <div className=\"text-muted ml-auto first:capitalize\">\r\n        <Trans message={member.role_name} />\r\n      </div>\r\n    ) : (\r\n      <RoleMenuTrigger\r\n        className=\"ml-auto flex-shrink-0\"\r\n        size=\"xs\"\r\n        value={selectedRole}\r\n        isDisabled={changeRole.isPending}\r\n        onChange={roleId => {\r\n          setSelectedRole(roleId);\r\n          changeRole.mutate({\r\n            roleId,\r\n            workspaceId: workspace.id,\r\n            member,\r\n          });\r\n        }}\r\n      />\r\n    );\r\n\r\n  return (\r\n    <>\r\n      {roleSelector}\r\n      {!isOwner && (isCurrentUser || can.delete) && (\r\n        <RemoveMemberButton\r\n          type={isCurrentUser ? 'leave' : 'remove'}\r\n          member={member}\r\n          workspace={workspace}\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\ninterface InviteChipFieldProps {\r\n  workspace: Workspace;\r\n}\r\nfunction InviteChipField({workspace}: InviteChipFieldProps) {\r\n  const {trans} = useTrans();\r\n  const [chips, setChips] = useState<ChipValue[]>([]);\r\n  const allEmailsValid = chips.every(chip => !chip.invalid);\r\n  const displayWith = (chip: ChipValue) => chip.description || chip.name;\r\n  const [selectedRole, setSelectedRole] = useState<number>();\r\n  const inviteMembers = useInviteMembers();\r\n  const {data} = useValueLists(['workspaceRoles']);\r\n\r\n  useEffect(() => {\r\n    if (!selectedRole && data?.workspaceRoles?.length) {\r\n      setSelectedRole(data.workspaceRoles[0].id);\r\n    }\r\n  }, [data, selectedRole]);\r\n\r\n  return (\r\n    <div className=\"mb-30\">\r\n      <ChipField\r\n        value={chips}\r\n        onChange={setChips}\r\n        displayWith={displayWith}\r\n        validateWith={chip => {\r\n          const invalid = !isEmail(chip.description);\r\n          return {\r\n            ...chip,\r\n            invalid,\r\n            errorMessage: invalid\r\n              ? trans({message: 'Not a valid email'})\r\n              : undefined,\r\n          };\r\n        }}\r\n        placeholder={trans({message: 'Enter email addresses'})}\r\n        label={<Trans message=\"Invite people\" />}\r\n      />\r\n      <div className=\"flex items-center gap-14 justify-between mt-14\">\r\n        <RoleMenuTrigger onChange={setSelectedRole} value={selectedRole} />\r\n        {chips.length && selectedRole ? (\r\n          <Button\r\n            variant=\"flat\"\r\n            color=\"primary\"\r\n            size=\"sm\"\r\n            disabled={inviteMembers.isPending || !allEmailsValid}\r\n            onClick={() => {\r\n              inviteMembers.mutate(\r\n                {\r\n                  emails: chips.map(c => displayWith(c)),\r\n                  roleId: selectedRole,\r\n                  workspaceId: workspace.id,\r\n                },\r\n                {\r\n                  onSuccess: () => {\r\n                    setChips([]);\r\n                  },\r\n                },\r\n              );\r\n            }}\r\n          >\r\n            <Trans message=\"Invite\" />\r\n          </Button>\r\n        ) : null}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface RemoveMemberButtonProps {\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n  workspace: Workspace;\r\n  type: 'leave' | 'remove';\r\n}\r\nfunction RemoveMemberButton({\r\n  member,\r\n  workspace,\r\n  type,\r\n}: RemoveMemberButtonProps) {\r\n  const removeMember = useRemoveMember();\r\n  const {close} = useDialogContext();\r\n  return (\r\n    <DialogTrigger\r\n      type=\"modal\"\r\n      onClose={isConfirmed => {\r\n        if (isConfirmed) {\r\n          removeMember.mutate({\r\n            workspaceId: workspace.id,\r\n            memberId: member.id,\r\n            memberType: member.model_type,\r\n          });\r\n          if (type === 'leave') {\r\n            close();\r\n            toast(message('Left workspace'));\r\n          }\r\n        }\r\n      }}\r\n    >\r\n      <IconButton\r\n        size=\"md\"\r\n        className=\"text-muted flex-shrink-0\"\r\n        disabled={removeMember.isPending}\r\n      >\r\n        {type === 'leave' ? <ExitToAppIcon /> : <CloseIcon />}\r\n      </IconButton>\r\n      {type === 'leave' ? (\r\n        <LeaveWorkspaceConfirmation />\r\n      ) : (\r\n        <RemoveMemberConfirmation member={member} />\r\n      )}\r\n    </DialogTrigger>\r\n  );\r\n}\r\n\r\ninterface RemoveMemberConfirmationProps {\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n}\r\nfunction RemoveMemberConfirmation({member}: RemoveMemberConfirmationProps) {\r\n  return (\r\n    <ConfirmationDialog\r\n      isDanger\r\n      title={<Trans message=\"Remove member\" />}\r\n      body={\r\n        <div>\r\n          <Trans\r\n            message=\"Are you sure you want to remove `:name`?\"\r\n            values={{name: member.display_name}}\r\n          />\r\n          <div className=\"font-semibold mt-8\">\r\n            <Trans\r\n              message=\"All workspace resources created by `:name` will be transferred to workspace owner.\"\r\n              values={{\r\n                name: member.display_name,\r\n              }}\r\n            />\r\n          </div>\r\n        </div>\r\n      }\r\n      confirm={<Trans message=\"Remove\" />}\r\n    />\r\n  );\r\n}\r\n\r\ninterface RoleMenuTriggerProps {\r\n  onChange: (value: number) => void;\r\n  value?: number;\r\n  size?: ButtonSize;\r\n  className?: string;\r\n  isDisabled?: boolean;\r\n}\r\nfunction RoleMenuTrigger({\r\n  value,\r\n  onChange,\r\n  size = 'xs',\r\n  className,\r\n  isDisabled,\r\n}: RoleMenuTriggerProps) {\r\n  const {data} = useValueLists(['workspaceRoles']);\r\n  const role = data?.workspaceRoles?.find(r => r.id === value);\r\n  if (!value || !role || !data?.workspaceRoles) return null;\r\n\r\n  return (\r\n    <MenuTrigger\r\n      selectionMode=\"single\"\r\n      selectedValue={value}\r\n      onSelectionChange={newValue => {\r\n        onChange(newValue as number);\r\n      }}\r\n    >\r\n      <Button\r\n        className={className}\r\n        size={size}\r\n        variant=\"flat\"\r\n        color=\"chip\"\r\n        disabled={isDisabled}\r\n        endIcon={<ArrowDropDownIcon />}\r\n      >\r\n        <Trans message={role.name} />\r\n      </Button>\r\n      <Menu>\r\n        {data.workspaceRoles.map(r => (\r\n          <MenuItem value={r.id} key={r.id} description={r.description}>\r\n            <Trans message={r.name} />\r\n          </MenuItem>\r\n        ))}\r\n      </Menu>\r\n    </MenuTrigger>\r\n  );\r\n}\r\n\r\ninterface MemberDisplayNameAppendProps {\r\n  member: WorkspaceMember | WorkspaceInvite;\r\n  workspace: Workspace;\r\n}\r\nfunction MemberDisplayNameAppend({\r\n  member,\r\n  workspace,\r\n}: MemberDisplayNameAppendProps) {\r\n  const {user} = useAuth();\r\n  const can = usePermissions(workspace);\r\n\r\n  if (user?.id === member.id) {\r\n    return (\r\n      <div className=\"font-medium\">\r\n        (<Trans message=\"You\" />)\r\n      </div>\r\n    );\r\n  }\r\n  if (member.model_type === 'invite') {\r\n    return (\r\n      <div className=\"flex items-center gap-4\">\r\n        <div></div>\r\n        <div className=\"font-medium\">\r\n          <Trans message=\"Invited\" />\r\n        </div>\r\n        {can.invite ? (\r\n          <>\r\n            <div></div>\r\n            <ResendInviteDialogTrigger member={member} workspace={workspace} />\r\n          </>\r\n        ) : null}\r\n      </div>\r\n    );\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction ResendInviteDialogTrigger({\r\n  member,\r\n  workspace,\r\n}: MemberDisplayNameAppendProps) {\r\n  const resendInvite = useResendInvite();\r\n  return (\r\n    <DialogTrigger\r\n      type=\"modal\"\r\n      onClose={isConfirmed => {\r\n        if (isConfirmed) {\r\n          resendInvite.mutate({\r\n            workspaceId: workspace.id,\r\n            inviteId: member.id as string,\r\n          });\r\n        }\r\n      }}\r\n    >\r\n      <Button\r\n        variant=\"link\"\r\n        size=\"sm\"\r\n        color=\"primary\"\r\n        disabled={resendInvite.isPending}\r\n      >\r\n        <Trans message=\"Resend invite\" />\r\n      </Button>\r\n      <ConfirmationDialog\r\n        title={<Trans message=\"Resend invite\" />}\r\n        body={\r\n          <Trans message=\"Are you sure you want to send this invite again?\" />\r\n        }\r\n        confirm={<Trans message=\"Send\" />}\r\n      />\r\n    </DialogTrigger>\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {UseFormReturn} from 'react-hook-form';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {toast} from '../../ui/toast/toast';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {Workspace} from '../types/workspace';\r\nimport {onFormQueryError} from '../../errors/on-form-query-error';\r\nimport {useDialogContext} from '../../ui/overlays/dialog/dialog-context';\r\nimport {message} from '../../i18n/message';\r\n\r\ninterface Response extends BackendResponse {\r\n  workspace: Workspace;\r\n}\r\n\r\nexport interface UpdateWorkspacePayload {\r\n  id: number;\r\n  name: string;\r\n}\r\n\r\nfunction updateWorkspace({\r\n  id,\r\n  ...props\r\n}: UpdateWorkspacePayload): Promise<Response> {\r\n  return apiClient.put(`workspace/${id}`, props).then(r => r.data);\r\n}\r\n\r\nexport function useUpdateWorkspace(\r\n  form: UseFormReturn<UpdateWorkspacePayload>,\r\n) {\r\n  const {close} = useDialogContext();\r\n  return useMutation({\r\n    mutationFn: (props: UpdateWorkspacePayload) => updateWorkspace(props),\r\n    onSuccess: response => {\r\n      close();\r\n      toast(message('Updated workspace'));\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.fetchUserWorkspaces,\r\n      });\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.workspaceWithMembers(\r\n          response.workspace.id,\r\n        ),\r\n      });\r\n    },\r\n    onError: r => onFormQueryError(r, form),\r\n  });\r\n}\r\n","import {useForm} from 'react-hook-form';\r\nimport {FormTextField} from '../ui/forms/input-field/text-field/text-field';\r\nimport {Form} from '../ui/forms/form';\r\nimport {Button} from '../ui/buttons/button';\r\nimport {DialogFooter} from '../ui/overlays/dialog/dialog-footer';\r\nimport {useDialogContext} from '../ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '../ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '../ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '../ui/overlays/dialog/dialog-body';\r\nimport {\r\n  UpdateWorkspacePayload,\r\n  useUpdateWorkspace,\r\n} from './requests/update-workspace';\r\nimport {Workspace} from './types/workspace';\r\nimport {Trans} from '../i18n/trans';\r\n\r\ninterface Props {\r\n  workspace: Workspace;\r\n}\r\nexport function RenameWorkspaceDialog({workspace}: Props) {\r\n  const form = useForm<UpdateWorkspacePayload>({\r\n    defaultValues: {id: workspace.id, name: workspace.name},\r\n  });\r\n  const {formId, close} = useDialogContext();\r\n  const updateWorkspace = useUpdateWorkspace(form);\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogHeader>\r\n        <Trans message=\"Rename workspace\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <Form\r\n          form={form}\r\n          id={formId}\r\n          onSubmit={() => {\r\n            updateWorkspace.mutate(form.getValues());\r\n          }}\r\n        >\r\n          <FormTextField\r\n            name=\"name\"\r\n            autoFocus\r\n            label={<Trans message=\"Name\" />}\r\n            minLength={3}\r\n            required\r\n          />\r\n        </Form>\r\n      </DialogBody>\r\n      <DialogFooter>\r\n        <Button variant=\"text\" onClick={close}>\r\n          <Trans message=\"Cancel\" />\r\n        </Button>\r\n        <Button\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          type=\"submit\"\r\n          form={formId}\r\n          disabled={updateWorkspace.isPending}\r\n        >\r\n          <Trans message=\"Rename\" />\r\n        </Button>\r\n      </DialogFooter>\r\n    </Dialog>\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {BackendResponse} from '../../http/backend-response/backend-response';\r\nimport {toast} from '../../ui/toast/toast';\r\nimport {apiClient, queryClient} from '../../http/query-client';\r\nimport {WorkspaceQueryKeys} from './workspace-query-keys';\r\nimport {useActiveWorkspaceId} from '../active-workspace-id-context';\r\nimport {PersonalWorkspace} from '../user-workspaces';\r\nimport {message} from '../../i18n/message';\r\nimport {showHttpErrorToast} from '../../utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {}\r\n\r\nexport interface DeleteWorkspacePayload {\r\n  id: number;\r\n}\r\n\r\nfunction deleteWorkspace({id}: DeleteWorkspacePayload): Promise<Response> {\r\n  return apiClient.delete(`workspace/${id}`).then(r => r.data);\r\n}\r\n\r\nexport function useDeleteWorkspace() {\r\n  const {workspaceId, setWorkspaceId} = useActiveWorkspaceId();\r\n  return useMutation({\r\n    mutationFn: (props: DeleteWorkspacePayload) => deleteWorkspace(props),\r\n    onSuccess: (r, payload) => {\r\n      toast(message('Deleted workspace'));\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.fetchUserWorkspaces,\r\n      });\r\n      queryClient.invalidateQueries({\r\n        queryKey: WorkspaceQueryKeys.workspaceWithMembers(payload.id),\r\n      });\r\n\r\n      // if user deleted workspace that is currently active, switch to personal workspace\r\n      if (workspaceId === payload.id) {\r\n        setWorkspaceId(PersonalWorkspace.id);\r\n      }\r\n    },\r\n    onError: err => showHttpErrorToast(err),\r\n  });\r\n}\r\n","import clsx from 'clsx';\r\nimport { PersonalWorkspace, useUserWorkspaces } from './user-workspaces';\r\nimport { NewWorkspaceDialog } from './new-workspace-dialog';\r\nimport { WorkspaceMembersDialog } from './workspace-members-dialog';\r\nimport { useActiveWorkspaceId } from './active-workspace-id-context';\r\nimport { Workspace } from './types/workspace';\r\nimport { Button, ButtonProps } from '../ui/buttons/button';\r\nimport { Menu, MenuItem, MenuTrigger } from '../ui/navigation/menu/menu-trigger';\r\nimport { KeyboardArrowDownIcon } from '../icons/material/KeyboardArrowDown';\r\nimport { PersonAddIcon } from '../icons/material/PersonAdd';\r\nimport { DeleteIcon } from '../icons/material/Delete';\r\nimport { ExitToAppIcon } from '../icons/material/ExitToApp';\r\nimport { EditIcon } from '../icons/material/Edit';\r\nimport { RenameWorkspaceDialog } from './rename-workspace-dialog';\r\nimport { ConfirmationDialog } from '../ui/overlays/dialog/confirmation-dialog';\r\nimport { useDeleteWorkspace } from './requests/delete-workspace';\r\nimport { useRemoveMember } from './requests/remove-member';\r\nimport { useAuth } from '../auth/use-auth';\r\nimport { Trans } from '../i18n/trans';\r\nimport { LeaveWorkspaceConfirmation } from './leave-workspace-confirmation';\r\nimport { openDialog } from '@common/ui/overlays/store/dialog-store';\r\nimport React, { useEffect, Fragment, ReactElement, useState } from 'react';\r\n\r\ninterface WorkspaceSelectorProps {\r\n  className?: string;\r\n  onChange?: (id: number) => void;\r\n  trigger?: ReactElement<ButtonProps>;\r\n}\r\n\r\nexport function WorkspaceSelector({\r\n  onChange,\r\n  className,\r\n}: WorkspaceSelectorProps) {\r\n  const { data: workspaces, isFetched, isFetching } = useUserWorkspaces();\r\n  const { workspaceId, setWorkspaceId } = useActiveWorkspaceId();\r\n  const activeWorkspace = workspaces?.find(w => w.id === workspaceId);\r\n  const { hasPermission } = useAuth();\r\n\r\n  useEffect(() => {\r\n    if (isFetched && !isFetching && !activeWorkspace) {\r\n      setWorkspaceId(PersonalWorkspace.id);\r\n    }\r\n  }, [activeWorkspace, workspaces, setWorkspaceId, isFetched, isFetching]);\r\n\r\n  if (\r\n    !activeWorkspace ||\r\n    (!hasPermission('workspaces.create') && workspaces?.length === 1)\r\n  ) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Fragment>\r\n      <div className={clsx('workspace-selector', className)}>\r\n        <div className=\"workspace-list flex flex-wrap gap-10 mx-36 justify-between\">\r\n          <WorkspaceAddNewButton onChange={onChange} />\r\n\r\n          {workspaces?.map(workspace => (\r\n            <WorkspaceItem\r\n              key={workspace.id}\r\n              workspace={workspace}\r\n              onChange={onChange}\r\n              setSelectorIsOpen={() => {}}\r\n            />\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </Fragment>\r\n  );\r\n}\r\n\r\ninterface WorkspaceAddNewButtonProps {\r\n  onChange?: (id: number) => void;\r\n}\r\n\r\nfunction WorkspaceAddNewButton({ onChange }: WorkspaceAddNewButtonProps) {\r\n  const { setWorkspaceId } = useActiveWorkspaceId();\r\n  \r\n  return (\r\n    <div className=\"add-workspace mb-4 px-4 text-center w-1/5\">\r\n      <Button\r\n        onClick={async (e) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          const workspaceId = await openDialog(NewWorkspaceDialog);\r\n          if (workspaceId) {\r\n            setWorkspaceId(workspaceId);\r\n            onChange?.(workspaceId);\r\n          }\r\n        }}\r\n        className=\"relative w-full rounded-xl bg-gradient-to-r from-[#6375f2] to-[#4a52ec] p-80 text-white shadow-lg hover:shadow-xl transform hover:scale-105 transition-transform duration-300\"\r\n      >\r\n        <div className=\"text-left w-full\">\r\n          <div className=\"text-xl font-semibold\">+ Add New</div>\r\n          <div className=\"text-3xl font-bold mt-1\">Workspace</div>\r\n        </div>\r\n\r\n        <div className=\"absolute top-30 right-8\">\r\n          <svg width=\"92\" height=\"45\" viewBox=\"0 0 92 45\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n            <path d=\"M2 42.2949C2 42.2949 8.27975 -5.21045 24 16.7949C39.7203 38.8003 46 37.7896 52 20.7949C59.4168 -0.212582 86.758 17.8755 89.5 2.79492\" stroke=\"url(#paint0_linear_26_2666)\" stroke-width=\"4\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n            <defs>\r\n            <linearGradient id=\"paint0_linear_26_2666\" x1=\"-1.50002\" y1=\"47.2949\" x2=\"70.5778\" y2=\"-16.1194\" gradientUnits=\"userSpaceOnUse\">\r\n            <stop stop-color=\"white\"/>\r\n            <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"0\"/>\r\n            </linearGradient>\r\n            </defs>\r\n          </svg>\r\n        </div>\r\n      </Button>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface WorkspaceItemProps {\r\n  workspace: Workspace;\r\n  onChange: WorkspaceSelectorProps['onChange'];\r\n  setSelectorIsOpen: (value: boolean) => void;\r\n}\r\n\r\nfunction WorkspaceItem({\r\n  workspace,\r\n  onChange,\r\n  setSelectorIsOpen,\r\n}: WorkspaceItemProps) {\r\n  const { workspaceId, setWorkspaceId } = useActiveWorkspaceId();\r\n  const isActive = workspaceId === workspace.id;\r\n\r\n  // Check if workspace.createdAt exists and is a valid value\r\n  const creationDate = workspace.created_at ? new Date(workspace.created_at) : new Date();\r\n\r\n  // If the creationDate is invalid, fallback to the current date\r\n  const formattedTime = creationDate instanceof Date && !isNaN(creationDate.getTime())\r\n    ? creationDate.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\r\n    : 'Invalid time';\r\n\r\n  const formattedDate = creationDate instanceof Date && !isNaN(creationDate.getTime())\r\n    ? creationDate.toLocaleDateString()\r\n    : 'Invalid date';\r\n\r\n  return (\r\n    <div\r\n      onClick={() => {\r\n        setWorkspaceId(workspace.id);\r\n        onChange?.(workspace.id);\r\n        setSelectorIsOpen(false);\r\n      }}\r\n      className={clsx(\r\n        'add-workspace mb-4 flex cursor-pointer items-center gap-10 p-20 rounded-2xl shadow-md bg-white dark:bg-gray-300 text-black dark:text-white dark:border-2 border-gray-700', isActive && 'bg-primary/5'\r\n      )}\r\n    >\r\n      <div className=\"w-40 py-2 px-8 bg-gray-100 rounded-2xl flex items-center justify-center\">\r\n        <svg\r\n          width=\"40\"\r\n          height=\"40\"\r\n          viewBox=\"0 0 24 24\"\r\n          fill=\"none\"\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n        >\r\n          <path\r\n            d=\"M10 4L4 4C3.44771 4 3 4.44771 3 5L3 19C3 19.5523 3.44771 20 4 20L20 20C20.5523 20 21 19.5523 21 19L21 8C21 7.44772 20.5523 7 20 7L12 7C11.4477 7 11 6.55228 11 6L11 5C11 4.44772 10.5523 4 10 4Z\"\r\n            fill=\"#2563EB\"\r\n          />\r\n        </svg>\r\n      </div>\r\n\r\n      <div className=\"flex-auto\">\r\n        <div className={clsx('text-lg font-semibold text-gray-900')}>\r\n          {workspace.name || \"Project 29\"}\r\n        </div>\r\n        <div className=\"text-sm text-gray-300 dark:text-white\">\r\n          {formattedDate} {formattedTime}\r\n        </div>\r\n      </div>\r\n\r\n      <div>\r\n        <ManageButton\r\n          setSelectorIsOpen={setSelectorIsOpen}\r\n          workspace={workspace}\r\n          onChange={onChange}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface LeaveWorkspaceDialogProps {\r\n  workspace: Workspace;\r\n  onChange?: (id: number) => void;\r\n}\r\n\r\nfunction LeaveWorkspaceDialog({\r\n  workspace,\r\n  onChange,\r\n}: LeaveWorkspaceDialogProps) {\r\n  const removeMember = useRemoveMember();\r\n  const { user } = useAuth();\r\n  return (\r\n    <LeaveWorkspaceConfirmation\r\n      isLoading={removeMember.isPending}\r\n      onConfirm={() => {\r\n        removeMember.mutate(\r\n          {\r\n            workspaceId: workspace.id,\r\n            memberId: user!.id,\r\n            memberType: 'member',\r\n          },\r\n          {\r\n            onSuccess: () => {\r\n              onChange?.(PersonalWorkspace.id);\r\n            },\r\n          },\r\n        );\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\ninterface DeleteWorkspaceConfirmationProps {\r\n  workspace: Workspace;\r\n  onChange?: (id: number) => void;\r\n}\r\n\r\nfunction DeleteWorkspaceConfirmation({\r\n  workspace,\r\n  onChange,\r\n}: DeleteWorkspaceConfirmationProps) {\r\n  const deleteWorkspace = useDeleteWorkspace();\r\n  return (\r\n    <ConfirmationDialog\r\n      isDanger\r\n      title={<Trans message=\"Delete workspace\" />}\r\n      body={\r\n        <Trans\r\n          message=\"Are you sure you want to delete :name?\"\r\n          values={{ name: workspace.name }}\r\n        />\r\n      }\r\n      confirm={<Trans message=\"Delete\" />}\r\n      isLoading={deleteWorkspace.isPending}\r\n      onConfirm={() => {\r\n        deleteWorkspace.mutate(\r\n          { id: workspace.id },\r\n          {\r\n            onSuccess: () => {\r\n              onChange?.(PersonalWorkspace.id);\r\n            },\r\n          },\r\n        );\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\ninterface ManageButtonProps {\r\n  setSelectorIsOpen: (value: boolean) => void;\r\n  workspace: Workspace;\r\n  onChange?: (id: number) => void;\r\n}\r\n\r\nfunction ManageButton({\r\n  setSelectorIsOpen,\r\n  workspace,\r\n  onChange,\r\n}: ManageButtonProps) {\r\n  const { user } = useAuth();\r\n\r\n  return (\r\n    <MenuTrigger onItemSelected={() => setSelectorIsOpen(false)}>\r\n      <Button\r\n        onClick={e => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n        }}\r\n        color=\"primary\"\r\n        size=\"xs\"\r\n        variant=\"outline\"\r\n        endIcon={<KeyboardArrowDownIcon className='h-40 hover:bg-transparent' />}\r\n        className='border-none hover:bg-transparent'\r\n      >\r\n        {/* <Trans message=\"Manage\" /> */}\r\n      </Button>\r\n      <Menu>\r\n        <MenuItem\r\n          onClick={e => {\r\n            e.stopPropagation();\r\n            openDialog(WorkspaceMembersDialog, { workspace });\r\n          }}\r\n          value=\"workspaceMembers\"\r\n          startIcon={<PersonAddIcon />}\r\n        >\r\n          <Trans message=\"Members\" />\r\n        </MenuItem>\r\n        {workspace.owner_id === user?.id && (\r\n          <MenuItem\r\n            onClick={e => {\r\n              e.stopPropagation();\r\n              openDialog(RenameWorkspaceDialog, { workspace });\r\n            }}\r\n            value=\"updateWorkspace\"\r\n            startIcon={<EditIcon />}\r\n          >\r\n            <Trans message=\"Rename\" />\r\n          </MenuItem>\r\n        )}\r\n        {workspace.owner_id !== user?.id && (\r\n          <MenuItem\r\n            onClick={e => {\r\n              e.stopPropagation();\r\n              openDialog(LeaveWorkspaceDialog, { workspace, onChange });\r\n            }}\r\n            value=\"leaveWorkspace\"\r\n            startIcon={<ExitToAppIcon />}\r\n          >\r\n            <Trans message=\"Leave\" />\r\n          </MenuItem>\r\n        )}\r\n        {workspace.owner_id === user?.id && (\r\n          <MenuItem\r\n            onClick={e => {\r\n              e.stopPropagation();\r\n              openDialog(DeleteWorkspaceConfirmation, { workspace, onChange });\r\n            }}\r\n            value=\"deleteWorkspace\"\r\n            startIcon={<DeleteIcon />}\r\n          >\r\n            <Trans message=\"Delete\" />\r\n          </MenuItem>\r\n        )}\r\n      </Menu>\r\n    </MenuTrigger>\r\n  );\r\n}\r\n","export enum MenuPositions {\r\n  DriveSidebar = 'drive-sidebar',\r\n}\r\n","\"use strict\";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var o in r=arguments[t])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},defaultConfig=(Object.defineProperty(exports,\"__esModule\",{value:!0}),{id:\"id\",parentId:\"parentId\",dataField:\"data\",childrenField:\"children\",throwIfOrphans:!1,rootParentIds:{\"\":!(exports.countNodes=exports.arrayToTree=void 0)},nestedIds:!0,assign:!1});function arrayToTree(c,e){void 0===e&&(e={});for(var r,t=__assign(__assign({},defaultConfig),e),n=[],o={},a=t.throwIfOrphans?new Set:null,s=0,h=c;s<h.length;s++){var i=h[s],d=t.nestedIds?getNestedProperty(i,t.id):i[t.id],l=t.nestedIds?getNestedProperty(i,t.parentId):i[t.parentId];if(t.rootParentIds[d])throw new Error(\"The item array contains a node whose parentId both exists in another node and is in \"+'`rootParentIds` (`itemId`: \"'.concat(d,'\", `rootParentIds`: ').concat(Object.keys(t.rootParentIds).map(function(e){return'\"'.concat(e,'\"')}).join(\", \"),\").\"));Object.prototype.hasOwnProperty.call(o,d)||(o[d]=((r={})[t.childrenField]=[],r)),a&&a.delete(d),t.dataField?o[d][t.dataField]=i:t.assign?o[d]=Object.assign(i,((r={})[t.childrenField]=o[d][t.childrenField],r)):o[d]=__assign(__assign({},i),((i={})[t.childrenField]=o[d][t.childrenField],i));i=o[d];null==l||t.rootParentIds[l]?n.push(i):(Object.prototype.hasOwnProperty.call(o,l)||(o[l]=((d={})[t.childrenField]=[],d),a&&a.add(l)),o[l][t.childrenField].push(i))}if(null!=a&&a.size)throw new Error(\"The items array contains orphans that point to the following parentIds: \"+\"[\".concat(Array.from(a),\"]. These parentIds do not exist in the items array. Hint: prevent orphans to result \")+\"in an error by passing the following option: { throwIfOrphans: false }\");if(t.throwIfOrphans&&countNodes(n,t.childrenField)<Object.keys(o).length)throw new Error(\"The items array contains nodes with a circular parent/child relationship.\");return n}function countNodes(e,t){return e.reduce(function(e,r){return e+1+(r[t]&&countNodes(r[t],t))},0)}function getNestedProperty(e,r){return r.split(\".\").reduce(function(e,r){return e&&e[r]},e)}exports.arrayToTree=arrayToTree,exports.countNodes=countNodes;","import {useQuery} from '@tanstack/react-query';\r\nimport {DriveFolder} from '../drive-entry';\r\nimport {useAuth} from '@common/auth/use-auth';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {useActiveWorkspaceId} from '@common/workspace/active-workspace-id-context';\r\n\r\nexport interface UserFoldersApiParams {\r\n  userId: number;\r\n  workspaceId: number | null;\r\n}\r\n\r\ninterface UserFoldersResponse extends BackendResponse {\r\n  folders: DriveFolder[];\r\n  rootFolder: DriveFolder;\r\n}\r\n\r\nfunction fetchUserFolders(\r\n  params: UserFoldersApiParams,\r\n): Promise<UserFoldersResponse> {\r\n  return apiClient\r\n    .get(`users/${params.userId}/folders`, {params})\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useFolders() {\r\n  const {user} = useAuth();\r\n  const {workspaceId} = useActiveWorkspaceId();\r\n  const params: UserFoldersApiParams = {\r\n    userId: user!.id,\r\n    workspaceId,\r\n  };\r\n  return useQuery({\r\n    queryKey: DriveQueryKeys.fetchUserFolders(params),\r\n    queryFn: () => fetchUserFolders(params),\r\n    enabled: !!user,\r\n  });\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveEntry} from '../drive-entry';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport {RootFolderPage} from '../../drive-page/drive-page';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface Response extends BackendResponse {\r\n  entries: DriveEntry[];\r\n  destination: FileEntry | null;\r\n}\r\n\r\ninterface Payload {\r\n  entryIds: number[];\r\n  destinationId?: number | null;\r\n}\r\n\r\nexport function useMoveEntries() {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => {\r\n      toast.loading(\r\n        message('Moving [one 1 item|other :count items]...', {\r\n          values: {\r\n            count: payload.entryIds.length,\r\n          },\r\n        }),\r\n        {disableExitAnimation: true},\r\n      );\r\n      return moveEntries(payload);\r\n    },\r\n    onSuccess: (r, p) => {\r\n      invalidateEntryQueries();\r\n      toast(\r\n        message('Moved [one 1 item|other :count items] to \":destination\"', {\r\n          values: {\r\n            count: p.entryIds.length,\r\n            destination: (r.destination || RootFolderPage.folder).name,\r\n          },\r\n        }),\r\n        {disableEnterAnimation: true},\r\n      );\r\n    },\r\n    onError: err =>\r\n      showHttpErrorToast(err, message('Could not move items'), null, {\r\n        disableEnterAnimation: true,\r\n      }),\r\n  });\r\n}\r\n\r\nfunction moveEntries(payload: Payload): Promise<Response> {\r\n  // backend expects null for root folder, it might be zero or empty string on frontend\r\n  payload.destinationId = !payload.destinationId ? null : payload.destinationId;\r\n  return apiClient\r\n    .post('file-entries/move', payload)\r\n    .then(response => response.data);\r\n}\r\n","import {FileEntry} from '@common/uploads/file-entry';\r\n\r\nexport interface PartialFolder {\r\n  id: number;\r\n  name: string;\r\n  path: string;\r\n  parent_id: number | null;\r\n  type: string;\r\n}\r\n\r\nexport function canMoveEntriesInto(\r\n  targets: FileEntry[],\r\n  destination: PartialFolder\r\n) {\r\n  if (destination.type !== 'folder') return false;\r\n\r\n  // should not be able to move folder into its\r\n  // own child or folder it's already in\r\n  return targets.every(target => {\r\n    if (!target) return false;\r\n    // entry is already in this folder\r\n    if (\r\n      destination.id === target.parent_id ||\r\n      // root folder check\r\n      (!target.parent_id && destination.id === 0)\r\n    ) {\r\n      return false;\r\n    }\r\n\r\n    return !destinationIsInTarget(destination, target);\r\n  });\r\n}\r\n\r\nfunction destinationIsInTarget(destination: PartialFolder, target: FileEntry) {\r\n  const destinationPath = (destination.path || '').split('/');\r\n  const targetPath = (target.path || '').split('/');\r\n  return targetPath.every((part, index) => {\r\n    return destinationPath[index] === part;\r\n  });\r\n}\r\n","import {FileEntry} from '@common/uploads/file-entry';\r\nimport {useMoveEntries} from './queries/use-move-entries';\r\nimport {useDriveUploadQueue} from '../uploading/use-drive-upload-queue';\r\nimport {canMoveEntriesInto} from './utils/can-move-entries-into';\r\nimport {\r\n  ConnectedDraggable,\r\n  MixedDraggable,\r\n} from '@common/ui/interactions/dnd/use-draggable';\r\nimport {NativeFileDraggable} from '@common/ui/interactions/dnd/use-droppable';\r\nimport {driveState} from '@app/drive/drive-store';\r\n\r\nexport function useFolderDropAction(folder: FileEntry) {\r\n  const moveEntries = useMoveEntries();\r\n  const {uploadFiles} = useDriveUploadQueue();\r\n\r\n  const onDrop = async (target: ConnectedDraggable | NativeFileDraggable) => {\r\n    if (folder.type !== 'folder') return;\r\n    if (target.type === 'nativeFile') {\r\n      uploadFiles(await target.getData(), {\r\n        metadata: {parentId: folder.id},\r\n      });\r\n    } else if (target.type === 'fileEntry') {\r\n      const entries = target.getData() as FileEntry[];\r\n      if (entries?.length && canMoveEntriesInto(entries, folder)) {\r\n        moveEntries.mutate({\r\n          destinationId: folder.id,\r\n          entryIds: entries.map(e => e.id),\r\n        });\r\n        driveState().deselectEntries('all');\r\n      }\r\n    }\r\n  };\r\n\r\n  return {onDrop};\r\n}\r\n\r\nexport function folderAcceptsDrop(target: MixedDraggable, entry: FileEntry) {\r\n  if (target.type === 'fileEntry') {\r\n    const entries = target.getData() as FileEntry[];\r\n    return canMoveEntriesInto(entries, entry);\r\n  }\r\n  return true;\r\n}\r\n","import {FileEntry} from '@common/uploads/file-entry';\r\n\r\nexport function makeFolderTreeDragId(entry: FileEntry) {\r\n  return `${entry.id}-tree`;\r\n}\r\n\r\nexport function isFolderTreeDragId(id: string | number): boolean {\r\n  return `${id}`.endsWith('-tree');\r\n}\r\n","import {useDroppable} from '@common/ui/interactions/dnd/use-droppable';\r\nimport {driveState} from '../../drive-store';\r\nimport {RefObject, useState} from 'react';\r\nimport {\r\n  folderAcceptsDrop,\r\n  useFolderDropAction,\r\n} from '../../files/use-folder-drop-action';\r\nimport {DriveFolder} from '../../files/drive-entry';\r\nimport {makeFolderTreeDragId} from './folder-tree-drag-id';\r\n\r\ninterface Props {\r\n  folder: DriveFolder;\r\n  ref: RefObject<HTMLDivElement>;\r\n}\r\nexport function useSidebarTreeDropTarget({folder, ref}: Props) {\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const {onDrop} = useFolderDropAction(folder);\r\n\r\n  const dropProps = useDroppable({\r\n    id: makeFolderTreeDragId(folder),\r\n    ref,\r\n    types: ['fileEntry', 'nativeFile'],\r\n    acceptsDrop: draggable => folderAcceptsDrop(draggable, folder),\r\n    onDragEnter: draggable => {\r\n      if (folderAcceptsDrop(draggable, folder)) {\r\n        setIsDragOver(true);\r\n      }\r\n    },\r\n    onDragLeave: () => {\r\n      setIsDragOver(false);\r\n    },\r\n    onDropActivate: () => {\r\n      if (!driveState().sidebarExpandedKeys.includes(folder.id)) {\r\n        driveState().setSidebarExpandedKeys([\r\n          ...driveState().sidebarExpandedKeys,\r\n          folder.id,\r\n        ]);\r\n      }\r\n    },\r\n    onDrop,\r\n  });\r\n\r\n  return {...dropProps, isDragOver};\r\n}\r\n","import {createContext, Key} from 'react';\r\n\r\nexport interface TreeContextValue {\r\n  expandedKeys: Key[];\r\n  setExpandedKeys: (value: Key[]) => void;\r\n  selectedKeys: Key[];\r\n  setSelectedKeys: (value: Key[]) => void;\r\n  focusedNode?: Key;\r\n  setFocusedNode: (node?: Key) => void;\r\n}\r\n\r\nexport const TreeContext = createContext<TreeContextValue>(null!);\r\n","import {TreeItemRenderer} from './tree-item';\r\nimport {cloneElement} from 'react';\r\nimport {TreeNode} from './tree';\r\n\r\ninterface RenderTreeProps<T extends TreeNode> {\r\n  nodes: T[];\r\n  parentNode?: T;\r\n  itemRenderer: TreeItemRenderer<T>;\r\n  level?: number;\r\n}\r\nexport function renderTree<T extends TreeNode>({\r\n  nodes,\r\n  itemRenderer,\r\n  parentNode,\r\n  level,\r\n}: RenderTreeProps<T>) {\r\n  return nodes.map((node, index) => {\r\n    return cloneElement(itemRenderer(node), {\r\n      level: level == undefined ? 0 : level + 1,\r\n      index,\r\n      node,\r\n      parentNode,\r\n      key: node.id,\r\n      itemRenderer,\r\n    });\r\n  });\r\n}\r\n","import React, {\r\n  forwardRef,\r\n  MouseEventHandler,\r\n  ReactNode,\r\n  useContext,\r\n} from 'react';\r\nimport {TreeContext} from './tree-context';\r\nimport clsx from 'clsx';\r\nimport {ArrowRightIcon} from '../../icons/material/ArrowRight';\r\n\r\ninterface TreeLabelProps {\r\n  level?: number;\r\n  node: any;\r\n  icon?: ReactNode;\r\n  label?: ReactNode;\r\n  className?: string;\r\n}\r\nexport const TreeLabel = forwardRef<HTMLDivElement, TreeLabelProps>(\r\n  ({icon, label, level = 0, node, className, ...domProps}, ref) => {\r\n    const {expandedKeys, setExpandedKeys, selectedKeys, setSelectedKeys} =\r\n      useContext(TreeContext);\r\n    const isExpanded = expandedKeys.includes(node.id);\r\n    const isSelected = selectedKeys.includes(node.id);\r\n\r\n    const handleExpandIconClick: MouseEventHandler = e => {\r\n      e.stopPropagation();\r\n      const index = expandedKeys.indexOf(node.id);\r\n      const newExpandedKeys = [...expandedKeys];\r\n      if (index > -1) {\r\n        newExpandedKeys.splice(index, 1);\r\n      } else {\r\n        newExpandedKeys.push(node.id);\r\n      }\r\n      setExpandedKeys(newExpandedKeys);\r\n    };\r\n\r\n    return (\r\n      <div\r\n        {...domProps}\r\n        ref={ref}\r\n        onClick={e => {\r\n          e.stopPropagation();\r\n          setSelectedKeys([node.id]);\r\n        }}\r\n        className={clsx(\r\n          'flex flex-nowrap whitespace-nowrap items-center gap-4 py-6 rounded header cursor-pointer overflow-hidden text-ellipsis tree-label',\r\n          className,\r\n          isSelected && 'bg-primary/selected text-primary font-bold',\r\n          !isSelected && 'hover:bg-hover'\r\n        )}\r\n      >\r\n        {level > 0 && (\r\n          <div className=\"flex\">\r\n            {Array.from({length: level}).map((_, i) => {\r\n              return <div key={i} className=\"w-24 h-24\" />;\r\n            })}\r\n          </div>\r\n        )}\r\n        <div onClick={handleExpandIconClick}>\r\n          <ArrowRightIcon\r\n            className={clsx(\r\n              'icon-sm cursor-default transition-transform',\r\n              isExpanded && 'rotate-90'\r\n            )}\r\n          />\r\n        </div>\r\n        {icon}\r\n        <div className=\"overflow-hidden text-ellipsis pr-6\">{label}</div>\r\n      </div>\r\n    );\r\n  }\r\n);\r\nTreeLabel.displayName = 'TreeLabel';\r\n","import React, {\r\n  HTMLAttributes,\r\n  ReactElement,\r\n  ReactNode,\r\n  Ref,\r\n  useContext,\r\n  useEffect,\r\n} from 'react';\r\nimport {useFocusManager} from '@react-aria/focus';\r\nimport {TreeContext} from './tree-context';\r\nimport {createEventHandler} from '../../utils/dom/create-event-handler';\r\nimport clsx from 'clsx';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {TreeNode} from './tree';\r\nimport {renderTree} from './render-tree';\r\nimport {TreeLabel} from './tree-label';\r\n\r\nexport type TreeItemRenderer<T extends TreeNode> = (\r\n  node: any,\r\n) => ReactElement<TreeItemProps<T>>;\r\n\r\nexport interface TreeItemProps<T extends TreeNode>\r\n  extends HTMLAttributes<HTMLElement> {\r\n  label: ReactNode;\r\n  icon: ReactNode;\r\n  node?: T;\r\n  parentNode?: T;\r\n  level?: number;\r\n  index?: number;\r\n  itemRenderer?: TreeItemRenderer<T>;\r\n  labelRef?: Ref<HTMLDivElement>;\r\n  labelClassName?: string;\r\n  className?: string;\r\n}\r\nexport function TreeItem<T extends TreeNode>({\r\n  label,\r\n  icon,\r\n  node,\r\n  level,\r\n  index,\r\n  itemRenderer,\r\n  labelRef,\r\n  labelClassName,\r\n  className,\r\n  parentNode,\r\n  ...domProps\r\n}: TreeItemProps<T>) {\r\n  const focusManager = useFocusManager();\r\n  const {\r\n    expandedKeys,\r\n    selectedKeys,\r\n    focusedNode,\r\n    setFocusedNode,\r\n    setExpandedKeys,\r\n    setSelectedKeys,\r\n  } = useContext(TreeContext);\r\n\r\n  // clear focused node on unmount\r\n  useEffect(() => {\r\n    return () => {\r\n      if (focusedNode === node?.id) {\r\n        setFocusedNode(undefined);\r\n      }\r\n    };\r\n  }, [focusedNode, node?.id, setFocusedNode]);\r\n\r\n  if (!node || !itemRenderer) return null;\r\n\r\n  const hasChildren = node.children.length;\r\n  const isExpanded = hasChildren && expandedKeys.includes(node.id);\r\n  const isSelected = selectedKeys.includes(node.id);\r\n  const isFirstNode = level === 0 && index === 0;\r\n  const isFocused =\r\n    focusedNode == undefined ? isFirstNode : focusedNode === node.id;\r\n\r\n  const onKeyDown = (e: React.KeyboardEvent<HTMLUListElement>) => {\r\n    if (focusedNode == null) return;\r\n    switch (e.key) {\r\n      // select the node\r\n      case 'Enter':\r\n      case ' ':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        setSelectedKeys([focusedNode]);\r\n        break;\r\n\r\n      // expand node, or move focus to first (and only first) child\r\n      case 'ArrowRight':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (!hasChildren) return;\r\n\r\n        if (!isExpanded) {\r\n          setExpandedKeys([...expandedKeys, focusedNode]);\r\n        } else {\r\n          focusManager?.focusNext();\r\n        }\r\n        break;\r\n\r\n      // collapse node, or move focus to parent node\r\n      case 'ArrowLeft':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (isExpanded) {\r\n          const index = expandedKeys.indexOf(focusedNode);\r\n          const newKeys = [...expandedKeys];\r\n          newKeys.splice(index, 1);\r\n          setExpandedKeys(newKeys);\r\n        } else if (parentNode) {\r\n          const parentEl =\r\n            document.activeElement?.parentElement?.closest('[tabindex]');\r\n          if (parentEl) {\r\n            (parentEl as HTMLElement).focus();\r\n          }\r\n        }\r\n        break;\r\n\r\n      // focus next visible node, recursively\r\n      case 'ArrowDown':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusManager?.focusNext();\r\n        break;\r\n\r\n      // focus previous visible node, recursively\r\n      case 'ArrowUp':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusManager?.focusPrevious();\r\n        break;\r\n\r\n      // focus first visible node\r\n      case 'Home':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusManager?.focusFirst();\r\n        break;\r\n\r\n      // focus last visible node\r\n      case 'End':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        focusManager?.focusLast();\r\n        break;\r\n\r\n      // expand all sibling nodes\r\n      case '*':\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n\r\n        if (parentNode?.children) {\r\n          const newKeys = [...expandedKeys];\r\n          parentNode.children.forEach(childNode => {\r\n            if (\r\n              childNode.children.length &&\r\n              !expandedKeys.includes(childNode.id)\r\n            ) {\r\n              newKeys.push(childNode.id);\r\n            }\r\n          });\r\n          if (newKeys.length !== expandedKeys.length) {\r\n            setExpandedKeys(newKeys);\r\n          }\r\n        }\r\n        break;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <li\r\n      role=\"treeitem\"\r\n      aria-expanded={isExpanded ? 'true' : 'false'}\r\n      aria-selected={isSelected}\r\n      tabIndex={isFocused ? 0 : -1}\r\n      onKeyDown={createEventHandler(onKeyDown)}\r\n      onFocus={e => {\r\n        e.stopPropagation();\r\n        setFocusedNode(node.id);\r\n      }}\r\n      onBlur={e => {\r\n        e.stopPropagation();\r\n        // only clear focus state when focus moves outside the tree\r\n        if (!e.currentTarget.contains(e.relatedTarget)) {\r\n          setFocusedNode(undefined);\r\n        }\r\n      }}\r\n      className={clsx(\r\n        'outline-none',\r\n        // focus direct .tree-label child when this element has :focus-visible\r\n        '[&>.tree-label]:focus-visible:ring [&>.tree-label]:focus-visible:ring-2 [&>.tree-label]:focus-visible:ring-inset',\r\n        className,\r\n      )}\r\n    >\r\n      <TreeLabel\r\n        ref={labelRef}\r\n        className={labelClassName}\r\n        node={node}\r\n        level={level}\r\n        label={label}\r\n        icon={icon}\r\n        {...domProps}\r\n      />\r\n      <AnimatePresence initial={false}>\r\n        {isExpanded ? (\r\n          <m.ul\r\n            key={`${node.id}-group`}\r\n            role=\"group\"\r\n            initial=\"closed\"\r\n            animate=\"open\"\r\n            exit=\"closed\"\r\n            variants={{\r\n              open: {opacity: 1, height: 'auto'},\r\n              closed: {opacity: 0, height: 0, overflow: 'hidden'},\r\n            }}\r\n          >\r\n            {renderTree({\r\n              nodes: node.children,\r\n              parentNode: node,\r\n              itemRenderer,\r\n              level,\r\n            })}\r\n          </m.ul>\r\n        ) : null}\r\n      </AnimatePresence>\r\n    </li>\r\n  );\r\n}\r\n","import React, {Key, useState} from 'react';\r\nimport {useControlledState} from '@react-stately/utils';\r\nimport {FocusScope} from '@react-aria/focus';\r\nimport {TreeContext, TreeContextValue} from './tree-context';\r\nimport {TreeItemRenderer} from './tree-item';\r\nimport {renderTree} from './render-tree';\r\n\r\nexport interface TreeNode {\r\n  id: number | string;\r\n  children: TreeNode[];\r\n}\r\n\r\ninterface TreeProps<T extends TreeNode> {\r\n  children: TreeItemRenderer<T>;\r\n  nodes: T[];\r\n  selectedKeys?: Key[];\r\n  expandedKeys?: Key[];\r\n  defaultExpandedKeys?: Key[];\r\n  onExpandedKeysChange?: (value: Key[]) => void;\r\n  defaultSelectedKeys?: Key[];\r\n  onSelectedKeysChange?: (value: Key[]) => void;\r\n}\r\n\r\nexport function Tree<T extends TreeNode>({\r\n  children,\r\n  nodes,\r\n  ...props\r\n}: TreeProps<T>) {\r\n  const [expandedKeys, setExpandedKeys] = useControlledState(\r\n    props.expandedKeys,\r\n    props.defaultSelectedKeys,\r\n    props.onExpandedKeysChange\r\n  );\r\n  const [selectedKeys, setSelectedKeys] = useControlledState(\r\n    props.selectedKeys,\r\n    props.defaultSelectedKeys,\r\n    props.onSelectedKeysChange\r\n  );\r\n  const [focusedNode, setFocusedNode] = useState<Key | undefined>();\r\n\r\n  const value: TreeContextValue = {\r\n    expandedKeys,\r\n    setExpandedKeys,\r\n    selectedKeys,\r\n    setSelectedKeys,\r\n    focusedNode,\r\n    setFocusedNode,\r\n  };\r\n\r\n  return (\r\n    <TreeContext.Provider value={value}>\r\n      <FocusScope>\r\n        <TreeRoot nodes={nodes} itemRenderer={children} />\r\n      </FocusScope>\r\n    </TreeContext.Provider>\r\n  );\r\n}\r\n\r\ninterface TreeRootProps<T extends TreeNode> {\r\n  nodes: TreeNode[];\r\n  itemRenderer: TreeItemRenderer<T>;\r\n}\r\n\r\nfunction TreeRoot<T extends TreeNode>(props: TreeRootProps<T>) {\r\n  return (\r\n    <ul className=\"overflow-hidden text-sm\" role=\"tree\">\r\n      {renderTree(props)}\r\n    </ul>\r\n  );\r\n}\r\n","import React, {useMemo, useRef} from 'react';\r\nimport {arrayToTree} from 'performant-array-to-tree';\r\nimport {useFolders} from '../../files/queries/use-folders';\r\nimport {DriveFolder} from '../../files/drive-entry';\r\nimport {driveState, useDriveStore} from '../../drive-store';\r\nimport {FolderIcon} from '@common/icons/material/Folder';\r\nimport {getPathForFolder, RootFolderPage} from '../../drive-page/drive-page';\r\nimport {mergeProps} from '@react-aria/utils';\r\nimport {\r\n  ConnectedDraggable,\r\n  useDraggable,\r\n} from '@common/ui/interactions/dnd/use-draggable';\r\nimport {useSidebarTreeDropTarget} from './use-sidebar-tree-drop-target';\r\nimport {makeFolderTreeDragId} from './folder-tree-drag-id';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport clsx from 'clsx';\r\nimport {BackupIcon} from '@common/icons/material/Backup';\r\nimport {TreeItem, TreeItemProps} from '@common/ui/tree/tree-item';\r\nimport {Tree} from '@common/ui/tree/tree';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\n\r\ninterface TreeFolder extends DriveFolder {\r\n  children: TreeFolder[];\r\n}\r\n\r\nexport function FolderTree() {\r\n  const navigate = useNavigate();\r\n  const {data} = useFolders();\r\n  const expandedKeys = useDriveStore(s => s.sidebarExpandedKeys);\r\n\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  let selectedKeys: number[] = [];\r\n  if (activePage?.isFolderPage) {\r\n    selectedKeys = activePage.folder ? [activePage.folder.id] : [];\r\n  }\r\n\r\n  const tree = useMemo(() => {\r\n    const folders = arrayToTree(data?.folders || [], {\r\n      parentId: 'parent_id',\r\n      dataField: null,\r\n    }) as TreeFolder[];\r\n    const rootFolder = {\r\n      ...RootFolderPage.folder,\r\n      children: folders,\r\n    };\r\n    return [rootFolder];\r\n  }, [data?.folders]);\r\n\r\n  return (\r\n    <Tree\r\n      nodes={tree}\r\n      expandedKeys={expandedKeys}\r\n      onExpandedKeysChange={keys => {\r\n        driveState().setSidebarExpandedKeys(keys);\r\n      }}\r\n      selectedKeys={selectedKeys}\r\n      onSelectedKeysChange={([id]) => {\r\n        const entryHash = findHash(id as number, tree);\r\n        if (entryHash) {\r\n          navigate(getPathForFolder(entryHash));\r\n        } else {\r\n          navigate(RootFolderPage.path);\r\n        }\r\n      }}\r\n    >\r\n      {() => <FolderTreeItem />}\r\n    </Tree>\r\n  );\r\n}\r\n\r\n// props will be passed by tree via cloneElement\r\nfunction FolderTreeItem(props: Partial<TreeItemProps<TreeFolder>>) {\r\n  const {node} = props as Required<TreeItemProps<TreeFolder>>;\r\n  const labelRef = useRef<HTMLDivElement>(null);\r\n  const isRootFolder = node.id === 0;\r\n  const isDragging = useDriveStore(s =>\r\n    s.entriesBeingDragged.includes(node.id)\r\n  );\r\n\r\n  const {draggableProps} = useDraggable({\r\n    type: 'fileEntry',\r\n    id: makeFolderTreeDragId(node),\r\n    ref: labelRef,\r\n    disabled: isRootFolder,\r\n    hidePreview: true,\r\n    onDragStart: (e, draggable) => {\r\n      const d = draggable as ConnectedDraggable<FileEntry[]>;\r\n      driveState().setEntriesBeingDragged(d.getData().map(e => e.id));\r\n      driveState().selectEntries([]);\r\n    },\r\n    onDragEnd: () => {\r\n      driveState().setEntriesBeingDragged([]);\r\n    },\r\n    getData: () => [node],\r\n  });\r\n\r\n  const {droppableProps, isDragOver} = useSidebarTreeDropTarget({\r\n    folder: node,\r\n    ref: labelRef,\r\n  });\r\n\r\n  return (\r\n    <TreeItem\r\n      {...mergeProps(draggableProps, droppableProps, props)}\r\n      onContextMenu={e => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        driveState().deselectEntries('all');\r\n        driveState().setContextMenuData({\r\n          x: e.clientX,\r\n          y: e.clientY,\r\n          entry: node,\r\n        });\r\n      }}\r\n      labelRef={labelRef}\r\n      className={isRootFolder ? 'focus-visible:ring-2' : undefined}\r\n      labelClassName={clsx(\r\n        isDragOver && 'bg-primary/selected ring ring-2 ring-inset ring-primary',\r\n        isDragging && 'opacity-30',\r\n        isRootFolder && 'h-40'\r\n      )}\r\n      icon={\r\n        isRootFolder ? (\r\n          <BackupIcon size=\"md\" className=\"mr-6\" />\r\n        ) : (\r\n          <FolderIcon size=\"sm\" className=\"mr-4\" />\r\n        )\r\n      }\r\n      label={node.name}\r\n    />\r\n  );\r\n}\r\n\r\nconst findHash = (id: number, nodes: FileEntry[]): string | undefined => {\r\n  for (const item of nodes) {\r\n    if (item.id === id) {\r\n      return item.hash;\r\n    } else if (item.children) {\r\n      const hash = findHash(id, item.children);\r\n      if (hash) {\r\n        return hash;\r\n      }\r\n    }\r\n  }\r\n};\r\n","import {CustomMenu, CustomMenuItem} from '@common/menus/custom-menu';\r\nimport {MenuPositions} from '../../menu-positions';\r\nimport React, {\r\n  ComponentPropsWithoutRef,\r\n  forwardRef,\r\n  useRef,\r\n  useState,\r\n} from 'react';\r\nimport {MenuItemConfig} from '@common/core/settings/settings';\r\nimport clsx from 'clsx';\r\nimport {useDroppable} from '@common/ui/interactions/dnd/use-droppable';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport {FolderTree} from './folder-tree';\r\nimport {useDeleteEntries} from '../../files/queries/use-delete-entries';\r\nimport {useActiveWorkspaceId} from '@common/workspace/active-workspace-id-context';\r\n\r\nexport function SidebarMenu() {\r\n  const {workspaceId} = useActiveWorkspaceId();\r\n  return (\r\n    <div className=\"container\" >\r\n    <div className=\"text-muted mt-26 px-12\">\r\n      <FolderTree />\r\n      <CustomMenu\r\n        menu={MenuPositions.DriveSidebar}\r\n        orientation=\"vertical\"\r\n        gap=\"gap-0\"\r\n      >\r\n        {item => {\r\n          if (item.action === '/drive/trash') {\r\n            return <TrashMenuItem key={item.id} item={item} />;\r\n          }\r\n          return <MenuItem key={item.id} item={item} />;\r\n        }}\r\n      </CustomMenu>\r\n    </div>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface MenuItemProps extends ComponentPropsWithoutRef<'a'> {\r\n  item: MenuItemConfig;\r\n  className?: string;\r\n}\r\nexport const MenuItem = forwardRef<HTMLAnchorElement, MenuItemProps>(\r\n  ({item, className, ...domProps}, ref) => {\r\n    return (\r\n      <CustomMenuItem\r\n        className={({isActive}) =>\r\n          clsx(\r\n            className,\r\n            'h-40 w-full my-4 px-24 rounded',\r\n            isActive\r\n              ? 'text-primary font-bold bg-primary/selected cursor-default'\r\n              : 'hover:bg-hover'\r\n          )\r\n        }\r\n        item={item}\r\n        ref={ref}\r\n        {...domProps}\r\n      />\r\n    );\r\n  }\r\n);\r\n\r\ninterface TrashMenuItemProps {\r\n  item: MenuItemConfig;\r\n}\r\nfunction TrashMenuItem({item}: TrashMenuItemProps) {\r\n  const deleteEntries = useDeleteEntries();\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const ref = useRef<HTMLAnchorElement>(null);\r\n\r\n  const {droppableProps} = useDroppable({\r\n    id: 'trash',\r\n    types: ['fileEntry'],\r\n    ref,\r\n    onDragEnter: () => {\r\n      setIsDragOver(true);\r\n    },\r\n    onDragLeave: () => {\r\n      setIsDragOver(false);\r\n    },\r\n    onDrop: draggable => {\r\n      const entryIds = (draggable.getData() as FileEntry[]).map(e => e.id);\r\n      deleteEntries.mutate({entryIds, deleteForever: false});\r\n    },\r\n  });\r\n  return (\r\n    <MenuItem\r\n      className={clsx(isDragOver && 'bg-primary/selected')}\r\n      ref={ref}\r\n      {...droppableProps}\r\n      item={item}\r\n    />\r\n  );\r\n}\r\n","import React, { useState } from 'react';\r\nimport { StorageMeter } from './storage-summary/storage-meter';\r\nimport { WorkspaceSelector } from '@common/workspace/workspace-selector';\r\nimport { RootFolderPage } from '../../drive-page/drive-page';\r\nimport { SidebarMenu } from './sidebar-menu';\r\nimport { useNavigate } from '@common/utils/hooks/use-navigate';\r\nimport { Button } from '@common/ui/buttons/button';\r\nimport { Link } from 'react-router-dom';\r\nimport { Trans } from '@common/i18n/trans';\r\nimport { useAuth } from '@common/auth/use-auth';\r\nimport clsx from 'clsx';\r\nimport { useSettings } from '@common/core/settings/use-settings';\r\nimport { Logo } from '@common/ui/navigation/navbar/logo';\r\nimport { useIsDarkMode } from '@common/ui/themes/use-is-dark-mode';\r\nimport { MenuIcon } from '@common/icons/material/Menu'; \r\n\r\ninterface SidebarProps {\r\n  className?: string;\r\n  logocolor?: 'dark' | 'light';\r\n}\r\n\r\nexport function Sidebar({ className, logocolor }: SidebarProps) {\r\n  const { isSubscribed } = useAuth();\r\n  const { billing } = useSettings();\r\n  const isDarkMode = useIsDarkMode();\r\n  const color = logocolor || (isDarkMode ? 'light' : 'dark');\r\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\r\n\r\n  const toggleSidebar = () => setIsSidebarOpen(!isSidebarOpen);\r\n\r\n  return (\r\n    <>\r\n      {/* Hamburger menu icon for mobile */}\r\n      <div className=\"lg:hidden fixed top-4 left-4 z-50\">\r\n        <button onClick={toggleSidebar} aria-label=\"Toggle Sidebar\">\r\n          <MenuIcon className=\"text-gray-700 dark:text-gray-300\" />\r\n        </button>\r\n      </div>\r\n\r\n      <div\r\n        className={clsx(\r\n          className,\r\n          'flex flex-col gap-20 bg-white dark:bg-gray-300 text-sm font-medium text-muted h-screen fixed z-40 transition-transform duration-300 ease-in-out',\r\n          isSidebarOpen ? 'translate-x-0' : '-translate-x-full', \r\n          'lg:translate-x-0', \r\n          'lg:w-240 w-240' \r\n        )}\r\n        style={{ boxShadow: '4px 0 10px rgba(0, 0, 0, 0.1)' }}\r\n      >\r\n        \r\n        <div className=\"sticky bottom-0 mt-20 flex items-center justify-center\">\r\n          <Logo isDarkMode={isDarkMode} color={color} logoColor={logocolor} />\r\n        </div>\r\n\r\n        <div className=\"flex-1 overflow-y-auto\">\r\n          <SidebarMenu />\r\n        </div>\r\n\r\n        <div className=\"mb-20 ml-4 w-200 bg-white dark:bg-gray-300 rounded-2xl shadow-lg\">\r\n          <StorageMeter />\r\n          {billing.enable ? (\r\n            <div className=\"mt-14 mb-20 pl-20\">\r\n              <Button\r\n                elementType={Link}\r\n                to={isSubscribed ? '/billing/change-plan' : '/pricing'}\r\n                variant=\"outline\"\r\n                size=\"xs\"\r\n                color=\"primary\"\r\n                className=\"text-gray-200\"\r\n              >\r\n                <Trans message=\"Upgrade\" />\r\n              </Button>\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction WorkspaceSwitcher() {\r\n  const navigate = useNavigate();\r\n  return (\r\n    <WorkspaceSelector\r\n      onChange={() => {\r\n        navigate(RootFolderPage.path);\r\n      }}\r\n      className=\"mt-auto w-full flex-shrink-0 border-t px-24 py-18\"\r\n    />\r\n  );\r\n}\r\n","import {InfiniteData, useInfiniteQuery} from '@tanstack/react-query';\r\nimport {useSearchParams} from 'react-router-dom';\r\nimport {LengthAwarePaginationResponse} from '@common/http/backend-response/pagination-response';\r\nimport {DriveEntry, DriveFolder} from '../drive-entry';\r\nimport {driveState, useDriveStore} from '../../drive-store';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {SortColumn, SortDirection} from '../../layout/sorting/available-sorts';\r\nimport {useActiveWorkspaceId} from '@common/workspace/active-workspace-id-context';\r\nimport {makeFolderPage, SearchPage} from '../../drive-page/drive-page';\r\nimport {useEffect} from 'react';\r\nimport {shallowEqual} from '@common/utils/shallow-equal';\r\n\r\nexport interface DriveApiIndexParams {\r\n  orderBy?: SortColumn;\r\n  orderDir?: SortDirection;\r\n  folderId?: string | number | null;\r\n  query?: string;\r\n  filters?: string;\r\n  deletedOnly?: boolean;\r\n  starredOnly?: boolean;\r\n  sharedOnly?: boolean;\r\n  perPage?: number;\r\n  page?: number;\r\n  recentOnly?: boolean;\r\n  workspaceId?: number | null;\r\n  pageId?: number | string;\r\n}\r\n\r\ninterface EntriesPaginationResponse\r\n  extends LengthAwarePaginationResponse<DriveEntry> {\r\n  folder?: DriveFolder;\r\n}\r\n\r\nfunction fetchEntries(\r\n  params: DriveApiIndexParams,\r\n): Promise<EntriesPaginationResponse> {\r\n  return apiClient\r\n    .get('drive/file-entries', {\r\n      params,\r\n    })\r\n    .then(response => response.data);\r\n}\r\n\r\nconst setActiveFolder = (response: InfiniteData<EntriesPaginationResponse>) => {\r\n  const firstPage = response.pages[0];\r\n  const newFolder = firstPage.folder;\r\n  const currentPage = driveState().activePage;\r\n\r\n  if (\r\n    newFolder &&\r\n    currentPage &&\r\n    currentPage.id === newFolder.hash &&\r\n    // only update page if once to set the folder or if permissions change, to keep page reference as stable as possible\r\n    (!currentPage.folder ||\r\n      !shallowEqual(newFolder.permissions, currentPage.folder?.permissions))\r\n  ) {\r\n    driveState().setActivePage(makeFolderPage(newFolder));\r\n  }\r\n  return response;\r\n};\r\n\r\nexport function usePaginatedEntries() {\r\n  const page = useDriveStore(s => s.activePage);\r\n  const sortDescriptor = useDriveStore(s => s.sortDescriptor);\r\n  const [searchParams] = useSearchParams();\r\n  const {workspaceId} = useActiveWorkspaceId();\r\n  const params: DriveApiIndexParams = {\r\n    pageId: page?.id,\r\n    ...page?.queryParams,\r\n    ...Object.fromEntries(searchParams),\r\n    folderId: page?.isFolderPage ? page.id : null,\r\n    workspaceId,\r\n    ...sortDescriptor,\r\n  };\r\n\r\n  // if we have no search query, there's no need to call the API, show no results message instead\r\n  const isDisabledInSearch =\r\n    page === SearchPage && !params.query && !params.filters;\r\n\r\n  const query = useInfiniteQuery({\r\n    queryKey: DriveQueryKeys.fetchEntries(params),\r\n    queryFn: ({pageParam = 1}) => {\r\n      return fetchEntries({...params, page: pageParam});\r\n    },\r\n    initialPageParam: 1,\r\n    getNextPageParam: lastResponse => {\r\n      const currentPage = lastResponse.current_page;\r\n      const lastPage = lastResponse.last_page;\r\n      if (currentPage >= lastPage) {\r\n        return undefined;\r\n      }\r\n      return currentPage + 1;\r\n    },\r\n    enabled: page != null && !isDisabledInSearch,\r\n  });\r\n\r\n  // need to do this in effect, to avoid react errors about\r\n  // multiple components re-rendering at the same time\r\n  useEffect(() => {\r\n    if (query.data?.pages[0].folder) {\r\n      setActiveFolder(query.data);\r\n    }\r\n  }, [query.data]);\r\n\r\n  return query;\r\n}\r\n\r\nexport function getAllEntries() {\r\n  const caches = queryClient.getQueriesData<\r\n    InfiniteData<EntriesPaginationResponse>\r\n  >({queryKey: DriveQueryKeys.fetchEntries()});\r\n  return caches.reduce<DriveEntry[]>((all, cache) => {\r\n    const current = cache[1] ? cache[1].pages.flatMap(p => p.data) : [];\r\n    return [...all, ...current];\r\n  }, []);\r\n}\r\n","import {\r\n  BackendFilter,\r\n  FilterControlType,\r\n  FilterOperator,\r\n} from '@common/datatable/filters/backend-filter';\r\nimport {FILE_ENTRY_TYPE_FILTER} from '@common/admin/file-entry/file-entry-index-filters';\r\nimport {message} from '@common/i18n/message';\r\nimport {\r\n  createdAtFilter,\r\n  updatedAtFilter,\r\n} from '@common/datatable/filters/timestamp-filters';\r\n\r\nexport const driveSearchFilters: BackendFilter[] = [\r\n  FILE_ENTRY_TYPE_FILTER,\r\n  {\r\n    key: 'owner_id',\r\n    label: message('Owner'),\r\n    description: message('User file was uploaded by'),\r\n    defaultOperator: FilterOperator.eq,\r\n    control: {\r\n      type: FilterControlType.Select,\r\n      defaultValue: '02',\r\n      options: [\r\n        {\r\n          key: '01',\r\n          label: message('anyone'),\r\n          value: {value: null, operator: '!='},\r\n        },\r\n        {\r\n          key: '02',\r\n          label: message('me'),\r\n          value: '{authId}',\r\n        },\r\n        {\r\n          key: '03',\r\n          label: message('not me'),\r\n          value: {value: '{authId}', operator: '!='},\r\n        },\r\n      ],\r\n    },\r\n  },\r\n  createdAtFilter({\r\n    description: message('Date file was uploaded'),\r\n  }),\r\n  updatedAtFilter({\r\n    description: message('Date file was last changed'),\r\n  }),\r\n  {\r\n    key: 'deleted_at',\r\n    label: message('In trash'),\r\n    description: message('Only show files that are in the trash'),\r\n    defaultOperator: FilterOperator.ne,\r\n    control: {\r\n      type: FilterControlType.BooleanToggle,\r\n      defaultValue: null,\r\n    },\r\n  },\r\n  {\r\n    key: 'shareableLink',\r\n    label: message('Has shareable link'),\r\n    description: message('Only show files that have a shareable link'),\r\n    defaultOperator: FilterOperator.has,\r\n    control: {\r\n      type: FilterControlType.BooleanToggle,\r\n      defaultValue: '*',\r\n    },\r\n  },\r\n  {\r\n    control: {\r\n      type: FilterControlType.BooleanToggle,\r\n      defaultValue: true,\r\n    },\r\n    key: 'sharedByMe',\r\n    label: message('Shared by me'),\r\n    description: message('Only show files that are shared with someone'),\r\n    defaultOperator: FilterOperator.eq,\r\n  },\r\n];\r\n","import React, {useContext, useState} from 'react';\r\nimport {driveSearchFilters} from './drive-search-filters';\r\nimport {useDriveStore} from '../drive-store';\r\nimport {SearchPage} from '../drive-page/drive-page';\r\nimport {TextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport {SearchIcon} from '@common/icons/material/Search';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\nimport {FilterList} from '@common/datatable/filters/filter-list/filter-list';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\nimport {useSearchParams} from 'react-router-dom';\r\nimport {message} from '@common/i18n/message';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\n\r\nconst alwaysShownFilters = driveSearchFilters.map(f => f.key);\r\n\r\nexport function SearchFilterList() {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const {isMobileMode} = useContext(DashboardLayoutContext);\r\n  const {trans} = useTrans();\r\n  const navigate = useNavigate();\r\n  const [searchParams] = useSearchParams();\r\n  const [inputValue, setInputValue] = useState(searchParams.get('query') || '');\r\n\r\n  if (activePage !== SearchPage) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"mb-30 mt-10 px-10 md:px-26\">\r\n      {isMobileMode && (\r\n        <form\r\n          className=\"contents\"\r\n          onSubmit={e => {\r\n            e.preventDefault();\r\n            // blur input so mobile keyboard is hidden\r\n            if (document.activeElement?.tagName === 'INPUT') {\r\n              (document.activeElement as HTMLInputElement).blur();\r\n            }\r\n            navigate(\r\n              {\r\n                pathname: SearchPage.path,\r\n                search: `?query=${inputValue}`,\r\n              },\r\n              {replace: true},\r\n            );\r\n          }}\r\n        >\r\n          <TextField\r\n            autoFocus\r\n            className=\"mb-20\"\r\n            startAdornment={\r\n              <IconButton type=\"submit\">\r\n                <SearchIcon />\r\n              </IconButton>\r\n            }\r\n            placeholder={trans(message('Type to search'))}\r\n            value={inputValue}\r\n            onChange={e => setInputValue(e.target.value)}\r\n          />\r\n        </form>\r\n      )}\r\n      <FilterList\r\n        filters={driveSearchFilters}\r\n        pinnedFilters={alwaysShownFilters}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import {InteractableRect} from '../interactable-event';\r\n\r\nexport function restrictResizableWithinBoundary(\r\n  rect: InteractableRect,\r\n  boundaryRect: InteractableRect\r\n) {\r\n  const boundedRect = {...rect};\r\n\r\n  // restrict to left edge of boundary\r\n  boundedRect.left = Math.max(0, boundedRect.left);\r\n  // compensate width when left is bounded\r\n  const leftRestriction = boundedRect.left - rect.left;\r\n  if (leftRestriction > 0) {\r\n    boundedRect.width -= leftRestriction;\r\n  }\r\n\r\n  // restrict to top edge of boundary\r\n  boundedRect.top = Math.max(0, boundedRect.top);\r\n  // compensate height when top is bounded\r\n  const topRestriction = boundedRect.top - rect.top;\r\n  if (topRestriction > 0) {\r\n    boundedRect.height -= topRestriction;\r\n  }\r\n\r\n  // restrict to right edge of boundary\r\n  boundedRect.width = Math.min(\r\n    boundedRect.width,\r\n    boundaryRect.width - boundedRect.left\r\n  );\r\n\r\n  // restrict to bottom edge of boundary\r\n  boundedRect.height = Math.min(\r\n    boundedRect.height,\r\n    boundaryRect.height - boundedRect.top\r\n  );\r\n\r\n  return boundedRect;\r\n}\r\n","import {RefObject, useLayoutEffect, useRef} from 'react';\r\nimport {droppables} from '../drag-state';\r\nimport {InteractableRect} from '../../interactable-event';\r\nimport {DraggableId} from '../use-draggable';\r\n\r\nexport interface ConnectedMouseSelectable {\r\n  id: DraggableId;\r\n  onSelected?: () => void;\r\n  onDeselected?: () => void;\r\n  ref: RefObject<HTMLElement>;\r\n  rect?: InteractableRect;\r\n}\r\n\r\nexport const mouseSelectables = new Map<\r\n  DraggableId,\r\n  ConnectedMouseSelectable\r\n>();\r\n\r\nexport function useMouseSelectable(options: ConnectedMouseSelectable) {\r\n  const {id, ref} = options;\r\n  const optionsRef = useRef(options);\r\n  optionsRef.current = options;\r\n\r\n  useLayoutEffect(() => {\r\n    if (!ref.current) return;\r\n    // register droppable regardless if it's enabled or not, it might be used by mouse selection box\r\n    mouseSelectables.set(id, {\r\n      ...mouseSelectables.get(id),\r\n      id,\r\n      ref,\r\n      // avoid stale closures\r\n      onSelected: () => {\r\n        optionsRef.current.onSelected?.();\r\n      },\r\n      onDeselected: () => optionsRef.current.onDeselected?.(),\r\n    });\r\n    return () => {\r\n      droppables.delete(id);\r\n    };\r\n  }, [id, optionsRef, ref]);\r\n}\r\n","import {InteractableRect} from '../interactable-event';\r\n\r\nexport function rectsIntersect(\r\n  rectA?: InteractableRect,\r\n  rectB?: InteractableRect\r\n) {\r\n  if (!rectA || !rectB) return false;\r\n  return (\r\n    rectA.left <= rectB.left + rectB.width &&\r\n    rectA.left + rectA.width >= rectB.left &&\r\n    rectA.top <= rectB.top + rectB.height &&\r\n    rectA.top + rectA.height >= rectB.top\r\n  );\r\n}\r\n","import React, {RefObject, useRef} from 'react';\r\nimport {usePointerEvents} from '../../use-pointer-events';\r\nimport {InteractableRect} from '../../interactable-event';\r\nimport {restrictResizableWithinBoundary} from '../../utils/restrict-resizable-within-boundary';\r\nimport {activeInteraction} from '../../active-interaction';\r\nimport {updateRects} from '../update-rects';\r\nimport {mouseSelectables} from './use-mouse-selectable';\r\nimport {rectsIntersect} from '../../utils/rects-intersect';\r\nimport {DraggableId} from '../use-draggable';\r\n\r\ninterface SelectionState {\r\n  startPoint?: {x: number; y: number; scrollTop: number};\r\n  endPoint?: {x: number; y: number};\r\n  boundaryRect?: InteractableRect & {heightWithoutScroll: number};\r\n  scrollListener?: EventListener;\r\n  rafId?: number;\r\n  selectedIds?: Set<DraggableId>;\r\n}\r\n\r\ninterface Props {\r\n  onPointerDown?: (e: React.PointerEvent) => void;\r\n  containerRef?: RefObject<HTMLDivElement>;\r\n}\r\nexport function useMouseSelectionBox({onPointerDown, ...props}: Props = {}) {\r\n  const defaultRef = useRef<HTMLDivElement>(null);\r\n  const containerRef = props.containerRef || defaultRef;\r\n  const boxRef = useRef<HTMLDivElement>(null);\r\n\r\n  let state = useRef<SelectionState>({}).current;\r\n\r\n  const drawSelectionBox = () => {\r\n    if (state.rafId) {\r\n      cancelAnimationFrame(state.rafId);\r\n    }\r\n\r\n    if (!state.startPoint || !state.endPoint || !state.boundaryRect) return;\r\n\r\n    const startPoint = state.startPoint;\r\n    const endPoint = state.endPoint;\r\n    const initialScrollTop = startPoint.scrollTop || 0;\r\n    const currentScrollTop = containerRef.current?.scrollTop || 0;\r\n\r\n    const newRect = {\r\n      left: Math.min(startPoint.x, endPoint.x),\r\n      top: Math.min(startPoint.y, endPoint.y),\r\n      width: Math.abs(startPoint.x - endPoint.x),\r\n      height: Math.abs(startPoint.y - endPoint.y),\r\n    };\r\n\r\n    // convert box coords to be relative to container and not viewport\r\n    newRect.left -= state.boundaryRect.left;\r\n    newRect.top -= state.boundaryRect.top;\r\n\r\n    // take initial scroll of container into account\r\n    newRect.top += initialScrollTop;\r\n\r\n    // scroll diff between drag start and now (auto scroll or mouse wheel)\r\n    const scrollDiff = currentScrollTop - initialScrollTop;\r\n    const scrollValue = Math.abs(scrollDiff);\r\n\r\n    // top needs to be changed only if scroll direction is top\r\n    if (scrollDiff < 0) {\r\n      newRect.top -= scrollValue;\r\n    }\r\n\r\n    // height needs to be changed regardless of direction and method\r\n    newRect.height += scrollValue;\r\n\r\n    const boundedRect = state.boundaryRect\r\n      ? restrictResizableWithinBoundary(newRect, state.boundaryRect)\r\n      : {...newRect};\r\n\r\n    if (boxRef.current) {\r\n      state.rafId = requestAnimationFrame(() => {\r\n        if (boxRef.current) {\r\n          boxRef.current.style.display = `block`;\r\n          boxRef.current.style.transform = `translate(${boundedRect.left}px, ${boundedRect.top}px)`;\r\n          boxRef.current.style.width = `${boundedRect.width}px`;\r\n          boxRef.current.style.height = `${boundedRect.height}px`;\r\n        }\r\n        state.rafId = undefined;\r\n      });\r\n    }\r\n\r\n    // convert rect back to absolute for intersection testing\r\n    const absoluteRect = {\r\n      ...boundedRect,\r\n      left: boundedRect.left + state.boundaryRect.left,\r\n      top: boundedRect.top + state.boundaryRect.top - currentScrollTop,\r\n    };\r\n\r\n    for (const [, selectable] of mouseSelectables) {\r\n      const intersect = rectsIntersect(selectable.rect, absoluteRect);\r\n      if (intersect && !state.selectedIds?.has(selectable.id)) {\r\n        state.selectedIds?.add(selectable.id);\r\n        selectable.onSelected?.();\r\n      } else if (!intersect && state.selectedIds?.has(selectable.id)) {\r\n        state.selectedIds?.delete(selectable.id);\r\n        selectable.onDeselected?.();\r\n      }\r\n    }\r\n  };\r\n\r\n  const pointerEvents = usePointerEvents({\r\n    minimumMovement: 4,\r\n    onPointerDown,\r\n    onMoveStart: e => {\r\n      if (activeInteraction) {\r\n        return false;\r\n      }\r\n      updateRects(mouseSelectables);\r\n      state = {\r\n        selectedIds: new Set(),\r\n      };\r\n      const el = containerRef.current;\r\n      state.startPoint = {\r\n        x: e.clientX,\r\n        y: e.clientY,\r\n        scrollTop: el?.scrollTop || 0,\r\n      };\r\n\r\n      state.scrollListener = e => {\r\n        if (!state.startPoint) return;\r\n        // update rects on scroll, because we are using relative position\r\n        updateRects(mouseSelectables);\r\n        if (state.boundaryRect?.height) {\r\n          state.boundaryRect.height = (e.target as HTMLElement).scrollHeight;\r\n        }\r\n        // draw selection box (for autoscroll and mousewheel)\r\n        drawSelectionBox();\r\n      };\r\n\r\n      if (el) {\r\n        const rect = el.getBoundingClientRect();\r\n        el.addEventListener('scroll', state.scrollListener);\r\n        state.boundaryRect = {\r\n          top: rect.top,\r\n          left: rect.left,\r\n          height: el.scrollHeight,\r\n          heightWithoutScroll: rect.height,\r\n          width: el.scrollWidth,\r\n        };\r\n      }\r\n    },\r\n    onMove: e => {\r\n      state.endPoint = {x: e.clientX, y: e.clientY};\r\n\r\n      if (state.boundaryRect && containerRef.current) {\r\n        const reachedBottomEdge =\r\n          e.clientY + 20 >\r\n          state.boundaryRect.heightWithoutScroll + state.boundaryRect.top;\r\n        const reachedTopEdge = e.clientY - 20 < state.boundaryRect.top;\r\n\r\n        if (reachedBottomEdge) {\r\n          containerRef.current.scrollBy({top: 10});\r\n        } else if (reachedTopEdge) {\r\n          containerRef.current.scrollBy({top: -10});\r\n        }\r\n      }\r\n\r\n      drawSelectionBox();\r\n    },\r\n    onMoveEnd: () => {\r\n      if (state.rafId) {\r\n        cancelAnimationFrame(state.rafId);\r\n      }\r\n      if (containerRef.current && state.scrollListener) {\r\n        containerRef.current.removeEventListener(\r\n          'scroll',\r\n          state.scrollListener\r\n        );\r\n      }\r\n      if (boxRef.current) {\r\n        boxRef.current.style.display = `none`;\r\n        boxRef.current.style.transform = '';\r\n        boxRef.current.style.width = '';\r\n        boxRef.current.style.height = '';\r\n      }\r\n      state = {};\r\n    },\r\n  });\r\n\r\n  return {\r\n    containerProps: {\r\n      ...pointerEvents.domProps,\r\n      ref: containerRef,\r\n    },\r\n    boxProps: {ref: boxRef},\r\n  };\r\n}\r\n","import {DriveEntry} from '../drive-entry';\r\nimport {usePaginatedEntries} from './use-paginated-entries';\r\n\r\nexport function useEntries(): DriveEntry[] {\r\n  const query = usePaginatedEntries();\r\n  if (!query.data) return [];\r\n  return query.data.pages.flatMap(p => p.data);\r\n}\r\n","import {driveState, useDriveStore} from '../drive-store';\r\nimport {getAllEntries} from './queries/use-paginated-entries';\r\nimport {DriveEntry, DriveFolder} from './drive-entry';\r\nimport {useEntries} from './queries/use-entries';\r\nimport {useFolders} from './queries/use-folders';\r\n\r\nexport function useSelectedEntries(): DriveEntry[] {\r\n  const ids = useDriveStore(s => s.selectedEntries);\r\n  const entries = useEntries();\r\n  return Array.from(ids)\r\n    .map(id => entries.find(entry => entry.id === id))\r\n    .filter(e => !!e) as DriveEntry[];\r\n}\r\n\r\nexport function useSelectedEntry(): DriveEntry | null {\r\n  const entries = useSelectedEntries();\r\n  return entries[0];\r\n}\r\n\r\nexport function useSelectedEntryParent(): DriveFolder | null | undefined {\r\n  const entry = useSelectedEntry();\r\n  const {data} = useFolders();\r\n  if (!entry || !data) return;\r\n  return data.folders.find(e => e.id === entry.parent_id) as DriveFolder;\r\n}\r\n\r\nexport function getSelectedEntries(): DriveEntry[] {\r\n  const ids = Array.from(driveState().selectedEntries);\r\n  const allEntries = getAllEntries();\r\n  return ids\r\n    .map(id => allEntries.find(entry => entry.id === id))\r\n    .filter(e => !!e) as DriveEntry[];\r\n}\r\n","import React, {createElement} from 'react';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {EntryActionMenuTrigger} from './entry-action-menu-trigger';\r\nimport {MoreVertIcon} from '@common/icons/material/MoreVert';\r\nimport {Tooltip} from '@common/ui/tooltip/tooltip';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {useSelectedEntries} from '../files/use-selected-entries';\r\nimport {\r\n  useDeleteEntriesAction,\r\n  usePreviewAction,\r\n  useRemoveSharedEntriesAction,\r\n  useShareAction,\r\n} from './use-entry-actions';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {EntryAction} from './entry-action';\r\n\r\ninterface EntryActionListProps {\r\n  className?: string;\r\n}\r\nexport function EntryActionList({className}: EntryActionListProps) {\r\n  const selectedEntries = useSelectedEntries();\r\n\r\n  if (!selectedEntries.length) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className={className}>\r\n      <ActionList entries={selectedEntries} />\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface ActionListProps {\r\n  entries: DriveEntry[];\r\n}\r\nfunction ActionList({entries}: ActionListProps) {\r\n  const preview = usePreviewAction(entries);\r\n  const share = useShareAction(entries);\r\n  const deleteAction = useDeleteEntriesAction(entries);\r\n  const removeShared = useRemoveSharedEntriesAction(entries);\r\n\r\n  const actions = [preview, share, deleteAction, removeShared].filter(\r\n    action => !!action\r\n  ) as EntryAction[];\r\n\r\n  return (\r\n    <div className=\"entry-action-list\">\r\n      {actions.map(action => (\r\n        <Tooltip key={action.key} label={<Trans {...action.label} />}>\r\n          <IconButton\r\n            size=\"sm\"\r\n            onClick={() => {\r\n              action.execute();\r\n            }}\r\n          >\r\n            {createElement(action.icon)}\r\n          </IconButton>\r\n        </Tooltip>\r\n      ))}\r\n      <EntryActionMenuTrigger entries={entries}>\r\n        <Tooltip label={<Trans message=\"More actions\" />}>\r\n          <IconButton>\r\n            <MoreVertIcon />\r\n          </IconButton>\r\n        </Tooltip>\r\n      </EntryActionMenuTrigger>\r\n    </div>\r\n  );\r\n}\r\n","import {useSelectedEntries} from './use-selected-entries';\r\nimport {DriveEntry} from './drive-entry';\r\nimport {useEntryActions} from '../entry-actions/use-entry-actions';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {ContextMenu} from '@common/ui/navigation/menu/context-menu';\r\nimport {MenuItem} from '@common/ui/navigation/menu/menu-trigger';\r\nimport React, {createElement} from 'react';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {EntryAction} from '../entry-actions/entry-action';\r\nimport {DrivePage, RootFolderPage} from '../drive-page/drive-page';\r\nimport {useDrivePageActions} from '../entry-actions/use-drive-page-actions';\r\n\r\nexport function DriveContextMenu() {\r\n  const selectedEntries = useSelectedEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const data = useDriveStore(s => s.contextMenuData);\r\n  const entries = data?.entry ? [data.entry] : selectedEntries;\r\n\r\n  // right-clicked root folder\r\n  if (data?.entry?.id === 0) {\r\n    return <PageContextMenu position={data} page={RootFolderPage} />;\r\n  }\r\n\r\n  if (data && entries.length) {\r\n    return <EntriesContextMenu entries={entries} position={data} />;\r\n  }\r\n\r\n  if (data && activePage) {\r\n    return <PageContextMenu position={data} page={activePage} />;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\ninterface EntriesContextMenuProps {\r\n  position: {x: number; y: number};\r\n  entries: DriveEntry[];\r\n}\r\nfunction EntriesContextMenu({entries, position}: EntriesContextMenuProps) {\r\n  const actions = useEntryActions(entries);\r\n  return <BaseContextMenu position={position} actions={actions} />;\r\n}\r\n\r\ninterface PageContextMenuProps {\r\n  position: {x: number; y: number};\r\n  page: DrivePage;\r\n}\r\nfunction PageContextMenu({page, position}: PageContextMenuProps) {\r\n  const actions = useDrivePageActions(page);\r\n  return <BaseContextMenu position={position} actions={actions} />;\r\n}\r\n\r\ninterface BaseContextMenuProps {\r\n  position: {x: number; y: number};\r\n  actions: EntryAction[];\r\n}\r\nfunction BaseContextMenu({position, actions}: BaseContextMenuProps) {\r\n  return (\r\n    <ContextMenu\r\n      position={position}\r\n      onOpenChange={isOpen => {\r\n        if (!isOpen) {\r\n          driveState().setContextMenuData(null);\r\n        }\r\n      }}\r\n    >\r\n      {actions.map(action => (\r\n        <MenuItem\r\n          value={action.key}\r\n          key={action.key}\r\n          onSelected={action.execute}\r\n          startIcon={createElement(action.icon)}\r\n        >\r\n          <Trans {...action.label} />\r\n        </MenuItem>\r\n      ))}\r\n    </ContextMenu>\r\n  );\r\n}\r\n","import {useMediaQuery} from './use-media-query';\r\n\r\nexport function useIsTouchDevice() {\r\n  return useMediaQuery('((pointer: coarse))');\r\n}\r\n","import {\r\n  ConnectedDraggable,\r\n  useDraggable,\r\n} from '@common/ui/interactions/dnd/use-draggable';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {getSelectedEntries} from '../files/use-selected-entries';\r\nimport {useDroppable} from '@common/ui/interactions/dnd/use-droppable';\r\nimport {\r\n  folderAcceptsDrop,\r\n  useFolderDropAction,\r\n} from '../files/use-folder-drop-action';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {useRef, useState} from 'react';\r\nimport clsx from 'clsx';\r\nimport {useIsTouchDevice} from '@common/utils/hooks/is-touch-device';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport {useMouseSelectable} from '@common/ui/interactions/dnd/mouse-selection/use-mouse-selectable';\r\nimport {TrashPage} from '@app/drive/drive-page/drive-page';\r\n\r\nexport function useFileViewDnd<T extends HTMLElement = HTMLElement>(\r\n  entry: DriveEntry\r\n) {\r\n  const isTouchDevice = useIsTouchDevice();\r\n  const ref = useRef<T>(null);\r\n  const {onDrop} = useFolderDropAction(entry);\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const isDragging = useDriveStore(s =>\r\n    s.entriesBeingDragged.includes(entry.id)\r\n  );\r\n  const activePage = useDriveStore(s => s.activePage);\r\n\r\n  const {draggableProps} = useDraggable({\r\n    disabled: !!isTouchDevice || activePage === TrashPage,\r\n    id: entry.id,\r\n    type: 'fileEntry',\r\n    ref,\r\n    hidePreview: true,\r\n    onDragStart: (e, target: ConnectedDraggable<FileEntry[]>) => {\r\n      if (!driveState().selectedEntries.has(entry.id)) {\r\n        driveState().selectEntries([entry.id]);\r\n      }\r\n      driveState().setEntriesBeingDragged(target.getData().map(e => e.id));\r\n    },\r\n    onDragEnd: () => {\r\n      driveState().setEntriesBeingDragged([]);\r\n    },\r\n    getData: () => getSelectedEntries(),\r\n  });\r\n\r\n  const {droppableProps} = useDroppable<T>({\r\n    id: entry.id,\r\n    disabled: isTouchDevice || entry.type !== 'folder',\r\n    ref,\r\n    types: ['fileEntry', 'nativeFile'],\r\n    acceptsDrop: target => folderAcceptsDrop(target, entry),\r\n    onDragEnter: () => setIsDragOver(true),\r\n    onDragLeave: () => setIsDragOver(false),\r\n    onDrop,\r\n  });\r\n\r\n  useMouseSelectable({\r\n    id: entry.id,\r\n    ref,\r\n    onSelected: () => {\r\n      driveState().selectEntries([entry.id], true);\r\n    },\r\n    onDeselected: () => {\r\n      driveState().deselectEntries([entry.id]);\r\n    },\r\n  });\r\n\r\n  const itemClassName = clsx(\r\n    isDragging && 'opacity-20',\r\n    isDragOver && 'ring ring-offset-4 ring-primary bg-primary-light/10 rounded'\r\n  );\r\n\r\n  return {\r\n    draggableProps,\r\n    droppableProps,\r\n    isDragOver,\r\n    isDragging,\r\n    itemClassName,\r\n    ref,\r\n  };\r\n}\r\n","import {DriveEntry} from '../../files/drive-entry';\r\nimport {RowElementProps} from '@common/ui/tables/table-row';\r\nimport {mergeProps} from '@react-aria/utils';\r\nimport {useFileViewDnd} from '../use-file-view-dnd';\r\nimport clsx from 'clsx';\r\nimport React, {useContext} from 'react';\r\nimport {driveState} from '../../drive-store';\r\nimport {TableContext} from '@common/ui/tables/table-context';\r\n\r\nexport function FileTableRow({\r\n  item,\r\n  children,\r\n  className,\r\n  ...domProps\r\n}: RowElementProps<DriveEntry>) {\r\n  const {isCollapsedMode} = useContext(TableContext);\r\n  const {draggableProps, droppableProps, itemClassName, ref} =\r\n    useFileViewDnd<HTMLDivElement>(item);\r\n\r\n  return (\r\n    <div\r\n      className={clsx(className, itemClassName)}\r\n      ref={ref}\r\n      {...mergeProps(draggableProps, droppableProps, domProps, {\r\n        onContextMenu: (e: React.MouseEvent) => {\r\n          e.preventDefault();\r\n          e.stopPropagation();\r\n          if (!isCollapsedMode) {\r\n            if (!driveState().selectedEntries.has(item.id)) {\r\n              driveState().selectEntries([item.id]);\r\n            }\r\n            driveState().setContextMenuData({x: e.clientX, y: e.clientY});\r\n          }\r\n        },\r\n      })}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n","import {useCallback} from 'react';\r\nimport {getPathForFolder, TrashPage} from '../drive-page/drive-page';\r\nimport {driveState} from '../drive-store';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {getSelectedEntries} from '../files/use-selected-entries';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\n\r\nexport function useViewItemActionHandler() {\r\n  const navigate = useNavigate();\r\n\r\n  const performViewItemAction = useCallback(\r\n    (entry: DriveEntry) => {\r\n      if (entry && entry.type === 'folder') {\r\n        if (driveState().activePage === TrashPage) {\r\n          driveState().setActiveActionDialog('trashFolderBlock', [entry]);\r\n        } else {\r\n          navigate(getPathForFolder(entry.hash));\r\n        }\r\n      } else {\r\n        const selectedEntries = getSelectedEntries();\r\n        driveState().setActiveActionDialog(\r\n          'preview',\r\n          selectedEntries.length ? selectedEntries : [entry]\r\n        );\r\n      }\r\n    },\r\n    [navigate]\r\n  );\r\n\r\n  return {performViewItemAction};\r\n}\r\n","import {DriveEntry} from '../../files/drive-entry';\r\nimport React, {useMemo} from 'react';\r\nimport {Table} from '@common/ui/tables/table';\r\nimport {\r\n  DriveSortDescriptor,\r\n  driveState,\r\n  useDriveStore,\r\n} from '../../drive-store';\r\nimport {FileTableRow} from './file-table-row';\r\nimport {useViewItemActionHandler} from '../use-view-item-action-handler';\r\nimport {fileTableColumns} from './file-table-columns';\r\n\r\ninterface Props {\r\n  entries: DriveEntry[];\r\n}\r\nexport function FileTable({entries}: Props) {\r\n  const {performViewItemAction} = useViewItemActionHandler();\r\n  const selectedEntries = useDriveStore(s => s.selectedEntries);\r\n  const sortDescriptor = useDriveStore(s => s.sortDescriptor);\r\n\r\n  const selectedRows = useMemo(() => {\r\n    return [...selectedEntries];\r\n  }, [selectedEntries]);\r\n\r\n  return (\r\n    <Table\r\n      columns={fileTableColumns}\r\n      data={entries}\r\n      sortDescriptor={sortDescriptor}\r\n      onSortChange={value => {\r\n        driveState().setSortDescriptor(value as DriveSortDescriptor);\r\n      }}\r\n      onAction={performViewItemAction}\r\n      selectedRows={selectedRows}\r\n      selectionStyle=\"highlight\"\r\n      renderRowAs={FileTableRow}\r\n      onSelectionChange={value => {\r\n        driveState().selectEntries(value as number[]);\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, {useContext} from 'react';\r\nimport {DriveEntry} from '../../files/drive-entry';\r\nimport {driveState, useDriveStore} from '../../drive-store';\r\nimport {mergeProps} from '@react-aria/utils';\r\nimport {useFileViewDnd} from '../use-file-view-dnd';\r\nimport {useViewItemActionHandler} from '../use-view-item-action-handler';\r\nimport {usePointerEvents} from '@common/ui/interactions/use-pointer-events';\r\nimport {createEventHandler} from '@common/utils/dom/create-event-handler';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\nimport {BaseFileGridItem} from './base-file-grid-item';\r\nimport {EntryActionMenuTrigger} from '../../entry-actions/entry-action-menu-trigger';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {MoreVertIcon} from '@common/icons/material/MoreVert';\r\nimport {Checkbox} from '@common/ui/forms/toggle/checkbox';\r\nimport {isCtrlOrShiftPressed} from '@common/utils/keybinds/is-ctrl-or-shift-pressed';\r\n\r\ninterface FileGridItemProps {\r\n  entry: DriveEntry;\r\n}\r\nexport function FileGridItem({entry}: FileGridItemProps) {\r\n  const isSelected = useDriveStore(s => s.selectedEntries.has(entry.id));\r\n  const {performViewItemAction} = useViewItemActionHandler();\r\n  const {isMobileMode} = useContext(DashboardLayoutContext);\r\n\r\n  const {draggableProps, droppableProps, itemClassName, ref} =\r\n    useFileViewDnd<HTMLDivElement>(entry);\r\n\r\n  const toggleEntry = () => {\r\n    if (isSelected) {\r\n      driveState().deselectEntries([entry.id]);\r\n    } else {\r\n      driveState().selectEntries([entry.id], true);\r\n    }\r\n  };\r\n\r\n  const pressHandler = (e: PointerEvent, el: HTMLElement) => {\r\n    if (isMobileMode) {\r\n      if (driveState().selectedEntries.size) {\r\n        toggleEntry();\r\n      } else {\r\n        performViewItemAction(entry);\r\n      }\r\n    } else {\r\n      if (isCtrlOrShiftPressed(e)) {\r\n        toggleEntry();\r\n      } else {\r\n        driveState().selectEntries([entry.id]);\r\n      }\r\n    }\r\n  };\r\n\r\n  const {domProps: pressProps} = usePointerEvents({\r\n    onLongPress: isMobileMode ? () => toggleEntry() : undefined,\r\n    onPress: pressHandler,\r\n  });\r\n\r\n  const keyboardHandler: React.KeyboardEventHandler = e => {\r\n    if (e.key === 'Enter' || e.key === ' ') {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      performViewItemAction(entry);\r\n    }\r\n  };\r\n\r\n  const contextMenuHandler: React.MouseEventHandler = e => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    if (!isMobileMode) {\r\n      if (!driveState().selectedEntries.has(entry.id)) {\r\n        driveState().selectEntries([entry.id]);\r\n      }\r\n      driveState().setContextMenuData({x: e.clientX, y: e.clientY});\r\n    }\r\n  };\r\n\r\n  return (\r\n    <BaseFileGridItem\r\n      {...mergeProps(draggableProps, droppableProps, pressProps, {\r\n        onKeyDown: createEventHandler(keyboardHandler),\r\n      })}\r\n      ref={ref}\r\n      entry={entry}\r\n      isSelected={isSelected}\r\n      isMobileMode={!!isMobileMode}\r\n      tabIndex={-1}\r\n      onDoubleClick={e => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (!isMobileMode) {\r\n          performViewItemAction(entry);\r\n        }\r\n      }}\r\n      footerAdornment={\r\n        isMobileMode && (\r\n          <FooterAdornment entry={entry} isSelected={isSelected} />\r\n        )\r\n      }\r\n      onContextMenu={createEventHandler(contextMenuHandler)}\r\n      className={itemClassName}\r\n    />\r\n  );\r\n}\r\n\r\ninterface FooterProps {\r\n  entry: DriveEntry;\r\n  isSelected?: boolean;\r\n}\r\nfunction FooterAdornment({entry, isSelected}: FooterProps) {\r\n  const anySelected = useDriveStore(s => s.selectedEntries.size);\r\n\r\n  if (anySelected) {\r\n    return <Checkbox className=\"block mr-8\" checked={isSelected} />;\r\n  }\r\n\r\n  return (\r\n    <EntryActionMenuTrigger entries={[entry]}>\r\n      <IconButton\r\n        className=\"text-muted\"\r\n        onPointerDown={e => {\r\n          e.stopPropagation();\r\n        }}\r\n      >\r\n        <MoreVertIcon />\r\n      </IconButton>\r\n    </EntryActionMenuTrigger>\r\n  );\r\n}\r\n","import {FileGridItem} from './file-grid-item';\r\nimport React from 'react';\r\nimport {DriveEntry} from '../../files/drive-entry';\r\n\r\ninterface FileGridProps {\r\n  entries: DriveEntry[];\r\n}\r\nexport function FileGrid({entries}: FileGridProps) {\r\n  return (\r\n    <div className=\"file-grid-container\">\r\n      <div className=\"file-grid\">\r\n        {entries.map(entry => {\r\n          return <FileGridItem key={entry.id} entry={entry} />;\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import {driveState, useDriveStore} from '../../drive-store';\r\nimport {EntriesSortButton} from './entries-sort-button';\r\nimport React from 'react';\r\n\r\ninterface DriveSortButtonProps {\r\n  isDisabled?: boolean;\r\n}\r\nexport function DriveSortButton({isDisabled}: DriveSortButtonProps) {\r\n  const descriptor = useDriveStore(s => s.sortDescriptor);\r\n  return (\r\n    <EntriesSortButton\r\n      isDisabled={isDisabled}\r\n      descriptor={descriptor}\r\n      onChange={value => {\r\n        driveState().setSortDescriptor(value);\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, {ReactNode, useContext} from 'react';\r\nimport {useDriveStore} from './drive-store';\r\nimport {\r\n  DrivePage,\r\n  makeFolderPage,\r\n  RootFolderPage,\r\n  SharesPage,\r\n  TrashPage,\r\n} from './drive-page/drive-page';\r\nimport {Breadcrumb} from '@common/ui/breadcrumbs/breadcrumb';\r\nimport {useAuth} from '@common/auth/use-auth';\r\nimport {useFolderPath} from './files/queries/use-folder-path';\r\nimport {EntryActionMenuTrigger} from './entry-actions/entry-action-menu-trigger';\r\nimport {useActiveWorkspace} from '@common/workspace/active-workspace-id-context';\r\nimport {ButtonBase} from '@common/ui/buttons/button-base';\r\nimport {BreadcrumbItem} from '@common/ui/breadcrumbs/breadcrumb-item';\r\nimport {ArrowDropDownIcon} from '@common/icons/material/ArrowDropDown';\r\nimport {MessageDescriptor} from '@common/i18n/message-descriptor';\r\nimport {MixedText} from '@common/i18n/mixed-text';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\n\r\ninterface ItemConfig {\r\n  page: DrivePage;\r\n  label: MessageDescriptor | string;\r\n}\r\n\r\ninterface PageBreadcrumbsProps {\r\n  className?: string;\r\n}\r\nexport function PageBreadcrumbs({className}: PageBreadcrumbsProps) {\r\n  const {isMobileMode} = useContext(DashboardLayoutContext);\r\n  const navigate = useNavigate();\r\n  const page = useDriveStore(s => s.activePage);\r\n  const folder = page?.folder;\r\n  const query = useFolderPath({\r\n    hash: folder?.hash,\r\n    isEnabled: folder?.hash !== RootFolderPage.folder.hash,\r\n  });\r\n  const workspace = useActiveWorkspace();\r\n  const rootItem = useRootItem();\r\n  // wait until path, folder and workspace load fully\r\n  const isLoading =\r\n    !page ||\r\n    !workspace ||\r\n    (page.isFolderPage && !folder) ||\r\n    query.fetchStatus !== 'idle';\r\n\r\n  let content: ReactNode;\r\n\r\n  if (isLoading) {\r\n    content = null;\r\n  } else {\r\n    const items: ItemConfig[] = rootItem ? [rootItem] : [];\r\n\r\n    if (query.data) {\r\n      query.data.path.forEach(parent => {\r\n        items.push({\r\n          page: makeFolderPage(parent),\r\n          label: parent.name,\r\n        });\r\n      });\r\n    }\r\n\r\n    content = (\r\n      <Breadcrumb\r\n        className={className}\r\n        size={isMobileMode ? 'md' : 'lg'}\r\n        currentIsClickable\r\n      >\r\n        {items.map((item, index) => {\r\n          const isLast = index === items.length - 1;\r\n          if (!isLast) {\r\n            return (\r\n              <BreadcrumbItem\r\n                key={item.page.id}\r\n                onSelected={() => {\r\n                  navigate(item.page.path);\r\n                }}\r\n              >\r\n                <MixedText value={item.label} />\r\n              </BreadcrumbItem>\r\n            );\r\n          }\r\n\r\n          return (\r\n            <BreadcrumbItem key={item.page.id}>\r\n              {({isMenuItem}) => {\r\n                if (\r\n                  isMenuItem ||\r\n                  (!item.page.folder && item.page !== TrashPage)\r\n                )\r\n                  return <MixedText value={item.label} />;\r\n                return (\r\n                  <EntryActionMenuTrigger page={item.page}>\r\n                    <ButtonBase className=\"flex items-center gap-2 rounded focus-visible:ring-offset-4\">\r\n                      <MixedText value={item.label} />\r\n                      <ArrowDropDownIcon className=\"icon-md text-muted\" />\r\n                    </ButtonBase>\r\n                  </EntryActionMenuTrigger>\r\n                );\r\n              }}\r\n            </BreadcrumbItem>\r\n          );\r\n        })}\r\n      </Breadcrumb>\r\n    );\r\n  }\r\n\r\n  return content;\r\n}\r\n\r\nfunction useRootItem(): ItemConfig | null {\r\n  const page = useDriveStore(s => s.activePage);\r\n  const workspace = useActiveWorkspace();\r\n  const {user} = useAuth();\r\n\r\n  if (!page) return null;\r\n\r\n  // in workspace\r\n  if (workspace && !workspace.default) {\r\n    if (\r\n      page?.isFolderPage &&\r\n      (page?.id === RootFolderPage.id ||\r\n        page.folder?.workspace_id === workspace.id)\r\n    ) {\r\n      return {label: workspace.name, page: RootFolderPage};\r\n    }\r\n  }\r\n\r\n  if (page?.isFolderPage) {\r\n    const owner = page.folder?.users.find(u => u.owns_entry);\r\n    // inside shared folder\r\n    if (owner?.id !== user?.id) {\r\n      return {label: SharesPage.label, page: SharesPage};\r\n    }\r\n    // if folder is currently active, root item will always be root folder page\r\n    return {label: RootFolderPage.label, page: RootFolderPage};\r\n  }\r\n\r\n  // if folder page is not active, we are already at the root\r\n  return {label: page.label, page};\r\n}\r\n","import React, {ReactNode, useEffect, useRef, useState} from 'react';\r\nimport clsx from 'clsx';\r\nimport {UseInfiniteQueryResult} from '@tanstack/react-query/src/types';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {opacityAnimation} from '@common/ui/animation/opacity-animation';\r\nimport {ProgressCircle} from '@common/ui/progress/progress-circle';\r\n\r\nexport interface InfiniteScrollSentinelProps {\r\n  loaderMarginTop?: string;\r\n  children?: ReactNode;\r\n  loadMoreExtraContent?: ReactNode;\r\n  query: UseInfiniteQueryResult;\r\n  style?: React.CSSProperties;\r\n  className?: string;\r\n  variant?: 'infiniteScroll' | 'loadMore';\r\n  size?: 'sm' | 'md';\r\n}\r\nexport function InfiniteScrollSentinel({\r\n  query: {isInitialLoading, fetchNextPage, isFetchingNextPage, hasNextPage},\r\n  children,\r\n  loaderMarginTop = 'mt-24',\r\n  style,\r\n  className,\r\n  variant: _variant = 'infiniteScroll',\r\n  loadMoreExtraContent,\r\n  size = 'md',\r\n}: InfiniteScrollSentinelProps) {\r\n  const sentinelRef = useRef<HTMLDivElement>(null);\r\n  const isLoading = isFetchingNextPage || isInitialLoading;\r\n  const [loadMoreClickCount, setLoadMoreClickCount] = useState(0);\r\n  const innerVariant =\r\n    _variant === 'loadMore' && loadMoreClickCount < 3\r\n      ? 'loadMore'\r\n      : 'infiniteScroll';\r\n\r\n  useEffect(() => {\r\n    const sentinelEl = sentinelRef.current;\r\n    if (!sentinelEl || innerVariant === 'loadMore') return;\r\n    const observer = new IntersectionObserver(([entry]) => {\r\n      if (entry.isIntersecting && hasNextPage && !isLoading) {\r\n        fetchNextPage();\r\n      }\r\n    });\r\n    observer.observe(sentinelEl);\r\n    return () => {\r\n      observer.unobserve(sentinelEl);\r\n    };\r\n  }, [fetchNextPage, hasNextPage, isLoading, innerVariant]);\r\n\r\n  let content: ReactNode;\r\n\r\n  if (children) {\r\n    // children might already be wrapped in AnimatePresence, so only wrap default loader with it\r\n    content = isFetchingNextPage ? children : null;\r\n  } else if (innerVariant === 'loadMore') {\r\n    content = !isInitialLoading && hasNextPage && (\r\n      <div className={clsx('flex items-center gap-8', loaderMarginTop)}>\r\n        {loadMoreExtraContent}\r\n        <Button\r\n          size={size === 'md' ? 'sm' : 'xs'}\r\n          className={clsx(\r\n            size === 'sm' ? 'min-h-24 min-w-96' : 'min-h-36 min-w-112'\r\n          )}\r\n          variant=\"outline\"\r\n          color=\"primary\"\r\n          onClick={() => {\r\n            fetchNextPage();\r\n            setLoadMoreClickCount(loadMoreClickCount + 1);\r\n          }}\r\n          disabled={isLoading}\r\n        >\r\n          {loadMoreClickCount >= 2 && !isFetchingNextPage ? (\r\n            <Trans message=\"Load all\" />\r\n          ) : (\r\n            <Trans message=\"Show more\" />\r\n          )}\r\n        </Button>\r\n      </div>\r\n    );\r\n  } else {\r\n    content = (\r\n      <AnimatePresence>\r\n        {isFetchingNextPage && (\r\n          <m.div\r\n            className={clsx('flex justify-center w-full', loaderMarginTop)}\r\n            {...opacityAnimation}\r\n          >\r\n            <ProgressCircle size={size} isIndeterminate aria-label=\"loading\" />\r\n          </m.div>\r\n        )}\r\n      </AnimatePresence>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      style={style}\r\n      className={clsx('w-full', className, hasNextPage && 'min-h-36')}\r\n      role=\"presentation\"\r\n    >\r\n      <div ref={sentinelRef} aria-hidden />\r\n      {content}\r\n    </div>\r\n  );\r\n}\r\n","import {AnimatePresence, m} from 'framer-motion';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport React from 'react';\r\nimport {opacityAnimation} from '@common/ui/animation/opacity-animation';\r\n\r\ninterface DropTargetMaskProps {\r\n  isVisible: boolean;\r\n}\r\nexport function DropTargetMask({isVisible}: DropTargetMaskProps) {\r\n  const mask = (\r\n    <m.div\r\n      key=\"dragTargetMask\"\r\n      {...opacityAnimation}\r\n      transition={{duration: 0.3}}\r\n      className=\"absolute inset-0 w-full min-h-full bg-primary-light/30 border-2 border-dashed border-primary pointer-events-none\"\r\n    >\r\n      <m.div\r\n        initial={{y: '100%', opacity: 0}}\r\n        animate={{y: '-10px', opacity: 1}}\r\n        exit={{y: '100%', opacity: 0}}\r\n        className=\"p-10 bg-primary text-on-primary fixed bottom-0 left-0 right-0 max-w-max mx-auto rounded\"\r\n      >\r\n        <Trans message=\"Drop files to upload them to this folder.\" />\r\n      </m.div>\r\n    </m.div>\r\n  );\r\n  return <AnimatePresence>{isVisible ? mask : null}</AnimatePresence>;\r\n}\r\n","import React, {\r\n  KeyboardEventHandler,\r\n  MouseEventHandler,\r\n  ReactNode,\r\n  useContext,\r\n  useRef,\r\n  useState,\r\n} from 'react';\r\nimport {usePaginatedEntries} from '../files/queries/use-paginated-entries';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {IllustratedMessage} from '@common/ui/images/illustrated-message';\r\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\r\nimport {SearchFilterList} from '../search/search-filter-list';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {useMouseSelectionBox} from '@common/ui/interactions/dnd/mouse-selection/use-mouse-selection-box';\r\nimport {useDroppable} from '@common/ui/interactions/dnd/use-droppable';\r\nimport {mergeProps} from '@react-aria/utils';\r\nimport {useDriveUploadQueue} from '../uploading/use-drive-upload-queue';\r\nimport {EntryActionList} from '../entry-actions/entry-action-list';\r\nimport {DriveContextMenu} from '../files/drive-context-menu';\r\nimport {FileTable} from './file-table/file-table';\r\nimport {FileGrid} from './file-grid/file-grid';\r\nimport {DriveSortButton} from '../layout/sorting/drive-sort-button';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\nimport {PageBreadcrumbs} from '../page-breadcrumbs';\r\nimport {InfiniteScrollSentinel} from '@common/ui/infinite-scroll/infinite-scroll-sentinel';\r\nimport {useEntries} from '../files/queries/use-entries';\r\nimport {AdHost} from '@common/admin/ads/ad-host';\r\nimport {DropTargetMask} from '../drop-target-mask';\r\nimport {useSearchParams} from 'react-router-dom';\r\nimport clsx from 'clsx';\r\nimport {MixedDraggable} from '@common/ui/interactions/dnd/use-draggable';\r\nimport {isCtrlKeyPressed} from '@common/utils/keybinds/is-ctrl-key-pressed';\r\nimport {useDeleteEntries} from '@app/drive/files/queries/use-delete-entries';\r\nimport {createEventHandler} from '@common/utils/dom/create-event-handler';\r\nimport {TrashPage} from '@app/drive/drive-page/drive-page';\r\nimport {getSelectedEntries} from '@app/drive/files/use-selected-entries';\r\nimport {CreateNewButton} from '../layout/create-new-button';\r\nimport {WorkspaceSelector} from '@common/workspace/workspace-selector';\r\nimport {RootFolderPage} from '../drive-page/drive-page';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\n\r\ninterface FileViewProps {\r\n  className?: string;\r\n}\r\nexport function FileView({className}: FileViewProps) {\r\n  const [params] = useSearchParams();\r\n  const isSearchingOrFiltering =\r\n    !!params.get('query') || !!params.get('filters');\r\n  const containerRef = useRef<HTMLDivElement>(null);\r\n  const query = usePaginatedEntries();\r\n  const entries = useEntries();\r\n  const {uploadFiles} = useDriveUploadQueue();\r\n  const deleteEntries = useDeleteEntries();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const [isDragOver, setIsDragOver] = useState(false);\r\n  const viewMode = useDriveStore(s => s.viewMode);\r\n  const {isMobileMode} = useContext(DashboardLayoutContext);\r\n\r\n  const {containerProps, boxProps} = useMouseSelectionBox({\r\n    containerRef,\r\n    onPointerDown: e => {\r\n      if (!(e.target as HTMLElement).closest('.entry-action-list')) {\r\n        driveState().deselectEntries('all');\r\n      }\r\n    },\r\n  });\r\n\r\n  console.log(\"entries\", entries);\r\n\r\n  const {droppableProps} = useDroppable({\r\n    id: 'driveRoot',\r\n    ref: containerRef,\r\n    types: ['nativeFile'],\r\n    disabled: !activePage?.canUpload,\r\n    onDragEnter: () => {\r\n      setIsDragOver(true);\r\n    },\r\n    onDragLeave: () => {\r\n      setIsDragOver(false);\r\n    },\r\n    onDrop: async (draggable: MixedDraggable) => {\r\n      if (draggable.type === 'nativeFile') {\r\n        uploadFiles(await draggable.getData());\r\n      }\r\n    },\r\n  });\r\n\r\n  if (!activePage) return null;\r\n\r\n  let content: ReactNode;\r\n  if (!entries.length && (!query.isLoading || query.fetchStatus === 'idle')) {\r\n    const noContentMessage = activePage.noContentMessage(\r\n      isSearchingOrFiltering,\r\n    );\r\n    content = (\r\n      <IllustratedMessage\r\n        className=\"mt-40\"\r\n        image={<SvgImage src={noContentMessage.image} />}\r\n        title={<Trans {...noContentMessage.title} />}\r\n        description={<Trans {...noContentMessage.description} />}\r\n      />\r\n    );\r\n  } else if (!query.isLoading) {\r\n    content =\r\n      viewMode === 'list' ? (\r\n        <FileTable entries={entries} />\r\n      ) : (\r\n        <FileGrid entries={entries} />\r\n      );\r\n  }\r\n\r\n  const handleContextMenu: MouseEventHandler = e => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    driveState().deselectEntries('all');\r\n    driveState().setContextMenuData({x: e.clientX, y: e.clientY});\r\n  };\r\n\r\n  const handleKeybinds: KeyboardEventHandler = e => {\r\n    if (e.key === 'a' && isCtrlKeyPressed(e)) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      driveState().selectEntries(entries.map(entry => entry.id));\r\n    }\r\n    if (e.key === 'Delete') {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      if (driveState().selectedEntries.size && !deleteEntries.isPending) {\r\n        if (activePage === TrashPage) {\r\n          driveState().setActiveActionDialog(\r\n            'confirmAndDeleteForever',\r\n            getSelectedEntries(),\r\n          );\r\n        } else {\r\n          deleteEntries.mutate({\r\n            entryIds: [...driveState().selectedEntries],\r\n            deleteForever: activePage === TrashPage,\r\n          });\r\n          driveState().selectEntries([]);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className={clsx('relative outline-none', className)}\r\n      tabIndex={-1}\r\n      {...mergeProps(containerProps, droppableProps, {\r\n        onKeyDown: createEventHandler(handleKeybinds),\r\n      })}\r\n      onContextMenu={handleContextMenu}\r\n    >\r\n      <div className=\"relative flex min-h-full flex-col pt-10\">\r\n        {isMobileMode ? (\r\n          <PageBreadcrumbs className=\"mb-10 px-14\" />\r\n        ) : (\r\n          <Toolbar />\r\n        )}\r\n        <SearchFilterList />\r\n        <div className=\"relative flex-auto px-18 pb-18 md:px-24\">\r\n          <AdHost slot=\"drive\" className=\"mb-24\" />\r\n          {content}\r\n          {/* <WorkspaceSwitcher /> */}\r\n          <InfiniteScrollSentinel query={query} />\r\n        </div>\r\n        <div\r\n          {...boxProps}\r\n          className=\"pointer-events-none absolute left-0 top-0 z-10 hidden border border-primary-light bg-primary-light/20 shadow-md\"\r\n        />\r\n        <DriveContextMenu />\r\n        <DropTargetMask isVisible={isDragOver} />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction WorkspaceSwitcher() {\r\n  const navigate = useNavigate();\r\n  return (\r\n    <WorkspaceSelector\r\n      onChange={() => {\r\n        navigate(RootFolderPage.path);\r\n      }}\r\n      className=\"w-full flex-shrink-0 border-t px-24 py-18\"\r\n    />\r\n  );\r\n}\r\n\r\nfunction Toolbar() {\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  return (\r\n    <div className=\"my-10 flex min-h-42 items-center justify-between gap-40 px-10 text-muted md:px-18\">\r\n      <DriveSortButton isDisabled={activePage?.disableSort} />\r\n      <EntryActionList className=\"text-muted\" />\r\n      <div>\r\n        <CreateNewButton className=\"px-8 text-center\" />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import {\r\n  ComponentPropsWithoutRef,\r\n  CSSProperties,\r\n  memo,\r\n  ReactElement,\r\n  useMemo,\r\n  useState,\r\n} from 'react';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {FileTypeIcon} from '@common/uploads/file-type-icon/file-type-icon';\r\nimport {prettyBytes} from '@common/uploads/utils/pretty-bytes';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {CloseIcon} from '@common/icons/material/Close';\r\nimport {ProgressCircle} from '@common/ui/progress/progress-circle';\r\nimport {CheckCircleIcon} from '@common/icons/material/CheckCircle';\r\nimport {UploadedFile} from '@common/uploads/uploaded-file';\r\nimport {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {MixedText} from '@common/i18n/mixed-text';\r\nimport {Tooltip} from '@common/ui/tooltip/tooltip';\r\nimport {ErrorIcon} from '@common/icons/material/Error';\r\nimport {WarningIcon} from '@common/icons/material/Warning';\r\nimport {message} from '@common/i18n/message';\r\n\r\ninterface UploadQueueProps {\r\n  file: UploadedFile;\r\n  style: CSSProperties;\r\n}\r\nexport const UploadQueueItem = memo(({file, style}: UploadQueueProps) => {\r\n  return (\r\n    <div\r\n      className=\"p-10 flex items-center gap-14 w-full absolute top-0 left-0\"\r\n      style={style}\r\n    >\r\n      <div className=\"shrink-0 border rounded p-8\">\r\n        <FileTypeIcon className=\"w-22 h-22\" mime={file.mime} />\r\n      </div>\r\n      <div className=\"flex-auto min-w-0 pr-10\">\r\n        <div className=\"mb-2 flex items-center min-w-0 gap-10\">\r\n          <div className=\"flex-auto font-medium whitespace-nowrap min-w-0 overflow-hidden overflow-ellipsis\">\r\n            {file.name}\r\n          </div>\r\n        </div>\r\n        <SizeInfo file={file} />\r\n      </div>\r\n      <div className=\"mr-10\">\r\n        <FileStatus file={file} />\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n\r\ninterface SizeInfoProps {\r\n  file: UploadedFile;\r\n}\r\nfunction SizeInfo({file}: SizeInfoProps) {\r\n  const fileUpload = useFileUploadStore(s => s.fileUploads.get(file.id));\r\n  const bytesUploaded = fileUpload?.bytesUploaded || 0;\r\n\r\n  const totalBytes = useMemo(() => prettyBytes(file.size), [file]);\r\n  const uploadedBytes = useMemo(\r\n    () => prettyBytes(bytesUploaded),\r\n    [bytesUploaded]\r\n  );\r\n\r\n  let statusMessage: ReactElement;\r\n  if (fileUpload?.status === 'completed') {\r\n    statusMessage = <Trans message=\"Upload complete\" />;\r\n  } else if (fileUpload?.status === 'aborted') {\r\n    statusMessage = <Trans message=\"Upload cancelled\" />;\r\n  } else if (fileUpload?.status === 'failed') {\r\n    statusMessage = <Trans message=\"Upload failed\" />;\r\n  } else {\r\n    statusMessage = (\r\n      <Trans\r\n        message=\":bytesUploaded of :totalBytes\"\r\n        values={{\r\n          bytesUploaded: uploadedBytes,\r\n          totalBytes,\r\n        }}\r\n      />\r\n    );\r\n  }\r\n\r\n  return <div className=\"text-muted text-xs\">{statusMessage}</div>;\r\n}\r\n\r\ninterface FileStatusProps {\r\n  file: UploadedFile;\r\n}\r\nfunction FileStatus({file}: FileStatusProps) {\r\n  const fileUpload = useFileUploadStore(s => s.fileUploads.get(file.id));\r\n  const abortUpload = useFileUploadStore(s => s.abortUpload);\r\n  const percentage = fileUpload?.percentage || 0;\r\n  const status = fileUpload?.status;\r\n  const errorMessage = fileUpload?.errorMessage;\r\n  const [isHovered, setIsHovered] = useState(false);\r\n\r\n  const abortButton = (\r\n    <IconButton\r\n      size=\"sm\"\r\n      onClick={() => {\r\n        abortUpload(file.id);\r\n      }}\r\n    >\r\n      <CloseIcon />\r\n    </IconButton>\r\n  );\r\n\r\n  const progressButton = (\r\n    <ProgressCircle aria-label=\"Upload progress\" size=\"sm\" value={percentage} />\r\n  );\r\n\r\n  let statusButton: ReactElement;\r\n  if (status === 'failed') {\r\n    const errMessage =\r\n      errorMessage || message('This file could not be uploaded');\r\n    statusButton = (\r\n      <AnimatedStatus>\r\n        <Tooltip variant=\"danger\" label={<MixedText value={errMessage} />}>\r\n          <ErrorIcon className=\"text-danger\" size=\"md\" />\r\n        </Tooltip>\r\n      </AnimatedStatus>\r\n    );\r\n  } else if (status === 'aborted') {\r\n    statusButton = (\r\n      <AnimatedStatus>\r\n        <WarningIcon className=\"text-warning\" size=\"md\" />\r\n      </AnimatedStatus>\r\n    );\r\n  } else if (status === 'completed') {\r\n    statusButton = (\r\n      <AnimatedStatus>\r\n        <CheckCircleIcon size=\"md\" className=\"text-positive\" />\r\n      </AnimatedStatus>\r\n    );\r\n  } else {\r\n    statusButton = (\r\n      <AnimatedStatus\r\n        onPointerEnter={e => {\r\n          if (e.pointerType === 'mouse') {\r\n            setIsHovered(true);\r\n          }\r\n        }}\r\n        onPointerLeave={e => {\r\n          if (e.pointerType === 'mouse') {\r\n            setIsHovered(false);\r\n          }\r\n        }}\r\n      >\r\n        {isHovered ? abortButton : progressButton}\r\n      </AnimatedStatus>\r\n    );\r\n  }\r\n\r\n  return <AnimatePresence>{statusButton}</AnimatePresence>;\r\n}\r\n\r\ninterface AnimatedStatusProps\r\n  extends Omit<\r\n    ComponentPropsWithoutRef<'div'>,\r\n    'onAnimationStart' | 'onDragStart' | 'onDragEnd' | 'onDrag'\r\n  > {\r\n  children: ReactElement;\r\n}\r\nfunction AnimatedStatus({children, ...domProps}: AnimatedStatusProps) {\r\n  return (\r\n    <m.div\r\n      {...domProps}\r\n      initial={{scale: 0, opacity: 0}}\r\n      animate={{scale: 1, opacity: 1}}\r\n      exit={{scale: 0, opacity: 0}}\r\n    >\r\n      {children}\r\n    </m.div>\r\n  );\r\n}\r\n","import {ReactElement, useRef} from 'react';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {CloseIcon} from '@common/icons/material/Close';\r\nimport {useFileUploadStore} from '@common/uploads/uploader/file-upload-provider';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {UploadQueueItem} from './upload-queue-item';\r\nimport {useVirtualizer} from '@tanstack/react-virtual';\r\n\r\nexport function UploadQueue() {\r\n  const isOpen = useDriveStore(s => s.uploadQueueIsOpen);\r\n\r\n  return (\r\n    <AnimatePresence>\r\n      {isOpen && (\r\n        <m.div\r\n          key=\"upload-queue\"\r\n          className=\"shadow-xl rounded fixed bottom-16 right-16 bg z-modal border w-375 text-sm\"\r\n          initial={{y: '100%', opacity: 0}}\r\n          animate={{y: 0, opacity: 1}}\r\n          exit={{y: '100%', opacity: 0}}\r\n        >\r\n          <Header />\r\n          <UploadList />\r\n        </m.div>\r\n      )}\r\n    </AnimatePresence>\r\n  );\r\n}\r\n\r\nexport function Header() {\r\n  const inProgressUploadsCount = useFileUploadStore(s => s.activeUploadsCount);\r\n  const completedUploadsCount = useFileUploadStore(\r\n    s => s.completedUploadsCount\r\n  );\r\n  const clearInactive = useFileUploadStore(s => s.clearInactive);\r\n\r\n  let message: ReactElement;\r\n  if (inProgressUploadsCount) {\r\n    message = (\r\n      <Trans\r\n        message=\"Uploading :count files\"\r\n        values={{count: inProgressUploadsCount}}\r\n      />\r\n    );\r\n  } else if (completedUploadsCount) {\r\n    message = (\r\n      <Trans\r\n        message=\"Uploaded :count files\"\r\n        values={{count: completedUploadsCount}}\r\n      />\r\n    );\r\n  } else {\r\n    message = <Trans message=\"No active uploads\" />;\r\n  }\r\n\r\n  // only allow closing upload queue if there are no active uploads\r\n  return (\r\n    <div className=\"px-10 py-4 bg-alt flex items-center gap-10 justify-between border-b min-h-[45px]\">\r\n      {message}\r\n      {inProgressUploadsCount === 0 ? (\r\n        <IconButton\r\n          size=\"sm\"\r\n          onClick={() => {\r\n            driveState().setUploadQueueIsOpen(false);\r\n            // wait for upload queue panel animation to complete, then clear inactive uploads\r\n            setTimeout(() => {\r\n              clearInactive();\r\n            }, 200);\r\n          }}\r\n        >\r\n          <CloseIcon />\r\n        </IconButton>\r\n      ) : undefined}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction UploadList() {\r\n  const uploads = useFileUploadStore(s => s.fileUploads);\r\n  const uploadsArray = [...uploads.values()];\r\n  const ref = useRef<HTMLDivElement>(null);\r\n  const virtualizer = useVirtualizer({\r\n    count: uploads.size,\r\n    getScrollElement: () => ref.current,\r\n    estimateSize: () => 60,\r\n    overscan: 4,\r\n  });\r\n\r\n  return (\r\n    <div className=\"max-h-320 overflow-y-auto\" ref={ref}>\r\n      <div\r\n        className=\"relative w-full\"\r\n        style={{\r\n          height: `${virtualizer.getTotalSize()}px`,\r\n        }}\r\n      >\r\n        {virtualizer.getVirtualItems().map(virtualItem => {\r\n          const upload = uploadsArray[virtualItem.index];\r\n          return (\r\n            <UploadQueueItem\r\n              style={{\r\n                height: `${virtualItem.size}px`,\r\n                transform: `translateY(${virtualItem.start}px)`,\r\n              }}\r\n              key={upload.file.id}\r\n              file={upload.file}\r\n            />\r\n          );\r\n        })}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","export default \"__VITE_ASSET__6b065fb0__\"","import React, {ReactNode, useContext} from 'react';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\nimport {FileTypeIcon} from '@common/uploads/file-type-icon/file-type-icon';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {CloseIcon} from '@common/icons/material/Close';\r\n\r\ninterface HeaderProps {\r\n  entryType: string;\r\n  entryName: ReactNode;\r\n}\r\nexport function DetailsSidebarHeader({entryType, entryName}: HeaderProps) {\r\n  const {setRightSidenavStatus} = useContext(DashboardLayoutContext);\r\n  return (\r\n    <div className=\"flex items-center gap-16 text-text-main mb-38\">\r\n      <FileTypeIcon className=\"w-24 h-24\" type={entryType} />\r\n      <div className=\"text-xl font-normal text-ellipsis flex-auto mr-auto min-w-0 break-words\">\r\n        {entryName}\r\n      </div>\r\n      <IconButton\r\n        size=\"md\"\r\n        className=\"flex-shrink-0\"\r\n        onClick={() => {\r\n          setRightSidenavStatus('closed');\r\n        }}\r\n      >\r\n        <CloseIcon />\r\n      </IconButton>\r\n    </div>\r\n  );\r\n}\r\n","import React, {ReactNode} from 'react';\r\nimport clsx from 'clsx';\r\n\r\ninterface Props {\r\n  children: ReactNode;\r\n  margin?: string;\r\n}\r\nexport function DetailsSidebarSectionHeader({\r\n  children,\r\n  margin = 'mb-20',\r\n}: Props) {\r\n  return <div className={clsx('text-base text-main', margin)}>{children}</div>;\r\n}\r\n","import {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {useMutation} from '@tanstack/react-query';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\nimport {message} from '@common/i18n/message';\r\nimport {ChipValue} from '@common/ui/forms/input-field/chip-field/chip-field';\r\nimport {DriveEntry} from '@app/drive/files/drive-entry';\r\nimport {invalidateEntryQueries} from '@app/drive/drive-query-keys';\r\n\r\ninterface Response extends BackendResponse {\r\n  //\r\n}\r\n\r\ninterface Payload {\r\n  entry: DriveEntry;\r\n  tags: ChipValue[];\r\n}\r\n\r\nexport function useSyncEntryTags() {\r\n  return useMutation({\r\n    mutationFn: (props: Payload) => createComment(props),\r\n    onSuccess: () => {\r\n      invalidateEntryQueries();\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Failed to save tags.')),\r\n  });\r\n}\r\n\r\nfunction createComment({entry, tags}: Payload): Promise<Response> {\r\n  return apiClient\r\n    .post(`file-entries/${entry.id}/sync-tags`, {\r\n      tags: tags.map(tag => tag.name),\r\n    })\r\n    .then(r => r.data);\r\n}\r\n","import {keepPreviousData, useQuery} from '@tanstack/react-query';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {NormalizedModel} from '@common/datatable/filters/normalized-model';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\n\r\ninterface Response extends BackendResponse {\r\n  results: NormalizedModel[];\r\n}\r\n\r\nexport function useFileEntryTags(query?: string) {\r\n  return useQuery({\r\n    queryKey: ['file-entry-tags', query],\r\n    queryFn: () => fetchTags(query),\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\nasync function fetchTags(query?: string) {\r\n  return apiClient\r\n    .get<Response>('file-entry-tags', {params: {query}})\r\n    .then(r => r.data);\r\n}\r\n","import {DetailsSidebarSectionHeader} from '@app/drive/details-sidebar/details-sidebar-section-header';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DriveEntry} from '@app/drive/files/drive-entry';\r\nimport {\r\n  ChipField,\r\n  ChipValue,\r\n} from '@common/ui/forms/input-field/chip-field/chip-field';\r\nimport React, {useState} from 'react';\r\nimport {Item} from '@common/ui/forms/listbox/item';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {message} from '@common/i18n/message';\r\nimport {useSyncEntryTags} from '@app/drive/details-sidebar/requests/use-sync-entry-tags';\r\nimport {useFileEntryTags} from '@app/drive/details-sidebar/requests/use-file-entry-tags';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\n\r\ninterface Props {\r\n  entry: DriveEntry;\r\n}\r\nexport function DetailsSidebarTags({entry}: Props) {\r\n  // use key={entry.id} to force re-render tag chip field when entry changes\r\n  return (\r\n    <div className=\"mt-20 border-t pt-20\">\r\n      <DetailsSidebarSectionHeader margin=\"mb-10\">\r\n        <Trans message=\"Tags\" />\r\n      </DetailsSidebarSectionHeader>\r\n      <TagChipField entry={entry} key={entry.id} />\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction TagChipField({entry}: Props) {\r\n  const {trans} = useTrans();\r\n  const navigate = useNavigate();\r\n  const syncTags = useSyncEntryTags();\r\n  const [inputValue, setInputValue] = useState('');\r\n  const [value, setValue] = useState<ChipValue[]>(entry.tags || []);\r\n  const {data, isLoading} = useFileEntryTags(inputValue);\r\n\r\n  const handleChange = (newTags: ChipValue[]) => {\r\n    setValue(newTags);\r\n    if (!syncTags.isPending) {\r\n      syncTags.mutate({tags: newTags, entry});\r\n    }\r\n  };\r\n\r\n  return (\r\n    <ChipField\r\n      isAsync\r\n      inputValue={inputValue}\r\n      onInputValueChange={setInputValue}\r\n      suggestions={data?.results}\r\n      placeholder={trans(message('+Add tag'))}\r\n      isLoading={isLoading}\r\n      chipSize=\"sm\"\r\n      value={value}\r\n      onChange={handleChange}\r\n      onChipClick={chip => {\r\n        navigate(`/drive/search?query=${chip.name}`);\r\n      }}\r\n    >\r\n      {data?.results.map(result => (\r\n        <Item value={result} key={result.id}>\r\n          {result.name}\r\n        </Item>\r\n      ))}\r\n    </ChipField>\r\n  );\r\n}\r\n","import {useSelectedEntryParent} from '@app/drive/files/use-selected-entries';\r\nimport {useNavigate} from '@common/utils/hooks/use-navigate';\r\nimport React, {ReactNode, useMemo} from 'react';\r\nimport {prettyBytes} from '@common/uploads/utils/pretty-bytes';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {FolderIcon} from '@common/icons/material/Folder';\r\nimport {\r\n  getPathForFolder,\r\n  RootFolderPage,\r\n} from '@app/drive/drive-page/drive-page';\r\nimport {FormattedDate} from '@common/i18n/formatted-date';\r\nimport {DriveEntry} from '@app/drive/files/drive-entry';\r\nimport {FileThumbnail} from '@common/uploads/file-type-icon/file-thumbnail';\r\nimport {GroupsIcon} from '@common/icons/material/Groups';\r\nimport {Tooltip} from '@common/ui/tooltip/tooltip';\r\nimport {Avatar} from '@common/ui/images/avatar';\r\nimport {driveState} from '@app/drive/drive-store';\r\nimport {DetailsSidebarHeader} from '@app/drive/details-sidebar/details-sidebar-header';\r\nimport {DetailsSidebarSectionHeader} from '@app/drive/details-sidebar/details-sidebar-section-header';\r\nimport {DetailsSidebarTags} from '@app/drive/details-sidebar/details-sidebar-tags';\r\n\r\ninterface EntryPropertiesProps {\r\n  entry: DriveEntry;\r\n}\r\n\r\nexport function DetailsSidebarProperties({entry}: EntryPropertiesProps) {\r\n  return (\r\n    <div>\r\n      <DetailsSidebarHeader entryType={entry.type} entryName={entry.name} />\r\n      {entry.type === 'image' && (\r\n        <FileThumbnail className=\"mb-20\" file={entry} />\r\n      )}\r\n      <div>\r\n        <DetailsSidebarSectionHeader>\r\n          <Trans message=\"Who has access\" />\r\n        </DetailsSidebarSectionHeader>\r\n        <div className=\"flex items-center gap-14\">\r\n          {entry.workspace_id ? (\r\n            <div className=\"rounded-full border w-32 h-32 flex items-center justify-center\">\r\n              <GroupsIcon className=\"icon-md\" />\r\n            </div>\r\n          ) : null}\r\n          {entry.users.map(user => (\r\n            <Tooltip label={user.display_name} key={user.id}>\r\n              <Avatar src={user.avatar} size=\"md\" circle />\r\n            </Tooltip>\r\n          ))}\r\n        </div>\r\n        {entry.permissions['files.update'] && (\r\n          <Button\r\n            className=\"block mt-20\"\r\n            variant=\"link\"\r\n            color=\"primary\"\r\n            onClick={() => {\r\n              driveState().setActiveActionDialog('share', [entry]);\r\n            }}\r\n          >\r\n            <Trans message=\"Manage Access\" />\r\n          </Button>\r\n        )}\r\n      </div>\r\n      <PropertyList entry={entry} />\r\n      <DetailsSidebarTags entry={entry} />\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface Props {\r\n  entry: DriveEntry;\r\n}\r\n\r\nfunction PropertyList({entry}: Props) {\r\n  const parent = useSelectedEntryParent();\r\n  const navigate = useNavigate();\r\n  const owner = entry.users.find(user => user.owns_entry);\r\n  const prettySize = useMemo(\r\n    () => prettyBytes(entry.file_size),\r\n    [entry.file_size]\r\n  );\r\n\r\n  return (\r\n    <div className=\"mt-20 border-t pt-20\">\r\n      <DetailsSidebarSectionHeader>\r\n        <Trans message=\"Properties\" />\r\n      </DetailsSidebarSectionHeader>\r\n      <PropertyItem\r\n        label={<Trans message=\"Type\" />}\r\n        value={\r\n          <span className=\"capitalize\">\r\n            <Trans message={entry.type} />\r\n          </span>\r\n        }\r\n      />\r\n      <PropertyItem\r\n        label={<Trans message=\"Size\" />}\r\n        value={entry.file_size ? prettySize : '-'}\r\n      />\r\n      <PropertyItem\r\n        label={<Trans message=\"Location\" />}\r\n        value={\r\n          <Button\r\n            variant=\"link\"\r\n            startIcon={<FolderIcon />}\r\n            onClick={() => {\r\n              navigate(\r\n                parent ? getPathForFolder(parent.hash) : RootFolderPage.path\r\n              );\r\n            }}\r\n          >\r\n            {parent ? parent.name : <Trans message=\"Root\" />}\r\n          </Button>\r\n        }\r\n      />\r\n      {owner && (\r\n        <PropertyItem\r\n          label={<Trans message=\"Owner\" />}\r\n          value={owner.display_name}\r\n        />\r\n      )}\r\n      <PropertyItem\r\n        label={<Trans message=\"Modified\" />}\r\n        value={<FormattedDate date={entry.updated_at} />}\r\n      />\r\n      <PropertyItem\r\n        label={<Trans message=\"Created\" />}\r\n        value={<FormattedDate date={entry.updated_at} />}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface PropertyItemProps {\r\n  label: ReactNode;\r\n  value: ReactNode;\r\n}\r\nfunction PropertyItem({label, value}: PropertyItemProps) {\r\n  return (\r\n    <div className=\"flex items-center mb-14\">\r\n      <div className=\"w-1/3 text-xs text-muted\">{label}</div>\r\n      <div className=\"w-2/3 text-sm text-main\">{value}</div>\r\n    </div>\r\n  );\r\n}\r\n","import React, {Fragment} from 'react';\r\nimport {useSelectedEntry} from '../files/use-selected-entries';\r\nimport {IllustratedMessage} from '@common/ui/images/illustrated-message';\r\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport detailedExamination from './detailed-examination.svg';\r\nimport clsx from 'clsx';\r\nimport {DetailsSidebarHeader} from '@app/drive/details-sidebar/details-sidebar-header';\r\nimport {DetailsSidebarProperties} from '@app/drive/details-sidebar/details-sidebar-properties';\r\n\r\ninterface DetailsSidebarProps {\r\n  className?: string;\r\n}\r\nexport function DetailsSidebar({className}: DetailsSidebarProps) {\r\n  const selectedEntry = useSelectedEntry();\r\n  return (\r\n    <div\r\n      className={clsx(\r\n        className,\r\n        'bg p-18 text-sm text-muted border-l h-full overflow-y-auto'\r\n      )}\r\n    >\r\n      {selectedEntry ? (\r\n        <DetailsSidebarProperties entry={selectedEntry} />\r\n      ) : (\r\n        <NothingSelected />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction NothingSelected() {\r\n  return (\r\n    <Fragment>\r\n      <DetailsSidebarHeader\r\n        entryType=\"folder\"\r\n        entryName={<Trans message=\"All files\" />}\r\n      />\r\n      <IllustratedMessage\r\n        image={<SvgImage src={detailedExamination} />}\r\n        description={\r\n          <Trans message=\"Select file or folder to see details here\" />\r\n        }\r\n      />\r\n    </Fragment>\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {UseFormReturn} from 'react-hook-form';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {message} from '@common/i18n/message';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\r\n\r\ninterface Response extends BackendResponse {\r\n  fileEntry: FileEntry;\r\n}\r\n\r\ninterface Payload {\r\n  entryId: number;\r\n  name: string;\r\n  initialName: string;\r\n}\r\n\r\nexport function useRenameEntry(form: UseFormReturn<any>) {\r\n  return useMutation({\r\n    mutationFn: (payload: Payload) => renameEntry(payload),\r\n    onSuccess: (r, p) => {\r\n      invalidateEntryQueries();\r\n      toast(\r\n        message(':oldName renamed to :newName', {\r\n          values: {oldName: p.initialName, newName: r.fileEntry.name},\r\n        }),\r\n      );\r\n    },\r\n    onError: err => onFormQueryError(err, form),\r\n  });\r\n}\r\n\r\nfunction renameEntry({entryId, ...payload}: Payload): Promise<Response> {\r\n  return apiClient\r\n    .put(`file-entries/${entryId}`, payload)\r\n    .then(response => response.data);\r\n}\r\n","import React from 'react';\r\nimport {useForm} from 'react-hook-form';\r\nimport {useRenameEntry} from '../queries/use-rename-entry';\r\nimport {FormTextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {Form} from '@common/ui/forms/form';\r\nimport {DialogFooter} from '@common/ui/overlays/dialog/dialog-footer';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '@common/ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DriveEntry} from '../drive-entry';\r\n\r\ninterface FormValue {\r\n  name?: string;\r\n}\r\n\r\ninterface RenameEntryDialogProps {\r\n  entries: DriveEntry[];\r\n}\r\nexport function RenameEntryDialog({entries}: RenameEntryDialogProps) {\r\n  const {close, formId} = useDialogContext();\r\n  const initialName = entries[0]?.name;\r\n  const form = useForm({defaultValues: {name: initialName}});\r\n  const renameEntry = useRenameEntry(form);\r\n\r\n  const onSubmit = (e: Required<FormValue>) => {\r\n    renameEntry.mutate(\r\n      {\r\n        entryId: entries[0].id,\r\n        name: e.name,\r\n        initialName,\r\n      },\r\n      {onSuccess: close},\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogHeader>\r\n        <Trans message=\"Rename\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <Form onSubmit={onSubmit} form={form} id={formId}>\r\n          <FormTextField\r\n            placeholder=\"Enter a name...\"\r\n            aria-label=\"Entry name\"\r\n            autoFocus\r\n            name=\"name\"\r\n            required\r\n            minLength={3}\r\n            maxLength={200}\r\n          />\r\n        </Form>\r\n      </DialogBody>\r\n      <DialogFooter>\r\n        <Button variant=\"flat\" onClick={() => close()}>\r\n          <Trans message=\"Cancel\" />\r\n        </Button>\r\n        <Button\r\n          form={formId}\r\n          type=\"submit\"\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          disabled={renameEntry.isPending || !form.formState.isDirty}\r\n        >\r\n          <Trans message=\"Save\" />\r\n        </Button>\r\n      </DialogFooter>\r\n    </Dialog>\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {UseFormReturn} from 'react-hook-form';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveFolder} from '../drive-entry';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\n\r\ninterface Response extends BackendResponse {\r\n  folder: DriveFolder;\r\n}\r\n\r\ninterface CreateFolderProps {\r\n  name: string;\r\n  parentId?: number | null;\r\n}\r\n\r\nfunction createFolder({name, parentId}: CreateFolderProps): Promise<Response> {\r\n  return apiClient\r\n    .post('folders', {\r\n      name,\r\n      parentId: parentId === 0 ? null : parentId,\r\n    })\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useCreateFolder(form: UseFormReturn<any>) {\r\n  return useMutation({\r\n    mutationFn: ({name, parentId}: CreateFolderProps) => {\r\n      return createFolder({name, parentId});\r\n    },\r\n    onSuccess: () => invalidateEntryQueries(),\r\n    onError: r => onFormQueryError(r, form),\r\n  });\r\n}\r\n","import React from 'react';\r\nimport {useForm} from 'react-hook-form';\r\nimport {FormTextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {Form} from '@common/ui/forms/form';\r\nimport {useCreateFolder} from '../queries/create-folder';\r\nimport {DialogFooter} from '@common/ui/overlays/dialog/dialog-footer';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '@common/ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {message} from '@common/i18n/message';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\n\r\ninterface FormValue {\r\n  name?: string;\r\n}\r\n\r\ninterface NewFolderDialogProps {\r\n  parentId: number;\r\n}\r\nexport function NewFolderDialog({parentId}: NewFolderDialogProps) {\r\n  const {close, formId} = useDialogContext();\r\n  const {trans} = useTrans();\r\n  const form = useForm({\r\n    defaultValues: {\r\n      name: trans({message: 'Untitled Folder'}),\r\n    },\r\n  });\r\n  const createFolder = useCreateFolder(form);\r\n\r\n  const onSubmit = (value: Required<FormValue>) => {\r\n    createFolder.mutate(\r\n      {...value, parentId},\r\n      {\r\n        onSuccess: response => {\r\n          close(response.folder);\r\n          toast(message('Folder created'));\r\n        },\r\n      },\r\n    );\r\n  };\r\n\r\n  return (\r\n    <Dialog>\r\n      <DialogHeader>\r\n        <Trans message=\"New Folder\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <Form onSubmit={onSubmit} form={form} id={formId}>\r\n          <FormTextField\r\n            placeholder={trans({\r\n              message: 'Enter a name...',\r\n            })}\r\n            aria-label=\"Entry name\"\r\n            autoFocus\r\n            autoSelectText\r\n            name=\"name\"\r\n            required\r\n            minLength={3}\r\n            maxLength={200}\r\n          />\r\n        </Form>\r\n      </DialogBody>\r\n      <DialogFooter>\r\n        <Button variant=\"flat\" onClick={() => close()}>\r\n          <Trans message=\"Cancel\" />\r\n        </Button>\r\n        <Button\r\n          form={formId}\r\n          type=\"submit\"\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          disabled={createFolder.isPending}\r\n        >\r\n          <Trans message=\"Create\" />\r\n        </Button>\r\n      </DialogFooter>\r\n    </Dialog>\r\n  );\r\n}\r\n","import {FilePreviewDialog} from '@common/uploads/preview/file-preview-dialog';\r\nimport {DriveEntry} from '../drive-entry';\r\nimport {createElement, Fragment, useState} from 'react';\r\nimport {useShareAction} from '../../entry-actions/use-entry-actions';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {useEntries} from '../queries/use-entries';\r\n\r\ninterface EntryPreviewDialogProps {\r\n  selectedEntry: DriveEntry;\r\n}\r\nexport function EntryPreviewDialog({selectedEntry}: EntryPreviewDialogProps) {\r\n  const files = useEntries().filter(entry => entry.type !== 'folder');\r\n  const defaultActiveIndex = files.findIndex(\r\n    file => file.id === selectedEntry?.id\r\n  );\r\n  const [activeIndex, setActiveIndex] = useState(defaultActiveIndex);\r\n\r\n  const filePermission: boolean | undefined = selectedEntry?.users?.[1]?.entry_permissions?.download;\r\n\r\n  const allowDownload: boolean = !!filePermission;\r\n  \r\n\r\n  return (\r\n    <FilePreviewDialog\r\n      // allowDownload={selectedEntry.permissions['files.download']}\r\n      allowDownload = {allowDownload}\r\n      headerActionsLeft={\r\n        <DriveActions activeIndex={activeIndex} entries={files} />\r\n      }\r\n      activeIndex={activeIndex}\r\n      onActiveIndexChange={setActiveIndex}\r\n      entries={files}\r\n    />\r\n  );\r\n}\r\n\r\ninterface DriveActionsProps {\r\n  activeIndex: number;\r\n  entries: DriveEntry[];\r\n}\r\nfunction DriveActions({activeIndex, entries}: DriveActionsProps) {\r\n  const selectedEntry = entries[activeIndex];\r\n  const share = useShareAction([selectedEntry]);\r\n  if (!selectedEntry || !share) return null;\r\n\r\n  return (\r\n    <Fragment>\r\n      <IconButton\r\n        className=\"md:hidden\"\r\n        onClick={() => {\r\n          share.execute();\r\n        }}\r\n      >\r\n        {createElement(share.icon)}\r\n      </IconButton>\r\n      <Button\r\n        className=\"max-md:hidden\"\r\n        variant=\"text\"\r\n        startIcon={createElement(share.icon)}\r\n        onClick={() => {\r\n          share.execute();\r\n        }}\r\n      >\r\n        <Trans {...share.label} />\r\n      </Button>\r\n    </Fragment>\r\n  );\r\n}\r\n","import axios from 'axios';\r\nimport {useMutation} from '@tanstack/react-query';\r\nimport {DriveEntryPermissions} from '../../files/drive-entry';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {BackendErrorResponse} from '@common/errors/backend-error-response';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\nexport interface ShareEntryPayload {\r\n  emails: string[];\r\n  permissions: DriveEntryPermissions;\r\n  entryId: number;\r\n}\r\n\r\nfunction shareEntry({\r\n  entryId,\r\n  ...payload\r\n}: ShareEntryPayload): Promise<BackendResponse> {\r\n  return apiClient\r\n    .post(`file-entries/${entryId}/share`, payload)\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useShareEntry() {\r\n  return useMutation({\r\n    mutationFn: (payload: ShareEntryPayload) => shareEntry(payload),\r\n    onSuccess: () => {\r\n      invalidateEntryQueries();\r\n    },\r\n    onError: err => {\r\n      if (axios.isAxiosError(err) && err.response) {\r\n        const response = err.response.data as BackendErrorResponse;\r\n        if (response.errors?.emails) {\r\n          toast.danger(response.errors?.emails[0]);\r\n        } else {\r\n          showHttpErrorToast(err);\r\n        }\r\n      }\r\n    },\r\n  });\r\n}\r\n","import {FileEntry} from '@common/uploads/file-entry';\r\n\r\nexport interface DriveEntry extends FileEntry {\r\n  users: DriveEntryUser[];\r\n  workspace_id?: number;\r\n  permissions: {\r\n    'files.create': boolean;\r\n    'files.update': boolean;\r\n    'files.delete': boolean;\r\n    'files.download': boolean;\r\n  };\r\n  received_from_superadmin?: boolean;\r\n  \r\n}\r\n\r\nexport interface DriveFolder extends DriveEntry {\r\n  type: 'folder';\r\n  model_type?: string;\r\n}\r\n\r\nexport interface DriveEntryUser {\r\n  id: number;\r\n  email: string;\r\n  display_name: string;\r\n  avatar?: string;\r\n  owns_entry: boolean;\r\n  entry_permissions: DriveEntryPermissions;\r\n}\r\n\r\nexport interface DriveEntryPermissions {\r\n  edit?: boolean;\r\n  view?: boolean;\r\n  download?: boolean;\r\n}\r\n\r\nexport const DRIVE_ENTRY_FULL_PERMISSIONS = {\r\n  edit: true,\r\n  view: true,\r\n  download: true,\r\n};\r\n","import {Button} from '@common/ui/buttons/button';\r\nimport {ArrowDropDownIcon} from '@common/icons/material/ArrowDropDown';\r\nimport {\r\n  DRIVE_ENTRY_FULL_PERMISSIONS,\r\n  DriveEntryPermissions,\r\n  DriveEntryUser,\r\n} from '../files/drive-entry';\r\nimport {\r\n  Menu,\r\n  MenuItem,\r\n  MenuTrigger,\r\n} from '@common/ui/navigation/menu/menu-trigger';\r\nimport {message} from '@common/i18n/message';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {MessageDescriptor} from '@common/i18n/message-descriptor';\r\n\r\nexport interface PermissionSelectorItem {\r\n  key: keyof DriveEntryPermissions;\r\n  value: DriveEntryPermissions;\r\n  label: MessageDescriptor;\r\n}\r\n\r\nexport const PermissionSelectorItems: PermissionSelectorItem[] = [\r\n  {\r\n    key: 'view',\r\n    value: {view: true, download: false},\r\n    label: message('Can view'),\r\n  },\r\n  {\r\n    key: 'download',\r\n    value: {view: true, download: true},\r\n    label: message('Can Download'),\r\n  },\r\n  {\r\n    key: 'edit',\r\n    value: DRIVE_ENTRY_FULL_PERMISSIONS,\r\n    label: message('Can edit'),\r\n  },\r\n];\r\n\r\ninterface Props {\r\n  onChange: (value: PermissionSelectorItem) => void;\r\n  value: PermissionSelectorItem;\r\n}\r\n\r\nexport function PermissionSelector({value, onChange}: Props) {\r\n  return (\r\n    <MenuTrigger\r\n      selectedValue={value.key}\r\n      selectionMode=\"single\"\r\n      onSelectionChange={key => {\r\n        if (key !== value.key) {\r\n          onChange(PermissionSelectorItems.find(p => p.key === key)!);\r\n        }\r\n      }}\r\n    >\r\n      <Button\r\n        variant=\"flat\"\r\n        color=\"chip\"\r\n        size=\"xs\"\r\n        endIcon={<ArrowDropDownIcon />}\r\n      >\r\n        <Trans {...value.label} />\r\n      </Button>\r\n      <Menu>\r\n        {PermissionSelectorItems.map(item => {\r\n          return (\r\n            <MenuItem key={item.key} value={item.key}>\r\n              <Trans {...item.label} />\r\n            </MenuItem>\r\n          );\r\n        })}\r\n      </Menu>\r\n    </MenuTrigger>\r\n  );\r\n}\r\n\r\nexport function getPermissionItemForUser(\r\n  user: DriveEntryUser\r\n): PermissionSelectorItem {\r\n  const {download, edit} = user.entry_permissions;\r\n  if (edit) {\r\n    return PermissionSelectorItems.find(item => item.key === 'edit')!;\r\n  }\r\n  if (download) {\r\n    return PermissionSelectorItems.find(item => item.key === 'download')!;\r\n  }\r\n  return PermissionSelectorItems.find(item => item.key === 'view')!;\r\n}\r\n\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {DriveEntryPermissions} from '../../files/drive-entry';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {invalidateEntryQueries} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\nexport interface ChangePermissionsPayload {\r\n  userId: number;\r\n  permissions: DriveEntryPermissions;\r\n  entryId: number;\r\n}\r\n\r\nexport function useChangePermission() {\r\n  return useMutation({\r\n    mutationFn: (payload: ChangePermissionsPayload) =>\r\n      changePermission(payload),\r\n    onSuccess: () => {\r\n      invalidateEntryQueries();\r\n      toast(message('Updated user permissions'));\r\n    },\r\n    onError: err =>\r\n      showHttpErrorToast(err, message('Could not update permissions')),\r\n  });\r\n}\r\n\r\nfunction changePermission({\r\n  entryId,\r\n  ...payload\r\n}: ChangePermissionsPayload): Promise<BackendResponse> {\r\n  return apiClient\r\n    .put(`file-entries/${entryId}/change-permissions`, payload)\r\n    .then(response => response.data);\r\n}\r\n","import {Avatar, AvatarProps} from '@common/ui/images/avatar';\r\nimport {User} from '@common/auth/user';\r\nimport {useContext} from 'react';\r\nimport {SiteConfigContext} from '@common/core/settings/site-config-context';\r\n\r\ninterface UserAvatarProps extends Omit<AvatarProps, 'label' | 'src' | 'link'> {\r\n  user?: User;\r\n}\r\nexport function UserAvatar({user, ...props}: UserAvatarProps) {\r\n  const {auth} = useContext(SiteConfigContext);\r\n  return (\r\n    <Avatar\r\n      {...props}\r\n      label={user?.display_name}\r\n      src={user?.avatar}\r\n      link={user?.id && auth.getUserProfileLink?.(user)}\r\n    />\r\n  );\r\n}\r\n","import {useState} from 'react';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport clsx from 'clsx';\r\nimport {DriveEntry, DriveEntryUser} from '../files/drive-entry';\r\nimport {\r\n  getPermissionItemForUser,\r\n  PermissionSelector,\r\n  PermissionSelectorItem,\r\n} from './permission-selector';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {CloseIcon} from '@common/icons/material/Close';\r\nimport {useChangePermission} from './queries/use-change-permission';\r\nimport {useUnshareEntries} from './queries/use-unshare-entries';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\nimport {UserAvatar} from '@common/ui/images/user-avatar';\r\n\r\ninterface MemberListProps {\r\n  className?: string;\r\n  entry: DriveEntry;\r\n}\r\n\r\nexport function MemberList({className, entry}: MemberListProps) {\r\n  if (!entry) return null;\r\n\r\n  const users = entry.users;\r\n\r\n  return (\r\n    <div className={clsx(className, 'overflow-hidden')}>\r\n      <div className=\"mb-14 text-sm\">\r\n        <Trans message=\"Who has access\" />\r\n      </div>\r\n      <AnimatePresence initial={false}>\r\n        {users.map(user => {\r\n          return <MemberListItem key={user.id} user={user} entry={entry} />;\r\n        })}\r\n      </AnimatePresence>\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface MemberListItemProps {\r\n  user: DriveEntryUser;\r\n  entry: DriveEntry;\r\n}\r\nfunction MemberListItem({user, entry}: MemberListItemProps) {\r\n  return (\r\n    <m.div\r\n      initial={{x: '-100%', opacity: 0}}\r\n      animate={{x: 0, opacity: 1}}\r\n      exit={{x: '100%', opacity: 0}}\r\n      transition={{type: 'tween', duration: 0.125}}\r\n      className=\"flex items-center text-sm gap-14 mb-20\"\r\n      key={user.id}\r\n    >\r\n      <UserAvatar user={user as any} circle size=\"w-44 h-44\" />\r\n      <div>\r\n        <div>{user.display_name}</div>\r\n        <div className=\"text-muted\">{user.email}</div>\r\n      </div>\r\n      <div className=\"ml-auto\">\r\n        {user.owns_entry ? (\r\n          <span className=\"text-muted\">\r\n            <Trans message=\"Owner\" />\r\n          </span>\r\n        ) : (\r\n          <ActionButtons user={user} entry={entry} />\r\n        )}\r\n      </div>\r\n    </m.div>\r\n  );\r\n}\r\n\r\ninterface ActionButtonsProps {\r\n  user: DriveEntryUser;\r\n  entry: DriveEntry;\r\n}\r\nfunction ActionButtons({user, entry}: ActionButtonsProps) {\r\n  const changePermissions = useChangePermission();\r\n  const unshareEntry = useUnshareEntries();\r\n  const [activePermission, setActivePermission] =\r\n    useState<PermissionSelectorItem>(() => {\r\n      return getPermissionItemForUser(user);\r\n    });\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-10\">\r\n      <PermissionSelector\r\n        onChange={item => {\r\n          changePermissions.mutate({\r\n            userId: user.id,\r\n            permissions: item.value,\r\n            entryId: entry.id,\r\n          });\r\n          setActivePermission(item);\r\n        }}\r\n        value={activePermission}\r\n      />\r\n      <IconButton\r\n        onClick={() => {\r\n          unshareEntry.mutate(\r\n            {userId: user.id, entryIds: [entry.id]},\r\n            {\r\n              onSuccess: () => {\r\n                toast(message('Member removed'));\r\n              },\r\n              onError: err =>\r\n                showHttpErrorToast(err, message('Could not remove member')),\r\n            }\r\n          );\r\n        }}\r\n      >\r\n        <CloseIcon />\r\n      </IconButton>\r\n    </div>\r\n  );\r\n}\r\n","import {useState} from 'react';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {useShareEntry} from './queries/use-share-entry';\r\nimport {\r\n  PermissionSelector,\r\n  PermissionSelectorItem,\r\n  PermissionSelectorItems,\r\n} from './permission-selector';\r\nimport {MemberList} from './member-list';\r\nimport {\r\n  ChipField,\r\n  ChipValue,\r\n} from '@common/ui/forms/input-field/chip-field/chip-field';\r\nimport {Avatar} from '@common/ui/images/avatar';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {Item} from '@common/ui/forms/listbox/item';\r\nimport {isEmail} from '@common/utils/string/is-email';\r\nimport {useNormalizedModels} from '@common/users/queries/use-normalized-models';\r\nimport {useSettings} from '@common/core/settings/use-settings';\r\n\r\ninterface SharePanelProps {\r\n  className?: string;\r\n  entry: DriveEntry;\r\n}\r\nexport function SharePanel({className, entry}: SharePanelProps) {\r\n  const {trans} = useTrans();\r\n  const {share} = useSettings();\r\n  const shareEntry = useShareEntry();\r\n  const [chips, setChips] = useState<ChipValue[]>([]);\r\n  const [isSharing, setIsSharing] = useState(false);\r\n  const [selectedPermission, setSelectedPermission] =\r\n    useState<PermissionSelectorItem>(PermissionSelectorItems[0]);\r\n  const allEmailsValid = chips.every(chip => !chip.invalid);\r\n  const [inputValue, setInputValue] = useState('');\r\n  const query = useNormalizedModels(\r\n    'normalized-models/user',\r\n    {perPage: 7, query: inputValue},\r\n    {enabled: share.suggest_emails},\r\n  );\r\n\r\n  // show user's email, instead of name in the chip\r\n  const displayWith = (chip: ChipValue) => chip.description || chip.name;\r\n  return (\r\n    <div className={className}>\r\n      <ChipField\r\n        value={chips}\r\n        onChange={setChips}\r\n        isAsync\r\n        isLoading={query.fetchStatus === 'fetching'}\r\n        inputValue={inputValue}\r\n        onInputValueChange={setInputValue}\r\n        suggestions={query.data?.results}\r\n        displayWith={displayWith}\r\n        validateWith={chip => {\r\n          const invalid = !isEmail(chip.description);\r\n          return {\r\n            ...chip,\r\n            invalid,\r\n            errorMessage: invalid\r\n              ? trans({message: 'Not a valid email'})\r\n              : undefined,\r\n          };\r\n        }}\r\n        placeholder={trans({message: 'Enter email addresses'})}\r\n        label={<Trans message=\"Invite people\" />}\r\n      >\r\n        {user => (\r\n          <Item\r\n            value={user.id}\r\n            startIcon={<Avatar circle src={user.image} alt=\"\" />}\r\n            description={user.description}\r\n          >\r\n            {user.name}\r\n          </Item>\r\n        )}\r\n      </ChipField>\r\n      <div className=\"mt-14 flex items-center justify-between gap-14\">\r\n        <PermissionSelector\r\n          onChange={setSelectedPermission}\r\n          value={selectedPermission}\r\n        />\r\n        {chips.length ? (\r\n          <Button\r\n            variant=\"flat\"\r\n            color=\"primary\"\r\n            size=\"sm\"\r\n            disabled={isSharing || !allEmailsValid}\r\n            onClick={() => {\r\n              setIsSharing(true);\r\n              shareEntry.mutate(\r\n                {\r\n                  emails: chips.map(c => displayWith(c)),\r\n                  permissions: selectedPermission.value,\r\n                  entryId: entry.id,\r\n                },\r\n                {\r\n                  onSuccess: () => {\r\n                    setChips([]);\r\n                  },\r\n                  onSettled: () => {\r\n                    setIsSharing(false);\r\n                  },\r\n                },\r\n              );\r\n            }}\r\n          >\r\n            <Trans message=\"Share\" />\r\n          </Button>\r\n        ) : null}\r\n      </div>\r\n      <MemberList className=\"mt-30\" entry={entry} />\r\n    </div>\r\n  );\r\n\r\n\r\n\r\n\r\n\r\n\r\n}\r\n","import {useQuery} from '@tanstack/react-query';\r\nimport {ShareableLink} from '../shareable-link';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {apiClient} from '@common/http/query-client';\r\n\r\nexport interface FetchShareableLinkResponse extends BackendResponse {\r\n  link: ShareableLink | null;\r\n}\r\n\r\nexport function useEntryShareableLink(entryId: number) {\r\n  return useQuery({\r\n    queryKey: DriveQueryKeys.fetchEntryShareableLink(entryId!),\r\n    queryFn: () => fetchLinkByEntryId(entryId!),\r\n    enabled: !!entryId,\r\n  });\r\n}\r\n\r\nfunction fetchLinkByEntryId(\r\n  entryId: number,\r\n): Promise<FetchShareableLinkResponse> {\r\n  return apiClient\r\n    .get(`file-entries/${entryId}/shareable-link`, {\r\n      params: {loader: 'shareableLink'},\r\n    })\r\n    .then(response => response.data);\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {FetchShareableLinkResponse} from './use-entry-shareable-link';\r\nimport {BackendResponse} from '@common/http/backend-response/backend-response';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\nimport {message} from '@common/i18n/message';\r\nimport {showHttpErrorToast} from '@common/utils/http/show-http-error-toast';\r\n\r\ninterface DeleteLinkParams {\r\n  entryId: number;\r\n}\r\n\r\nfunction deleteShareableLink({\r\n  entryId,\r\n}: DeleteLinkParams): Promise<BackendResponse> {\r\n  return apiClient\r\n    .delete(`file-entries/${entryId}/shareable-link`)\r\n    .then(r => r.data);\r\n}\r\n\r\ninterface Payload {\r\n  entryId: number;\r\n}\r\nexport function useDeleteShareableLink() {\r\n  return useMutation({\r\n    mutationFn: ({entryId}: Payload) => deleteShareableLink({entryId}),\r\n    onSuccess: (response, {entryId}) => {\r\n      queryClient.setQueryData<FetchShareableLinkResponse>(\r\n        DriveQueryKeys.fetchEntryShareableLink(entryId),\r\n        {...response, link: null},\r\n      );\r\n    },\r\n    onError: err => showHttpErrorToast(err, message('Could not delete link')),\r\n  });\r\n}\r\n","export function randomString(length: number = 36) {\r\n  let random = '';\r\n  const possible =\r\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n\r\n  for (let i = 0; i < length; i += 1) {\r\n    random += possible.charAt(Math.floor(Math.random() * possible.length));\r\n  }\r\n\r\n  return random;\r\n}\r\n","import useClipboard from 'react-use-clipboard';\r\nimport {useEntryShareableLink} from '../../shareable-link/queries/use-entry-shareable-link';\r\nimport {useCreateShareableLink} from '../../shareable-link/queries/create-shareable-link';\r\nimport {useDeleteShareableLink} from '../../shareable-link/queries/use-delete-shareable-link';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {ShareableLink} from '../../shareable-link/shareable-link';\r\nimport {TextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport type {ShareDialogActivePanel} from '../share-dialog';\r\nimport {Switch} from '@common/ui/forms/toggle/switch';\r\nimport {randomString} from '@common/utils/string/random-string';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {useActiveDialogEntry} from '../../drive-store';\r\nimport {DriveEntry} from '../../files/drive-entry';\r\nimport {useSettings} from '@common/core/settings/use-settings';\r\n\r\ninterface ShareableLinkPanelProps {\r\n  setActivePanel: (name: ShareDialogActivePanel) => void;\r\n  entry: DriveEntry;\r\n  focusInput?: boolean;\r\n}\r\nexport function ShareableLinkPanel({\r\n  setActivePanel,\r\n  entry,\r\n  focusInput,\r\n}: ShareableLinkPanelProps) {\r\n  const query = useEntryShareableLink(entry.id);\r\n  const linkExists = !!query.data?.link;\r\n  const createLink = useCreateShareableLink();\r\n  const deleteLink = useDeleteShareableLink();\r\n  const isLoading =\r\n    query.isLoading || createLink.isPending || deleteLink.isPending;\r\n  return (\r\n    <div>\r\n      <div className=\"mb-10\">\r\n        <Trans message=\"Share link\" />\r\n      </div>\r\n      <div className=\"flex items-center justify-between gap-14 px-2 pb-4\">\r\n        <Switch\r\n          checked={linkExists}\r\n          disabled={isLoading}\r\n          onChange={() => {\r\n            if (linkExists) {\r\n              deleteLink.mutate({entryId: entry.id});\r\n            } else {\r\n              createLink.mutate({entryId: entry.id});\r\n            }\r\n          }}\r\n        >\r\n          {linkExists ? (\r\n            <Trans message=\"Shareable link is created\" />\r\n          ) : (\r\n            <Trans message=\"Create shareable link\" />\r\n          )}\r\n        </Switch>\r\n      </div>\r\n      <ShareableLinkInput autoFocus={focusInput} link={query.data?.link} />\r\n    </div>\r\n  );\r\n}\r\n\r\ninterface ShareableLinkInputProps {\r\n  link?: ShareableLink | null;\r\n  autoFocus?: boolean;\r\n}\r\nfunction ShareableLinkInput({link, autoFocus}: ShareableLinkInputProps) {\r\n  const {base_url} = useSettings();\r\n  const {trans} = useTrans();\r\n  const entry = useActiveDialogEntry();\r\n  const hash = link?.hash || entry?.hash || randomString();\r\n  const linkUrl = `${base_url}/drive/s/${hash}`;\r\n  const [isCopied, setCopied] = useClipboard(linkUrl, {\r\n    successDuration: 1000,\r\n  });\r\n  return (\r\n    <TextField\r\n      autoFocus={autoFocus}\r\n      disabled={!link}\r\n      className=\"mt-10\"\r\n      readOnly\r\n      value={linkUrl}\r\n      aria-label={trans({message: 'Shareable link'})}\r\n      onFocus={e => {\r\n        (e.target as HTMLInputElement).select();\r\n      }}\r\n      endAppend={\r\n        <Button\r\n          className=\"min-w-100\"\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          onClick={setCopied}\r\n        >\r\n          {isCopied ? <Trans message=\"Copied!\" /> : <Trans message=\"Copy\" />}\r\n        </Button>\r\n      }\r\n    />\r\n  );\r\n}\r\n","import {useMutation} from '@tanstack/react-query';\r\nimport {UseFormReturn} from 'react-hook-form';\r\nimport {apiClient, queryClient} from '@common/http/query-client';\r\nimport {FetchShareableLinkResponse} from './use-entry-shareable-link';\r\nimport {onFormQueryError} from '@common/errors/on-form-query-error';\r\nimport {DriveQueryKeys} from '../../drive-query-keys';\r\n\r\nexport interface UpdateShareableLinkPayload {\r\n  allowEdit: boolean;\r\n  allowDownload: boolean;\r\n  expiresAt: string;\r\n  password: string;\r\n  entryId: number;\r\n}\r\n\r\nfunction updateShareableLink({\r\n  entryId,\r\n  ...payload\r\n}: UpdateShareableLinkPayload): Promise<FetchShareableLinkResponse> {\r\n  return apiClient\r\n    .put(`file-entries/${entryId}/shareable-link`, payload)\r\n    .then(response => response.data);\r\n}\r\n\r\nexport function useUpdateShareableLink(\r\n  form: UseFormReturn<UpdateShareableLinkPayload>,\r\n) {\r\n  return useMutation({\r\n    mutationFn: (payload: UpdateShareableLinkPayload) =>\r\n      updateShareableLink(payload),\r\n    onSuccess: (data, {entryId}) => {\r\n      queryClient.setQueryData<FetchShareableLinkResponse>(\r\n        DriveQueryKeys.fetchEntryShareableLink(entryId),\r\n        data,\r\n      );\r\n    },\r\n    onError: r => onFormQueryError(r, form),\r\n  });\r\n}\r\n","import {useForm} from 'react-hook-form';\r\nimport {Fragment, ReactElement, useState} from 'react';\r\nimport clsx from 'clsx';\r\nimport {m} from 'framer-motion';\r\nimport {getLocalTimeZone, now} from '@internationalized/date';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {FormTextField} from '@common/ui/forms/input-field/text-field/text-field';\r\nimport {DialogFooter} from '@common/ui/overlays/dialog/dialog-footer';\r\nimport type {ShareDialogActivePanel} from '../share-dialog';\r\nimport {useEntryShareableLink} from '../../shareable-link/queries/use-entry-shareable-link';\r\nimport {Form} from '@common/ui/forms/form';\r\nimport {\r\n  UpdateShareableLinkPayload,\r\n  useUpdateShareableLink,\r\n} from '../../shareable-link/queries/use-update-shareable-link';\r\nimport {FormSwitch, Switch} from '@common/ui/forms/toggle/switch';\r\nimport {toast} from '@common/ui/toast/toast';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\r\nimport {FormDatePicker} from '@common/ui/forms/input-field/date/date-picker/date-picker';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {message} from '@common/i18n/message';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\n\r\ninterface LinkSettingsDialogProps {\r\n  className?: string;\r\n  setActivePanel: (name: ShareDialogActivePanel) => void;\r\n  entry: FileEntry;\r\n}\r\nexport function LinkSettingsDialog({\r\n  className,\r\n  setActivePanel,\r\n  entry,\r\n}: LinkSettingsDialogProps) {\r\n  const {formId} = useDialogContext();\r\n  const {data} = useEntryShareableLink(entry.id);\r\n  const link = data?.link;\r\n  const form = useForm<UpdateShareableLinkPayload>({\r\n    defaultValues: {\r\n      allowDownload: link?.allow_download,\r\n      allowEdit: link?.allow_edit,\r\n      expiresAt: link?.expires_at,\r\n      entryId: entry.id,\r\n    },\r\n  });\r\n  const updateLink = useUpdateShareableLink(form);\r\n\r\n  return (\r\n    <Fragment>\r\n      <DialogHeader\r\n        onDismiss={() => {\r\n          setActivePanel('main');\r\n        }}\r\n      >\r\n        <Trans message=\"Shareable Link Settings\" />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <m.div\r\n          key=\"link-settings-content\"\r\n          className=\"min-h-[335px]\"\r\n          animate={{opacity: 1, y: 0}}\r\n          initial={{opacity: 0, y: 20}}\r\n          exit={{opacity: 0, y: -20}}\r\n          transition={{duration: 0.1}}\r\n        >\r\n          <Form\r\n            id={formId}\r\n            className={className}\r\n            form={form}\r\n            onSubmit={value => {\r\n              updateLink.mutate(value, {\r\n                onSuccess: () => {\r\n                  setActivePanel('main');\r\n                  toast(message('Link settings saved'));\r\n                },\r\n              });\r\n            }}\r\n          >\r\n            <LinkExpirationOption showField={!!link?.expires_at} />\r\n            <LinkPasswordOption showField={!!link?.password} />\r\n            <LinkOption>\r\n              <Trans message=\"Allow download\" />\r\n              <FormSwitch name=\"allowDownload\">\r\n                <Trans message=\"Users with link can download this item\" />\r\n              </FormSwitch>\r\n            </LinkOption>\r\n            <LinkOption showBorder={false}>\r\n              <Trans message=\"Allow import\" />\r\n              <FormSwitch name=\"allowEdit\">\r\n                <Trans message=\"Users with link can import this item into their own drive\" />\r\n              </FormSwitch>\r\n            </LinkOption>\r\n          </Form>\r\n        </m.div>\r\n      </DialogBody>\r\n      <DialogFooter>\r\n        <Button\r\n          type=\"button\"\r\n          onClick={() => {\r\n            setActivePanel('main');\r\n          }}\r\n        >\r\n          <Trans message=\"Cancel\" />\r\n        </Button>\r\n        <Button\r\n          type=\"submit\"\r\n          form={formId}\r\n          variant=\"flat\"\r\n          color=\"primary\"\r\n          disabled={updateLink.isPending}\r\n        >\r\n          <Trans message=\"Save\" />\r\n        </Button>\r\n      </DialogFooter>\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nconst minDate = now(getLocalTimeZone());\r\n\r\ninterface LinkExpirationOptionProps {\r\n  showField: boolean;\r\n}\r\nfunction LinkExpirationOption({\r\n  showField: showFieldDefault,\r\n}: LinkExpirationOptionProps) {\r\n  const {trans} = useTrans();\r\n  const [showField, setShowField] = useState(showFieldDefault);\r\n  return (\r\n    <LinkOption>\r\n      <Trans message=\"Link expiration\" />\r\n      <div>\r\n        <Switch\r\n          checked={showField}\r\n          onChange={e => {\r\n            setShowField(e.target.checked);\r\n          }}\r\n        >\r\n          <Trans message=\"Link is valid until\" />\r\n        </Switch>\r\n        {showField && (\r\n          <FormDatePicker\r\n            min={minDate}\r\n            name=\"expiresAt\"\r\n            granularity=\"minute\"\r\n            className=\"mt-20\"\r\n            aria-label={trans({\r\n              message: 'Link expiration date and time',\r\n            })}\r\n          />\r\n        )}\r\n      </div>\r\n    </LinkOption>\r\n  );\r\n}\r\n\r\ninterface LinkPasswordOptionProps {\r\n  showField: boolean;\r\n}\r\nfunction LinkPasswordOption({\r\n  showField: showFieldDefault,\r\n}: LinkPasswordOptionProps) {\r\n  const {trans} = useTrans();\r\n  const [showField, setShowField] = useState(showFieldDefault);\r\n  return (\r\n    <LinkOption>\r\n      <Trans message=\"Password protect\" />\r\n      <div>\r\n        <Switch\r\n          checked={showField}\r\n          onChange={e => {\r\n            setShowField(e.target.checked);\r\n          }}\r\n        >\r\n          <Trans message=\"Users will need to enter password in order to view this link\" />\r\n        </Switch>\r\n        {showField && (\r\n          <FormTextField\r\n            type=\"password\"\r\n            autoFocus\r\n            name=\"password\"\r\n            className=\"mt-20\"\r\n            aria-label={trans({message: 'Link password'})}\r\n            description={\r\n              <Trans message=\"Password will not be requested when viewing the link as file owner.\" />\r\n            }\r\n            placeholder={trans({\r\n              message: 'Enter new password...',\r\n            })}\r\n          />\r\n        )}\r\n      </div>\r\n    </LinkOption>\r\n  );\r\n}\r\n\r\ninterface LinkOptionProps {\r\n  children: [ReactElement, ReactElement];\r\n  showBorder?: boolean;\r\n}\r\nfunction LinkOption({children, showBorder = true}: LinkOptionProps) {\r\n  const [title, content] = children;\r\n  return (\r\n    <div className={clsx(showBorder && 'mb-20 border-b pb-20')}>\r\n      <div className=\"mb-8 text-sm font-medium\">{title}</div>\r\n      {content}\r\n    </div>\r\n  );\r\n}\r\n","import {Fragment, useState} from 'react';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport {SharePanel} from './share-panel';\r\nimport {ShareableLinkPanel} from './link-panel/shareable-link-panel';\r\nimport {LinkSettingsDialog} from './link-panel/link-settings-dialog';\r\nimport {Dialog} from '@common/ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {DriveEntry} from '../files/drive-entry';\r\nimport {useQuery} from '@tanstack/react-query';\r\nimport {apiClient} from '@common/http/query-client';\r\nimport {DriveQueryKeys} from '../drive-query-keys';\r\n\r\nexport type ShareDialogActivePanel = 'main' | 'linkSettings';\r\n\r\ninterface ShareDialogProps {\r\n  entry: DriveEntry;\r\n  focusLinkInput?: boolean;\r\n}\r\nexport function ShareDialog({\r\n  entry: initialEntry,\r\n  focusLinkInput,\r\n}: ShareDialogProps) {\r\n  const {\r\n    data: {fileEntry},\r\n  } = useQuery({\r\n    queryKey: DriveQueryKeys.fetchFileEntry(initialEntry.id),\r\n    queryFn: () =>\r\n      apiClient\r\n        .get(`drive/file-entries/${initialEntry.id}/model`)\r\n        .then(response => response.data as {fileEntry: DriveEntry}),\r\n    initialData: {fileEntry: initialEntry},\r\n  });\r\n\r\n  const [activePanel, setActivePanel] =\r\n    useState<ShareDialogActivePanel>('main');\r\n\r\n  return (\r\n    <Dialog size=\"lg\">\r\n      <AnimatePresence initial={false} mode=\"wait\">\r\n        {activePanel === 'linkSettings' ? (\r\n          <LinkSettingsDialog\r\n            key=\"one\"\r\n            setActivePanel={setActivePanel}\r\n            entry={fileEntry}\r\n          />\r\n        ) : (\r\n          <MainDialog\r\n            key=\"two\"\r\n            setActivePanel={setActivePanel}\r\n            entry={fileEntry}\r\n            focusLinkInput={focusLinkInput}\r\n          />\r\n        )}\r\n      </AnimatePresence>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\ninterface MainDialogProps {\r\n  setActivePanel: (name: ShareDialogActivePanel) => void;\r\n  entry: DriveEntry;\r\n  focusLinkInput?: boolean;\r\n}\r\nfunction MainDialog({setActivePanel, entry, focusLinkInput}: MainDialogProps) {\r\n  return (\r\n    <Fragment>\r\n      <DialogHeader>\r\n        <Trans message=\"Share :name\" values={{name: entry.name}} />\r\n      </DialogHeader>\r\n      <DialogBody className=\"relative\">\r\n        <m.div\r\n          key=\"share-content\"\r\n          animate={{opacity: 1, y: 0}}\r\n          initial={{opacity: 0, y: 20}}\r\n          exit={{opacity: 0, y: -20}}\r\n          transition={{duration: 0.1}}\r\n        >\r\n          <SharePanel className=\"mb-30 border-b pb-30\" entry={entry} />\r\n          <ShareableLinkPanel\r\n            setActivePanel={setActivePanel}\r\n            entry={entry}\r\n            focusInput={!!focusLinkInput}\r\n          />\r\n        </m.div>\r\n      </DialogBody>\r\n    </Fragment>\r\n  );\r\n}\r\n","import React, {ReactElement, Ref} from 'react';\r\nimport {BaseFieldPropsWithDom} from '../input-field/base-field-props';\r\nimport {Item} from '../listbox/item';\r\nimport {useListbox} from '../listbox/use-listbox';\r\nimport {IconButton} from '../../buttons/icon-button';\r\nimport {TextField} from '../input-field/text-field/text-field';\r\nimport {Listbox} from '../listbox/listbox';\r\nimport {SvgIconProps} from '@common/icons/svg-icon';\r\nimport {useListboxKeyboardNavigation} from '@common/ui/forms/listbox/use-listbox-keyboard-navigation';\r\nimport {createEventHandler} from '@common/utils/dom/create-event-handler';\r\nimport {ListBoxChildren, ListboxProps} from '../listbox/types';\r\nimport {Popover} from '../../overlays/popover';\r\nimport {ComboboxEndAdornment} from '@common/ui/forms/combobox/combobox-end-adornment';\r\n\r\nexport {Item as Option};\r\n\r\nexport type ComboboxProps<T extends object> = Omit<\r\n  BaseFieldPropsWithDom<HTMLInputElement>,\r\n  'endAdornment'\r\n> &\r\n  ListBoxChildren<T> &\r\n  ListboxProps & {\r\n    selectionMode?: 'single' | 'none';\r\n    isAsync?: boolean;\r\n    isLoading?: boolean;\r\n    openMenuOnFocus?: boolean;\r\n    endAdornmentIcon?: ReactElement<SvgIconProps>;\r\n    useOptionLabelAsInputValue?: boolean;\r\n    hideEndAdornment?: boolean;\r\n    onEndAdornmentClick?: () => void;\r\n    prependListbox?: boolean;\r\n    listboxClassName?: string;\r\n  };\r\n\r\nfunction ComboBox<T extends object>(\r\n  props: ComboboxProps<T> & {selectionMode: 'single'},\r\n  ref: Ref<HTMLInputElement>,\r\n) {\r\n  const {\r\n    children,\r\n    items,\r\n    isAsync,\r\n    isLoading,\r\n    openMenuOnFocus = true,\r\n    endAdornmentIcon,\r\n    onItemSelected,\r\n    maxItems,\r\n    clearInputOnItemSelection,\r\n    inputValue: userInputValue,\r\n    selectedValue,\r\n    onSelectionChange,\r\n    allowCustomValue = false,\r\n    onInputValueChange,\r\n    defaultInputValue,\r\n    selectionMode = 'single',\r\n    useOptionLabelAsInputValue,\r\n    showEmptyMessage,\r\n    floatingMaxHeight,\r\n    hideEndAdornment = false,\r\n    blurReferenceOnItemSelection,\r\n    isOpen: propsIsOpen,\r\n    onOpenChange: propsOnOpenChange,\r\n    prependListbox,\r\n    listboxClassName,\r\n    onEndAdornmentClick,\r\n    autoFocusFirstItem = true,\r\n    ...textFieldProps\r\n  } = props;\r\n\r\n  const listbox = useListbox(\r\n    {\r\n      ...props,\r\n      floatingMaxHeight,\r\n      blurReferenceOnItemSelection,\r\n      selectionMode,\r\n      role: 'listbox',\r\n      virtualFocus: true,\r\n      clearSelectionOnInputClear: true,\r\n    },\r\n    ref,\r\n  );\r\n\r\n  const {\r\n    reference,\r\n    listboxId,\r\n    onInputChange,\r\n    state: {\r\n      isOpen,\r\n      setIsOpen,\r\n      inputValue,\r\n      setInputValue,\r\n      selectValues,\r\n      selectedValues,\r\n      setActiveCollection,\r\n    },\r\n    collection,\r\n  } = listbox;\r\n\r\n  const textLabel = selectedValues[0]\r\n    ? collection.get(selectedValues[0])?.textLabel\r\n    : undefined;\r\n\r\n  const {handleListboxSearchFieldKeydown} =\r\n    useListboxKeyboardNavigation(listbox);\r\n\r\n  const handleFocusAndClick = createEventHandler(\r\n    (e: React.FocusEvent<HTMLInputElement>) => {\r\n      if (openMenuOnFocus && !isOpen) {\r\n        setIsOpen(true);\r\n      }\r\n      e.target.select();\r\n    },\r\n  );\r\n\r\n  return (\r\n    <Listbox\r\n      prepend={prependListbox}\r\n      className={listboxClassName}\r\n      listbox={listbox}\r\n      mobileOverlay={Popover}\r\n      isLoading={isLoading}\r\n      onPointerDown={e => {\r\n        // prevent focus from leaving input when scrolling listbox via mouse\r\n        e.preventDefault();\r\n      }}\r\n    >\r\n      <TextField\r\n        inputRef={reference}\r\n        {...textFieldProps}\r\n        endAdornment={\r\n          !hideEndAdornment ? (\r\n            <IconButton\r\n              size=\"md\"\r\n              tabIndex={-1}\r\n              disabled={textFieldProps.disabled}\r\n              className=\"pointer-events-auto\"\r\n              onPointerDown={e => {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                if (onEndAdornmentClick) {\r\n                  onEndAdornmentClick();\r\n                } else {\r\n                  setActiveCollection('all');\r\n                  setIsOpen(!isOpen);\r\n                }\r\n              }}\r\n            >\r\n              <ComboboxEndAdornment\r\n                isLoading={isLoading}\r\n                icon={endAdornmentIcon}\r\n              />\r\n            </IconButton>\r\n          ) : null\r\n        }\r\n        aria-expanded={isOpen ? 'true' : 'false'}\r\n        aria-haspopup=\"listbox\"\r\n        aria-controls={isOpen ? listboxId : undefined}\r\n        aria-autocomplete=\"list\"\r\n        autoComplete=\"off\"\r\n        autoCorrect=\"off\"\r\n        spellCheck=\"false\"\r\n        onChange={onInputChange}\r\n        value={useOptionLabelAsInputValue && textLabel ? textLabel : inputValue}\r\n        onBlur={e => {\r\n          if (allowCustomValue) {\r\n            selectValues(e.target.value);\r\n          } else if (!clearInputOnItemSelection) {\r\n            const val = selectedValues[0];\r\n            setInputValue(selectValues.length && val != null ? `${val}` : '');\r\n          }\r\n        }}\r\n        onFocus={handleFocusAndClick}\r\n        onClick={handleFocusAndClick}\r\n        onKeyDown={e => handleListboxSearchFieldKeydown(e)}\r\n      />\r\n    </Listbox>\r\n  );\r\n}\r\n\r\nconst ComboBoxForwardRef = React.forwardRef(ComboBox) as <T extends object>(\r\n  props: ComboboxProps<T> & {ref?: Ref<HTMLInputElement>},\r\n) => ReactElement;\r\nexport {ComboBoxForwardRef as ComboBox};\r\n","import React from 'react';\r\nimport {SearchIcon} from '@common/icons/material/Search';\r\nimport {ComboBox} from '@common/ui/forms/combobox/combobox';\r\nimport {Item} from '@common/ui/forms/listbox/item';\r\nimport {useTrans} from '@common/i18n/use-trans';\r\nimport {PartialFolder} from '../../utils/can-move-entries-into';\r\n\r\ninterface SearchComboBoxProps {\r\n  allFolders: PartialFolder[];\r\n  onFolderSelected: (folder: PartialFolder) => void;\r\n}\r\nexport function MoveEntriesDialogSearch({\r\n  allFolders,\r\n  onFolderSelected,\r\n}: SearchComboBoxProps) {\r\n  const {trans} = useTrans();\r\n  const searchLabel = trans({message: 'Search folders'});\r\n  return (\r\n    <ComboBox\r\n      size=\"sm\"\r\n      maxItems={10}\r\n      placeholder={searchLabel}\r\n      aria-label={searchLabel}\r\n      className=\"pt-20\"\r\n      endAdornmentIcon={<SearchIcon />}\r\n      items={allFolders}\r\n      clearInputOnItemSelection\r\n      onItemSelected={value => {\r\n        const folderId = parseInt(value as string);\r\n        const folder = allFolders.find(f => f.id === folderId);\r\n        if (folder) {\r\n          onFolderSelected(folder);\r\n        }\r\n      }}\r\n    >\r\n      {item => (\r\n        <Item key={item.id} value={item.id}>\r\n          {item.name}\r\n        </Item>\r\n      )}\r\n    </ComboBox>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {ArrowBackIcon} from '@common/icons/material/ArrowBack';\r\nimport {Breadcrumb} from '@common/ui/breadcrumbs/breadcrumb';\r\nimport {FolderIcon} from '@common/icons/material/Folder';\r\nimport {BreadcrumbItem} from '@common/ui/breadcrumbs/breadcrumb-item';\r\nimport {PartialFolder} from '../../utils/can-move-entries-into';\r\n\r\ninterface FolderBreadCrumbsProps {\r\n  selectedFolder: PartialFolder;\r\n  allFolders: PartialFolder[];\r\n  rootFolder: PartialFolder;\r\n  onFolderSelected: (folder: PartialFolder) => void;\r\n}\r\nexport function MoveEntriesDialogBreadcrumbs({\r\n  selectedFolder,\r\n  allFolders,\r\n  rootFolder,\r\n  onFolderSelected,\r\n}: FolderBreadCrumbsProps) {\r\n  const path: PartialFolder[] = selectedFolder.path\r\n    .split('/')\r\n    .map(part => {\r\n      const folderId = parseInt(part);\r\n      return allFolders.find(folder => folderId === folder.id);\r\n    })\r\n    .filter(f => !!f) as PartialFolder[];\r\n  const fullPath: PartialFolder[] = [rootFolder, ...path];\r\n\r\n  const previous = path[path.length - 2];\r\n\r\n  return (\r\n    <div className=\"flex items-center gap-6 border-b pb-10\">\r\n      <IconButton\r\n        className=\"flex-shrink-0\"\r\n        variant=\"outline\"\r\n        size=\"xs\"\r\n        disabled={!previous && !selectedFolder.id}\r\n        onClick={() => {\r\n          onFolderSelected(previous || rootFolder);\r\n        }}\r\n      >\r\n        <ArrowBackIcon />\r\n      </IconButton>\r\n      <Breadcrumb size=\"sm\" className=\"flex-auto\">\r\n        {fullPath.map(item => {\r\n          return (\r\n            <BreadcrumbItem\r\n              onSelected={() => {\r\n                onFolderSelected(item);\r\n              }}\r\n              key={item.id || 'root'}\r\n              className=\"flex items-center gap-8\"\r\n            >\r\n              {!item.id && <FolderIcon className=\"icon-sm\" />}\r\n              {item.name}\r\n            </BreadcrumbItem>\r\n          );\r\n        })}\r\n      </Breadcrumb>\r\n    </div>\r\n  );\r\n}\r\n","export default \"__VITE_ASSET__b64d6dd2__\"","import React, {useMemo} from 'react';\r\nimport {IllustratedMessage} from '@common/ui/images/illustrated-message';\r\nimport {SvgImage} from '@common/ui/images/svg-image/svg-image';\r\nimport {FileTypeIcon} from '@common/uploads/file-type-icon/file-type-icon';\r\nimport {ChevronRightIcon} from '@common/icons/material/ChevronRight';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {List, ListItem} from '@common/ui/list/list';\r\nimport myFilesSvg from './my-files.svg';\r\nimport {PartialFolder} from '../../utils/can-move-entries-into';\r\n\r\ninterface FolderListProps {\r\n  selectedFolder: PartialFolder;\r\n  allFolders: PartialFolder[];\r\n  onFolderSelected: (folder: PartialFolder) => void;\r\n}\r\n\r\nexport function MoveEntriesDialogFolderList(props: FolderListProps) {\r\n  const {onFolderSelected, selectedFolder, allFolders} = props;\r\n\r\n  const subFolders = useMemo(() => {\r\n    const parentId = selectedFolder.id || null;\r\n    return allFolders.filter(f => f.parent_id === parentId);\r\n  }, [selectedFolder.id, allFolders]);\r\n\r\n  if (!subFolders.length) {\r\n    return (\r\n      <IllustratedMessage\r\n        size=\"xs\"\r\n        className=\"pt-64 pb-20 min-h-288\"\r\n        image={<SvgImage src={myFilesSvg} />}\r\n        title={\r\n          <Trans\r\n            message={`There are no subfolders in \":folder\"`}\r\n            values={{folder: selectedFolder.name}}\r\n          />\r\n        }\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <List className=\"h-288 overflow-y-auto\">\r\n      {subFolders.map(folder => {\r\n        return (\r\n          <ListItem\r\n            className=\"border-b min-h-48\"\r\n            key={folder.id}\r\n            onSelected={() => {\r\n              onFolderSelected(folder);\r\n            }}\r\n            startIcon={<FileTypeIcon type=\"folder\" />}\r\n            endIcon={<ChevronRightIcon size=\"md\" />}\r\n          >\r\n            {folder.name}\r\n          </ListItem>\r\n        );\r\n      })}\r\n    </List>\r\n  );\r\n}\r\n","import React, {useState} from 'react';\r\nimport {Button} from '@common/ui/buttons/button';\r\nimport {useFolders} from '../../queries/use-folders';\r\nimport {useMoveEntries} from '../../queries/use-move-entries';\r\nimport {NewFolderDialog} from '../new-folder-dialog';\r\nimport {CreateNewFolderIcon} from '@common/icons/material/CreateNewFolder';\r\nimport {MoveEntriesDialogSearch} from './move-entries-dialog-search';\r\nimport {MoveEntriesDialogBreadcrumbs} from './move-entries-dialog-breadcrumbs';\r\nimport {MoveEntriesDialogFolderList} from './move-entries-dialog-folder-list';\r\nimport {DialogTrigger} from '@common/ui/overlays/dialog/dialog-trigger';\r\nimport {DialogFooter} from '@common/ui/overlays/dialog/dialog-footer';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\nimport {Dialog} from '@common/ui/overlays/dialog/dialog';\r\nimport {DialogHeader} from '@common/ui/overlays/dialog/dialog-header';\r\nimport {DialogBody} from '@common/ui/overlays/dialog/dialog-body';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {RootFolderPage} from '../../../drive-page/drive-page';\r\nimport {DriveEntry} from '../../drive-entry';\r\nimport {useDriveStore} from '../../../drive-store';\r\nimport {\r\n  canMoveEntriesInto,\r\n  PartialFolder,\r\n} from '../../utils/can-move-entries-into';\r\n\r\ninterface MoveEntriesDialogProps {\r\n  entries: DriveEntry[];\r\n}\r\nexport function MoveEntriesDialog({entries}: MoveEntriesDialogProps) {\r\n  const {data} = useFolders();\r\n  const allFolders = data?.folders || [];\r\n  const activePage = useDriveStore(s => s.activePage);\r\n  const [selectedFolder, setSelectedFolder] = useState<PartialFolder>(\r\n    activePage?.folder || RootFolderPage.folder,\r\n  );\r\n\r\n  return (\r\n    <Dialog size=\"lg\">\r\n      <DialogHeader>\r\n        <Trans\r\n          message=\"Move [one :name|other :count items]\"\r\n          values={{\r\n            count: entries.length,\r\n            name: entries[0].name,\r\n          }}\r\n        />\r\n      </DialogHeader>\r\n      <DialogBody>\r\n        <div className=\"text-sm\">\r\n          <Trans message=\"Select a destination folder.\" />\r\n        </div>\r\n        <MoveEntriesDialogSearch\r\n          allFolders={allFolders}\r\n          onFolderSelected={setSelectedFolder}\r\n        />\r\n        <div className=\"mb-20 mt-40\">\r\n          <MoveEntriesDialogBreadcrumbs\r\n            selectedFolder={selectedFolder}\r\n            allFolders={allFolders}\r\n            rootFolder={RootFolderPage.folder}\r\n            onFolderSelected={setSelectedFolder}\r\n          />\r\n          <MoveEntriesDialogFolderList\r\n            selectedFolder={selectedFolder}\r\n            allFolders={allFolders}\r\n            onFolderSelected={setSelectedFolder}\r\n          />\r\n        </div>\r\n      </DialogBody>\r\n      <Footer\r\n        selectedFolder={selectedFolder}\r\n        setSelectedFolder={setSelectedFolder}\r\n        entries={entries}\r\n      />\r\n    </Dialog>\r\n  );\r\n}\r\n\r\ninterface FooterProps {\r\n  selectedFolder: PartialFolder;\r\n  setSelectedFolder: (folder: PartialFolder) => void;\r\n  entries: DriveEntry[];\r\n}\r\nfunction Footer({selectedFolder, setSelectedFolder, entries}: FooterProps) {\r\n  const {close} = useDialogContext();\r\n  const moveEntries = useMoveEntries();\r\n  return (\r\n    <DialogFooter\r\n      className=\"border-t\"\r\n      startAction={\r\n        <DialogTrigger\r\n          type=\"modal\"\r\n          onClose={folder => {\r\n            if (folder) {\r\n              setSelectedFolder(folder);\r\n            }\r\n          }}\r\n        >\r\n          <Button startIcon={<CreateNewFolderIcon />} variant=\"text\">\r\n            <Trans message=\"New Folder\" />\r\n          </Button>\r\n          <NewFolderDialog parentId={selectedFolder.id} />\r\n        </DialogTrigger>\r\n      }\r\n    >\r\n      <Button className=\"max-md:hidden\" variant=\"flat\" onClick={() => close()}>\r\n        <Trans message=\"Cancel\" />\r\n      </Button>\r\n      <Button\r\n        type=\"submit\"\r\n        variant=\"flat\"\r\n        color=\"primary\"\r\n        disabled={\r\n          !canMoveEntriesInto(entries, selectedFolder) || moveEntries.isPending\r\n        }\r\n        onClick={() => {\r\n          moveEntries.mutate(\r\n            {\r\n              destinationId: selectedFolder.id,\r\n              entryIds: entries.map(e => e.id),\r\n            },\r\n            {onSuccess: close},\r\n          );\r\n        }}\r\n      >\r\n        <Trans message=\"Move here\" />\r\n      </Button>\r\n    </DialogFooter>\r\n  );\r\n}\r\n","import {DriveEntry} from '../drive-entry';\r\nimport {ConfirmationDialog} from '@common/ui/overlays/dialog/confirmation-dialog';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {useDeleteEntries} from '../queries/use-delete-entries';\r\nimport {driveState} from '../../drive-store';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\n\r\ninterface DeleteEntriesForeverDialogProps {\r\n  entries: DriveEntry[];\r\n}\r\nexport function DeleteEntriesForeverDialog({\r\n  entries,\r\n}: DeleteEntriesForeverDialogProps) {\r\n  const deleteEntries = useDeleteEntries();\r\n  const {close} = useDialogContext();\r\n\r\n  const message =\r\n    entries.length === 1 ? (\r\n      <Trans\r\n        message=\":name will be deleted forever and you won't be able to restore it.\"\r\n        values={{name: entries[0].name}}\r\n      />\r\n    ) : (\r\n      <Trans\r\n        message=\":count items will be deleted forever and you won't be able to restore them.\"\r\n        values={{count: entries.length}}\r\n      />\r\n    );\r\n\r\n  return (\r\n    <ConfirmationDialog\r\n      isDanger\r\n      title={<Trans message=\"Delete forever?\" />}\r\n      body={message}\r\n      confirm={<Trans message=\"Delete forever\" />}\r\n      isLoading={deleteEntries.isPending}\r\n      onConfirm={() => {\r\n        deleteEntries.mutate(\r\n          {\r\n            entryIds: entries.map(e => e.id),\r\n            deleteForever: true,\r\n          },\r\n          {\r\n            onSuccess: () => {\r\n              close();\r\n              driveState().selectEntries([]);\r\n            },\r\n          },\r\n        );\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import {DriveEntry} from '../drive-entry';\r\nimport {ConfirmationDialog} from '@common/ui/overlays/dialog/confirmation-dialog';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {driveState} from '../../drive-store';\r\nimport {useRestoreEntries} from '../queries/use-restore-entries';\r\nimport {useDialogContext} from '@common/ui/overlays/dialog/dialog-context';\r\n\r\ninterface DeleteEntriesForeverDialogProps {\r\n  entries: DriveEntry[];\r\n}\r\nexport function BlockTrashFolderViewDialog({\r\n  entries,\r\n}: DeleteEntriesForeverDialogProps) {\r\n  const restoreEntries = useRestoreEntries();\r\n  const {close} = useDialogContext();\r\n\r\n  return (\r\n    <ConfirmationDialog\r\n      title={<Trans message=\"This folder is in your trash\" />}\r\n      body={<Trans message=\"To view this folder, restore it from the trash.\" />}\r\n      confirm={<Trans message=\"Restore\" />}\r\n      isLoading={restoreEntries.isPending}\r\n      onConfirm={() => {\r\n        restoreEntries.mutate(\r\n          {\r\n            entryIds: entries.map(e => e.id),\r\n          },\r\n          {\r\n            onSuccess: () => {\r\n              close();\r\n              driveState().selectEntries([]);\r\n            },\r\n          },\r\n        );\r\n      }}\r\n    />\r\n  );\r\n}\r\n","import React, {ReactElement} from 'react';\r\nimport {ActiveActionDialog, driveState, useDriveStore} from '../../drive-store';\r\nimport {RenameEntryDialog} from './rename-entry-dialog';\r\nimport {NewFolderDialog} from './new-folder-dialog';\r\nimport {EntryPreviewDialog} from './entry-preview-dialog';\r\nimport {ShareDialog} from '../../share-dialog/share-dialog';\r\nimport {MoveEntriesDialog} from './move-entries-dialog/move-entries-dialog';\r\nimport {DialogTrigger} from '@common/ui/overlays/dialog/dialog-trigger';\r\nimport {DeleteEntriesForeverDialog} from './delete-entries-forever-dialog';\r\nimport {BlockTrashFolderViewDialog} from './block-trash-folder-view-dialog';\r\n\r\nexport function DriveDialogsContainer() {\r\n  const activeDialog = useDriveStore(s => s.activeActionDialog);\r\n  const dialog = getDialog(activeDialog);\r\n\r\n  return (\r\n    <DialogTrigger\r\n      type=\"modal\"\r\n      isOpen={!!dialog}\r\n      onClose={() => {\r\n        driveState().setActiveActionDialog(null);\r\n      }}\r\n    >\r\n      {dialog}\r\n    </DialogTrigger>\r\n  );\r\n}\r\n\r\nfunction getDialog(dialog?: ActiveActionDialog | null): ReactElement | null {\r\n  switch (dialog?.name) {\r\n    case 'rename':\r\n      return <RenameEntryDialog entries={dialog.entries} />;\r\n    case 'newFolder':\r\n      return <NewFolderDialog parentId={dialog.entries[0]?.id} />;\r\n    case 'preview':\r\n      return <EntryPreviewDialog selectedEntry={dialog.entries[0]} />;\r\n    case 'share':\r\n      return <ShareDialog entry={dialog.entries[0]} />;\r\n    case 'getLink':\r\n      return <ShareDialog entry={dialog.entries[0]} focusLinkInput />;\r\n    case 'moveTo':\r\n      return <MoveEntriesDialog entries={dialog.entries} />;\r\n    case 'confirmAndDeleteForever':\r\n      return <DeleteEntriesForeverDialog entries={dialog.entries} />;\r\n    case 'trashFolderBlock':\r\n      return <BlockTrashFolderViewDialog entries={dialog.entries} />;\r\n    default:\r\n      return null;\r\n  }\r\n}\r\n","import {InteractableEvent} from '../interactable-event';\r\nimport {useEffect, useId, useRef} from 'react';\r\nimport {dragMonitors, DragSessionStatus} from './drag-state';\r\nimport {ConnectedDraggable} from './use-draggable';\r\n\r\nexport interface DragMonitor {\r\n  type: string;\r\n  onDragStart?: (e: InteractableEvent, dragTarget: ConnectedDraggable) => void;\r\n  onDragMove?: (e: InteractableEvent, dragTarget: ConnectedDraggable) => void;\r\n  onDragEnd?: (\r\n    e: InteractableEvent,\r\n    dragTarget: ConnectedDraggable,\r\n    status: DragSessionStatus\r\n  ) => void;\r\n}\r\n\r\nexport function useDragMonitor(monitor: DragMonitor) {\r\n  const monitorRef = useRef(monitor);\r\n  const id = useId();\r\n\r\n  useEffect(() => {\r\n    dragMonitors.set(id, monitorRef.current);\r\n    return () => {\r\n      dragMonitors.delete(id);\r\n    };\r\n  }, [id]);\r\n}\r\n","import {useDragMonitor} from '@common/ui/interactions/dnd/use-drag-monitor';\r\nimport React, {memo, useRef, useState} from 'react';\r\nimport {FileTypeIcon} from '@common/uploads/file-type-icon/file-type-icon';\r\nimport {FileEntry} from '@common/uploads/file-entry';\r\nimport {\r\n  DragSessionStatus,\r\n  droppables,\r\n} from '@common/ui/interactions/dnd/drag-state';\r\nimport {AnimatePresence, m} from 'framer-motion';\r\nimport clsx from 'clsx';\r\nimport {\r\n  isFolderTreeDragId,\r\n  makeFolderTreeDragId,\r\n} from '../layout/sidebar/folder-tree-drag-id';\r\nimport {InteractableEvent} from '@common/ui/interactions/interactable-event';\r\nimport {useDriveStore} from '../drive-store';\r\nimport {ConnectedDraggable} from '@common/ui/interactions/dnd/use-draggable';\r\n\r\ninterface Point {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\ninterface DragPreviewState {\r\n  entries?: FileEntry[];\r\n  e?: InteractableEvent;\r\n  status?: DragSessionStatus;\r\n  draggingTreeItem?: boolean;\r\n}\r\n\r\nexport function EntryDragPreview() {\r\n  const ref = useRef<HTMLDivElement>(null);\r\n  const [points, setPoints] = useState<{start?: Point; end?: Point}>();\r\n  const [state, setState] = useState<DragPreviewState>({});\r\n\r\n  useDragMonitor({\r\n    type: 'fileEntry',\r\n    onDragStart: (e, dragTarget) => {\r\n      const target = dragTarget as ConnectedDraggable<FileEntry[]>;\r\n      if (target) {\r\n        setState({\r\n          entries: target.getData(),\r\n          e,\r\n          draggingTreeItem: isFolderTreeDragId(target.id as number),\r\n        });\r\n        setPoints({start: e});\r\n      }\r\n    },\r\n    onDragMove: e => {\r\n      setState(prev => {\r\n        return {...prev, e: e};\r\n      });\r\n      setPoints(prev => {\r\n        return {...prev, end: e};\r\n      });\r\n    },\r\n    onDragEnd: (e, dragTarget, status) => {\r\n      setState({status});\r\n    },\r\n  });\r\n\r\n  let preview = null;\r\n\r\n  if (state.entries && state.e) {\r\n    preview = (\r\n      <div\r\n        ref={ref}\r\n        style={\r\n          state.e\r\n            ? {\r\n                transform: `translate(${state.e.x}px, ${state.e.y}px)`,\r\n                width: `${state.e.rect.width}px`,\r\n              }\r\n            : undefined\r\n        }\r\n        className=\"fixed isolate left-0 top-0 pointer-events-none\"\r\n      >\r\n        {state.entries.map((item, index) => (\r\n          <EntryPreview\r\n            key={item.id}\r\n            index={index}\r\n            entry={item}\r\n            points={points}\r\n            state={state}\r\n          />\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <AnimatePresence custom={state.status}>{preview}</AnimatePresence>;\r\n}\r\n\r\ninterface EntryPreviewProps {\r\n  entry: FileEntry;\r\n  index: number;\r\n  points?: {start?: Point; end?: Point};\r\n  state: DragPreviewState;\r\n}\r\n\r\nconst EntryPreview = memo(\r\n  ({entry, points, index, state}: EntryPreviewProps) => {\r\n    const viewMode = useDriveStore(s => s.viewMode);\r\n    const droppableId = state.draggingTreeItem\r\n      ? makeFolderTreeDragId(entry)\r\n      : entry.id;\r\n    const target = droppables.get(droppableId);\r\n    if (!target?.rect || !points?.start) return null;\r\n    const rect = target.rect;\r\n    const itemCount = state.entries?.length || 0;\r\n\r\n    const exitVariant = (status: DragSessionStatus) => {\r\n      if (status === 'dropSuccess') {\r\n        return {\r\n          x: 0,\r\n          y: 0,\r\n          opacity: 0,\r\n          transition: {duration: 0.1, delay: 0},\r\n        };\r\n      }\r\n      return {\r\n        x: rect.left - (points.end?.x || 0),\r\n        y: rect.top - (points.end?.y || 0),\r\n        width: `${state.e?.rect.width}px`,\r\n      };\r\n    };\r\n\r\n    return (\r\n      <m.div\r\n        key={entry.id}\r\n        transition={{delay: 0.01 * index, bounce: 0, duration: 0.2}}\r\n        initial={{\r\n          x: rect.left - points.start.x,\r\n          y: rect.top - points.start.y,\r\n          width: `${state.e?.rect.width}px`,\r\n        }}\r\n        animate={{\r\n          x: 0,\r\n          y: 0,\r\n          // in list/table mode limit preview size to 288px, but start and end the animation\r\n          // at full width, so it returns to original position at original size smoothly\r\n          width: viewMode === 'list' ? 288 : undefined,\r\n        }}\r\n        exit={exitVariant as any}\r\n        style={{\r\n          // in grid mode simply use the width of the draggable item\r\n          width: viewMode === 'grid' ? `${state.e?.rect.width}px` : undefined,\r\n          height: `${state.e?.rect.height}px`,\r\n        }}\r\n        className={clsx(\r\n          'absolute bg-paper whitespace-nowrap rounded border border-primary-light max-h-48',\r\n          index < 2 && 'shadow',\r\n          index === 0 && 'z-10 top-0 left-0',\r\n          index > 0 && 'top-6 left-6'\r\n        )}\r\n      >\r\n        {itemCount > 1 && index === 0 && <EntryCount count={itemCount} />}\r\n        <div className=\"text-sm h-full flex justify-center items-center px-16 gap-10 bg-primary-light/20 overflow-hidden\">\r\n          <FileTypeIcon type={entry.type} />\r\n          <div className=\"flex-auto text-ellipsis overflow-hidden\">\r\n            {entry.name}\r\n          </div>\r\n        </div>\r\n      </m.div>\r\n    );\r\n  }\r\n);\r\n\r\ninterface EntryCountProps {\r\n  count: number;\r\n}\r\nconst EntryCount = memo(({count}: EntryCountProps) => {\r\n  return (\r\n    <m.div\r\n      key=\"entryCount\"\r\n      initial={{opacity: 0}}\r\n      animate={{opacity: 1, transition: {delay: 0.1}}}\r\n      exit={{opacity: 0}}\r\n      transition={{duration: 0.1}}\r\n      className=\"absolute -top-6 shadow-lg -right-6 z-30 rounded-full bg-danger text-white w-20 h-20 flex items-center justify-center text-sm font-bold z-10\"\r\n    >\r\n      {count}\r\n    </m.div>\r\n  );\r\n});\r\n","import { PageBreadcrumbs } from '../page-breadcrumbs';\r\nimport { DashboardContentHeader } from '@common/ui/layout/dashboard-content-header';\r\nimport React, { useContext } from 'react';\r\nimport { driveState, useDriveStore } from '../drive-store';\r\nimport { Trans } from '@common/i18n/trans';\r\nimport { Tooltip } from '@common/ui/tooltip/tooltip';\r\nimport { IconButton } from '@common/ui/buttons/icon-button';\r\nimport { ViewListIcon } from '@common/icons/material/ViewList';\r\nimport { ViewModuleIcon } from '@common/icons/material/ViewModule';\r\nimport { DashboardLayoutContext } from '@common/ui/layout/dashboard-layout-context';\r\nimport { InfoIcon } from '@common/icons/material/Info';\r\nimport { DriveSortButton } from './sorting/drive-sort-button';\r\nimport clsx from 'clsx';\r\n\r\nexport function DriveContentHeader() {\r\n  const { isMobileMode } = useContext(DashboardLayoutContext);\r\n  const activePage = useDriveStore((s) => s.activePage);\r\n\r\n  return (\r\n    <DashboardContentHeader className=\"px-8 md:px-26 py-4 mt-20 flex items-center gap-20 h-60\">\r\n      {isMobileMode ? (\r\n        <DriveSortButton isDisabled={activePage?.disableSort} />\r\n      ) : (\r\n        <PageBreadcrumbs />\r\n      )}\r\n      <div className=\"ml-auto flex items-center gap-2\"> \r\n        <ToggleViewModeButton />\r\n        <ToggleDetailsButton />\r\n      </div>\r\n    </DashboardContentHeader>\r\n  );\r\n}\r\n\r\nfunction ToggleViewModeButton() {\r\n  const viewMode = useDriveStore((s) => s.viewMode);\r\n\r\n  return (\r\n    <div className=\"flex gap-2\">\r\n      <Tooltip label={<Trans message=\"Grid view\" />}>\r\n        <IconButton\r\n          size=\"md\"\r\n          onClick={() => {\r\n            driveState().setViewMode('grid');\r\n          }}\r\n          className={clsx(\r\n            viewMode === 'grid' ? 'text-gray-200 dark:text-gray-200' : 'text-black dark:text-white'\r\n          )}\r\n        >\r\n          <ViewModuleIcon />\r\n        </IconButton>\r\n      </Tooltip>\r\n\r\n      <Tooltip label={<Trans message=\"List view\" />}>\r\n        <IconButton\r\n          size=\"md\"\r\n          onClick={() => {\r\n            driveState().setViewMode('list');\r\n          }}\r\n          className={clsx(\r\n            viewMode === 'list' ? 'text-gray-200 dark:text-gray-200' : 'text-black dark:text-white'\r\n          )}\r\n        >\r\n          <ViewListIcon />\r\n        </IconButton>\r\n      </Tooltip>\r\n    </div>\r\n\r\n  );\r\n}\r\n\r\nfunction ToggleDetailsButton() {\r\n  const { rightSidenavStatus: status, setRightSidenavStatus } = useContext(\r\n    DashboardLayoutContext\r\n  );\r\n  const tooltip = status ? (\r\n    <Trans message=\"Hide details\" />\r\n  ) : (\r\n    <Trans message=\"Show details\" />\r\n  );\r\n\r\n  return (\r\n    <Tooltip label={tooltip}>\r\n      <IconButton\r\n        size=\"md\"\r\n        color={status === 'open' ? 'primary' : null}\r\n        onClick={() => {\r\n          setRightSidenavStatus(status === 'open' ? 'closed' : 'open');\r\n        }}\r\n      >\r\n        <InfoIcon />\r\n      </IconButton>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import React, {Fragment, useContext, useEffect, useMemo} from 'react';\r\nimport {Link, useLocation, useParams} from 'react-router-dom';\r\nimport {Sidebar} from './sidebar/sidebar';\r\nimport {FileView} from '../file-view/file-view';\r\nimport {UploadQueue} from '../uploading/upload-queue';\r\nimport {driveState, useDriveStore} from '../drive-store';\r\nimport {\r\n  DRIVE_PAGES,\r\n  makePartialFolderPage,\r\n  SearchPage,\r\n} from '../drive-page/drive-page';\r\nimport {DetailsSidebar} from '../details-sidebar/details-sidebar';\r\nimport {DriveDialogsContainer} from '../files/dialogs/drive-dialogs-container';\r\nimport {NavbarSearch} from '../search/navbar-search';\r\nimport {useActiveWorkspaceId} from '@common/workspace/active-workspace-id-context';\r\nimport {FileEntryUrlsContext} from '@common/uploads/hooks/file-entry-urls';\r\nimport {FileUploadProvider} from '@common/uploads/uploader/file-upload-provider';\r\nimport {EntryDragPreview} from '../file-view/entry-drag-preview';\r\nimport {DashboardLayout} from '@common/ui/layout/dashboard-layout';\r\nimport {DashboardContent} from '@common/ui/layout/dashboard-content';\r\nimport {DashboardNavbar} from '@common/ui/layout/dashboard-navbar';\r\nimport {DriveContentHeader} from './drive-content-header';\r\nimport {IconButton} from '@common/ui/buttons/icon-button';\r\nimport {SearchIcon} from '@common/icons/material/Search';\r\nimport {DashboardLayoutContext} from '@common/ui/layout/dashboard-layout-context';\r\nimport {CloseIcon} from '@common/icons/material/Close';\r\nimport {Trans} from '@common/i18n/trans';\r\nimport {EntryActionList} from '../entry-actions/entry-action-list';\r\nimport {CreateNewButton} from './create-new-button';\r\nimport {StaticPageTitle} from '@common/seo/static-page-title';\r\nimport {DashboardSidenav} from '@common/ui/layout/dashboard-sidenav';\r\n\r\nexport function DriveLayout() {\r\n  const {pathname} = useLocation();\r\n  const {hash} = useParams();\r\n  const {workspaceId} = useActiveWorkspaceId();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n\r\n  useEffect(() => {\r\n    driveState().setActivePage(\r\n      DRIVE_PAGES.find(p => p.path === pathname) ||\r\n        makePartialFolderPage(hash!),\r\n    );\r\n  }, [pathname, hash]);\r\n\r\n  const urlsContextValue = useMemo(() => {\r\n    return {workspaceId};\r\n  }, [workspaceId]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      driveState().reset();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <Fragment>\r\n      {activePage?.label && (\r\n        <StaticPageTitle>\r\n          <Trans\r\n            message={\r\n              typeof activePage.label === 'string'\r\n                ? activePage.label\r\n                : activePage.label.message\r\n            }\r\n          />\r\n        </StaticPageTitle>\r\n      )}\r\n      <FileUploadProvider>\r\n        <FileEntryUrlsContext.Provider value={urlsContextValue}>\r\n          <DashboardLayout\r\n            name=\"drive\"\r\n            onDragOver={e => {\r\n              e.preventDefault();\r\n              e.stopPropagation();\r\n              e.dataTransfer.dropEffect = 'none';\r\n            }}\r\n            onDrop={e => {\r\n              e.preventDefault();\r\n            }}>\r\n            <Navbar/>\r\n            <DashboardSidenav position=\"left\" size=\"md\">\r\n              <Sidebar/>\r\n            </DashboardSidenav>\r\n            <DriveContentHeader />\r\n            <DashboardContent>\r\n              <FileView/>\r\n            </DashboardContent>\r\n            <UploadQueue />\r\n            <DriveDialogsContainer />\r\n            <DashboardSidenav position=\"right\" size=\"lg\">\r\n              <DetailsSidebar />\r\n            </DashboardSidenav>\r\n          </DashboardLayout>\r\n        </FileEntryUrlsContext.Provider>\r\n        <EntryDragPreview />\r\n      </FileUploadProvider>\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nfunction Navbar() {\r\n  const {isMobileMode} = useContext(DashboardLayoutContext);\r\n  const activePage = useDriveStore(s => s.activePage);\r\n\r\n  const children = isMobileMode ? null : <NavbarSearch />;\r\n  const searchButton = (\r\n    <IconButton elementType={Link} to={SearchPage.path}>\r\n      <SearchIcon />\r\n    </IconButton>\r\n  );\r\n\r\n  const mobileRightChildren = (\r\n    <Fragment>\r\n      {activePage !== SearchPage && searchButton}\r\n      <CreateNewButton isCompact />\r\n    </Fragment>\r\n  );\r\n\r\n  return (\r\n    <Fragment>\r\n      <DashboardNavbar\r\n        rightChildren={isMobileMode && mobileRightChildren}\r\n        menuPosition=\"drive-navbar\"\r\n      >\r\n        {children}\r\n      </DashboardNavbar>\r\n      {isMobileMode && <FloatingActionList />}\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nfunction FloatingActionList() {\r\n  const entriesSelected = useDriveStore(s => s.selectedEntries.size);\r\n  if (!entriesSelected) return null;\r\n  return (\r\n    <div className=\"fixed right-0 top-0 z-10 flex h-54 w-full items-center justify-center gap-10 rounded bg-primary px-6 text-on-primary shadow-xl\">\r\n      <IconButton\r\n        onClick={() => {\r\n          driveState().selectEntries([]);\r\n        }}\r\n      >\r\n        <CloseIcon />\r\n      </IconButton>\r\n      <Trans message=\":count selected\" values={{count: entriesSelected}} />\r\n      <EntryActionList className=\"ml-auto\" />\r\n    </div>\r\n  );\r\n}\r\n","import { PageBreadcrumbs } from '../page-breadcrumbs';\r\nimport { DashboardContentHeader } from '@common/ui/layout/dashboard-content-header';\r\nimport React, { useContext } from 'react';\r\nimport { driveState, useDriveStore } from '../drive-store';\r\nimport { Trans } from '@common/i18n/trans';\r\nimport { Tooltip } from '@common/ui/tooltip/tooltip';\r\nimport { IconButton } from '@common/ui/buttons/icon-button';\r\nimport { ViewListIcon } from '@common/icons/material/ViewList';\r\nimport { ViewModuleIcon } from '@common/icons/material/ViewModule';\r\nimport { DashboardLayoutContext } from '@common/ui/layout/dashboard-layout-context';\r\nimport { InfoIcon } from '@common/icons/material/Info';\r\nimport { DriveSortButton } from './sorting/drive-sort-button';\r\nimport clsx from 'clsx';\r\n\r\nexport function WorkspaceContentHeader() {\r\n  const { isMobileMode } = useContext(DashboardLayoutContext);\r\n  const activePage = useDriveStore((s) => s.activePage);\r\n\r\n  return (\r\n    <DashboardContentHeader className=\"px-8 md:px-26 py-4 mt-20 flex items-center gap-20 h-60\">\r\n        <li className='relative inline-flex min-w-0 flex-shrink-0 items-center justify-start text-lg'>\r\n            <div className='ml-16 cursor-pointer overflow-hidden whitespace-nowrap rounded px-8 py-4 font-semibold text-bg-600 hover:bg-hover'>Workspace</div>\r\n        </li>\r\n      {/* {isMobileMode ? (\r\n        <DriveSortButton isDisabled={activePage?.disableSort} />\r\n      ) : (\r\n        <PageBreadcrumbs />\r\n      )} */}\r\n      <div className=\"ml-auto flex items-center gap-2\"> \r\n        {/* <ToggleViewModeButton /> */}\r\n      </div>\r\n    </DashboardContentHeader>\r\n  );\r\n}\r\n\r\nfunction ToggleViewModeButton() {\r\n  const viewMode = useDriveStore((s) => s.viewMode);\r\n\r\n  return (\r\n    <div className=\"flex gap-2\">\r\n      <Tooltip label={<Trans message=\"Grid view\" />}>\r\n        <IconButton\r\n          size=\"md\"\r\n          onClick={() => {\r\n            driveState().setViewMode('grid');\r\n          }}\r\n          className={clsx(\r\n            viewMode === 'grid' ? 'text-gray-200 dark:text-white' : 'text-gray-400'\r\n          )}\r\n        >\r\n          <ViewModuleIcon />\r\n        </IconButton>\r\n      </Tooltip>\r\n\r\n      <Tooltip label={<Trans message=\"List view\" />}>\r\n        <IconButton\r\n          size=\"md\"\r\n          onClick={() => {\r\n            driveState().setViewMode('list');\r\n          }}\r\n          className={clsx(\r\n            viewMode === 'list' ? 'text-gray-200 dark:text-white' : 'text-gray-400'\r\n          )}\r\n        >\r\n          <ViewListIcon />\r\n        </IconButton>\r\n      </Tooltip>\r\n    </div>\r\n\r\n  );\r\n}\r\n\r\nfunction ToggleDetailsButton() {\r\n  const { rightSidenavStatus: status, setRightSidenavStatus } = useContext(\r\n    DashboardLayoutContext\r\n  );\r\n  const tooltip = status ? (\r\n    <Trans message=\"Hide details\" />\r\n  ) : (\r\n    <Trans message=\"Show details\" />\r\n  );\r\n\r\n  return (\r\n    <Tooltip label={tooltip}>\r\n      <IconButton\r\n        size=\"md\"\r\n        color={status === 'open' ? 'primary' : null}\r\n        onClick={() => {\r\n          setRightSidenavStatus(status === 'open' ? 'closed' : 'open');\r\n        }}\r\n      >\r\n        <InfoIcon />\r\n      </IconButton>\r\n    </Tooltip>\r\n  );\r\n}\r\n","import React, { Fragment, useEffect, useMemo, useContext } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { useDriveStore, driveState } from '../drive-store';\r\nimport { useActiveWorkspaceId } from '@common/workspace/active-workspace-id-context';\r\nimport { FileUploadProvider } from '@common/uploads/uploader/file-upload-provider';\r\nimport { StaticPageTitle } from '@common/seo/static-page-title';\r\nimport { DashboardLayout } from '@common/ui/layout/dashboard-layout';\r\nimport { DashboardNavbar } from '@common/ui/layout/dashboard-navbar';\r\nimport { DashboardSidenav } from '@common/ui/layout/dashboard-sidenav';\r\nimport { Trans } from '@common/i18n/trans';\r\nimport { NavbarSearch } from '../search/navbar-search';\r\nimport { CreateNewButton } from './create-new-button';\r\nimport { WorkspaceSelector } from '@common/workspace/workspace-selector';\r\nimport { Sidebar } from './sidebar/sidebar';\r\nimport { DashboardLayoutContext } from '@common/ui/layout/dashboard-layout-context'; \r\nimport { WorkspaceContentHeader } from './workspace-content-header';\r\n\r\n\r\nexport function WorkspaceLayout() {\r\n  const { pathname } = useLocation();\r\n  const { workspaceId } = useActiveWorkspaceId();\r\n  const activePage = useDriveStore(s => s.activePage);\r\n\r\n  const urlsContextValue = useMemo(() => {\r\n    return { workspaceId };\r\n  }, [workspaceId]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      driveState().reset();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <Fragment>\r\n      {activePage?.label && (\r\n        <StaticPageTitle>\r\n          <Trans\r\n            message={\r\n              typeof activePage.label === 'string'\r\n                ? activePage.label\r\n                : activePage.label.message\r\n            }\r\n          />\r\n        </StaticPageTitle>\r\n      )}\r\n      <FileUploadProvider>\r\n        <DashboardLayout\r\n          name=\"workspace\"\r\n          onDragOver={e => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            e.dataTransfer.dropEffect = 'none';\r\n          }}\r\n          onDrop={e => {\r\n            e.preventDefault();\r\n          }}>\r\n          <Navbar />\r\n          <DashboardSidenav position=\"left\" size=\"md\">\r\n            <Sidebar />\r\n          </DashboardSidenav>\r\n          <WorkspaceContentHeader/>\r\n          <WorkspaceSelector />\r\n        </DashboardLayout>\r\n      </FileUploadProvider>\r\n    </Fragment>\r\n  );\r\n}\r\n\r\nfunction Navbar() {\r\n  const { isMobileMode } = useContext(DashboardLayoutContext);\r\n  const activePage = useDriveStore(s => s.activePage);\r\n\r\n  const children = isMobileMode ? null : <NavbarSearch />;\r\n  const mobileRightChildren = (\r\n    <Fragment>\r\n      <CreateNewButton isCompact />\r\n    </Fragment>\r\n  );\r\n\r\n  return (\r\n    <Fragment>\r\n      <DashboardNavbar\r\n        rightChildren={isMobileMode && mobileRightChildren}\r\n        menuPosition=\"workspace-navbar\">\r\n        {children}\r\n      </DashboardNavbar>\r\n    </Fragment>\r\n  );\r\n}\r\n","import {RouteObject, useRoutes} from 'react-router-dom';\r\nimport {ShareableLinkPage} from './shareable-link/shareable-link-page/shareable-link-page';\r\nimport {DriveLayout} from './layout/drive-layout';\r\nimport {AuthRoute} from '@common/auth/guards/auth-route';\r\nimport {NotFoundPage} from '@common/ui/not-found-page/not-found-page';\r\nimport {WorkspaceLayout} from './layout/workspace-layout';\r\nimport { SupportticketLayout } from './layout/supportticketlayout';\r\nimport { IntegrationLayout } from './layout/Integrationlayout';\r\n\r\nconst DriveRouteConfig: RouteObject[] = [\r\n  {\r\n    path: '/',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/folders/:hash',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/shares',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/recent',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/starred',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/trash',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/search',\r\n    element: (\r\n      <AuthRoute>\r\n        <DriveLayout />\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  {\r\n    path: '/workspace',\r\n    element: (\r\n      <AuthRoute>\r\n        <WorkspaceLayout/>\r\n      </AuthRoute>\r\n    ),\r\n  },\r\n  // {\r\n  //   path: '/supportticket',\r\n  //   element: (\r\n  //     <AuthRoute>\r\n  //       <SupportticketLayout/>\r\n  //     </AuthRoute>\r\n  //   ),\r\n  // },\r\n  // {\r\n  //   path: '/integration',\r\n  //   element: (\r\n  //     <AuthRoute>\r\n  //       <IntegrationLayout/>\r\n  //     </AuthRoute>\r\n  //   ),\r\n  // },\r\n  {path: 's/:hash', element: <ShareableLinkPage />},\r\n  {path: '*', element: <NotFoundPage />},\r\n];\r\n\r\nexport default function DriveRoutes() {\r\n  return useRoutes(DriveRouteConfig);\r\n}\r\n"],"names":["InfiniteQueryObserver","QueryObserver","client","options","notifyOptions","infiniteQueryBehavior","query","state","result","isFetching","isRefetching","isFetchingNextPage","_b","_a","isFetchingPreviousPage","_d","_c","hasNextPage","hasPreviousPage","useInfiniteQuery","queryClient","useBaseQuery","useLinkPageStore","create","immer","set","getFromLocalStorage","value","mode","setInLocalStorage","linkPageState","useShareableLinkPage","hash","useParams","orderBy","orderDir","s","order","isPasswordProtected","password","DriveQueryKeys","pageParam","response","fetchLinkByHash","data","getBootstrapData","lastResponse","currentPage","lastPage","keepPreviousData","p","page","apiClient","checkLinkPassword","linkHash","r","useCheckLinkPassword","useMutation","props","err","showHttpErrorToast","message","importIntoOwnDrive","linkId","useImportIntoOwnDrive","toast","ShareableLinkPageActionButtons","link","user","isLoggedIn","useAuth","downloadUrl","useFileEntryUrls","alreadyImported","u","jsx","DownloadButton","jsxs","MenuTrigger","key","downloadFileFromUrl","IconButton","KeyboardArrowDownIcon","Menu","MenuItem","FileDownloadIcon","Trans","ImportExportIcon","Fragment","Tooltip","Button","ShareableLinkNavbar","isMobile","useIsMobileMediaQuery","Navbar","FileTypeIcon","PasswordPage","trans","useTrans","fieldLabel","setPassword","useState","checkPassword","passwordIsInvalid","SvgImage","secureFilesSvg","e","TextField","BaseFileGridItem","React","entry","className","isSelected","isMobileMode","footerAdornment","domProps","ref","clsx","FileThumbnail","Footer","adornment","FolderPreviewFileGrid","entries","onEntrySelected","index","createShareableLink","entryId","useCreateShareableLink","addStarToEntries","entryIds","useAddStarToEntries","payload","invalidateEntryQueries","removeStarFromEntries","useRemoveStarFromEntries","duplicateEntries","useDuplicateEntries","deleteEntries","useDeleteEntries","getLoaderMessage","emptyTrash","deleteForever","backendError","getAxiosErrorMessage","useUnshareEntries","unshareEntries","useRestoreEntries","restoreEntries","useEntryActions","preview","usePreviewAction","share","useShareAction","getLink","useGetLinkAction","addStar","useAddToStarredAction","removeStar","useRemoveFromStarred","moveTo","useMoveToAction","rename","useRenameAction","makeCopy","useMakeCopyAction","download","useDownloadEntriesAction","deleteAction","useDeleteEntriesAction","removeSharedEntries","useRemoveSharedEntriesAction","useRestoreEntriesAction","action","RemoveRedEyeIcon","driveState","activePage","useDriveStore","TrashPage","PersonAddIcon","createLink","LinkIcon","starEntries","tag","StarIcon","StarOutlineIcon","SharesPage","DriveFileMoveIcon","DriveFileRenameOutlineIcon","ContentCopyIcon","DeleteIcon","RestoreIcon","useDrivePageActions","newFolder","useNewFolderAction","uploadFiles","useUploadFilesAction","uploadFolder","useUploadFolderAction","useEmptyTrashAction","CreateNewFolderIcon","useDriveUploadQueue","FileUploadIcon","openUploadWindow","DriveFolderUploadIcon","DeleteForeverIcon","EntryActionMenuTrigger","children","RootFolderPage","PageMenu","EntriesMenu","actions","BaseMenu","createElement","formatFileSize","memoize","bytes","prettyBytes","fileTableColumns","FileNameColumn","FormattedDate","ActionsColumn","isCollapsedMode","useContext","TableContext","sizeClassName","selectedRows","Checkbox","MoreVertIcon","mobileColumns","config","FolderPreviewFileTable","sortDescriptor","Table","item","buildFolderHash","folderHash","useNavigateToSubfolder","navigate","useNavigate","FolderPreviewFileView","pathname","useLocation","navigateToSubfolder","activePreviewIndex","setActivePreviewIndex","viewMode","sentinelRef","useRef","fetchNextPage","isPlaceholderData","useEffect","sentinelEl","observer","ProgressCircle","handlePreview","folderEntries","AdHost","AnimatePresence","m","opacityAnimation","DialogTrigger","FilePreviewDialog","DashboardContentHeader","useFolderPath","params","isEnabled","useQuery","fetchFolderPath","FolderPreviewBreadcrumb","folder","content","items","parent","Breadcrumb","BreadcrumbItem","AVAILABLE_SORTS","EntriesSortButton","descriptor","onChange","isDisabled","column","direction","sort","SortIcon","MenuSection","FolderPreviewHeader","activeSort","hasEntry","GridViewIcon","FolderPreview","isFetched","showEmptyMessage","DashboardLayout","DashboardNavbar","FileUploadProvider","DashboardContent","EmptyMessage","IllustratedMessage","shareSvg","ShareableLinkPageFilePreview","FilePreviewContainer","ShareableLinkPage","status","NotFoundPage","FileEntryUrlsContext","useCreateWorkspace","form","createWorkspace","WorkspaceQueryKeys","onFormQueryError","NewWorkspaceDialog","useForm","formId","close","useDialogContext","Dialog","DialogHeader","DialogBody","Form","FormTextField","DialogFooter","fetchWorkspaceWithMembers","workspaceId","useWorkspaceWithMembers","InviteMembers","other","useInviteMembers","ResendInvite","inviteId","useResendInvite","matcher","isEmail","string","ChangeRole","member","modelType","memberId","useChangeRole","removeMember","memberType","endpoint","useRemoveMember","setWorkspaceId","useActiveWorkspaceId","PersonalWorkspace","LeaveWorkspaceConfirmation","onConfirm","isLoading","ConfirmationDialog","WorkspaceMembersDialog","workspace","Manager","can","usePermissions","members","InviteChipField","GroupIcon","MemberListItem","MemberDisplayNameAppend","MemberActions","authUser","permissions","authMember","mb","permission","selectedRole","setSelectedRole","changeRole","isOwner","isCurrentUser","roleSelector","RoleMenuTrigger","roleId","RemoveMemberButton","chips","setChips","allEmailsValid","chip","displayWith","inviteMembers","useValueLists","ChipField","invalid","c","type","isConfirmed","ExitToAppIcon","CloseIcon","RemoveMemberConfirmation","size","role","newValue","ArrowDropDownIcon","ResendInviteDialogTrigger","resendInvite","updateWorkspace","id","useUpdateWorkspace","RenameWorkspaceDialog","deleteWorkspace","useDeleteWorkspace","WorkspaceSelector","workspaces","useUserWorkspaces","activeWorkspace","w","hasPermission","WorkspaceAddNewButton","WorkspaceItem","openDialog","setSelectorIsOpen","isActive","creationDate","formattedTime","formattedDate","ManageButton","LeaveWorkspaceDialog","DeleteWorkspaceConfirmation","EditIcon","MenuPositions","__assign","this","t","n","o","defaultConfig","exports","arrayToTree","a","h","i","d","getNestedProperty","l","countNodes","fetchUserFolders","useFolders","useMoveEntries","moveEntries","canMoveEntriesInto","targets","destination","target","destinationIsInTarget","destinationPath","part","useFolderDropAction","folderAcceptsDrop","makeFolderTreeDragId","isFolderTreeDragId","useSidebarTreeDropTarget","isDragOver","setIsDragOver","onDrop","useDroppable","draggable","TreeContext","createContext","renderTree","nodes","itemRenderer","parentNode","level","node","cloneElement","TreeLabel","forwardRef","icon","label","expandedKeys","setExpandedKeys","selectedKeys","setSelectedKeys","isExpanded","handleExpandIconClick","newExpandedKeys","_","ArrowRightIcon","TreeItem","labelRef","labelClassName","focusManager","useFocusManager","focusedNode","setFocusedNode","hasChildren","isFirstNode","isFocused","onKeyDown","newKeys","parentEl","childNode","createEventHandler","Tree","useControlledState","FocusScope","TreeRoot","FolderTree","tree","useMemo","folders","keys","entryHash","findHash","getPathForFolder","FolderTreeItem","isRootFolder","isDragging","draggableProps","useDraggable","droppableProps","mergeProps","BackupIcon","FolderIcon","SidebarMenu","CustomMenu","TrashMenuItem","CustomMenuItem","Sidebar","logocolor","isSubscribed","billing","useSettings","isDarkMode","useIsDarkMode","color","isSidebarOpen","setIsSidebarOpen","toggleSidebar","MenuIcon","Logo","StorageMeter","Link","fetchEntries","setActiveFolder","shallowEqual","makeFolderPage","usePaginatedEntries","searchParams","useSearchParams","isDisabledInSearch","SearchPage","getAllEntries","all","cache","current","driveSearchFilters","FILE_ENTRY_TYPE_FILTER","FilterOperator","FilterControlType","createdAtFilter","updatedAtFilter","alwaysShownFilters","f","SearchFilterList","DashboardLayoutContext","inputValue","setInputValue","SearchIcon","FilterList","restrictResizableWithinBoundary","rect","boundaryRect","boundedRect","leftRestriction","topRestriction","mouseSelectables","useMouseSelectable","optionsRef","useLayoutEffect","droppables","rectsIntersect","rectA","rectB","useMouseSelectionBox","onPointerDown","defaultRef","containerRef","boxRef","drawSelectionBox","startPoint","endPoint","initialScrollTop","currentScrollTop","newRect","scrollDiff","scrollValue","absoluteRect","selectable","intersect","_e","_f","_g","usePointerEvents","activeInteraction","updateRects","el","reachedBottomEdge","reachedTopEdge","useEntries","useSelectedEntries","ids","useSelectedEntry","useSelectedEntryParent","getSelectedEntries","allEntries","EntryActionList","selectedEntries","ActionList","removeShared","DriveContextMenu","PageContextMenu","EntriesContextMenu","position","BaseContextMenu","ContextMenu","isOpen","useIsTouchDevice","useMediaQuery","useFileViewDnd","isTouchDevice","itemClassName","FileTableRow","useViewItemActionHandler","useCallback","FileTable","performViewItemAction","FileGridItem","toggleEntry","pressHandler","isCtrlOrShiftPressed","pressProps","keyboardHandler","contextMenuHandler","FooterAdornment","FileGrid","DriveSortButton","PageBreadcrumbs","useActiveWorkspace","rootItem","useRootItem","isMenuItem","MixedText","ButtonBase","owner","InfiniteScrollSentinel","isInitialLoading","loaderMarginTop","style","_variant","loadMoreExtraContent","loadMoreClickCount","setLoadMoreClickCount","innerVariant","DropTargetMask","isVisible","mask","FileView","isSearchingOrFiltering","containerProps","boxProps","noContentMessage","handleContextMenu","handleKeybinds","isCtrlKeyPressed","Toolbar","CreateNewButton","UploadQueueItem","memo","file","SizeInfo","FileStatus","fileUpload","useFileUploadStore","bytesUploaded","totalBytes","uploadedBytes","statusMessage","abortUpload","percentage","errorMessage","isHovered","setIsHovered","abortButton","progressButton","statusButton","errMessage","AnimatedStatus","ErrorIcon","WarningIcon","CheckCircleIcon","UploadQueue","Header","UploadList","inProgressUploadsCount","completedUploadsCount","clearInactive","uploads","uploadsArray","virtualizer","useVirtualizer","virtualItem","upload","detailedExamination","DetailsSidebarHeader","entryType","entryName","setRightSidenavStatus","DetailsSidebarSectionHeader","margin","useSyncEntryTags","createComment","tags","useFileEntryTags","fetchTags","DetailsSidebarTags","TagChipField","syncTags","setValue","handleChange","newTags","Item","DetailsSidebarProperties","GroupsIcon","Avatar","PropertyList","prettySize","PropertyItem","DetailsSidebar","selectedEntry","NothingSelected","useRenameEntry","renameEntry","RenameEntryDialog","initialName","onSubmit","createFolder","name","parentId","useCreateFolder","NewFolderDialog","EntryPreviewDialog","files","defaultActiveIndex","activeIndex","setActiveIndex","allowDownload","DriveActions","shareEntry","useShareEntry","axios","DRIVE_ENTRY_FULL_PERMISSIONS","PermissionSelectorItems","PermissionSelector","getPermissionItemForUser","edit","useChangePermission","changePermission","UserAvatar","auth","SiteConfigContext","MemberList","users","ActionButtons","changePermissions","unshareEntry","activePermission","setActivePermission","SharePanel","isSharing","setIsSharing","selectedPermission","setSelectedPermission","useNormalizedModels","useEntryShareableLink","fetchLinkByEntryId","deleteShareableLink","useDeleteShareableLink","randomString","length","random","possible","ShareableLinkPanel","setActivePanel","focusInput","linkExists","deleteLink","Switch","ShareableLinkInput","autoFocus","base_url","useActiveDialogEntry","linkUrl","isCopied","setCopied","useClipboard","updateShareableLink","useUpdateShareableLink","LinkSettingsDialog","updateLink","LinkExpirationOption","LinkPasswordOption","LinkOption","FormSwitch","minDate","now","getLocalTimeZone","showFieldDefault","showField","setShowField","FormDatePicker","showBorder","title","ShareDialog","initialEntry","focusLinkInput","fileEntry","activePanel","MainDialog","ComboBox","isAsync","openMenuOnFocus","endAdornmentIcon","onItemSelected","maxItems","clearInputOnItemSelection","userInputValue","selectedValue","onSelectionChange","allowCustomValue","onInputValueChange","defaultInputValue","selectionMode","useOptionLabelAsInputValue","floatingMaxHeight","hideEndAdornment","blurReferenceOnItemSelection","propsIsOpen","propsOnOpenChange","prependListbox","listboxClassName","onEndAdornmentClick","autoFocusFirstItem","textFieldProps","listbox","useListbox","reference","listboxId","onInputChange","setIsOpen","selectValues","selectedValues","setActiveCollection","collection","textLabel","handleListboxSearchFieldKeydown","useListboxKeyboardNavigation","handleFocusAndClick","Listbox","Popover","ComboboxEndAdornment","val","ComboBoxForwardRef","MoveEntriesDialogSearch","allFolders","onFolderSelected","searchLabel","folderId","MoveEntriesDialogBreadcrumbs","selectedFolder","rootFolder","path","fullPath","previous","ArrowBackIcon","myFilesSvg","MoveEntriesDialogFolderList","subFolders","List","ListItem","ChevronRightIcon","MoveEntriesDialog","setSelectedFolder","DeleteEntriesForeverDialog","BlockTrashFolderViewDialog","DriveDialogsContainer","activeDialog","dialog","getDialog","useDragMonitor","monitor","monitorRef","useId","dragMonitors","EntryDragPreview","points","setPoints","setState","dragTarget","prev","EntryPreview","droppableId","itemCount","exitVariant","EntryCount","count","DriveContentHeader","ToggleViewModeButton","ToggleDetailsButton","ViewModuleIcon","ViewListIcon","tooltip","InfoIcon","DriveLayout","DRIVE_PAGES","makePartialFolderPage","urlsContextValue","StaticPageTitle","DashboardSidenav","NavbarSearch","searchButton","mobileRightChildren","FloatingActionList","entriesSelected","WorkspaceContentHeader","WorkspaceLayout","DriveRouteConfig","AuthRoute","DriveRoutes","useRoutes"],"mappings":"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","x_google_ignoreList":[0,1,49]}