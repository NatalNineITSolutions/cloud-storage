import{bj as In,bk as qt,bl as Pn,bm as En,bn as Dn,a6 as Nn,a7 as Fn,bo as Cn,bp as Mn,ap as rt,bq as O,aC as An,k as ns,e as E,J as F,M as A,m as f,K as T,L as N,a4 as V,j as t,aH as he,h as C,b9 as rs,aI as fe,I as R,T as d,r as x,a3 as J,B as D,f as as,br as Ln,a$ as Ee,y as K,U as De,bs as Rn,z as He,R as is,c as P,bt as $,bu as Tn,bv as p,bw as y,bx as M,by as Se,bz as os,bA as Ye,bB as _n,bC as ls,bD as zn,bE as _,aO as On,aP as We,a2 as Ve,w as cs,ag as $n,a8 as at,ae as xe,bF as it,A as Q,o as z,E as ot,x as Ne,d as pe,av as Ut,D as lt,a as ct,ad as dt,Q as Ge,bG as Bn,bi as ds,bH as U,X as Fe,v as Ce,p as H,q as le,s as ee,t as te,F as Me,Y as Ae,W as ge,bI as Y,bJ as Le,N as je,aj as us,bK as ms,_ as ve,bL as Wn,bM as we,b2 as Qt,n as Vn,bN as Ie,$ as Ht,l as Kn,aw as be,bO as ut,an as Ze,bP as qn,C as Un,u as mt,bQ as Qn,bR as Hn,bS as Yn,bT as Gn,a1 as xs,bU as xt,bV as Zn,bW as hs,bX as Pe,bY as G,S as ht,bZ as Xn,b_ as Jn,b$ as fs,aa as Be,af as er,c0 as ft,c1 as ie,c2 as tr,b7 as sr,c3 as nr,c4 as rr,aB as ar,c5 as ir,c6 as or,c7 as lr,c8 as cr,c9 as dr,ca as ur,cb as mr,cc as xr,ak as hr,al as fr,cd as pr,ce as gr,H as ps,b as st,cf as gs,bg as jr,bh as X}from"./main-1f8acdba.js";import{O as js,h as Ke,i as qe,P as pt,L as vr,s as gt,Q as jt,M as vt,T as vs,E as bs,D as ys,R as br,V as ws,w as bt,A as yt,o as Xe,n as ks,W as yr,F as ze,a as Oe,c as wr,u as kr,g as Sr,q as Ss,X as Is,p as Yt,Y as Ir,Z as Pr,_ as Er,x as Dr,j as wt,y as Nr,t as kt,l as Gt,k as Fr,$ as Cr,J as Mr,a0 as Zt}from"./ArrowBack-1cb088fd.js";import{I as Ar,R as Lr,P as Ps,S as Rr,a as Tr,D as _r,b as zr,C as Or,c as $r,d as Br,e as Wr,G as Vr,f as Kr,A as qr,B as Ur,F as St,g as Qr,V as Hr,h as Yr,i as Gr}from"./Info-ce056689.js";import{B as It,a as Ue,E as Zr,C as Xr}from"./Edit-d993be71.js";var Jr=class extends In{constructor(e,s){super(e,s)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e,s){super.setOptions({...e,behavior:qt()},s)}getOptimisticResult(e){return e.behavior=qt(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,s){var c,u,h,m;const{state:n}=e,r=super.createResult(e,s),{isFetching:a,isRefetching:i}=r,o=a&&((u=(c=n.fetchMeta)==null?void 0:c.fetchMore)==null?void 0:u.direction)==="forward",l=a&&((m=(h=n.fetchMeta)==null?void 0:h.fetchMore)==null?void 0:m.direction)==="backward";return{...r,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:Pn(s,n.data),hasPreviousPage:En(s,n.data),isFetchingNextPage:o,isFetchingPreviousPage:l,isRefetching:i&&!o&&!l}}};function Es(e,s){return Dn(e,Jr,s)}const W=Nn()(Fn(e=>({password:null,viewMode:Cn("drive.viewMode"),activeSort:{orderBy:"updated_at",orderDir:"desc"},setPassword:s=>{e(n=>{n.password=s})},isPasswordProtected:!1,setIsPasswordProtected:s=>{e(n=>{n.isPasswordProtected=s})},setViewMode:s=>{e(n=>{n.viewMode=s,Mn("drive.viewMode",s)})},setActiveSort:s=>{e(n=>{n.activeSort=s})}})));function oe(){return W.getState()}function se(){var l,c;const{hash:e}=rt(),{orderBy:s,orderDir:n}=W(u=>u.activeSort),r=`${s}:${n}`,a=W(u=>u.isPasswordProtected),i=W(u=>u.password),o=Es({queryKey:O.fetchShareableLink({hash:e,sort:r}),queryFn:async({pageParam:u=1})=>{const h=await ea({hash:e,page:u,order:r,password:i});return h.passwordInvalid&&oe().setIsPasswordProtected(!0),h},initialData:()=>{var h,m;const u=(h=An().loaders)==null?void 0:h.shareableLinkPage;if(u&&((m=u.link)==null?void 0:m.hash)===e)return u.passwordInvalid&&oe().setIsPasswordProtected(!0),{pageParams:[void 0,1],pages:[u]}},initialPageParam:1,getNextPageParam:u=>{if(!u.folderChildren)return;const h=u.folderChildren.current_page,m=u.folderChildren.last_page;if(!(h>=m))return h+1},enabled:!!e&&!a||i!=null,placeholderData:ns});return{...o,link:(l=o.data)==null?void 0:l.pages[0].link,entries:(c=o.data)==null?void 0:c.pages.flatMap(u=>{var h;return(h=u.folderChildren)==null?void 0:h.data})}}function ea({hash:e,page:s=1,order:n,password:r}){return E.get(`shareable-links/${e}`,{params:{loader:"shareableLinkPage",page:s,order:n,password:r}}).then(a=>a.data)}function ta({password:e,linkHash:s}){return E.post(`shareable-links/${s}/check-password`,{password:e}).then(n=>n.data)}function sa(){return F({mutationFn:e=>ta(e),onSuccess:(e,s)=>{e.matches&&oe().setPassword(s.password)},onError:e=>A(e,f("Could not create link"))})}function na({linkId:e,password:s}){return E.post(`shareable-links/${e}/import`,{password:s}).then(n=>n.data)}function ra(){const e=W(s=>s.password);return F({mutationFn:s=>na({...s,password:e}),onSuccess:async()=>{await T.invalidateQueries({queryKey:O.fetchShareableLink()}),N(f("Item imported into your drive"))},onError:s=>A(s,f("Could not create link"))})}function Ds(){var o;const{link:e}=se(),{user:s,isLoggedIn:n}=V(),{downloadUrl:r}=js(e==null?void 0:e.entry),a=ra(),i=(o=e==null?void 0:e.entry)==null?void 0:o.users.find(l=>l.id===(s==null?void 0:s.id));return e!=null&&e.entry?t.jsxs("div",{children:[e.allow_download&&t.jsx(aa,{downloadUrl:r}),!i&&n&&e.allow_edit&&t.jsxs(he,{onItemSelected:l=>{l==="import"?a.mutate({linkId:e.id}):l==="download"&&r&&Ke(r)},children:[t.jsx(C,{className:"ml-6",disabled:a.isPending,children:t.jsx(rs,{})}),t.jsxs(fe,{children:[t.jsx(R,{value:"download",startIcon:t.jsx(qe,{}),children:t.jsx(d,{message:"Download"})}),t.jsx(R,{value:"import",startIcon:t.jsx(Ar,{}),children:t.jsx(d,{message:"Save a copy to your own drive"})})]})]})]}):null}function aa({downloadUrl:e}){return t.jsxs(x.Fragment,{children:[t.jsx(J,{label:t.jsx(d,{message:"Download"}),children:t.jsx(C,{className:"md:hidden",onClick:()=>{e&&Ke(e)},children:t.jsx(qe,{})})}),t.jsx(D,{className:"max-md:hidden",size:"sm",variant:"flat",color:"chip",startIcon:t.jsx(qe,{}),onClick:()=>{e&&Ke(e)},children:t.jsx(d,{message:"Download"})})]})}function Ns(){const{link:e}=se(),s=as();return t.jsx(Ln,{size:"md",color:"bg",className:"flex-shrink-0",rightChildren:(e==null?void 0:e.entry)&&t.jsx(Ds,{}),menuPosition:"shareable-link-page",hideLogo:s,children:(e==null?void 0:e.entry)&&e.entry.type!=="folder"&&t.jsxs("div",{className:"fex-auto flex min-w-0 items-center gap-10",children:[t.jsx(Ee,{className:"flex-shrink-0",type:e.entry.type}),t.jsx("div",{className:"flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap font-medium",children:e.entry.name})]})})}function ia(){const{trans:e}=K(),{hash:s}=rt(),n=e({message:"Password"}),[r,a]=x.useState(""),i=sa(),o=s?s.split(":")[0]:null,l=i.data&&!i.data.matches;return t.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[t.jsx(Ns,{}),t.jsx("div",{className:"mx-auto my-80 px-10 md:px-20",children:t.jsxs("div",{className:"flex max-w-[560px] flex-col items-center gap-40 rounded border bg p-24 md:flex-row md:gap-14",children:[t.jsx("div",{className:"h-132 w-[165px]",children:t.jsx(De,{src:Rn})}),t.jsxs("form",{onSubmit:c=>{c.preventDefault(),i.mutate({linkHash:o,password:r})},children:[t.jsx("span",{className:"text-sm",children:t.jsx(d,{message:"The link you are trying to access is password protected."})}),t.jsx(He,{autoFocus:!0,placeholder:n,"aria-label":n,className:"mb-20 mt-10",type:"password",value:r,required:!0,errorMessage:l&&t.jsx(d,{message:"Password is not valid"}),onChange:c=>{a(c.target.value)}}),t.jsx("div",{className:"text-right",children:t.jsx(D,{variant:"flat",color:"primary",type:"submit",className:"w-full md:w-auto",disabled:i.isPending,children:t.jsx(d,{message:"Enter"})})})]})]})})]})}const Fs=is.forwardRef(({entry:e,className:s,isSelected:n,isMobileMode:r,footerAdornment:a,...i},o)=>t.jsxs("div",{...i,ref:o,className:P("shadow rounded border aspect-square flex flex-col grid-item transition-shadow-opacity select-none overflow-hidden outline-none dark:bg-alt",n&&"border-primary",s),children:[t.jsx("div",{className:"flex-auto relative min-h-0",children:t.jsx(pt,{className:"h-full w-full",iconClassName:"block w-70 h-70 absolute m-auto inset-0",file:e})}),t.jsx(oa,{entry:e,isSelected:n,isMobile:r,adornment:a})]}));function oa({entry:e,isSelected:s,isMobile:n,adornment:r}){return t.jsxs("div",{className:P("text-sm h-48 flex-shrink-0 flex items-center",n?"justify-between gap-10 pl-18 pr-2":"justify-center px-16"),children:[t.jsx("div",{className:"min-w-0 whitespace-nowrap overflow-hidden overflow-ellipsis",children:e.name}),r]})}function la({entries:e,onEntrySelected:s}){return t.jsx("div",{className:"file-grid",children:e.map((n,r)=>t.jsx(Fs,{tabIndex:-1,className:"hover:shadow-md cursor-pointer bg",entry:n,onContextMenu:a=>{a.preventDefault()},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&s(n,r)},onClick:()=>{s(n,r)}},n.id))})}function ca(e){return e?E.post(`file-entries/${e}/shareable-link`).then(s=>s.data):Promise.reject(new Error("Invalid entry id"))}function Cs(){return F({mutationFn:({entryId:e})=>ca(e),onSuccess:(e,{entryId:s})=>{T.setQueryData(O.fetchEntryShareableLink(s),e)},onError:e=>A(e,f("Could not create link"))})}function da({entryIds:e}){return E.post("file-entries/star",{entryIds:e}).then(s=>s.data)}function ua(){return F({mutationFn:e=>da(e),onSuccess:(e,{entryIds:s})=>{$(),N(f("Starred [one 1 item|other :count items]",{values:{count:s.length}}))},onError:e=>A(e,f("Could not star items"))})}function ma({entryIds:e}){return E.post("file-entries/unstar",{entryIds:e}).then(s=>s.data)}function xa(){return F({mutationFn:e=>ma(e),onSuccess:(e,{entryIds:s})=>{$(),N(f("Removed star from [one 1 item|other :count items]",{values:{count:s.length}}))},onError:e=>A(e,f("Could not remove star"))})}function ha(e){return E.post("file-entries/duplicate",e).then(s=>s.data)}function fa(){return F({mutationFn:e=>(N.loading(f("Duplicating [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),ha(e)),onSuccess:(e,s)=>{$(),T.invalidateQueries({queryKey:O.fetchStorageSummary}),N(f("Duplicated [one 1 item|other :count items]",{values:{count:s.entryIds.length}}),{disableEnterAnimation:!0})},onError:e=>A(e,f("Could not duplicate items"),null,{disableEnterAnimation:!0})})}function pa(e){return E.post("file-entries/delete",e).then(s=>s.data)}function Re(){return F({mutationFn:e=>(N.loading(ga(e),{disableExitAnimation:!0}),pa(e)),onSuccess:(e,{entryIds:s,emptyTrash:n,deleteForever:r})=>{$(),T.invalidateQueries({queryKey:O.fetchStorageSummary}),n?N(f("Emptied trash"),{disableEnterAnimation:!0}):r?N(f("Permanently deleted [one 1 item|other :count items]",{values:{count:s.length}}),{disableEnterAnimation:!0}):N(f("Moved [one 1 item|other :count items] to trash",{values:{count:s.length}}),{disableEnterAnimation:!0})},onError:(e,{emptyTrash:s})=>{const n=Tn(e);n?N.danger(n,{disableEnterAnimation:!0}):s?N.danger("could not empty trash",{disableEnterAnimation:!0}):N.danger("Could not delete items",{disableEnterAnimation:!0})}})}function ga(e){return e.emptyTrash?f("Emptying trash..."):e.deleteForever?f("Deleting files..."):f("Moving to trash...")}function Ms(){return F({mutationFn:e=>ja(e),onSuccess:()=>$()})}function ja({entryIds:e,...s}){return E.post(`file-entries/${e.join(",")}/unshare`,s).then(n=>n.data)}function As(){return F({mutationFn:e=>va(e),onSuccess:(e,s)=>{$(),N(f("Restored [one 1 item|other :count items]",{values:{count:s.entryIds.length}}))},onError:e=>A(e,f("Could not restore items"))})}function va(e){return E.post("file-entries/restore",e).then(s=>s.data)}function Ls(e){const s=Rs(e),n=Pt(e),r=ba(e),a=ya(e),i=wa(e),o=ka(e),l=Sa(e),c=Ia(e),u=Pa(e),h=Ts(e),m=_s(e),j=Ea(e);return[s,n,r,a,i,o,l,c,u,h,m,j].filter(v=>!!v)}function Rs(e){if(e.some(s=>s.type!=="folder"))return{label:f("Preview"),icon:Lr,key:"preview",execute:()=>{p().setActiveActionDialog("preview",e)}}}function Pt(e){const s=y(n=>n.activePage);if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||s===M))return{label:f("Share"),icon:Ps,key:"share",execute:()=>{p().setActiveActionDialog("share",e)}}}function ba(e){const s=y(r=>r.activePage),n=Cs();if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||s===M))return{label:f("Get link"),icon:vr,key:"getLink",execute:()=>{n.mutate({entryId:e[0].id}),p().setActiveActionDialog("getLink",e)}}}function ya(e){const s=y(r=>r.activePage),n=ua();if(!(e.every(r=>{var a;return(a=r.tags)==null?void 0:a.find(i=>i.name==="starred")})||!e.every(r=>r.permissions["files.update"])||s===M))return{label:f("Add to starred"),icon:Rr,key:"addToStarred",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),p().selectEntries([])}}}function wa(e){const s=y(r=>r.activePage),n=xa();if(!(!e.every(r=>{var a;return(a=r.tags)==null?void 0:a.find(i=>i.name==="starred")})||s===M))return{label:f("Remove from starred"),icon:Tr,key:"removeFromStarred",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),p().selectEntries([])}}}function ka(e){const s=y(n=>n.activePage);if(!(!e.every(n=>n.permissions["files.update"])||s===Se||s===M))return{label:f("Move to"),icon:_r,key:"moveTo",execute:()=>{p().setActiveActionDialog("moveTo",e)}}}function Sa(e){const s=y(n=>n.activePage);if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||s===M))return{label:f("Rename"),icon:zr,key:"rename",execute:()=>{p().setActiveActionDialog("rename",e)}}}function Ia(e){const s=y(r=>r.activePage),n=fa();if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||s===M))return{label:f("Make a copy"),icon:Or,key:"makeCopy",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),p().selectEntries([])}}}function Pa(e){const{downloadUrl:s}=js(e[0],{downloadHashes:e.map(n=>n.hash)});if(e.every(n=>n.permissions["files.download"]))return{label:f("Download"),icon:qe,key:"download",execute:()=>{s&&Ke(s),p().selectEntries([])}}}function Ts(e){const s=Re(),n=y(r=>r.activePage);if(!(n===Se||!e.every(r=>r.permissions["files.delete"])))return{label:n===M?f("Delete forever"):f("Remove"),icon:gt,key:"delete",execute:()=>{n===M?p().setActiveActionDialog("confirmAndDeleteForever",e):(s.mutate({entryIds:e.map(r=>r.id),deleteForever:n===M}),p().selectEntries([]))}}}function Ea(e){const s=As();if(!(y(r=>r.activePage)!==M||!e.every(r=>r.permissions["files.delete"])))return{label:f("Restore"),icon:$r,key:"restore",execute:()=>{s.mutate({entryIds:e.map(r=>r.id)}),p().selectEntries([])}}}function _s(e){const s=Ms();if(y(r=>r.activePage)===Se)return{label:f("Remove"),icon:gt,key:"removeSharedEntry",execute:()=>{s.mutate({entryIds:e.map(r=>r.id),userId:"me"},{onSuccess:(r,a)=>{N(f("Removed [one 1 item|other {count} items]",{values:{count:a.entryIds.length}}))},onError:r=>A(r,f("Could not remove items"))}),p().selectEntries([])}}}function zs(e){const s=Da(e),n=Na(e),r=Fa(e),a=Ca();return[s,n,r,a].filter(i=>!!i)}function Da(e){if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:f("New folder"),icon:os,key:"newFolder",execute:()=>{e.folder&&p().setActiveActionDialog("newFolder",[e.folder])}}}function Na(e){const{uploadFiles:s}=Ye();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:f("Upload files"),icon:_n,key:"uploadFiles",execute:async()=>{s(await ls({multiple:!0}))}}}function Fa(e){const{uploadFiles:s}=Ye();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:f("Upload folder"),icon:zn,key:"uploadFolder",execute:async()=>{s(await ls({directory:!0}))}}}function Ca(e){const s=Re();if(y(r=>r.activePage)===M)return{label:f("Empty trash"),icon:Br,key:"emptyTrash",execute:()=>{s.mutate({entryIds:[],emptyTrash:!0}),p().selectEntries([])}}}function Je({children:e,entries:s,page:n}){return(n==null?void 0:n.id)===_.id?t.jsx(Jt,{page:_,children:e}):n===M?t.jsx(Jt,{page:M,children:e}):n!=null&&n.folder?t.jsx(Xt,{entries:[n.folder],children:e}):s!=null&&s.length?t.jsx(Xt,{entries:s,children:e}):null}function Xt({entries:e,children:s}){const n=Ls(e);return t.jsx(Os,{actions:n,children:s})}function Jt({page:e,children:s}){const n=zs(e);return t.jsx(Os,{actions:n,children:s})}function Os({actions:e,children:s}){return t.jsxs(he,{children:[s,t.jsx(fe,{children:e.map(n=>t.jsx(R,{onSelected:()=>{n.execute()},value:n.key,startIcon:x.createElement(n.icon),children:t.jsx(d,{...n.label})},n.key))})]})}const $s=On(e=>We(e)),Et=[{key:"name",allowsSorting:!0,header:()=>t.jsx(d,{message:"Name"}),visibleInMode:"all",width:"flex-3 min-w-200",body:e=>t.jsx(Ma,{entry:e})},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-184",header:()=>t.jsx(d,{message:"Last modified"}),body:e=>t.jsx(Ve,{date:e.updated_at})},{key:"file_size",allowsSorting:!0,header:()=>t.jsx(d,{message:"Size"}),maxWidth:"max-w-144",body:e=>$s(e.file_size)??"-"},{key:"actions",hideHeader:!0,header:()=>t.jsx(d,{message:"Actions"}),align:"end",width:"w-42 flex-shrink-0",visibleInMode:"all",body:e=>t.jsx(Aa,{entry:e})}];function Ma({entry:e}){const{isCollapsedMode:s}=x.useContext(jt),n=s?"w-30 h-30":"w-24 h-24";return t.jsxs("div",{className:"flex items-center gap-14",children:[t.jsx(pt,{className:P("rounded",n),iconClassName:n,file:e}),t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"overflow-hidden overflow-ellipsis",children:e.name}),s&&t.jsxs("div",{className:"text-muted text-xs flex items-center mt-4",children:[t.jsx(Ve,{date:e.updated_at}),t.jsx("div",{children:"·"}),t.jsx("div",{children:$s(e.file_size)})]})]})]})}function Aa({entry:e}){const{selectedRows:s}=x.useContext(jt);return s.length?t.jsx(cs,{className:"block mr-8",checked:s.includes(e.id)}):t.jsx(Je,{entries:[e],children:t.jsx(C,{className:"text-muted",children:t.jsx(vt,{})})})}const La=Et.filter(e=>e.key!=="updated_at");function Ra({entries:e,onEntrySelected:s}){const n=W(a=>a.activeSort),r=as();return t.jsx(vs,{columns:r?La:Et,data:e,sortDescriptor:n,onSortChange:a=>{oe().setActiveSort(a)},onAction:(a,i)=>{s(a,i)},enableSelection:!1})}function Ta(e,s){var r;let n=e.hash;return s&&((r=e.entry)==null?void 0:r.hash)!==s&&(n=`${n}:${s}`),n}function Bs(){const{link:e}=se(),s=$n();return n=>{e&&s(`/drive/s/${Ta(e,n)}`)}}function _a({className:e}){const{pathname:s}=at(),n=Bs(),[r,a]=x.useState(),i=W(g=>g.viewMode),o=x.useRef(null),{link:l,entries:c,isFetchingNextPage:u,hasNextPage:h,fetchNextPage:m,isPlaceholderData:j}=se();if(x.useEffect(()=>{a(void 0)},[s]),x.useEffect(()=>{const g=o.current;if(!g)return;const b=new IntersectionObserver(([k])=>{k.isIntersecting&&h&&m()});return b.observe(g),()=>{b.unobserve(g)}},[h,m]),!l||j)return t.jsx("div",{className:P("flex justify-center",e),children:t.jsx(xe,{isIndeterminate:!0})});const v=(g,b)=>{g.type==="folder"?n(g.hash):a(b)},w=c||[];return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:P("file-grid-container flex-auto overflow-auto px-14 pb-14 md:px-24 md:pb-24",e),children:[t.jsx(it,{slot:"file-preview",className:"mb-40"}),i==="grid"?t.jsx(la,{entries:w,onEntrySelected:v}):t.jsx(Ra,{entries:w,onEntrySelected:v}),t.jsx("span",{ref:o,"aria-hidden":!0}),t.jsx(Q,{children:u&&t.jsx(z.div,{className:"mt-24 flex w-full justify-center",...ot,children:t.jsx(xe,{isIndeterminate:!0,"aria-label":"loading"})})})]}),t.jsx(Ne,{type:"modal",isOpen:r!=null,onClose:()=>a(void 0),children:t.jsx(bs,{entries:w,defaultActiveIndex:r,allowDownload:l.allow_download})})]})}function Dt({children:e,className:s}){return t.jsx("div",{className:P(s,"dashboard-grid-header"),children:e})}function Ws({hash:e,params:s,isEnabled:n=!0}){return pe({queryKey:O.fetchFolderPath(e,s),queryFn:()=>za(e,s),enabled:!!e&&n})}function za(e,s){return E.get(`folders/${e}/path`,{params:s}).then(n=>n.data)}function Oa({className:e,folder:s,link:n}){const r=Bs(),a=W(l=>l.password),i=Ws({hash:s==null?void 0:s.hash,params:{shareable_link:n.id,password:a}});let o;if(i.isLoading)o=null;else{const l=[];i.data&&i.data.path.forEach(c=>{l.push({folder:c,label:t.jsx(t.Fragment,{children:c.name})})}),o=t.jsx(It,{size:"lg",isNavigation:!0,children:l.map(c=>t.jsx(Ue,{onSelected:()=>{r(c.folder.hash)},children:c.label},c.folder.hash))})}return t.jsx("div",{className:P("h-36 flex-shrink-0",e),children:o})}const es=[{id:"file_size",label:f("Size")},{id:"name",label:f("Name")},{id:"updated_at",label:f("Last modified")},{id:"created_at",label:f("Upload date")},{id:"type",label:f("Type")},{id:"extension",label:f("Extension")}];function Vs({descriptor:e,onChange:s,isDisabled:n=!1}){const r=e.orderBy,a=e.orderDir,i=es.find(o=>o.id===r);return t.jsxs(he,{showCheckmark:!0,selectionMode:"multiple",selectedValue:[a||"desc",r||""],onItemSelected:o=>{s(o==="asc"||o==="desc"?{orderBy:r,orderDir:o}:{orderBy:o,orderDir:a})},children:[t.jsx(D,{className:"text-muted",variant:"text",size:"sm",startIcon:t.jsx(Wr,{}),disabled:n,children:i?t.jsx(d,{...i.label}):null}),t.jsxs(fe,{children:[t.jsxs(Ut,{label:t.jsx(d,{message:"Direction"}),children:[t.jsx(R,{value:"asc",children:t.jsx(d,{message:"Ascending"})}),t.jsx(R,{value:"desc",children:t.jsx(d,{message:"Descending"})})]}),t.jsx(Ut,{label:t.jsx(d,{message:"Sort By"}),children:es.map(o=>t.jsx(R,{value:o.id,children:t.jsx(d,{...o.label})},o.id))})]})]})}function $a(){const e=W(a=>a.activeSort),{link:s,isFetching:n}=se(),r=s&&s.entry;return t.jsxs("div",{className:"md:flex-row flex flex-col md:items-center gap-14 justify-between p-14 md:p-24 md:h-90",children:[r&&t.jsx(Oa,{link:s,folder:s.entry,className:"flex-auto"}),r&&t.jsxs("div",{className:"flex items-center justify-between md:justify-start text-muted",children:[t.jsx(Vs,{isDisabled:n,descriptor:e,onChange:a=>{oe().setActiveSort(a)}}),t.jsx("div",{className:"md:border-l md:pl-10 ml-10",children:t.jsx(C,{onClick:()=>{oe().setViewMode(oe().viewMode==="grid"?"list":"grid")},children:t.jsx(Vr,{})})})]})]})}function Ba(){const{entries:e,isFetched:s}=se(),n=s&&!(e!=null&&e.length);return t.jsxs(lt,{name:"folder-preview",children:[t.jsx(ct,{hideToggleButton:!0,rightChildren:t.jsx(Ds,{}),color:"bg"}),t.jsx(Dt,{children:t.jsx($a,{})}),t.jsx(dt,{children:t.jsx(ys,{children:n?t.jsx(Wa,{}):t.jsx(_a,{})})})]})}function Wa({className:e}){return t.jsx(Ge,{className:P(e,"mt-80"),image:t.jsx(De,{src:Bn}),title:t.jsx(d,{message:"Folder is empty"}),description:t.jsx(d,{message:"No files have been uploaded to this folder yet"})})}function Va(){const{link:e}=se();return e!=null&&e.entry?t.jsxs("div",{className:"flex h-screen flex-col bg-alt",children:[t.jsx(Ns,{}),t.jsx(it,{slot:"file-preview",className:"mx-auto mt-24"}),t.jsx(br,{entries:[e.entry],showHeader:!1,allowDownload:e.allow_download})]}):null}function Ka(){var o;const{status:e,link:s}=se(),{trans:n}=K(),r=W(l=>l.isPasswordProtected),a=W(l=>l.password);let i;if(e==="pending")i=t.jsx("div",{className:"flex h-screen flex-auto items-center justify-center",children:t.jsx(xe,{"aria-label":n({message:"Loading link"}),isIndeterminate:!0})});else{if(!s&&!r)return t.jsx(ds,{});r&&!a?i=t.jsx(ia,{}):((o=s==null?void 0:s.entry)==null?void 0:o.type)==="folder"?i=t.jsx(Ba,{}):i=t.jsx(Va,{})}return t.jsx(ws.Provider,{value:{shareable_link:s==null?void 0:s.id,password:a},children:i})}function qa(e){return F({mutationFn:s=>Ua(s),onSuccess:()=>{N(f("Created workspace")),T.invalidateQueries({queryKey:U.fetchUserWorkspaces})},onError:s=>Fe(s,e)})}function Ua(e){return E.post("workspace",e).then(s=>s.data)}function Qa(){const e=Ce(),{formId:s,close:n}=H(),r=qa(e);return t.jsxs(le,{children:[t.jsx(ee,{children:t.jsx(d,{message:"Create workspace"})}),t.jsx(te,{children:t.jsx(Me,{form:e,id:s,onSubmit:()=>{r.mutate(e.getValues(),{onSuccess:a=>{n(a.workspace.id)}})},children:t.jsx(Ae,{name:"name",autoFocus:!0,label:t.jsx(d,{message:"Workspace name"}),minLength:3,required:!0})})}),t.jsxs(ge,{children:[t.jsx(D,{variant:"text",onClick:n,children:t.jsx(d,{message:"Cancel"})}),t.jsx(D,{variant:"flat",color:"primary",type:"submit",form:s,disabled:r.isPending,children:t.jsx(d,{message:"Create"})})]})]})}function Ha(e){return E.get(`workspace/${e}`).then(s=>s.data)}function Ya(e){return pe({queryKey:U.workspaceWithMembers(e),queryFn:()=>Ha(e)})}function Ga({workspaceId:e,...s}){return E.post(`workspace/${e}/invite`,s).then(n=>n.data)}function Za(){return F({mutationFn:e=>Ga(e),onSuccess:(e,s)=>{T.invalidateQueries({queryKey:U.workspaceWithMembers(s.workspaceId)})},onError:e=>A(e)})}function Xa({workspaceId:e,inviteId:s,...n}){return E.post(`workspace/${e}/${s}/resend`,n).then(r=>r.data)}function Ja(){return F({mutationFn:e=>Xa(e),onSuccess:()=>{N("Invite sent")},onError:e=>A(e)})}const ei=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function Ks(e){return!e||e.length>320?!1:ei.test(e)}function ti({workspaceId:e,member:s,...n}){const r=s.model_type,a=s.model_type==="invite"?s.id:s.member_id;return E.post(`workspace/${e}/${r}/${a}/change-role`,n).then(i=>i.data)}function si(){return F({mutationFn:e=>ti(e),onSuccess:(e,s)=>{N(f("Role changed")),T.invalidateQueries({queryKey:U.workspaceWithMembers(s.workspaceId)})},onError:e=>A(e)})}function ni({workspaceId:e,memberId:s,memberType:n}){const r=n==="invite"?`workspace/invite/${s}`:`workspace/${e}/member/${s}`;return E.delete(r).then(a=>a.data)}function qs(){const{workspaceId:e,setWorkspaceId:s}=Y(),{user:n}=V();return F({mutationFn:r=>ni(r),onSuccess:(r,a)=>{T.invalidateQueries({queryKey:U.fetchUserWorkspaces}),T.invalidateQueries({queryKey:U.workspaceWithMembers(a.workspaceId)}),a.memberId===(n==null?void 0:n.id)&&e===a.workspaceId&&s(Le.id)},onError:r=>A(r)})}function Us({onConfirm:e,isLoading:s}){return t.jsx(je,{isDanger:!0,title:t.jsx(d,{message:"Leave workspace"}),isLoading:s,onConfirm:e,body:t.jsxs("div",{children:[t.jsx(d,{message:"Are you sure you want to leave this workspace?"}),t.jsx("div",{className:"mt-8 font-semibold",children:t.jsx(d,{message:"All resources you've created in the workspace will be transferred to workspace owner."})})]}),confirm:t.jsx(d,{message:"Leave"})})}function ri({workspace:e}){const{data:s,isLoading:n}=Ya(e.id);return t.jsxs(le,{size:"lg",children:[t.jsx(ee,{children:t.jsx(d,{message:"Manage workspace members"})}),t.jsx(te,{children:n?t.jsx("div",{className:"flex items-center justify-center min-h-[238px]",children:t.jsx(xe,{isIndeterminate:!0,"aria-label":"Loading workspace..."})}):t.jsx(ai,{workspace:s.workspace})})]})}function ai({workspace:e}){const s=Nt(e),n=[...e.members||[],...e.invites||[]];return t.jsxs("div",{children:[s.invite&&t.jsx(li,{workspace:e}),t.jsxs("div",{className:"flex items-center gap-10 mb-14 text-base",children:[t.jsx(Kr,{className:"icon-sm"}),t.jsx(d,{message:"Members of `:workspace`",values:{workspace:e.name}})]}),t.jsx(Q,{initial:!1,children:n.map(r=>t.jsx(ii,{workspace:e,member:r},`${r.model_type}.${r.id}`))})]})}function ii({workspace:e,member:s}){return t.jsxs(z.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"flex items-start text-sm gap-14 mb-20",children:[t.jsx("img",{className:"w-36 h-36 rounded flex-shrink-0",src:s.avatar,alt:""}),t.jsxs("div",{className:"md:flex flex-auto items-center justify-between gap-14 min-w-0",children:[t.jsxs("div",{className:"overflow-hidden mb-10 md:mb-0 md:mr-10",children:[t.jsxs("div",{className:"flex items-center justify-start gap-6",children:[t.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:s.display_name}),t.jsx(ui,{workspace:e,member:s})]}),t.jsx("div",{className:"text-muted",children:s.email})]}),t.jsx(oi,{workspace:e,member:s})]})]},`${s.model_type}.${s.id}`)}function Nt(e){var i;const{user:s}=V(),n={update:!1,invite:!1,delete:!1},r=["update","invite","delete"],a=(i=e.members)==null?void 0:i.find(o=>o.id===(s==null?void 0:s.id));return a&&r.forEach(o=>{var l;n[o]=a.is_owner||!!((l=a.permissions)!=null&&l.find(c=>c.name===`workspace_members.${o}`))}),n}function oi({workspace:e,member:s}){const[n,r]=x.useState(s.role_id),a=si(),{user:i}=V(),o=Nt(e),l=s.model_type==="member"&&s.is_owner,c=s.model_type==="member"&&(i==null?void 0:i.id)===s.id,u=!o.update||l||c?t.jsx("div",{className:"text-muted ml-auto first:capitalize",children:t.jsx(d,{message:s.role_name})}):t.jsx(Qs,{className:"ml-auto flex-shrink-0",size:"xs",value:n,isDisabled:a.isPending,onChange:h=>{r(h),a.mutate({roleId:h,workspaceId:e.id,member:s})}});return t.jsxs(t.Fragment,{children:[u,!l&&(c||o.delete)&&t.jsx(ci,{type:c?"leave":"remove",member:s,workspace:e})]})}function li({workspace:e}){const{trans:s}=K(),[n,r]=x.useState([]),a=n.every(h=>!h.invalid),i=h=>h.description||h.name,[o,l]=x.useState(),c=Za(),{data:u}=us(["workspaceRoles"]);return x.useEffect(()=>{var h;!o&&((h=u==null?void 0:u.workspaceRoles)!=null&&h.length)&&l(u.workspaceRoles[0].id)},[u,o]),t.jsxs("div",{className:"mb-30",children:[t.jsx(bt,{value:n,onChange:r,displayWith:i,validateWith:h=>{const m=!Ks(h.description);return{...h,invalid:m,errorMessage:m?s({message:"Not a valid email"}):void 0}},placeholder:s({message:"Enter email addresses"}),label:t.jsx(d,{message:"Invite people"})}),t.jsxs("div",{className:"flex items-center gap-14 justify-between mt-14",children:[t.jsx(Qs,{onChange:l,value:o}),n.length&&o?t.jsx(D,{variant:"flat",color:"primary",size:"sm",disabled:c.isPending||!a,onClick:()=>{c.mutate({emails:n.map(h=>i(h)),roleId:o,workspaceId:e.id},{onSuccess:()=>{r([])}})},children:t.jsx(d,{message:"Invite"})}):null]})]})}function ci({member:e,workspace:s,type:n}){const r=qs(),{close:a}=H();return t.jsxs(Ne,{type:"modal",onClose:i=>{i&&(r.mutate({workspaceId:s.id,memberId:e.id,memberType:e.model_type}),n==="leave"&&(a(),N(f("Left workspace"))))},children:[t.jsx(C,{size:"md",className:"text-muted flex-shrink-0",disabled:r.isPending,children:n==="leave"?t.jsx(ms,{}):t.jsx(ve,{})}),n==="leave"?t.jsx(Us,{}):t.jsx(di,{member:e})]})}function di({member:e}){return t.jsx(je,{isDanger:!0,title:t.jsx(d,{message:"Remove member"}),body:t.jsxs("div",{children:[t.jsx(d,{message:"Are you sure you want to remove `:name`?",values:{name:e.display_name}}),t.jsx("div",{className:"font-semibold mt-8",children:t.jsx(d,{message:"All workspace resources created by `:name` will be transferred to workspace owner.",values:{name:e.display_name}})})]}),confirm:t.jsx(d,{message:"Remove"})})}function Qs({value:e,onChange:s,size:n="xs",className:r,isDisabled:a}){var l;const{data:i}=us(["workspaceRoles"]),o=(l=i==null?void 0:i.workspaceRoles)==null?void 0:l.find(c=>c.id===e);return!e||!o||!(i!=null&&i.workspaceRoles)?null:t.jsxs(he,{selectionMode:"single",selectedValue:e,onSelectionChange:c=>{s(c)},children:[t.jsx(D,{className:r,size:n,variant:"flat",color:"chip",disabled:a,endIcon:t.jsx(yt,{}),children:t.jsx(d,{message:o.name})}),t.jsx(fe,{children:i.workspaceRoles.map(c=>t.jsx(R,{value:c.id,description:c.description,children:t.jsx(d,{message:c.name})},c.id))})]})}function ui({member:e,workspace:s}){const{user:n}=V(),r=Nt(s);return(n==null?void 0:n.id)===e.id?t.jsxs("div",{className:"font-medium",children:["(",t.jsx(d,{message:"You"}),")"]}):e.model_type==="invite"?t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{children:"·"}),t.jsx("div",{className:"font-medium",children:t.jsx(d,{message:"Invited"})}),r.invite?t.jsxs(t.Fragment,{children:[t.jsx("div",{children:"·"}),t.jsx(mi,{member:e,workspace:s})]}):null]}):null}function mi({member:e,workspace:s}){const n=Ja();return t.jsxs(Ne,{type:"modal",onClose:r=>{r&&n.mutate({workspaceId:s.id,inviteId:e.id})},children:[t.jsx(D,{variant:"link",size:"sm",color:"primary",disabled:n.isPending,children:t.jsx(d,{message:"Resend invite"})}),t.jsx(je,{title:t.jsx(d,{message:"Resend invite"}),body:t.jsx(d,{message:"Are you sure you want to send this invite again?"}),confirm:t.jsx(d,{message:"Send"})})]})}function xi({id:e,...s}){return E.put(`workspace/${e}`,s).then(n=>n.data)}function hi(e){const{close:s}=H();return F({mutationFn:n=>xi(n),onSuccess:n=>{s(),N(f("Updated workspace")),T.invalidateQueries({queryKey:U.fetchUserWorkspaces}),T.invalidateQueries({queryKey:U.workspaceWithMembers(n.workspace.id)})},onError:n=>Fe(n,e)})}function fi({workspace:e}){const s=Ce({defaultValues:{id:e.id,name:e.name}}),{formId:n,close:r}=H(),a=hi(s);return t.jsxs(le,{children:[t.jsx(ee,{children:t.jsx(d,{message:"Rename workspace"})}),t.jsx(te,{children:t.jsx(Me,{form:s,id:n,onSubmit:()=>{a.mutate(s.getValues())},children:t.jsx(Ae,{name:"name",autoFocus:!0,label:t.jsx(d,{message:"Name"}),minLength:3,required:!0})})}),t.jsxs(ge,{children:[t.jsx(D,{variant:"text",onClick:r,children:t.jsx(d,{message:"Cancel"})}),t.jsx(D,{variant:"flat",color:"primary",type:"submit",form:n,disabled:a.isPending,children:t.jsx(d,{message:"Rename"})})]})]})}function pi({id:e}){return E.delete(`workspace/${e}`).then(s=>s.data)}function gi(){const{workspaceId:e,setWorkspaceId:s}=Y();return F({mutationFn:n=>pi(n),onSuccess:(n,r)=>{N(f("Deleted workspace")),T.invalidateQueries({queryKey:U.fetchUserWorkspaces}),T.invalidateQueries({queryKey:U.workspaceWithMembers(r.id)}),e===r.id&&s(Le.id)},onError:n=>A(n)})}function ji({onChange:e,className:s}){const{data:n,isFetched:r,isFetching:a}=Wn(),{workspaceId:i,setWorkspaceId:o}=Y(),l=n==null?void 0:n.find(u=>u.id===i),{hasPermission:c}=V();return x.useEffect(()=>{r&&!a&&!l&&o(Le.id)},[l,n,o,r,a]),!l||!c("workspaces.create")&&(n==null?void 0:n.length)===1?null:t.jsx(x.Fragment,{children:t.jsx("div",{className:P("workspace-selector",s),children:t.jsxs("div",{className:"workspace-list flex flex-wrap gap-10 mx-36 justify-between",children:[t.jsx(vi,{onChange:e}),n==null?void 0:n.map(u=>t.jsx(bi,{workspace:u,onChange:e,setSelectorIsOpen:()=>{}},u.id))]})})})}function vi({onChange:e}){const{setWorkspaceId:s}=Y();return t.jsx("div",{className:"add-workspace mb-4 px-4 text-center w-1/5",children:t.jsxs(D,{onClick:async n=>{n.preventDefault(),n.stopPropagation();const r=await we(Qa);r&&(s(r),e==null||e(r))},className:"relative w-full rounded-xl bg-gradient-to-r from-[#6375f2] to-[#4a52ec] p-80 text-white shadow-lg hover:shadow-xl transform hover:scale-105 transition-transform duration-300",children:[t.jsxs("div",{className:"text-left w-full",children:[t.jsx("div",{className:"text-xl font-semibold",children:"+ Add New"}),t.jsx("div",{className:"text-3xl font-bold mt-1",children:"Workspace"})]}),t.jsx("div",{className:"absolute top-30 right-8",children:t.jsxs("svg",{width:"92",height:"45",viewBox:"0 0 92 45",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("path",{d:"M2 42.2949C2 42.2949 8.27975 -5.21045 24 16.7949C39.7203 38.8003 46 37.7896 52 20.7949C59.4168 -0.212582 86.758 17.8755 89.5 2.79492",stroke:"url(#paint0_linear_26_2666)","stroke-width":"4","stroke-linecap":"round","stroke-linejoin":"round"}),t.jsx("defs",{children:t.jsxs("linearGradient",{id:"paint0_linear_26_2666",x1:"-1.50002",y1:"47.2949",x2:"70.5778",y2:"-16.1194",gradientUnits:"userSpaceOnUse",children:[t.jsx("stop",{"stop-color":"white"}),t.jsx("stop",{offset:"1","stop-color":"white","stop-opacity":"0"})]})})]})})]})})}function bi({workspace:e,onChange:s,setSelectorIsOpen:n}){const{workspaceId:r,setWorkspaceId:a}=Y(),i=r===e.id,o=e.created_at?new Date(e.created_at):new Date,l=o instanceof Date&&!isNaN(o.getTime())?o.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Invalid time",c=o instanceof Date&&!isNaN(o.getTime())?o.toLocaleDateString():"Invalid date";return t.jsxs("div",{onClick:()=>{a(e.id),s==null||s(e.id),n(!1)},className:P("add-workspace mb-4 flex cursor-pointer items-center gap-10 p-20 rounded-2xl shadow-md bg-white dark:bg-gray-300 text-black dark:text-white dark:border-2 border-gray-700",i&&"bg-primary/5"),children:[t.jsx("div",{className:"w-40 py-2 px-8 bg-gray-100 rounded-2xl flex items-center justify-center",children:t.jsx("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M10 4L4 4C3.44771 4 3 4.44771 3 5L3 19C3 19.5523 3.44771 20 4 20L20 20C20.5523 20 21 19.5523 21 19L21 8C21 7.44772 20.5523 7 20 7L12 7C11.4477 7 11 6.55228 11 6L11 5C11 4.44772 10.5523 4 10 4Z",fill:"#2563EB"})})}),t.jsxs("div",{className:"flex-auto",children:[t.jsx("div",{className:P("text-lg font-semibold text-gray-900"),children:e.name||"Project 29"}),t.jsxs("div",{className:"text-sm text-gray-300 dark:text-white",children:[c," ",l]})]}),t.jsx("div",{children:t.jsx(ki,{setSelectorIsOpen:n,workspace:e,onChange:s})})]})}function yi({workspace:e,onChange:s}){const n=qs(),{user:r}=V();return t.jsx(Us,{isLoading:n.isPending,onConfirm:()=>{n.mutate({workspaceId:e.id,memberId:r.id,memberType:"member"},{onSuccess:()=>{s==null||s(Le.id)}})}})}function wi({workspace:e,onChange:s}){const n=gi();return t.jsx(je,{isDanger:!0,title:t.jsx(d,{message:"Delete workspace"}),body:t.jsx(d,{message:"Are you sure you want to delete “:name“?",values:{name:e.name}}),confirm:t.jsx(d,{message:"Delete"}),isLoading:n.isPending,onConfirm:()=>{n.mutate({id:e.id},{onSuccess:()=>{s==null||s(Le.id)}})}})}function ki({setSelectorIsOpen:e,workspace:s,onChange:n}){const{user:r}=V();return t.jsxs(he,{onItemSelected:()=>e(!1),children:[t.jsx(D,{onClick:a=>{a.preventDefault(),a.stopPropagation()},color:"primary",size:"xs",variant:"outline",endIcon:t.jsx(rs,{className:"h-40 hover:bg-transparent"}),className:"border-none hover:bg-transparent"}),t.jsxs(fe,{children:[t.jsx(R,{onClick:a=>{a.stopPropagation(),we(ri,{workspace:s})},value:"workspaceMembers",startIcon:t.jsx(Ps,{}),children:t.jsx(d,{message:"Members"})}),s.owner_id===(r==null?void 0:r.id)&&t.jsx(R,{onClick:a=>{a.stopPropagation(),we(fi,{workspace:s})},value:"updateWorkspace",startIcon:t.jsx(Zr,{}),children:t.jsx(d,{message:"Rename"})}),s.owner_id!==(r==null?void 0:r.id)&&t.jsx(R,{onClick:a=>{a.stopPropagation(),we(yi,{workspace:s,onChange:n})},value:"leaveWorkspace",startIcon:t.jsx(ms,{}),children:t.jsx(d,{message:"Leave"})}),s.owner_id===(r==null?void 0:r.id)&&t.jsx(R,{onClick:a=>{a.stopPropagation(),we(wi,{workspace:s,onChange:n})},value:"deleteWorkspace",startIcon:t.jsx(gt,{}),children:t.jsx(d,{message:"Delete"})})]})]})}var Hs=(e=>(e.DriveSidebar="drive-sidebar",e))(Hs||{}),Ys={};(function(e){var s=Qt&&Qt.__assign||function(){return(s=Object.assign||function(o){for(var l,c=1,u=arguments.length;c<u;c++)for(var h in l=arguments[c])Object.prototype.hasOwnProperty.call(l,h)&&(o[h]=l[h]);return o}).apply(this,arguments)},n=(Object.defineProperty(e,"__esModule",{value:!0}),{id:"id",parentId:"parentId",dataField:"data",childrenField:"children",throwIfOrphans:!1,rootParentIds:{"":!(e.countNodes=e.arrayToTree=void 0)},nestedIds:!0,assign:!1});function r(o,l){l===void 0&&(l={});for(var c,u=s(s({},n),l),h=[],m={},j=u.throwIfOrphans?new Set:null,v=0,w=o;v<w.length;v++){var g=w[v],b=u.nestedIds?i(g,u.id):g[u.id],k=u.nestedIds?i(g,u.parentId):g[u.parentId];if(u.rootParentIds[b])throw new Error("The item array contains a node whose parentId both exists in another node and is in "+'`rootParentIds` (`itemId`: "'.concat(b,'", `rootParentIds`: ').concat(Object.keys(u.rootParentIds).map(function(L){return'"'.concat(L,'"')}).join(", "),")."));Object.prototype.hasOwnProperty.call(m,b)||(m[b]=((c={})[u.childrenField]=[],c)),j&&j.delete(b),u.dataField?m[b][u.dataField]=g:u.assign?m[b]=Object.assign(g,((c={})[u.childrenField]=m[b][u.childrenField],c)):m[b]=s(s({},g),((g={})[u.childrenField]=m[b][u.childrenField],g)),g=m[b],k==null||u.rootParentIds[k]?h.push(g):(Object.prototype.hasOwnProperty.call(m,k)||(m[k]=((b={})[u.childrenField]=[],b),j&&j.add(k)),m[k][u.childrenField].push(g))}if(j!=null&&j.size)throw new Error("The items array contains orphans that point to the following parentIds: "+"[".concat(Array.from(j),"]. These parentIds do not exist in the items array. Hint: prevent orphans to result ")+"in an error by passing the following option: { throwIfOrphans: false }");if(u.throwIfOrphans&&a(h,u.childrenField)<Object.keys(m).length)throw new Error("The items array contains nodes with a circular parent/child relationship.");return h}function a(o,l){return o.reduce(function(c,u){return c+1+(u[l]&&a(u[l],l))},0)}function i(o,l){return l.split(".").reduce(function(c,u){return c&&c[u]},o)}e.arrayToTree=r,e.countNodes=a})(Ys);function Si(e){return E.get(`users/${e.userId}/folders`,{params:e}).then(s=>s.data)}function Ft(){const{user:e}=V(),{workspaceId:s}=Y(),n={userId:e.id,workspaceId:s};return pe({queryKey:O.fetchUserFolders(n),queryFn:()=>Si(n),enabled:!!e})}function Gs(){return F({mutationFn:e=>(N.loading(f("Moving [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),Ii(e)),onSuccess:(e,s)=>{$(),N(f('Moved [one 1 item|other :count items] to ":destination"',{values:{count:s.entryIds.length,destination:(e.destination||_.folder).name}}),{disableEnterAnimation:!0})},onError:e=>A(e,f("Could not move items"),null,{disableEnterAnimation:!0})})}function Ii(e){return e.destinationId=e.destinationId?e.destinationId:null,E.post("file-entries/move",e).then(s=>s.data)}function Ct(e,s){return s.type!=="folder"?!1:e.every(n=>!n||s.id===n.parent_id||!n.parent_id&&s.id===0?!1:!Pi(s,n))}function Pi(e,s){const n=(e.path||"").split("/");return(s.path||"").split("/").every((a,i)=>n[i]===a)}function Zs(e){const s=Gs(),{uploadFiles:n}=Ye();return{onDrop:async a=>{if(e.type==="folder"){if(a.type==="nativeFile")n(await a.getData(),{metadata:{parentId:e.id}});else if(a.type==="fileEntry"){const i=a.getData();i!=null&&i.length&&Ct(i,e)&&(s.mutate({destinationId:e.id,entryIds:i.map(o=>o.id)}),p().deselectEntries("all"))}}}}}function nt(e,s){if(e.type==="fileEntry"){const n=e.getData();return Ct(n,s)}return!0}function Mt(e){return`${e.id}-tree`}function Ei(e){return`${e}`.endsWith("-tree")}function Di({folder:e,ref:s}){const[n,r]=x.useState(!1),{onDrop:a}=Zs(e);return{...Xe({id:Mt(e),ref:s,types:["fileEntry","nativeFile"],acceptsDrop:o=>nt(o,e),onDragEnter:o=>{nt(o,e)&&r(!0)},onDragLeave:()=>{r(!1)},onDropActivate:()=>{p().sidebarExpandedKeys.includes(e.id)||p().setSidebarExpandedKeys([...p().sidebarExpandedKeys,e.id])},onDrop:a}),isDragOver:n}}const At=x.createContext(null);function Xs({nodes:e,itemRenderer:s,parentNode:n,level:r}){return e.map((a,i)=>x.cloneElement(s(a),{level:r==null?0:r+1,index:i,node:a,parentNode:n,key:a.id,itemRenderer:s}))}const Js=x.forwardRef(({icon:e,label:s,level:n=0,node:r,className:a,...i},o)=>{const{expandedKeys:l,setExpandedKeys:c,selectedKeys:u,setSelectedKeys:h}=x.useContext(At),m=l.includes(r.id),j=u.includes(r.id),v=w=>{w.stopPropagation();const g=l.indexOf(r.id),b=[...l];g>-1?b.splice(g,1):b.push(r.id),c(b)};return t.jsxs("div",{...i,ref:o,onClick:w=>{w.stopPropagation(),h([r.id])},className:P("flex flex-nowrap whitespace-nowrap items-center gap-4 py-6 rounded header cursor-pointer overflow-hidden text-ellipsis tree-label",a,j&&"bg-primary/selected text-primary font-bold",!j&&"hover:bg-hover"),children:[n>0&&t.jsx("div",{className:"flex",children:Array.from({length:n}).map((w,g)=>t.jsx("div",{className:"w-24 h-24"},g))}),t.jsx("div",{onClick:v,children:t.jsx(qr,{className:P("icon-sm cursor-default transition-transform",m&&"rotate-90")})}),e,t.jsx("div",{className:"overflow-hidden text-ellipsis pr-6",children:s})]})});Js.displayName="TreeLabel";function Ni({label:e,icon:s,node:n,level:r,index:a,itemRenderer:i,labelRef:o,labelClassName:l,className:c,parentNode:u,...h}){const m=Vn(),{expandedKeys:j,selectedKeys:v,focusedNode:w,setFocusedNode:g,setExpandedKeys:b,setSelectedKeys:k}=x.useContext(At);if(x.useEffect(()=>()=>{w===(n==null?void 0:n.id)&&g(void 0)},[w,n==null?void 0:n.id,g]),!n||!i)return null;const L=n.children.length,S=L&&j.includes(n.id),Z=v.includes(n.id),ce=r===0&&a===0,de=w==null?ce:w===n.id,ye=I=>{var ne,Te;if(w!=null)switch(I.key){case"Enter":case" ":I.stopPropagation(),I.preventDefault(),k([w]);break;case"ArrowRight":if(I.stopPropagation(),I.preventDefault(),!L)return;S?m==null||m.focusNext():b([...j,w]);break;case"ArrowLeft":if(I.stopPropagation(),I.preventDefault(),S){const B=j.indexOf(w),re=[...j];re.splice(B,1),b(re)}else if(u){const B=(Te=(ne=document.activeElement)==null?void 0:ne.parentElement)==null?void 0:Te.closest("[tabindex]");B&&B.focus()}break;case"ArrowDown":I.stopPropagation(),I.preventDefault(),m==null||m.focusNext();break;case"ArrowUp":I.stopPropagation(),I.preventDefault(),m==null||m.focusPrevious();break;case"Home":I.stopPropagation(),I.preventDefault(),m==null||m.focusFirst();break;case"End":I.stopPropagation(),I.preventDefault(),m==null||m.focusLast();break;case"*":if(I.stopPropagation(),I.preventDefault(),u!=null&&u.children){const B=[...j];u.children.forEach(re=>{re.children.length&&!j.includes(re.id)&&B.push(re.id)}),B.length!==j.length&&b(B)}break}};return t.jsxs("li",{role:"treeitem","aria-expanded":S?"true":"false","aria-selected":Z,tabIndex:de?0:-1,onKeyDown:Ie(ye),onFocus:I=>{I.stopPropagation(),g(n.id)},onBlur:I=>{I.stopPropagation(),I.currentTarget.contains(I.relatedTarget)||g(void 0)},className:P("outline-none","[&>.tree-label]:focus-visible:ring [&>.tree-label]:focus-visible:ring-2 [&>.tree-label]:focus-visible:ring-inset",c),children:[t.jsx(Js,{ref:o,className:l,node:n,level:r,label:e,icon:s,...h}),t.jsx(Q,{initial:!1,children:S?t.jsx(z.ul,{role:"group",initial:"closed",animate:"open",exit:"closed",variants:{open:{opacity:1,height:"auto"},closed:{opacity:0,height:0,overflow:"hidden"}},children:Xs({nodes:n.children,parentNode:n,itemRenderer:i,level:r})},`${n.id}-group`):null})]})}function Fi({children:e,nodes:s,...n}){const[r,a]=Ht(n.expandedKeys,n.defaultSelectedKeys,n.onExpandedKeysChange),[i,o]=Ht(n.selectedKeys,n.defaultSelectedKeys,n.onSelectedKeysChange),[l,c]=x.useState(),u={expandedKeys:r,setExpandedKeys:a,selectedKeys:i,setSelectedKeys:o,focusedNode:l,setFocusedNode:c};return t.jsx(At.Provider,{value:u,children:t.jsx(Kn,{children:t.jsx(Ci,{nodes:s,itemRenderer:e})})})}function Ci(e){return t.jsx("ul",{className:"overflow-hidden text-sm",role:"tree",children:Xs(e)})}function Mi(){const e=be(),{data:s}=Ft(),n=y(o=>o.sidebarExpandedKeys),r=y(o=>o.activePage);let a=[];r!=null&&r.isFolderPage&&(a=r.folder?[r.folder.id]:[]);const i=x.useMemo(()=>{const o=Ys.arrayToTree((s==null?void 0:s.folders)||[],{parentId:"parent_id",dataField:null});return[{..._.folder,children:o}]},[s==null?void 0:s.folders]);return t.jsx(Fi,{nodes:i,expandedKeys:n,onExpandedKeysChange:o=>{p().setSidebarExpandedKeys(o)},selectedKeys:a,onSelectedKeysChange:([o])=>{const l=en(o,i);e(l?ut(l):_.path)},children:()=>t.jsx(Ai,{})})}function Ai(e){const{node:s}=e,n=x.useRef(null),r=s.id===0,a=y(c=>c.entriesBeingDragged.includes(s.id)),{draggableProps:i}=ks({type:"fileEntry",id:Mt(s),ref:n,disabled:r,hidePreview:!0,onDragStart:(c,u)=>{const h=u;p().setEntriesBeingDragged(h.getData().map(m=>m.id)),p().selectEntries([])},onDragEnd:()=>{p().setEntriesBeingDragged([])},getData:()=>[s]}),{droppableProps:o,isDragOver:l}=Di({folder:s,ref:n});return t.jsx(Ni,{...Ze(i,o,e),onContextMenu:c=>{c.preventDefault(),c.stopPropagation(),p().deselectEntries("all"),p().setContextMenuData({x:c.clientX,y:c.clientY,entry:s})},labelRef:n,className:r?"focus-visible:ring-2":void 0,labelClassName:P(l&&"bg-primary/selected ring ring-2 ring-inset ring-primary",a&&"opacity-30",r&&"h-40"),icon:r?t.jsx(Ur,{size:"md",className:"mr-6"}):t.jsx(St,{size:"sm",className:"mr-4"}),label:s.name})}const en=(e,s)=>{for(const n of s){if(n.id===e)return n.hash;if(n.children){const r=en(e,n.children);if(r)return r}}};function Li(){return Y(),t.jsx("div",{className:"container",children:t.jsxs("div",{className:"text-muted mt-26 px-12",children:[t.jsx(Mi,{}),t.jsx(Un,{menu:Hs.DriveSidebar,orientation:"vertical",gap:"gap-0",children:e=>e.action==="/drive/trash"?t.jsx(Ri,{item:e},e.id):t.jsx(tn,{item:e},e.id)})]})})}const tn=x.forwardRef(({item:e,className:s,...n},r)=>t.jsx(qn,{className:({isActive:a})=>P(s,"h-40 w-full my-4 px-24 rounded",a?"text-primary font-bold bg-primary/selected cursor-default":"hover:bg-hover"),item:e,ref:r,...n}));function Ri({item:e}){const s=Re(),[n,r]=x.useState(!1),a=x.useRef(null),{droppableProps:i}=Xe({id:"trash",types:["fileEntry"],ref:a,onDragEnter:()=>{r(!0)},onDragLeave:()=>{r(!1)},onDrop:o=>{const l=o.getData().map(c=>c.id);s.mutate({entryIds:l,deleteForever:!1})}});return t.jsx(tn,{className:P(n&&"bg-primary/selected"),ref:a,...i,item:e})}function sn({className:e,logocolor:s}){const{isSubscribed:n}=V(),{billing:r}=mt(),a=Qn(),i=s||(a?"light":"dark"),[o,l]=x.useState(!1),c=()=>l(!o);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:t.jsx("button",{onClick:c,"aria-label":"Toggle Sidebar",children:t.jsx(Hn,{className:"text-gray-700 dark:text-gray-300"})})}),t.jsxs("div",{className:P(e,"flex flex-col gap-20 bg-white dark:bg-gray-300 text-sm font-medium text-muted h-screen fixed z-40 transition-transform duration-300 ease-in-out",o?"translate-x-0":"-translate-x-full","lg:translate-x-0","lg:w-240 w-240"),style:{boxShadow:"4px 0 10px rgba(0, 0, 0, 0.1)"},children:[t.jsx("div",{className:"sticky bottom-0 mt-20 flex items-center justify-center",children:t.jsx(Yn,{isDarkMode:a,color:i,logoColor:s})}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:t.jsx(Li,{})}),t.jsxs("div",{className:"mb-20 ml-4 w-200 bg-white dark:bg-gray-300 rounded-2xl shadow-lg",children:[t.jsx(Gn,{}),r.enable?t.jsx("div",{className:"mt-14 mb-20 pl-20",children:t.jsx(D,{elementType:xs,to:n?"/billing/change-plan":"/pricing",variant:"outline",size:"xs",color:"primary",className:"text-gray-200",children:t.jsx(d,{message:"Upgrade"})})}):null]})]})]})}function Ti(e){return E.get("drive/file-entries",{params:e}).then(s=>s.data)}const _i=e=>{var a;const n=e.pages[0].folder,r=p().activePage;return n&&r&&r.id===n.hash&&(!r.folder||!Zn(n.permissions,(a=r.folder)==null?void 0:a.permissions))&&p().setActivePage(hs(n)),e};function nn(){const e=y(l=>l.activePage),s=y(l=>l.sortDescriptor),[n]=xt(),{workspaceId:r}=Y(),a={pageId:e==null?void 0:e.id,...e==null?void 0:e.queryParams,...Object.fromEntries(n),folderId:e!=null&&e.isFolderPage?e.id:null,workspaceId:r,...s},i=e===Pe&&!a.query&&!a.filters,o=Es({queryKey:O.fetchEntries(a),queryFn:({pageParam:l=1})=>Ti({...a,page:l}),initialPageParam:1,getNextPageParam:l=>{const c=l.current_page,u=l.last_page;if(!(c>=u))return c+1},enabled:e!=null&&!i});return x.useEffect(()=>{var l;(l=o.data)!=null&&l.pages[0].folder&&_i(o.data)},[o.data]),o}function zi(){return T.getQueriesData({queryKey:O.fetchEntries()}).reduce((s,n)=>{const r=n[1]?n[1].pages.flatMap(a=>a.data):[];return[...s,...r]},[])}const rn=[yr,{key:"owner_id",label:f("Owner"),description:f("User file was uploaded by"),defaultOperator:ze.eq,control:{type:Oe.Select,defaultValue:"02",options:[{key:"01",label:f("anyone"),value:{value:null,operator:"!="}},{key:"02",label:f("me"),value:"{authId}"},{key:"03",label:f("not me"),value:{value:"{authId}",operator:"!="}}]}},wr({description:f("Date file was uploaded")}),kr({description:f("Date file was last changed")}),{key:"deleted_at",label:f("In trash"),description:f("Only show files that are in the trash"),defaultOperator:ze.ne,control:{type:Oe.BooleanToggle,defaultValue:null}},{key:"shareableLink",label:f("Has shareable link"),description:f("Only show files that have a shareable link"),defaultOperator:ze.has,control:{type:Oe.BooleanToggle,defaultValue:"*"}},{control:{type:Oe.BooleanToggle,defaultValue:!0},key:"sharedByMe",label:f("Shared by me"),description:f("Only show files that are shared with someone"),defaultOperator:ze.eq}],Oi=rn.map(e=>e.key);function $i(){const e=y(l=>l.activePage),{isMobileMode:s}=x.useContext(G),{trans:n}=K(),r=be(),[a]=xt(),[i,o]=x.useState(a.get("query")||"");return e!==Pe?null:t.jsxs("div",{className:"mb-30 mt-10 px-10 md:px-26",children:[s&&t.jsx("form",{className:"contents",onSubmit:l=>{var c;l.preventDefault(),((c=document.activeElement)==null?void 0:c.tagName)==="INPUT"&&document.activeElement.blur(),r({pathname:Pe.path,search:`?query=${i}`},{replace:!0})},children:t.jsx(He,{autoFocus:!0,className:"mb-20",startAdornment:t.jsx(C,{type:"submit",children:t.jsx(ht,{})}),placeholder:n(f("Type to search")),value:i,onChange:l=>o(l.target.value)})}),t.jsx(Sr,{filters:rn,pinnedFilters:Oi})]})}function Bi(e,s){const n={...e};n.left=Math.max(0,n.left);const r=n.left-e.left;r>0&&(n.width-=r),n.top=Math.max(0,n.top);const a=n.top-e.top;return a>0&&(n.height-=a),n.width=Math.min(n.width,s.width-n.left),n.height=Math.min(n.height,s.height-n.top),n}const ke=new Map;function Wi(e){const{id:s,ref:n}=e,r=x.useRef(e);r.current=e,x.useLayoutEffect(()=>{if(n.current)return ke.set(s,{...ke.get(s),id:s,ref:n,onSelected:()=>{var a,i;(i=(a=r.current).onSelected)==null||i.call(a)},onDeselected:()=>{var a,i;return(i=(a=r.current).onDeselected)==null?void 0:i.call(a)}}),()=>{Ss.delete(s)}},[s,r,n])}function Vi(e,s){return!e||!s?!1:e.left<=s.left+s.width&&e.left+e.width>=s.left&&e.top<=s.top+s.height&&e.top+e.height>=s.top}function Ki({onPointerDown:e,...s}={}){const n=x.useRef(null),r=s.containerRef||n,a=x.useRef(null);let i=x.useRef({}).current;const o=()=>{var k,L,S,Z,ce,de,ye;if(i.rafId&&cancelAnimationFrame(i.rafId),!i.startPoint||!i.endPoint||!i.boundaryRect)return;const c=i.startPoint,u=i.endPoint,h=c.scrollTop||0,m=((k=r.current)==null?void 0:k.scrollTop)||0,j={left:Math.min(c.x,u.x),top:Math.min(c.y,u.y),width:Math.abs(c.x-u.x),height:Math.abs(c.y-u.y)};j.left-=i.boundaryRect.left,j.top-=i.boundaryRect.top,j.top+=h;const v=m-h,w=Math.abs(v);v<0&&(j.top-=w),j.height+=w;const g=i.boundaryRect?Bi(j,i.boundaryRect):{...j};a.current&&(i.rafId=requestAnimationFrame(()=>{a.current&&(a.current.style.display="block",a.current.style.transform=`translate(${g.left}px, ${g.top}px)`,a.current.style.width=`${g.width}px`,a.current.style.height=`${g.height}px`),i.rafId=void 0}));const b={...g,left:g.left+i.boundaryRect.left,top:g.top+i.boundaryRect.top-m};for(const[,I]of ke){const ne=Vi(I.rect,b);ne&&!((L=i.selectedIds)!=null&&L.has(I.id))?((S=i.selectedIds)==null||S.add(I.id),(Z=I.onSelected)==null||Z.call(I)):!ne&&((ce=i.selectedIds)!=null&&ce.has(I.id))&&((de=i.selectedIds)==null||de.delete(I.id),(ye=I.onDeselected)==null||ye.call(I))}};return{containerProps:{...Is({minimumMovement:4,onPointerDown:e,onMoveStart:c=>{if(Ir)return!1;Yt(ke),i={selectedIds:new Set};const u=r.current;if(i.startPoint={x:c.clientX,y:c.clientY,scrollTop:(u==null?void 0:u.scrollTop)||0},i.scrollListener=h=>{var m;i.startPoint&&(Yt(ke),(m=i.boundaryRect)!=null&&m.height&&(i.boundaryRect.height=h.target.scrollHeight),o())},u){const h=u.getBoundingClientRect();u.addEventListener("scroll",i.scrollListener),i.boundaryRect={top:h.top,left:h.left,height:u.scrollHeight,heightWithoutScroll:h.height,width:u.scrollWidth}}},onMove:c=>{if(i.endPoint={x:c.clientX,y:c.clientY},i.boundaryRect&&r.current){const u=c.clientY+20>i.boundaryRect.heightWithoutScroll+i.boundaryRect.top,h=c.clientY-20<i.boundaryRect.top;u?r.current.scrollBy({top:10}):h&&r.current.scrollBy({top:-10})}o()},onMoveEnd:()=>{i.rafId&&cancelAnimationFrame(i.rafId),r.current&&i.scrollListener&&r.current.removeEventListener("scroll",i.scrollListener),a.current&&(a.current.style.display="none",a.current.style.transform="",a.current.style.width="",a.current.style.height=""),i={}}}).domProps,ref:r},boxProps:{ref:a}}}function Lt(){const e=nn();return e.data?e.data.pages.flatMap(s=>s.data):[]}function Rt(){const e=y(n=>n.selectedEntries),s=Lt();return Array.from(e).map(n=>s.find(r=>r.id===n)).filter(n=>!!n)}function an(){return Rt()[0]}function qi(){const e=an(),{data:s}=Ft();if(!(!e||!s))return s.folders.find(n=>n.id===e.parent_id)}function Tt(){const e=Array.from(p().selectedEntries),s=zi();return e.map(n=>s.find(r=>r.id===n)).filter(n=>!!n)}function on({className:e}){const s=Rt();return s.length?t.jsx("div",{className:e,children:t.jsx(Ui,{entries:s})}):null}function Ui({entries:e}){const s=Rs(e),n=Pt(e),r=Ts(e),a=_s(e),i=[s,n,r,a].filter(o=>!!o);return t.jsxs("div",{className:"entry-action-list",children:[i.map(o=>t.jsx(J,{label:t.jsx(d,{...o.label}),children:t.jsx(C,{size:"sm",onClick:()=>{o.execute()},children:x.createElement(o.icon)})},o.key)),t.jsx(Je,{entries:e,children:t.jsx(J,{label:t.jsx(d,{message:"More actions"}),children:t.jsx(C,{children:t.jsx(vt,{})})})})]})}function Qi(){var a;const e=Rt(),s=y(i=>i.activePage),n=y(i=>i.contextMenuData),r=n!=null&&n.entry?[n.entry]:e;return((a=n==null?void 0:n.entry)==null?void 0:a.id)===0?t.jsx(ts,{position:n,page:_}):n&&r.length?t.jsx(Hi,{entries:r,position:n}):n&&s?t.jsx(ts,{position:n,page:s}):null}function Hi({entries:e,position:s}){const n=Ls(e);return t.jsx(ln,{position:s,actions:n})}function ts({page:e,position:s}){const n=zs(e);return t.jsx(ln,{position:s,actions:n})}function ln({position:e,actions:s}){return t.jsx(Xn,{position:e,onOpenChange:n=>{n||p().setContextMenuData(null)},children:s.map(n=>t.jsx(R,{value:n.key,onSelected:n.execute,startIcon:x.createElement(n.icon),children:t.jsx(d,{...n.label})},n.key))})}function Yi(){return Jn("((pointer: coarse))")}function cn(e){const s=Yi(),n=x.useRef(null),{onDrop:r}=Zs(e),[a,i]=x.useState(!1),o=y(m=>m.entriesBeingDragged.includes(e.id)),l=y(m=>m.activePage),{draggableProps:c}=ks({disabled:!!s||l===M,id:e.id,type:"fileEntry",ref:n,hidePreview:!0,onDragStart:(m,j)=>{p().selectedEntries.has(e.id)||p().selectEntries([e.id]),p().setEntriesBeingDragged(j.getData().map(v=>v.id))},onDragEnd:()=>{p().setEntriesBeingDragged([])},getData:()=>Tt()}),{droppableProps:u}=Xe({id:e.id,disabled:s||e.type!=="folder",ref:n,types:["fileEntry","nativeFile"],acceptsDrop:m=>nt(m,e),onDragEnter:()=>i(!0),onDragLeave:()=>i(!1),onDrop:r});Wi({id:e.id,ref:n,onSelected:()=>{p().selectEntries([e.id],!0)},onDeselected:()=>{p().deselectEntries([e.id])}});const h=P(o&&"opacity-20",a&&"ring ring-offset-4 ring-primary bg-primary-light/10 rounded");return{draggableProps:c,droppableProps:u,isDragOver:a,isDragging:o,itemClassName:h,ref:n}}function Gi({item:e,children:s,className:n,...r}){const{isCollapsedMode:a}=x.useContext(jt),{draggableProps:i,droppableProps:o,itemClassName:l,ref:c}=cn(e);return t.jsx("div",{className:P(n,l),ref:c,...Ze(i,o,r,{onContextMenu:u=>{u.preventDefault(),u.stopPropagation(),a||(p().selectedEntries.has(e.id)||p().selectEntries([e.id]),p().setContextMenuData({x:u.clientX,y:u.clientY}))}}),children:s})}function dn(){const e=be();return{performViewItemAction:x.useCallback(n=>{if(n&&n.type==="folder")p().activePage===M?p().setActiveActionDialog("trashFolderBlock",[n]):e(ut(n.hash));else{const r=Tt();p().setActiveActionDialog("preview",r.length?r:[n])}},[e])}}function Zi({entries:e}){const{performViewItemAction:s}=dn(),n=y(i=>i.selectedEntries),r=y(i=>i.sortDescriptor),a=x.useMemo(()=>[...n],[n]);return t.jsx(vs,{columns:Et,data:e,sortDescriptor:r,onSortChange:i=>{p().setSortDescriptor(i)},onAction:s,selectedRows:a,selectionStyle:"highlight",renderRowAs:Gi,onSelectionChange:i=>{p().selectEntries(i)}})}function Xi({entry:e}){const s=y(v=>v.selectedEntries.has(e.id)),{performViewItemAction:n}=dn(),{isMobileMode:r}=x.useContext(G),{draggableProps:a,droppableProps:i,itemClassName:o,ref:l}=cn(e),c=()=>{s?p().deselectEntries([e.id]):p().selectEntries([e.id],!0)},u=(v,w)=>{r?p().selectedEntries.size?c():n(e):Pr(v)?c():p().selectEntries([e.id])},{domProps:h}=Is({onLongPress:r?()=>c():void 0,onPress:u}),m=v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),v.stopPropagation(),n(e))},j=v=>{v.preventDefault(),v.stopPropagation(),r||(p().selectedEntries.has(e.id)||p().selectEntries([e.id]),p().setContextMenuData({x:v.clientX,y:v.clientY}))};return t.jsx(Fs,{...Ze(a,i,h,{onKeyDown:Ie(m)}),ref:l,entry:e,isSelected:s,isMobileMode:!!r,tabIndex:-1,onDoubleClick:v=>{v.preventDefault(),v.stopPropagation(),r||n(e)},footerAdornment:r&&t.jsx(Ji,{entry:e,isSelected:s}),onContextMenu:Ie(j),className:o})}function Ji({entry:e,isSelected:s}){return y(r=>r.selectedEntries.size)?t.jsx(cs,{className:"block mr-8",checked:s}):t.jsx(Je,{entries:[e],children:t.jsx(C,{className:"text-muted",onPointerDown:r=>{r.stopPropagation()},children:t.jsx(vt,{})})})}function eo({entries:e}){return t.jsx("div",{className:"file-grid-container",children:t.jsx("div",{className:"file-grid",children:e.map(s=>t.jsx(Xi,{entry:s},s.id))})})}function un({isDisabled:e}){const s=y(n=>n.sortDescriptor);return t.jsx(Vs,{isDisabled:e,descriptor:s,onChange:n=>{p().setSortDescriptor(n)}})}function mn({className:e}){const{isMobileMode:s}=x.useContext(G),n=be(),r=y(h=>h.activePage),a=r==null?void 0:r.folder,i=Ws({hash:a==null?void 0:a.hash,isEnabled:(a==null?void 0:a.hash)!==_.folder.hash}),o=fs(),l=to(),c=!r||!o||r.isFolderPage&&!a||i.fetchStatus!=="idle";let u;if(c)u=null;else{const h=l?[l]:[];i.data&&i.data.path.forEach(m=>{h.push({page:hs(m),label:m.name})}),u=t.jsx(It,{className:e,size:s?"md":"lg",currentIsClickable:!0,children:h.map((m,j)=>j===h.length-1?t.jsx(Ue,{children:({isMenuItem:w})=>w||!m.page.folder&&m.page!==M?t.jsx(Be,{value:m.label}):t.jsx(Je,{page:m.page,children:t.jsxs(er,{className:"flex items-center gap-2 rounded focus-visible:ring-offset-4",children:[t.jsx(Be,{value:m.label}),t.jsx(yt,{className:"icon-md text-muted"})]})})},m.page.id):t.jsx(Ue,{onSelected:()=>{n(m.page.path)},children:t.jsx(Be,{value:m.label})},m.page.id))})}return u}function to(){var r,a;const e=y(i=>i.activePage),s=fs(),{user:n}=V();if(!e)return null;if(s&&!s.default&&e!=null&&e.isFolderPage&&((e==null?void 0:e.id)===_.id||((r=e.folder)==null?void 0:r.workspace_id)===s.id))return{label:s.name,page:_};if(e!=null&&e.isFolderPage){const i=(a=e.folder)==null?void 0:a.users.find(o=>o.owns_entry);return(i==null?void 0:i.id)!==(n==null?void 0:n.id)?{label:Se.label,page:Se}:{label:_.label,page:_}}return{label:e.label,page:e}}function so({query:{isInitialLoading:e,fetchNextPage:s,isFetchingNextPage:n,hasNextPage:r},children:a,loaderMarginTop:i="mt-24",style:o,className:l,variant:c="infiniteScroll",loadMoreExtraContent:u,size:h="md"}){const m=x.useRef(null),j=n||e,[v,w]=x.useState(0),g=c==="loadMore"&&v<3?"loadMore":"infiniteScroll";x.useEffect(()=>{const k=m.current;if(!k||g==="loadMore")return;const L=new IntersectionObserver(([S])=>{S.isIntersecting&&r&&!j&&s()});return L.observe(k),()=>{L.unobserve(k)}},[s,r,j,g]);let b;return a?b=n?a:null:g==="loadMore"?b=!e&&r&&t.jsxs("div",{className:P("flex items-center gap-8",i),children:[u,t.jsx(D,{size:h==="md"?"sm":"xs",className:P(h==="sm"?"min-h-24 min-w-96":"min-h-36 min-w-112"),variant:"outline",color:"primary",onClick:()=>{s(),w(v+1)},disabled:j,children:v>=2&&!n?t.jsx(d,{message:"Load all"}):t.jsx(d,{message:"Show more"})})]}):b=t.jsx(Q,{children:n&&t.jsx(z.div,{className:P("flex justify-center w-full",i),...ot,children:t.jsx(xe,{size:h,isIndeterminate:!0,"aria-label":"loading"})})}),t.jsxs("div",{style:o,className:P("w-full",l,r&&"min-h-36"),role:"presentation",children:[t.jsx("div",{ref:m,"aria-hidden":!0}),b]})}function no({isVisible:e}){const s=t.jsx(z.div,{...ot,transition:{duration:.3},className:"absolute inset-0 w-full min-h-full bg-primary-light/30 border-2 border-dashed border-primary pointer-events-none",children:t.jsx(z.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"p-10 bg-primary text-on-primary fixed bottom-0 left-0 right-0 max-w-max mx-auto rounded",children:t.jsx(d,{message:"Drop files to upload them to this folder."})})},"dragTargetMask");return t.jsx(Q,{children:e?s:null})}function ro({className:e}){const[s]=xt(),n=!!s.get("query")||!!s.get("filters"),r=x.useRef(null),a=nn(),i=Lt(),{uploadFiles:o}=Ye(),l=Re(),c=y(S=>S.activePage),[u,h]=x.useState(!1),m=y(S=>S.viewMode),{isMobileMode:j}=x.useContext(G),{containerProps:v,boxProps:w}=Ki({containerRef:r,onPointerDown:S=>{S.target.closest(".entry-action-list")||p().deselectEntries("all")}});console.log("entries",i);const{droppableProps:g}=Xe({id:"driveRoot",ref:r,types:["nativeFile"],disabled:!(c!=null&&c.canUpload),onDragEnter:()=>{h(!0)},onDragLeave:()=>{h(!1)},onDrop:async S=>{S.type==="nativeFile"&&o(await S.getData())}});if(!c)return null;let b;if(!i.length&&(!a.isLoading||a.fetchStatus==="idle")){const S=c.noContentMessage(n);b=t.jsx(Ge,{className:"mt-40",image:t.jsx(De,{src:S.image}),title:t.jsx(d,{...S.title}),description:t.jsx(d,{...S.description})})}else a.isLoading||(b=m==="list"?t.jsx(Zi,{entries:i}):t.jsx(eo,{entries:i}));const k=S=>{S.preventDefault(),S.stopPropagation(),p().deselectEntries("all"),p().setContextMenuData({x:S.clientX,y:S.clientY})},L=S=>{S.key==="a"&&Er(S)&&(S.preventDefault(),S.stopPropagation(),p().selectEntries(i.map(Z=>Z.id))),S.key==="Delete"&&(S.preventDefault(),S.stopPropagation(),p().selectedEntries.size&&!l.isPending&&(c===M?p().setActiveActionDialog("confirmAndDeleteForever",Tt()):(l.mutate({entryIds:[...p().selectedEntries],deleteForever:c===M}),p().selectEntries([]))))};return t.jsx("div",{className:P("relative outline-none",e),tabIndex:-1,...Ze(v,g,{onKeyDown:Ie(L)}),onContextMenu:k,children:t.jsxs("div",{className:"relative flex min-h-full flex-col pt-10",children:[j?t.jsx(mn,{className:"mb-10 px-14"}):t.jsx(ao,{}),t.jsx($i,{}),t.jsxs("div",{className:"relative flex-auto px-18 pb-18 md:px-24",children:[t.jsx(it,{slot:"drive",className:"mb-24"}),b,t.jsx(so,{query:a})]}),t.jsx("div",{...w,className:"pointer-events-none absolute left-0 top-0 z-10 hidden border border-primary-light bg-primary-light/20 shadow-md"}),t.jsx(Qi,{}),t.jsx(no,{isVisible:u})]})})}function ao(){const e=y(s=>s.activePage);return t.jsxs("div",{className:"my-10 flex min-h-42 items-center justify-between gap-40 px-10 text-muted md:px-18",children:[t.jsx(un,{isDisabled:e==null?void 0:e.disableSort}),t.jsx(on,{className:"text-muted"}),t.jsx("div",{children:t.jsx(ft,{className:"px-8 text-center"})})]})}const io=x.memo(({file:e,style:s})=>t.jsxs("div",{className:"p-10 flex items-center gap-14 w-full absolute top-0 left-0",style:s,children:[t.jsx("div",{className:"shrink-0 border rounded p-8",children:t.jsx(Ee,{className:"w-22 h-22",mime:e.mime})}),t.jsxs("div",{className:"flex-auto min-w-0 pr-10",children:[t.jsx("div",{className:"mb-2 flex items-center min-w-0 gap-10",children:t.jsx("div",{className:"flex-auto font-medium whitespace-nowrap min-w-0 overflow-hidden overflow-ellipsis",children:e.name})}),t.jsx(oo,{file:e})]}),t.jsx("div",{className:"mr-10",children:t.jsx(lo,{file:e})})]}));function oo({file:e}){const s=ie(o=>o.fileUploads.get(e.id)),n=(s==null?void 0:s.bytesUploaded)||0,r=x.useMemo(()=>We(e.size),[e]),a=x.useMemo(()=>We(n),[n]);let i;return(s==null?void 0:s.status)==="completed"?i=t.jsx(d,{message:"Upload complete"}):(s==null?void 0:s.status)==="aborted"?i=t.jsx(d,{message:"Upload cancelled"}):(s==null?void 0:s.status)==="failed"?i=t.jsx(d,{message:"Upload failed"}):i=t.jsx(d,{message:":bytesUploaded of :totalBytes",values:{bytesUploaded:a,totalBytes:r}}),t.jsx("div",{className:"text-muted text-xs",children:i})}function lo({file:e}){const s=ie(m=>m.fileUploads.get(e.id)),n=ie(m=>m.abortUpload),r=(s==null?void 0:s.percentage)||0,a=s==null?void 0:s.status,i=s==null?void 0:s.errorMessage,[o,l]=x.useState(!1),c=t.jsx(C,{size:"sm",onClick:()=>{n(e.id)},children:t.jsx(ve,{})}),u=t.jsx(xe,{"aria-label":"Upload progress",size:"sm",value:r});let h;if(a==="failed"){const m=i||f("This file could not be uploaded");h=t.jsx($e,{children:t.jsx(J,{variant:"danger",label:t.jsx(Be,{value:m}),children:t.jsx(tr,{className:"text-danger",size:"md"})})})}else a==="aborted"?h=t.jsx($e,{children:t.jsx(sr,{className:"text-warning",size:"md"})}):a==="completed"?h=t.jsx($e,{children:t.jsx(nr,{size:"md",className:"text-positive"})}):h=t.jsx($e,{onPointerEnter:m=>{m.pointerType==="mouse"&&l(!0)},onPointerLeave:m=>{m.pointerType==="mouse"&&l(!1)},children:o?c:u});return t.jsx(Q,{children:h})}function $e({children:e,...s}){return t.jsx(z.div,{...s,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function co(){const e=y(s=>s.uploadQueueIsOpen);return t.jsx(Q,{children:e&&t.jsxs(z.div,{className:"shadow-xl rounded fixed bottom-16 right-16 bg z-modal border w-375 text-sm",initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},children:[t.jsx(uo,{}),t.jsx(mo,{})]},"upload-queue")})}function uo(){const e=ie(a=>a.activeUploadsCount),s=ie(a=>a.completedUploadsCount),n=ie(a=>a.clearInactive);let r;return e?r=t.jsx(d,{message:"Uploading :count files",values:{count:e}}):s?r=t.jsx(d,{message:"Uploaded :count files",values:{count:s}}):r=t.jsx(d,{message:"No active uploads"}),t.jsxs("div",{className:"px-10 py-4 bg-alt flex items-center gap-10 justify-between border-b min-h-[45px]",children:[r,e===0?t.jsx(C,{size:"sm",onClick:()=>{p().setUploadQueueIsOpen(!1),setTimeout(()=>{n()},200)},children:t.jsx(ve,{})}):void 0]})}function mo(){const e=ie(a=>a.fileUploads),s=[...e.values()],n=x.useRef(null),r=Dr({count:e.size,getScrollElement:()=>n.current,estimateSize:()=>60,overscan:4});return t.jsx("div",{className:"max-h-320 overflow-y-auto",ref:n,children:t.jsx("div",{className:"relative w-full",style:{height:`${r.getTotalSize()}px`},children:r.getVirtualItems().map(a=>{const i=s[a.index];return t.jsx(io,{style:{height:`${a.size}px`,transform:`translateY(${a.start}px)`},file:i.file},i.file.id)})})})}const xo=""+new URL("detailed-examination-f7914cf1.svg",import.meta.url).href;function xn({entryType:e,entryName:s}){const{setRightSidenavStatus:n}=x.useContext(G);return t.jsxs("div",{className:"flex items-center gap-16 text-text-main mb-38",children:[t.jsx(Ee,{className:"w-24 h-24",type:e}),t.jsx("div",{className:"text-xl font-normal text-ellipsis flex-auto mr-auto min-w-0 break-words",children:s}),t.jsx(C,{size:"md",className:"flex-shrink-0",onClick:()=>{n("closed")},children:t.jsx(ve,{})})]})}function _t({children:e,margin:s="mb-20"}){return t.jsx("div",{className:P("text-base text-main",s),children:e})}function ho(){return F({mutationFn:e=>fo(e),onSuccess:()=>{$()},onError:e=>A(e,f("Failed to save tags."))})}function fo({entry:e,tags:s}){return E.post(`file-entries/${e.id}/sync-tags`,{tags:s.map(n=>n.name)}).then(n=>n.data)}function po(e){return pe({queryKey:["file-entry-tags",e],queryFn:()=>go(e),placeholderData:ns})}async function go(e){return E.get("file-entry-tags",{params:{query:e}}).then(s=>s.data)}function jo({entry:e}){return t.jsxs("div",{className:"mt-20 border-t pt-20",children:[t.jsx(_t,{margin:"mb-10",children:t.jsx(d,{message:"Tags"})}),t.jsx(vo,{entry:e},e.id)]})}function vo({entry:e}){const{trans:s}=K(),n=be(),r=ho(),[a,i]=x.useState(""),[o,l]=x.useState(e.tags||[]),{data:c,isLoading:u}=po(a),h=m=>{l(m),r.isPending||r.mutate({tags:m,entry:e})};return t.jsx(bt,{isAsync:!0,inputValue:a,onInputValueChange:i,suggestions:c==null?void 0:c.results,placeholder:s(f("+Add tag")),isLoading:u,chipSize:"sm",value:o,onChange:h,onChipClick:m=>{n(`/drive/search?query=${m.name}`)},children:c==null?void 0:c.results.map(m=>t.jsx(R,{value:m,children:m.name},m.id))})}function bo({entry:e}){return t.jsxs("div",{children:[t.jsx(xn,{entryType:e.type,entryName:e.name}),e.type==="image"&&t.jsx(pt,{className:"mb-20",file:e}),t.jsxs("div",{children:[t.jsx(_t,{children:t.jsx(d,{message:"Who has access"})}),t.jsxs("div",{className:"flex items-center gap-14",children:[e.workspace_id?t.jsx("div",{className:"rounded-full border w-32 h-32 flex items-center justify-center",children:t.jsx(Qr,{className:"icon-md"})}):null,e.users.map(s=>t.jsx(J,{label:s.display_name,children:t.jsx(wt,{src:s.avatar,size:"md",circle:!0})},s.id))]}),e.permissions["files.update"]&&t.jsx(D,{className:"block mt-20",variant:"link",color:"primary",onClick:()=>{p().setActiveActionDialog("share",[e])},children:t.jsx(d,{message:"Manage Access"})})]}),t.jsx(yo,{entry:e}),t.jsx(jo,{entry:e})]})}function yo({entry:e}){const s=qi(),n=be(),r=e.users.find(i=>i.owns_entry),a=x.useMemo(()=>We(e.file_size),[e.file_size]);return t.jsxs("div",{className:"mt-20 border-t pt-20",children:[t.jsx(_t,{children:t.jsx(d,{message:"Properties"})}),t.jsx(ue,{label:t.jsx(d,{message:"Type"}),value:t.jsx("span",{className:"capitalize",children:t.jsx(d,{message:e.type})})}),t.jsx(ue,{label:t.jsx(d,{message:"Size"}),value:e.file_size?a:"-"}),t.jsx(ue,{label:t.jsx(d,{message:"Location"}),value:t.jsx(D,{variant:"link",startIcon:t.jsx(St,{}),onClick:()=>{n(s?ut(s.hash):_.path)},children:s?s.name:t.jsx(d,{message:"Root"})})}),r&&t.jsx(ue,{label:t.jsx(d,{message:"Owner"}),value:r.display_name}),t.jsx(ue,{label:t.jsx(d,{message:"Modified"}),value:t.jsx(Ve,{date:e.updated_at})}),t.jsx(ue,{label:t.jsx(d,{message:"Created"}),value:t.jsx(Ve,{date:e.updated_at})})]})}function ue({label:e,value:s}){return t.jsxs("div",{className:"flex items-center mb-14",children:[t.jsx("div",{className:"w-1/3 text-xs text-muted",children:e}),t.jsx("div",{className:"w-2/3 text-sm text-main",children:s})]})}function wo({className:e}){const s=an();return t.jsx("div",{className:P(e,"bg p-18 text-sm text-muted border-l h-full overflow-y-auto"),children:s?t.jsx(bo,{entry:s}):t.jsx(ko,{})})}function ko(){return t.jsxs(x.Fragment,{children:[t.jsx(xn,{entryType:"folder",entryName:t.jsx(d,{message:"All files"})}),t.jsx(Ge,{image:t.jsx(De,{src:xo}),description:t.jsx(d,{message:"Select file or folder to see details here"})})]})}function So(e){return F({mutationFn:s=>Io(s),onSuccess:(s,n)=>{$(),N(f(":oldName renamed to :newName",{values:{oldName:n.initialName,newName:s.fileEntry.name}}))},onError:s=>Fe(s,e)})}function Io({entryId:e,...s}){return E.put(`file-entries/${e}`,s).then(n=>n.data)}function Po({entries:e}){var l;const{close:s,formId:n}=H(),r=(l=e[0])==null?void 0:l.name,a=Ce({defaultValues:{name:r}}),i=So(a),o=c=>{i.mutate({entryId:e[0].id,name:c.name,initialName:r},{onSuccess:s})};return t.jsxs(le,{children:[t.jsx(ee,{children:t.jsx(d,{message:"Rename"})}),t.jsx(te,{children:t.jsx(Me,{onSubmit:o,form:a,id:n,children:t.jsx(Ae,{placeholder:"Enter a name...","aria-label":"Entry name",autoFocus:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),t.jsxs(ge,{children:[t.jsx(D,{variant:"flat",onClick:()=>s(),children:t.jsx(d,{message:"Cancel"})}),t.jsx(D,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isPending||!a.formState.isDirty,children:t.jsx(d,{message:"Save"})})]})]})}function Eo({name:e,parentId:s}){return E.post("folders",{name:e,parentId:s===0?null:s}).then(n=>n.data)}function Do(e){return F({mutationFn:({name:s,parentId:n})=>Eo({name:s,parentId:n}),onSuccess:()=>$(),onError:s=>Fe(s,e)})}function hn({parentId:e}){const{close:s,formId:n}=H(),{trans:r}=K(),a=Ce({defaultValues:{name:r({message:"Untitled Folder"})}}),i=Do(a),o=l=>{i.mutate({...l,parentId:e},{onSuccess:c=>{s(c.folder),N(f("Folder created"))}})};return t.jsxs(le,{children:[t.jsx(ee,{children:t.jsx(d,{message:"New Folder"})}),t.jsx(te,{children:t.jsx(Me,{onSubmit:o,form:a,id:n,children:t.jsx(Ae,{placeholder:r({message:"Enter a name..."}),"aria-label":"Entry name",autoFocus:!0,autoSelectText:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),t.jsxs(ge,{children:[t.jsx(D,{variant:"flat",onClick:()=>s(),children:t.jsx(d,{message:"Cancel"})}),t.jsx(D,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isPending,children:t.jsx(d,{message:"Create"})})]})]})}function No({selectedEntry:e}){var l,c,u;const s=Lt().filter(h=>h.type!=="folder"),n=s.findIndex(h=>h.id===(e==null?void 0:e.id)),[r,a]=x.useState(n),o=!!((u=(c=(l=e==null?void 0:e.users)==null?void 0:l[1])==null?void 0:c.entry_permissions)==null?void 0:u.download);return t.jsx(bs,{allowDownload:o,headerActionsLeft:t.jsx(Fo,{activeIndex:r,entries:s}),activeIndex:r,onActiveIndexChange:a,entries:s})}function Fo({activeIndex:e,entries:s}){const n=s[e],r=Pt([n]);return!n||!r?null:t.jsxs(x.Fragment,{children:[t.jsx(C,{className:"md:hidden",onClick:()=>{r.execute()},children:x.createElement(r.icon)}),t.jsx(D,{className:"max-md:hidden",variant:"text",startIcon:x.createElement(r.icon),onClick:()=>{r.execute()},children:t.jsx(d,{...r.label})})]})}function Co({entryId:e,...s}){return E.post(`file-entries/${e}/share`,s).then(n=>n.data)}function Mo(){return F({mutationFn:e=>Co(e),onSuccess:()=>{$()},onError:e=>{var s,n;if(rr.isAxiosError(e)&&e.response){const r=e.response.data;(s=r.errors)!=null&&s.emails?N.danger((n=r.errors)==null?void 0:n.emails[0]):A(e)}}})}const Ao={edit:!0,view:!0,download:!0},me=[{key:"view",value:{view:!0,download:!1},label:f("Can view")},{key:"download",value:{view:!0,download:!0},label:f("Can Download")},{key:"edit",value:Ao,label:f("Can edit")}];function fn({value:e,onChange:s}){return t.jsxs(he,{selectedValue:e.key,selectionMode:"single",onSelectionChange:n=>{n!==e.key&&s(me.find(r=>r.key===n))},children:[t.jsx(D,{variant:"flat",color:"chip",size:"xs",endIcon:t.jsx(yt,{}),children:t.jsx(d,{...e.label})}),t.jsx(fe,{children:me.map(n=>t.jsx(R,{value:n.key,children:t.jsx(d,{...n.label})},n.key))})]})}function Lo(e){const{download:s,edit:n}=e.entry_permissions;return n?me.find(r=>r.key==="edit"):s?me.find(r=>r.key==="download"):me.find(r=>r.key==="view")}function Ro(){return F({mutationFn:e=>To(e),onSuccess:()=>{$(),N(f("Updated user permissions"))},onError:e=>A(e,f("Could not update permissions"))})}function To({entryId:e,...s}){return E.put(`file-entries/${e}/change-permissions`,s).then(n=>n.data)}function _o({user:e,...s}){var r;const{auth:n}=x.useContext(ar);return t.jsx(wt,{...s,label:e==null?void 0:e.display_name,src:e==null?void 0:e.avatar,link:(e==null?void 0:e.id)&&((r=n.getUserProfileLink)==null?void 0:r.call(n,e))})}function zo({className:e,entry:s}){if(!s)return null;const n=s.users;return t.jsxs("div",{className:P(e,"overflow-hidden"),children:[t.jsx("div",{className:"mb-14 text-sm",children:t.jsx(d,{message:"Who has access"})}),t.jsx(Q,{initial:!1,children:n.map(r=>t.jsx(Oo,{user:r,entry:s},r.id))})]})}function Oo({user:e,entry:s}){return t.jsxs(z.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"flex items-center text-sm gap-14 mb-20",children:[t.jsx(_o,{user:e,circle:!0,size:"w-44 h-44"}),t.jsxs("div",{children:[t.jsx("div",{children:e.display_name}),t.jsx("div",{className:"text-muted",children:e.email})]}),t.jsx("div",{className:"ml-auto",children:e.owns_entry?t.jsx("span",{className:"text-muted",children:t.jsx(d,{message:"Owner"})}):t.jsx($o,{user:e,entry:s})})]},e.id)}function $o({user:e,entry:s}){const n=Ro(),r=Ms(),[a,i]=x.useState(()=>Lo(e));return t.jsxs("div",{className:"flex items-center gap-10",children:[t.jsx(fn,{onChange:o=>{n.mutate({userId:e.id,permissions:o.value,entryId:s.id}),i(o)},value:a}),t.jsx(C,{onClick:()=>{r.mutate({userId:e.id,entryIds:[s.id]},{onSuccess:()=>{N(f("Member removed"))},onError:o=>A(o,f("Could not remove member"))})},children:t.jsx(ve,{})})]})}function Bo({className:e,entry:s}){var b;const{trans:n}=K(),{share:r}=mt(),a=Mo(),[i,o]=x.useState([]),[l,c]=x.useState(!1),[u,h]=x.useState(me[0]),m=i.every(k=>!k.invalid),[j,v]=x.useState(""),w=Nr("normalized-models/user",{perPage:7,query:j},{enabled:r.suggest_emails}),g=k=>k.description||k.name;return t.jsxs("div",{className:e,children:[t.jsx(bt,{value:i,onChange:o,isAsync:!0,isLoading:w.fetchStatus==="fetching",inputValue:j,onInputValueChange:v,suggestions:(b=w.data)==null?void 0:b.results,displayWith:g,validateWith:k=>{const L=!Ks(k.description);return{...k,invalid:L,errorMessage:L?n({message:"Not a valid email"}):void 0}},placeholder:n({message:"Enter email addresses"}),label:t.jsx(d,{message:"Invite people"}),children:k=>t.jsx(R,{value:k.id,startIcon:t.jsx(wt,{circle:!0,src:k.image,alt:""}),description:k.description,children:k.name})}),t.jsxs("div",{className:"mt-14 flex items-center justify-between gap-14",children:[t.jsx(fn,{onChange:h,value:u}),i.length?t.jsx(D,{variant:"flat",color:"primary",size:"sm",disabled:l||!m,onClick:()=>{c(!0),a.mutate({emails:i.map(k=>g(k)),permissions:u.value,entryId:s.id},{onSuccess:()=>{o([])},onSettled:()=>{c(!1)}})},children:t.jsx(d,{message:"Share"})}):null]}),t.jsx(zo,{className:"mt-30",entry:s})]})}function pn(e){return pe({queryKey:O.fetchEntryShareableLink(e),queryFn:()=>Wo(e),enabled:!!e})}function Wo(e){return E.get(`file-entries/${e}/shareable-link`,{params:{loader:"shareableLink"}}).then(s=>s.data)}function Vo({entryId:e}){return E.delete(`file-entries/${e}/shareable-link`).then(s=>s.data)}function Ko(){return F({mutationFn:({entryId:e})=>Vo({entryId:e}),onSuccess:(e,{entryId:s})=>{T.setQueryData(O.fetchEntryShareableLink(s),{...e,link:null})},onError:e=>A(e,f("Could not delete link"))})}function qo(e=36){let s="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<e;r+=1)s+=n.charAt(Math.floor(Math.random()*n.length));return s}function Uo({setActivePanel:e,entry:s,focusInput:n}){var c,u;const r=pn(s.id),a=!!((c=r.data)!=null&&c.link),i=Cs(),o=Ko(),l=r.isLoading||i.isPending||o.isPending;return t.jsxs("div",{children:[t.jsx("div",{className:"mb-10",children:t.jsx(d,{message:"Share link"})}),t.jsx("div",{className:"flex items-center justify-between gap-14 px-2 pb-4",children:t.jsx(kt,{checked:a,disabled:l,onChange:()=>{a?o.mutate({entryId:s.id}):i.mutate({entryId:s.id})},children:a?t.jsx(d,{message:"Shareable link is created"}):t.jsx(d,{message:"Create shareable link"})})}),t.jsx(Qo,{autoFocus:n,link:(u=r.data)==null?void 0:u.link})]})}function Qo({link:e,autoFocus:s}){const{base_url:n}=mt(),{trans:r}=K(),a=ir(),i=(e==null?void 0:e.hash)||(a==null?void 0:a.hash)||qo(),o=`${n}/drive/s/${i}`,[l,c]=or(o,{successDuration:1e3});return t.jsx(He,{autoFocus:s,disabled:!e,className:"mt-10",readOnly:!0,value:o,"aria-label":r({message:"Shareable link"}),onFocus:u=>{u.target.select()},endAppend:t.jsx(D,{className:"min-w-100",variant:"flat",color:"primary",onClick:c,children:l?t.jsx(d,{message:"Copied!"}):t.jsx(d,{message:"Copy"})})})}function Ho({entryId:e,...s}){return E.put(`file-entries/${e}/shareable-link`,s).then(n=>n.data)}function Yo(e){return F({mutationFn:s=>Ho(s),onSuccess:(s,{entryId:n})=>{T.setQueryData(O.fetchEntryShareableLink(n),s)},onError:s=>Fe(s,e)})}function Go({className:e,setActivePanel:s,entry:n}){const{formId:r}=H(),{data:a}=pn(n.id),i=a==null?void 0:a.link,o=Ce({defaultValues:{allowDownload:i==null?void 0:i.allow_download,allowEdit:i==null?void 0:i.allow_edit,expiresAt:i==null?void 0:i.expires_at,entryId:n.id}}),l=Yo(o);return t.jsxs(x.Fragment,{children:[t.jsx(ee,{onDismiss:()=>{s("main")},children:t.jsx(d,{message:"Shareable Link Settings"})}),t.jsx(te,{children:t.jsx(z.div,{className:"min-h-[335px]",animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:t.jsxs(Me,{id:r,className:e,form:o,onSubmit:c=>{l.mutate(c,{onSuccess:()=>{s("main"),N(f("Link settings saved"))}})},children:[t.jsx(Xo,{showField:!!(i!=null&&i.expires_at)}),t.jsx(Jo,{showField:!!(i!=null&&i.password)}),t.jsxs(Qe,{children:[t.jsx(d,{message:"Allow download"}),t.jsx(Gt,{name:"allowDownload",children:t.jsx(d,{message:"Users with link can download this item"})})]}),t.jsxs(Qe,{showBorder:!1,children:[t.jsx(d,{message:"Allow import"}),t.jsx(Gt,{name:"allowEdit",children:t.jsx(d,{message:"Users with link can import this item into their own drive"})})]})]})},"link-settings-content")}),t.jsxs(ge,{children:[t.jsx(D,{type:"button",onClick:()=>{s("main")},children:t.jsx(d,{message:"Cancel"})}),t.jsx(D,{type:"submit",form:r,variant:"flat",color:"primary",disabled:l.isPending,children:t.jsx(d,{message:"Save"})})]})]})}const Zo=lr(cr());function Xo({showField:e}){const{trans:s}=K(),[n,r]=x.useState(e);return t.jsxs(Qe,{children:[t.jsx(d,{message:"Link expiration"}),t.jsxs("div",{children:[t.jsx(kt,{checked:n,onChange:a=>{r(a.target.checked)},children:t.jsx(d,{message:"Link is valid until"})}),n&&t.jsx(Fr,{min:Zo,name:"expiresAt",granularity:"minute",className:"mt-20","aria-label":s({message:"Link expiration date and time"})})]})]})}function Jo({showField:e}){const{trans:s}=K(),[n,r]=x.useState(e);return t.jsxs(Qe,{children:[t.jsx(d,{message:"Password protect"}),t.jsxs("div",{children:[t.jsx(kt,{checked:n,onChange:a=>{r(a.target.checked)},children:t.jsx(d,{message:"Users will need to enter password in order to view this link"})}),n&&t.jsx(Ae,{type:"password",autoFocus:!0,name:"password",className:"mt-20","aria-label":s({message:"Link password"}),description:t.jsx(d,{message:"Password will not be requested when viewing the link as file owner."}),placeholder:s({message:"Enter new password..."})})]})]})}function Qe({children:e,showBorder:s=!0}){const[n,r]=e;return t.jsxs("div",{className:P(s&&"mb-20 border-b pb-20"),children:[t.jsx("div",{className:"mb-8 text-sm font-medium",children:n}),r]})}function ss({entry:e,focusLinkInput:s}){const{data:{fileEntry:n}}=pe({queryKey:O.fetchFileEntry(e.id),queryFn:()=>E.get(`drive/file-entries/${e.id}/model`).then(i=>i.data),initialData:{fileEntry:e}}),[r,a]=x.useState("main");return t.jsx(le,{size:"lg",children:t.jsx(Q,{initial:!1,mode:"wait",children:r==="linkSettings"?t.jsx(Go,{setActivePanel:a,entry:n},"one"):t.jsx(el,{setActivePanel:a,entry:n,focusLinkInput:s},"two")})})}function el({setActivePanel:e,entry:s,focusLinkInput:n}){return t.jsxs(x.Fragment,{children:[t.jsx(ee,{children:t.jsx(d,{message:"Share ‘:name’",values:{name:s.name}})}),t.jsx(te,{className:"relative",children:t.jsxs(z.div,{animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:[t.jsx(Bo,{className:"mb-30 border-b pb-30",entry:s}),t.jsx(Uo,{setActivePanel:e,entry:s,focusInput:!!n})]},"share-content")})]})}function tl(e,s){var Vt;const{children:n,items:r,isAsync:a,isLoading:i,openMenuOnFocus:o=!0,endAdornmentIcon:l,onItemSelected:c,maxItems:u,clearInputOnItemSelection:h,inputValue:m,selectedValue:j,onSelectionChange:v,allowCustomValue:w=!1,onInputValueChange:g,defaultInputValue:b,selectionMode:k="single",useOptionLabelAsInputValue:L,showEmptyMessage:S,floatingMaxHeight:Z,hideEndAdornment:ce=!1,blurReferenceOnItemSelection:de,isOpen:ye,onOpenChange:I,prependListbox:ne,listboxClassName:Te,onEndAdornmentClick:B,autoFocusFirstItem:re=!0,...zt}=e,et=dr({...e,floatingMaxHeight:Z,blurReferenceOnItemSelection:de,selectionMode:k,role:"listbox",virtualFocus:!0,clearSelectionOnInputClear:!0},s),{reference:gn,listboxId:jn,onInputChange:vn,state:{isOpen:_e,setIsOpen:Ot,inputValue:bn,setInputValue:yn,selectValues:$t,selectedValues:tt,setActiveCollection:wn},collection:kn}=et,Bt=tt[0]?(Vt=kn.get(tt[0]))==null?void 0:Vt.textLabel:void 0,{handleListboxSearchFieldKeydown:Sn}=xr(et),Wt=Ie(q=>{o&&!_e&&Ot(!0),q.target.select()});return t.jsx(ur,{prepend:ne,className:Te,listbox:et,mobileOverlay:mr,isLoading:i,onPointerDown:q=>{q.preventDefault()},children:t.jsx(He,{inputRef:gn,...zt,endAdornment:ce?null:t.jsx(C,{size:"md",tabIndex:-1,disabled:zt.disabled,className:"pointer-events-auto",onPointerDown:q=>{q.preventDefault(),q.stopPropagation(),B?B():(wn("all"),Ot(!_e))},children:t.jsx(Cr,{isLoading:i,icon:l})}),"aria-expanded":_e?"true":"false","aria-haspopup":"listbox","aria-controls":_e?jn:void 0,"aria-autocomplete":"list",autoComplete:"off",autoCorrect:"off",spellCheck:"false",onChange:vn,value:L&&Bt?Bt:bn,onBlur:q=>{if(w)$t(q.target.value);else if(!h){const Kt=tt[0];yn($t.length&&Kt!=null?`${Kt}`:"")}},onFocus:Wt,onClick:Wt,onKeyDown:q=>Sn(q)})})}const sl=is.forwardRef(tl);function nl({allFolders:e,onFolderSelected:s}){const{trans:n}=K(),r=n({message:"Search folders"});return t.jsx(sl,{size:"sm",maxItems:10,placeholder:r,"aria-label":r,className:"pt-20",endAdornmentIcon:t.jsx(ht,{}),items:e,clearInputOnItemSelection:!0,onItemSelected:a=>{const i=parseInt(a),o=e.find(l=>l.id===i);o&&s(o)},children:a=>t.jsx(R,{value:a.id,children:a.name},a.id)})}function rl({selectedFolder:e,allFolders:s,rootFolder:n,onFolderSelected:r}){const a=e.path.split("/").map(l=>{const c=parseInt(l);return s.find(u=>c===u.id)}).filter(l=>!!l),i=[n,...a],o=a[a.length-2];return t.jsxs("div",{className:"flex items-center gap-6 border-b pb-10",children:[t.jsx(C,{className:"flex-shrink-0",variant:"outline",size:"xs",disabled:!o&&!e.id,onClick:()=>{r(o||n)},children:t.jsx(Mr,{})}),t.jsx(It,{size:"sm",className:"flex-auto",children:i.map(l=>t.jsxs(Ue,{onSelected:()=>{r(l)},className:"flex items-center gap-8",children:[!l.id&&t.jsx(St,{className:"icon-sm"}),l.name]},l.id||"root"))})]})}const al=""+new URL("my-files-f7f7cfee.svg",import.meta.url).href;function il(e){const{onFolderSelected:s,selectedFolder:n,allFolders:r}=e,a=x.useMemo(()=>{const i=n.id||null;return r.filter(o=>o.parent_id===i)},[n.id,r]);return a.length?t.jsx(hr,{className:"h-288 overflow-y-auto",children:a.map(i=>t.jsx(fr,{className:"border-b min-h-48",onSelected:()=>{s(i)},startIcon:t.jsx(Ee,{type:"folder"}),endIcon:t.jsx(Xr,{size:"md"}),children:i.name},i.id))}):t.jsx(Ge,{size:"xs",className:"pt-64 pb-20 min-h-288",image:t.jsx(De,{src:al}),title:t.jsx(d,{message:'There are no subfolders in ":folder"',values:{folder:n.name}})})}function ol({entries:e}){const{data:s}=Ft(),n=(s==null?void 0:s.folders)||[],r=y(o=>o.activePage),[a,i]=x.useState((r==null?void 0:r.folder)||_.folder);return t.jsxs(le,{size:"lg",children:[t.jsx(ee,{children:t.jsx(d,{message:"Move [one ‘:name‘|other :count items]",values:{count:e.length,name:e[0].name}})}),t.jsxs(te,{children:[t.jsx("div",{className:"text-sm",children:t.jsx(d,{message:"Select a destination folder."})}),t.jsx(nl,{allFolders:n,onFolderSelected:i}),t.jsxs("div",{className:"mb-20 mt-40",children:[t.jsx(rl,{selectedFolder:a,allFolders:n,rootFolder:_.folder,onFolderSelected:i}),t.jsx(il,{selectedFolder:a,allFolders:n,onFolderSelected:i})]})]}),t.jsx(ll,{selectedFolder:a,setSelectedFolder:i,entries:e})]})}function ll({selectedFolder:e,setSelectedFolder:s,entries:n}){const{close:r}=H(),a=Gs();return t.jsxs(ge,{className:"border-t",startAction:t.jsxs(Ne,{type:"modal",onClose:i=>{i&&s(i)},children:[t.jsx(D,{startIcon:t.jsx(os,{}),variant:"text",children:t.jsx(d,{message:"New Folder"})}),t.jsx(hn,{parentId:e.id})]}),children:[t.jsx(D,{className:"max-md:hidden",variant:"flat",onClick:()=>r(),children:t.jsx(d,{message:"Cancel"})}),t.jsx(D,{type:"submit",variant:"flat",color:"primary",disabled:!Ct(n,e)||a.isPending,onClick:()=>{a.mutate({destinationId:e.id,entryIds:n.map(i=>i.id)},{onSuccess:r})},children:t.jsx(d,{message:"Move here"})})]})}function cl({entries:e}){const s=Re(),{close:n}=H(),r=e.length===1?t.jsx(d,{message:"‘:name‘ will be deleted forever and you won't be able to restore it.",values:{name:e[0].name}}):t.jsx(d,{message:":count items will be deleted forever and you won't be able to restore them.",values:{count:e.length}});return t.jsx(je,{isDanger:!0,title:t.jsx(d,{message:"Delete forever?"}),body:r,confirm:t.jsx(d,{message:"Delete forever"}),isLoading:s.isPending,onConfirm:()=>{s.mutate({entryIds:e.map(a=>a.id),deleteForever:!0},{onSuccess:()=>{n(),p().selectEntries([])}})}})}function dl({entries:e}){const s=As(),{close:n}=H();return t.jsx(je,{title:t.jsx(d,{message:"This folder is in your trash"}),body:t.jsx(d,{message:"To view this folder, restore it from the trash."}),confirm:t.jsx(d,{message:"Restore"}),isLoading:s.isPending,onConfirm:()=>{s.mutate({entryIds:e.map(r=>r.id)},{onSuccess:()=>{n(),p().selectEntries([])}})}})}function ul(){const e=y(n=>n.activeActionDialog),s=ml(e);return t.jsx(Ne,{type:"modal",isOpen:!!s,onClose:()=>{p().setActiveActionDialog(null)},children:s})}function ml(e){var s;switch(e==null?void 0:e.name){case"rename":return t.jsx(Po,{entries:e.entries});case"newFolder":return t.jsx(hn,{parentId:(s=e.entries[0])==null?void 0:s.id});case"preview":return t.jsx(No,{selectedEntry:e.entries[0]});case"share":return t.jsx(ss,{entry:e.entries[0]});case"getLink":return t.jsx(ss,{entry:e.entries[0],focusLinkInput:!0});case"moveTo":return t.jsx(ol,{entries:e.entries});case"confirmAndDeleteForever":return t.jsx(cl,{entries:e.entries});case"trashFolderBlock":return t.jsx(dl,{entries:e.entries});default:return null}}function xl(e){const s=x.useRef(e),n=x.useId();x.useEffect(()=>(Zt.set(n,s.current),()=>{Zt.delete(n)}),[n])}function hl(){const e=x.useRef(null),[s,n]=x.useState(),[r,a]=x.useState({});xl({type:"fileEntry",onDragStart:(o,l)=>{const c=l;c&&(a({entries:c.getData(),e:o,draggingTreeItem:Ei(c.id)}),n({start:o}))},onDragMove:o=>{a(l=>({...l,e:o})),n(l=>({...l,end:o}))},onDragEnd:(o,l,c)=>{a({status:c})}});let i=null;return r.entries&&r.e&&(i=t.jsx("div",{ref:e,style:r.e?{transform:`translate(${r.e.x}px, ${r.e.y}px)`,width:`${r.e.rect.width}px`}:void 0,className:"fixed isolate left-0 top-0 pointer-events-none",children:r.entries.map((o,l)=>t.jsx(fl,{index:l,entry:o,points:s,state:r},o.id))})),t.jsx(Q,{custom:r.status,children:i})}const fl=x.memo(({entry:e,points:s,index:n,state:r})=>{var h,m,j,v;const a=y(w=>w.viewMode),i=r.draggingTreeItem?Mt(e):e.id,o=Ss.get(i);if(!(o!=null&&o.rect)||!(s!=null&&s.start))return null;const l=o.rect,c=((h=r.entries)==null?void 0:h.length)||0,u=w=>{var g,b,k;return w==="dropSuccess"?{x:0,y:0,opacity:0,transition:{duration:.1,delay:0}}:{x:l.left-(((g=s.end)==null?void 0:g.x)||0),y:l.top-(((b=s.end)==null?void 0:b.y)||0),width:`${(k=r.e)==null?void 0:k.rect.width}px`}};return t.jsxs(z.div,{transition:{delay:.01*n,bounce:0,duration:.2},initial:{x:l.left-s.start.x,y:l.top-s.start.y,width:`${(m=r.e)==null?void 0:m.rect.width}px`},animate:{x:0,y:0,width:a==="list"?288:void 0},exit:u,style:{width:a==="grid"?`${(j=r.e)==null?void 0:j.rect.width}px`:void 0,height:`${(v=r.e)==null?void 0:v.rect.height}px`},className:P("absolute bg-paper whitespace-nowrap rounded border border-primary-light max-h-48",n<2&&"shadow",n===0&&"z-10 top-0 left-0",n>0&&"top-6 left-6"),children:[c>1&&n===0&&t.jsx(pl,{count:c}),t.jsxs("div",{className:"text-sm h-full flex justify-center items-center px-16 gap-10 bg-primary-light/20 overflow-hidden",children:[t.jsx(Ee,{type:e.type}),t.jsx("div",{className:"flex-auto text-ellipsis overflow-hidden",children:e.name})]})]},e.id)}),pl=x.memo(({count:e})=>t.jsx(z.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.1}},exit:{opacity:0},transition:{duration:.1},className:"absolute -top-6 shadow-lg -right-6 z-30 rounded-full bg-danger text-white w-20 h-20 flex items-center justify-center text-sm font-bold z-10",children:e},"entryCount"));function gl(){const{isMobileMode:e}=x.useContext(G),s=y(n=>n.activePage);return t.jsxs(Dt,{className:"px-8 md:px-26 py-4 mt-20 flex items-center gap-20 h-60",children:[e?t.jsx(un,{isDisabled:s==null?void 0:s.disableSort}):t.jsx(mn,{}),t.jsxs("div",{className:"ml-auto flex items-center gap-2",children:[t.jsx(jl,{}),t.jsx(vl,{})]})]})}function jl(){const e=y(s=>s.viewMode);return t.jsxs("div",{className:"flex gap-2",children:[t.jsx(J,{label:t.jsx(d,{message:"Grid view"}),children:t.jsx(C,{size:"md",onClick:()=>{p().setViewMode("grid")},className:P(e==="grid"?"text-gray-200 dark:text-gray-200":"text-black dark:text-white"),children:t.jsx(Hr,{})})}),t.jsx(J,{label:t.jsx(d,{message:"List view"}),children:t.jsx(C,{size:"md",onClick:()=>{p().setViewMode("list")},className:P(e==="list"?"text-gray-200 dark:text-gray-200":"text-black dark:text-white"),children:t.jsx(Yr,{})})})]})}function vl(){const{rightSidenavStatus:e,setRightSidenavStatus:s}=x.useContext(G),n=e?t.jsx(d,{message:"Hide details"}):t.jsx(d,{message:"Show details"});return t.jsx(J,{label:n,children:t.jsx(C,{size:"md",color:e==="open"?"primary":null,onClick:()=>{s(e==="open"?"closed":"open")},children:t.jsx(Gr,{})})})}function ae(){const{pathname:e}=at(),{hash:s}=rt(),{workspaceId:n}=Y(),r=y(i=>i.activePage);x.useEffect(()=>{p().setActivePage(pr.find(i=>i.path===e)||gr(s))},[e,s]);const a=x.useMemo(()=>({workspaceId:n}),[n]);return x.useEffect(()=>()=>{p().reset()},[]),t.jsxs(x.Fragment,{children:[(r==null?void 0:r.label)&&t.jsx(ps,{children:t.jsx(d,{message:typeof r.label=="string"?r.label:r.label.message})}),t.jsxs(dt,{children:[t.jsx(ws.Provider,{value:a,children:t.jsxs(lt,{name:"drive",onDragOver:i=>{i.preventDefault(),i.stopPropagation(),i.dataTransfer.dropEffect="none"},onDrop:i=>{i.preventDefault()},children:[t.jsx(bl,{}),t.jsx(st,{position:"left",size:"md",children:t.jsx(sn,{})}),t.jsx(gl,{}),t.jsx(ys,{children:t.jsx(ro,{})}),t.jsx(co,{}),t.jsx(ul,{}),t.jsx(st,{position:"right",size:"lg",children:t.jsx(wo,{})})]})}),t.jsx(hl,{})]})]})}function bl(){const{isMobileMode:e}=x.useContext(G),s=y(i=>i.activePage),n=e?null:t.jsx(gs,{}),r=t.jsx(C,{elementType:xs,to:Pe.path,children:t.jsx(ht,{})}),a=t.jsxs(x.Fragment,{children:[s!==Pe&&r,t.jsx(ft,{isCompact:!0})]});return t.jsxs(x.Fragment,{children:[t.jsx(ct,{rightChildren:e&&a,menuPosition:"drive-navbar",children:n}),e&&t.jsx(yl,{})]})}function yl(){const e=y(s=>s.selectedEntries.size);return e?t.jsxs("div",{className:"fixed right-0 top-0 z-10 flex h-54 w-full items-center justify-center gap-10 rounded bg-primary px-6 text-on-primary shadow-xl",children:[t.jsx(C,{onClick:()=>{p().selectEntries([])},children:t.jsx(ve,{})}),t.jsx(d,{message:":count selected",values:{count:e}}),t.jsx(on,{className:"ml-auto"})]}):null}function wl(){return x.useContext(G),y(e=>e.activePage),t.jsxs(Dt,{className:"px-8 md:px-26 py-4 mt-20 flex items-center gap-20 h-60",children:[t.jsx("li",{className:"relative inline-flex min-w-0 flex-shrink-0 items-center justify-start text-lg",children:t.jsx("div",{className:"ml-16 cursor-pointer overflow-hidden whitespace-nowrap rounded px-8 py-4 font-semibold text-bg-600 hover:bg-hover",children:"Workspace"})}),t.jsx("div",{className:"ml-auto flex items-center gap-2"})]})}function kl(){at();const{workspaceId:e}=Y(),s=y(n=>n.activePage);return x.useMemo(()=>({workspaceId:e}),[e]),x.useEffect(()=>()=>{p().reset()},[]),t.jsxs(x.Fragment,{children:[(s==null?void 0:s.label)&&t.jsx(ps,{children:t.jsx(d,{message:typeof s.label=="string"?s.label:s.label.message})}),t.jsx(dt,{children:t.jsxs(lt,{name:"workspace",onDragOver:n=>{n.preventDefault(),n.stopPropagation(),n.dataTransfer.dropEffect="none"},onDrop:n=>{n.preventDefault()},children:[t.jsx(Sl,{}),t.jsx(st,{position:"left",size:"md",children:t.jsx(sn,{})}),t.jsx(wl,{}),t.jsx(ji,{})]})})]})}function Sl(){const{isMobileMode:e}=x.useContext(G);y(r=>r.activePage);const s=e?null:t.jsx(gs,{}),n=t.jsx(x.Fragment,{children:t.jsx(ft,{isCompact:!0})});return t.jsx(x.Fragment,{children:t.jsx(ct,{rightChildren:e&&n,menuPosition:"workspace-navbar",children:s})})}const Il=[{path:"/",element:t.jsx(X,{children:t.jsx(ae,{})})},{path:"/folders/:hash",element:t.jsx(X,{children:t.jsx(ae,{})})},{path:"/shares",element:t.jsx(X,{children:t.jsx(ae,{})})},{path:"/recent",element:t.jsx(X,{children:t.jsx(ae,{})})},{path:"/starred",element:t.jsx(X,{children:t.jsx(ae,{})})},{path:"/trash",element:t.jsx(X,{children:t.jsx(ae,{})})},{path:"/search",element:t.jsx(X,{children:t.jsx(ae,{})})},{path:"/workspace",element:t.jsx(X,{children:t.jsx(kl,{})})},{path:"s/:hash",element:t.jsx(Ka,{})},{path:"*",element:t.jsx(ds,{})}];function Fl(){return jr(Il)}export{Fl as default};
//# sourceMappingURL=drive-routes-45d138fc.js.map
